{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee","passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee"}},"code":"function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nmodule.export({\n  TAPi18nClient: function () {\n    return TAPi18nClient;\n  }\n});\nvar TAPi18nBase;\nmodule.link(\"./tap_i18n-common\", {\n  TAPi18nBase: function (v) {\n    TAPi18nBase = v;\n  }\n}, 0);\nvar globals;\nmodule.link(\"./globals\", {\n  globals: function (v) {\n    globals = v;\n  }\n}, 1);\nvar indexOf = [].indexOf;\n\nvar TAPi18nClient = function () {\n  var TAPi18nClient =\n  /*#__PURE__*/\n  function (_TAPi18nBase) {\n    _inheritsLoose(TAPi18nClient, _TAPi18nBase);\n\n    function TAPi18nClient() {\n      return _TAPi18nBase.apply(this, arguments) || this;\n    }\n\n    var _proto = TAPi18nClient.prototype;\n\n    _proto._getLanguageFilePath = function () {\n      function _getLanguageFilePath(lang_tag) {\n        var path;\n\n        if (!this._enabled()) {\n          return null;\n        }\n\n        path = this.conf.cdn_path != null ? this.conf.cdn_path : this.conf.i18n_files_route;\n        path = path.replace(/\\/$/, \"\");\n\n        if (Meteor.isCordova && path[0] === \"/\") {\n          path = Meteor.absoluteUrl().replace(/\\/+$/, \"\") + path;\n        }\n\n        return path + \"/\" + lang_tag + \".json\";\n      }\n\n      return _getLanguageFilePath;\n    }();\n\n    _proto._loadLanguage = function () {\n      function _loadLanguage(languageTag) {\n        var _this = this;\n\n        var dependencyLoadDfd, dfd, directDependencyLanguageTag, loadLanguageTag, project_languages; // Load languageTag and its dependencies languages to TAPi18next if we\n        // haven't loaded them already.\n        // languageTag dependencies languages are:\n        // * The base language if languageTag is a dialect.\n        // * The fallback language (en) if we haven't loaded it already.\n        // Returns a deferred object that resolves with no arguments if all files\n        // loaded successfully to TAPi18next and rejects with array of error\n        // messages otherwise\n        // Example:\n        // TAPi18n._loadLanguage(\"pt-BR\")\n        //   .done(function () {\n        //     console.log(\"languageLoaded successfully\");\n        //   })\n        //   .fail(function (messages) {\n        //     console.log(\"Couldn't load languageTag\", messages);\n        //   })\n        // The above example will attempt to load pt-BR, pt and en\n\n        dfd = new $.Deferred();\n\n        if (!this._enabled()) {\n          return dfd.reject(\"tap-i18n is not enabled in the project level, check tap-i18n README\");\n        }\n\n        project_languages = this._getProjectLanguages();\n\n        if (indexOf.call(project_languages, languageTag) >= 0) {\n          if (indexOf.call(this._loaded_languages, languageTag) < 0) {\n            loadLanguageTag = function () {\n              var jqXHR;\n              jqXHR = $.getJSON(_this._getLanguageFilePath(languageTag));\n              jqXHR.done(function (data) {\n                _this._loadLangFileObject(languageTag, data);\n\n                _this._loaded_languages.push(languageTag);\n\n                return dfd.resolve();\n              });\n              return jqXHR.fail(function (xhr, error_code) {\n                return dfd.reject(\"Couldn't load language '\" + languageTag + \"' JSON: \" + error_code);\n              });\n            };\n\n            directDependencyLanguageTag = indexOf.call(languageTag, \"-\") >= 0 ? languageTag.replace(/-.*/, \"\") : this._fallback_language; // load dependency language if it is part of the project and not the fallback language\n\n            if (languageTag !== this._fallback_language && indexOf.call(project_languages, directDependencyLanguageTag) >= 0) {\n              dependencyLoadDfd = this._loadLanguage(directDependencyLanguageTag);\n              dependencyLoadDfd.done(function () {\n                // All dependencies loaded successfully\n                return loadLanguageTag();\n              });\n              dependencyLoadDfd.fail(function (message) {\n                return dfd.reject(\"Loading process failed since dependency language '\" + directDependencyLanguageTag + \"' failed to load: \" + message);\n              });\n            } else {\n              loadLanguageTag();\n            }\n          } else {\n            // languageTag loaded already\n            dfd.resolve();\n          }\n        } else {\n          dfd.reject([\"Language \" + languageTag + \" is not supported\"]);\n        }\n\n        return dfd.promise();\n      }\n\n      return _loadLanguage;\n    }();\n\n    _proto._registerHelpers = function () {\n      function _registerHelpers(package_name, template) {\n        var _this2 = this;\n\n        var helpers, tapI18nextProxy, underscore_helper;\n\n        if (package_name !== globals.project_translations_domain) {\n          tapI18nextProxy = this._getPackageI18nextProxy(this.packages[package_name].namespace);\n        } else {\n          tapI18nextProxy = this._getPackageI18nextProxy(globals.project_translations_domain);\n        }\n\n        underscore_helper = function (key) {\n          var options;\n\n          for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n            args[_key - 1] = arguments[_key];\n          }\n\n          options = args.pop().hash;\n\n          if (!_.isEmpty(args)) {\n            options.sprintf = args;\n          }\n\n          return tapI18nextProxy(key, options);\n        }; // template specific helpers\n\n\n        if (package_name !== globals.project_translations_domain) {\n          // {{_ }}\n          if (Template[template] != null && Template[template].helpers != null) {\n            helpers = {};\n            helpers[this.packages[package_name].helper_name] = underscore_helper;\n            Template[template].helpers(helpers);\n          }\n        } else {\n          // {{_ }}\n          // global helpers\n          UI.registerHelper(this.conf.helper_name, underscore_helper); // {{languageTag}}\n\n          UI.registerHelper(\"languageTag\", function () {\n            return _this2.getLanguage();\n          });\n        }\n      }\n\n      return _registerHelpers;\n    }();\n\n    _proto._getRegisterHelpersProxy = function () {\n      function _getRegisterHelpersProxy(package_name) {\n        var _this3 = this;\n\n        // A proxy to _registerHelpers where the package_name is fixed to package_name\n        return function (template) {\n          return _this3._registerHelpers(package_name, template);\n        };\n      }\n\n      return _getRegisterHelpersProxy;\n    }();\n\n    _proto._prepareLanguageSpecificTranslator = function () {\n      function _prepareLanguageSpecificTranslator(lang_tag) {\n        var _this4 = this;\n\n        var dfd;\n        dfd = new $.Deferred().resolve().promise();\n\n        if (lang_tag in this._languageSpecificTranslatorsTrackers) {\n          return dfd;\n        }\n\n        this._languageSpecificTranslatorsTrackers[lang_tag] = new Tracker.Dependency();\n\n        if (!(lang_tag in this._languageSpecificTranslators)) {\n          dfd = this._loadLanguage(lang_tag).done(function () {\n            _this4._languageSpecificTranslators[lang_tag] = _this4._getSpecificLangTranslator(lang_tag);\n            return _this4._languageSpecificTranslatorsTrackers[lang_tag].changed();\n          });\n        }\n\n        return dfd;\n      }\n\n      return _prepareLanguageSpecificTranslator;\n    }();\n\n    _proto._getPackageI18nextProxy = function () {\n      function _getPackageI18nextProxy(package_name) {\n        var _this5 = this;\n\n        // A proxy to TAPi18next.t where the namespace is preset to the package's\n        return function (key, options) {\n          var lang_tag = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n          // Devs get confused and use lang option instead of lng option, make lang\n          // alias of lng\n          if ((options != null ? options.lang : void 0) != null && (options != null ? options.lng : void 0) == null) {\n            options.lng = options.lang;\n          }\n\n          if ((options != null ? options.lng : void 0) != null && lang_tag == null) {\n            lang_tag = options.lng; // Remove options.lng so we won't pass it to the regular TAPi18next\n            // before the language specific translator is ready to keep behavior\n            // consistent.\n            // If lang is actually ready before the language specifc translator is\n            // ready, TAPi18next will translate to lang_tag if we won't remove\n            // options.lng.\n\n            delete options.lng;\n          }\n\n          if (lang_tag != null) {\n            _this5._prepareLanguageSpecificTranslator(lang_tag);\n\n            _this5._languageSpecificTranslatorsTrackers[lang_tag].depend();\n\n            if (lang_tag in _this5._languageSpecificTranslators) {\n              return _this5._languageSpecificTranslators[lang_tag](_this5._getPackageDomain(package_name) + \":\" + key, options);\n            } else {\n              return TAPi18next.t(_this5._getPackageDomain(package_name) + \":\" + key, options);\n            }\n          } // If inside a reactive computation, we want to invalidate the computation if the client lang changes\n\n\n          _this5._language_changed_tracker.depend();\n\n          return TAPi18next.t(_this5._getPackageDomain(package_name) + \":\" + key, options);\n        };\n      }\n\n      return _getPackageI18nextProxy;\n    }();\n\n    _proto._onceEnabled = function () {\n      function _onceEnabled() {\n        return this._registerHelpers(globals.project_translations_domain);\n      }\n\n      return _onceEnabled;\n    }();\n\n    _proto.setLanguage = function () {\n      function setLanguage(lang_tag) {\n        var _this6 = this;\n\n        var isAborted, self;\n        self = this;\n\n        if (typeof this._abortPreviousSetLang === \"function\") {\n          this._abortPreviousSetLang();\n        }\n\n        isAborted = false;\n\n        this._abortPreviousSetLang = function () {\n          return isAborted = true;\n        };\n\n        return this._loadLanguage(lang_tag).then(function () {\n          if (!isAborted) {\n            TAPi18next.setLng(lang_tag);\n\n            _this6._language_changed_tracker.changed();\n\n            return Session.set(_this6._loaded_lang_session_key, lang_tag);\n          }\n        });\n      }\n\n      return setLanguage;\n    }();\n\n    _proto.getLanguage = function () {\n      function getLanguage() {\n        var session_lang;\n\n        if (!this._enabled()) {\n          return null;\n        }\n\n        session_lang = Session.get(this._loaded_lang_session_key);\n\n        if (session_lang != null) {\n          return session_lang;\n        } else {\n          return this._fallback_language;\n        }\n      }\n\n      return getLanguage;\n    }();\n\n    return TAPi18nClient;\n  }(TAPi18nBase);\n\n  ;\n  TAPi18nClient.prototype._languageSpecificTranslators = null;\n  TAPi18nClient.prototype._languageSpecificTranslatorsTrackers = null;\n  TAPi18nClient.prototype._abortPreviousSetLang = null;\n  return TAPi18nClient;\n}.call(this);","map":{"version":3,"sources":["packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee"],"names":["module","export","TAPi18nClient","TAPi18nBase","link","v","globals","indexOf","_getLanguageFilePath","lang_tag","path","_enabled","conf","cdn_path","i18n_files_route","replace","Meteor","isCordova","absoluteUrl","_loadLanguage","languageTag","dependencyLoadDfd","dfd","directDependencyLanguageTag","loadLanguageTag","project_languages","$","Deferred","reject","_getProjectLanguages","call","_loaded_languages","jqXHR","getJSON","done","data","_loadLangFileObject","push","resolve","fail","xhr","error_code","_fallback_language","message","promise","_registerHelpers","package_name","template","helpers","tapI18nextProxy","underscore_helper","project_translations_domain","_getPackageI18nextProxy","packages","namespace","key","options","args","pop","hash","_","isEmpty","sprintf","Template","helper_name","UI","registerHelper","getLanguage","_getRegisterHelpersProxy","_prepareLanguageSpecificTranslator","_languageSpecificTranslatorsTrackers","Tracker","Dependency","_languageSpecificTranslators","_getSpecificLangTranslator","changed","lang","lng","depend","_getPackageDomain","TAPi18next","t","_language_changed_tracker","_onceEnabled","setLanguage","isAborted","self","_abortPreviousSetLang","then","setLng","Session","set","_loaded_lang_session_key","session_lang","get","prototype"],"mappings":"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","sourcesContent":["var indexOf = [].indexOf;\n\nimport {\n  TAPi18nBase\n} from './tap_i18n-common';\n\nimport {\n  globals\n} from './globals';\n\nexport var TAPi18nClient = (function() {\n  class TAPi18nClient extends TAPi18nBase {\n    _getLanguageFilePath(lang_tag) {\n      var path;\n      if (!this._enabled()) {\n        return null;\n      }\n      path = this.conf.cdn_path != null ? this.conf.cdn_path : this.conf.i18n_files_route;\n      path = path.replace(/\\/$/, \"\");\n      if (Meteor.isCordova && path[0] === \"/\") {\n        path = Meteor.absoluteUrl().replace(/\\/+$/, \"\") + path;\n      }\n      return `${path}/${lang_tag}.json`;\n    }\n\n    _loadLanguage(languageTag) {\n      var dependencyLoadDfd, dfd, directDependencyLanguageTag, loadLanguageTag, project_languages;\n      // Load languageTag and its dependencies languages to TAPi18next if we\n      // haven't loaded them already.\n\n      // languageTag dependencies languages are:\n      // * The base language if languageTag is a dialect.\n      // * The fallback language (en) if we haven't loaded it already.\n\n      // Returns a deferred object that resolves with no arguments if all files\n      // loaded successfully to TAPi18next and rejects with array of error\n      // messages otherwise\n\n      // Example:\n      // TAPi18n._loadLanguage(\"pt-BR\")\n      //   .done(function () {\n      //     console.log(\"languageLoaded successfully\");\n      //   })\n      //   .fail(function (messages) {\n      //     console.log(\"Couldn't load languageTag\", messages);\n      //   })\n\n      // The above example will attempt to load pt-BR, pt and en\n      dfd = new $.Deferred();\n      if (!this._enabled()) {\n        return dfd.reject(\"tap-i18n is not enabled in the project level, check tap-i18n README\");\n      }\n      project_languages = this._getProjectLanguages();\n      if (indexOf.call(project_languages, languageTag) >= 0) {\n        if (indexOf.call(this._loaded_languages, languageTag) < 0) {\n          loadLanguageTag = () => {\n            var jqXHR;\n            jqXHR = $.getJSON(this._getLanguageFilePath(languageTag));\n            jqXHR.done((data) => {\n              this._loadLangFileObject(languageTag, data);\n              this._loaded_languages.push(languageTag);\n              return dfd.resolve();\n            });\n            return jqXHR.fail((xhr, error_code) => {\n              return dfd.reject(`Couldn't load language '${languageTag}' JSON: ${error_code}`);\n            });\n          };\n          directDependencyLanguageTag = indexOf.call(languageTag, \"-\") >= 0 ? languageTag.replace(/-.*/, \"\") : this._fallback_language;\n          // load dependency language if it is part of the project and not the fallback language\n          if (languageTag !== this._fallback_language && indexOf.call(project_languages, directDependencyLanguageTag) >= 0) {\n            dependencyLoadDfd = this._loadLanguage(directDependencyLanguageTag);\n            dependencyLoadDfd.done(() => {\n              // All dependencies loaded successfully\n              return loadLanguageTag();\n            });\n            dependencyLoadDfd.fail((message) => {\n              return dfd.reject(`Loading process failed since dependency language '${directDependencyLanguageTag}' failed to load: ` + message);\n            });\n          } else {\n            loadLanguageTag();\n          }\n        } else {\n          // languageTag loaded already\n          dfd.resolve();\n        }\n      } else {\n        dfd.reject([`Language ${languageTag} is not supported`]);\n      }\n      return dfd.promise();\n    }\n\n    _registerHelpers(package_name, template) {\n      var helpers, tapI18nextProxy, underscore_helper;\n      if (package_name !== globals.project_translations_domain) {\n        tapI18nextProxy = this._getPackageI18nextProxy(this.packages[package_name].namespace);\n      } else {\n        tapI18nextProxy = this._getPackageI18nextProxy(globals.project_translations_domain);\n      }\n      underscore_helper = function(key, ...args) {\n        var options;\n        options = (args.pop()).hash;\n        if (!_.isEmpty(args)) {\n          options.sprintf = args;\n        }\n        return tapI18nextProxy(key, options);\n      };\n      // template specific helpers\n      if (package_name !== globals.project_translations_domain) {\n        // {{_ }}\n        if ((Template[template] != null) && (Template[template].helpers != null)) {\n          helpers = {};\n          helpers[this.packages[package_name].helper_name] = underscore_helper;\n          Template[template].helpers(helpers);\n        }\n      } else {\n        // {{_ }}\n        // global helpers\n        UI.registerHelper(this.conf.helper_name, underscore_helper);\n        // {{languageTag}}\n        UI.registerHelper(\"languageTag\", () => {\n          return this.getLanguage();\n        });\n      }\n    }\n\n    _getRegisterHelpersProxy(package_name) {\n      // A proxy to _registerHelpers where the package_name is fixed to package_name\n      return (template) => {\n        return this._registerHelpers(package_name, template);\n      };\n    }\n\n    _prepareLanguageSpecificTranslator(lang_tag) {\n      var dfd;\n      dfd = (new $.Deferred()).resolve().promise();\n      if (lang_tag in this._languageSpecificTranslatorsTrackers) {\n        return dfd;\n      }\n      this._languageSpecificTranslatorsTrackers[lang_tag] = new Tracker.Dependency;\n      if (!(lang_tag in this._languageSpecificTranslators)) {\n        dfd = this._loadLanguage(lang_tag).done(() => {\n          this._languageSpecificTranslators[lang_tag] = this._getSpecificLangTranslator(lang_tag);\n          return this._languageSpecificTranslatorsTrackers[lang_tag].changed();\n        });\n      }\n      return dfd;\n    }\n\n    _getPackageI18nextProxy(package_name) {\n      // A proxy to TAPi18next.t where the namespace is preset to the package's\n      return (key, options, lang_tag = null) => {\n        // Devs get confused and use lang option instead of lng option, make lang\n        // alias of lng\n        if (((options != null ? options.lang : void 0) != null) && ((options != null ? options.lng : void 0) == null)) {\n          options.lng = options.lang;\n        }\n        if (((options != null ? options.lng : void 0) != null) && (lang_tag == null)) {\n          lang_tag = options.lng;\n          // Remove options.lng so we won't pass it to the regular TAPi18next\n          // before the language specific translator is ready to keep behavior\n          // consistent.\n\n          // If lang is actually ready before the language specifc translator is\n          // ready, TAPi18next will translate to lang_tag if we won't remove\n          // options.lng.\n          delete options.lng;\n        }\n        if (lang_tag != null) {\n          this._prepareLanguageSpecificTranslator(lang_tag);\n          this._languageSpecificTranslatorsTrackers[lang_tag].depend();\n          if (lang_tag in this._languageSpecificTranslators) {\n            return this._languageSpecificTranslators[lang_tag](`${this._getPackageDomain(package_name)}:${key}`, options);\n          } else {\n            return TAPi18next.t(`${this._getPackageDomain(package_name)}:${key}`, options);\n          }\n        }\n        // If inside a reactive computation, we want to invalidate the computation if the client lang changes\n        this._language_changed_tracker.depend();\n        return TAPi18next.t(`${this._getPackageDomain(package_name)}:${key}`, options);\n      };\n    }\n\n    _onceEnabled() {\n      return this._registerHelpers(globals.project_translations_domain);\n    }\n\n    setLanguage(lang_tag) {\n      var isAborted, self;\n      self = this;\n      if (typeof this._abortPreviousSetLang === \"function\") {\n        this._abortPreviousSetLang();\n      }\n      isAborted = false;\n      this._abortPreviousSetLang = function() {\n        return isAborted = true;\n      };\n      return this._loadLanguage(lang_tag).then(() => {\n        if (!isAborted) {\n          TAPi18next.setLng(lang_tag);\n          this._language_changed_tracker.changed();\n          return Session.set(this._loaded_lang_session_key, lang_tag);\n        }\n      });\n    }\n\n    getLanguage() {\n      var session_lang;\n      if (!this._enabled()) {\n        return null;\n      }\n      session_lang = Session.get(this._loaded_lang_session_key);\n      if (session_lang != null) {\n        return session_lang;\n      } else {\n        return this._fallback_language;\n      }\n    }\n\n  };\n\n  TAPi18nClient.prototype._languageSpecificTranslators = null;\n\n  TAPi18nClient.prototype._languageSpecificTranslatorsTrackers = null;\n\n  TAPi18nClient.prototype._abortPreviousSetLang = null;\n\n  return TAPi18nClient;\n\n}).call(this);\n"]},"sourceType":"script","hash":"9c27251f4fed452b382a07f70f465cb8ae4d1aa0"}
