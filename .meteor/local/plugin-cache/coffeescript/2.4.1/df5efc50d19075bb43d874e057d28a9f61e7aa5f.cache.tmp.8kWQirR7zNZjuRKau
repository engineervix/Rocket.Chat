{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nmodule.export({\n  TAPi18nBase: () => TAPi18nBase\n});\nlet TAPi18next;\nmodule.link(\"../tap_i18next/tap_i18next-1.7.3.js\", {\n  default(v) {\n    TAPi18next = v;\n  }\n\n}, 0);\nlet globals;\nmodule.link(\"./globals\", {\n  globals(v) {\n    globals = v;\n  }\n\n}, 1);\nvar fallback_language;\nfallback_language = globals.fallback_language;\nTAPi18next.init({\n  resStore: {},\n  fallbackLng: globals.fallback_language,\n  useCookie: false\n});\n\nvar TAPi18nBase = function () {\n  class TAPi18nBase extends EventEmitter {\n    constructor() {\n      super();\n      this._fallback_language = fallback_language;\n      this._language_changed_tracker = new Tracker.Dependency();\n      this._loaded_languages = [fallback_language]; // stores the loaded languages, the fallback language is loaded automatically\n\n      this.conf = null; // If conf isn't null we assume that tap:i18n is enabled for the project.\n      // We assume conf is valid, we sterilize and validate it during the build process.\n\n      this.packages = {}; // Stores the packages' package-tap.i18n jsons\n\n      this.languages_names = {}; // Stores languages that we've found languages files for in the project dir.\n      // format:\n      // {\n      //    lang_tag: [lang_name_in_english, lang_name_in_local_language]\n      // }\n\n      this.translations = {}; // Stores the packages/project translations - Server side only\n      // fallback_language translations are not stored here\n\n      if (Meteor.isClient) {\n        Session.set(this._loaded_lang_session_key, null);\n        this._languageSpecificTranslators = {};\n        this._languageSpecificTranslatorsTrackers = {};\n      }\n\n      if (Meteor.isServer) {\n        this.server_translators = {};\n        Meteor.startup(() => {\n          // If tap-i18n is enabled for that project\n          if (this._enabled()) {\n            return this._registerHTTPMethod();\n          }\n        });\n      }\n\n      this.__ = this._getPackageI18nextProxy(globals.project_translations_domain);\n      TAPi18next.setLng(fallback_language);\n    }\n\n    _enable(conf) {\n      // tap:i18n gets enabled for a project once a conf file is set for it.\n      // It can be either a conf object that was set by project-tap.i18n file or\n      // a default conf, which is being added if the project has lang files\n      // (*.i18n.json) but not project-tap.i18n\n      this.conf = conf;\n      return this._onceEnabled();\n    }\n\n    _onceEnabled() {} // The arch specific code can use this for procedures that should be performed once\n    // tap:i18n gets enabled (project conf file is being set)\n\n\n    _enabled() {\n      // read the comment of @conf\n      return this.conf != null;\n    }\n\n    _getPackageDomain(package_name) {\n      return package_name.replace(/:/g, \"-\");\n    }\n\n    addResourceBundle(lang_tag, package_name, translations) {\n      return TAPi18next.addResourceBundle(lang_tag, this._getPackageDomain(package_name), translations);\n    }\n\n    _getSpecificLangTranslator(lang) {\n      var current_lang, translator;\n      current_lang = TAPi18next.lng();\n      translator = null;\n      TAPi18next.setLng(lang, {\n        fixLng: true\n      }, lang_translator => {\n        return translator = lang_translator;\n      }); // Restore i18next lang that had been changed in the process of generating\n      // lang specific translator\n\n      TAPi18next.setLng(current_lang);\n      return translator;\n    }\n\n    _getProjectLanguages() {\n      // Return an array of languages available for the current project\n      if (this._enabled()) {\n        if (_.isArray(this.conf.supported_languages)) {\n          return _.union([this._fallback_language], this.conf.supported_languages);\n        } else {\n          // If supported_languages is null, all the languages we found\n          // translations files to in the project level are considered supported.\n          // We use the @.languages_names array to tell which languages we found\n          // since for every i18n.json file we found in the project level we add\n          // an entry for its language to @.languages_names in the build process.\n          // We also know for certain that when tap-i18n is enabled the fallback\n          // lang is in @.languages_names\n          return _.keys(this.languages_names);\n        }\n      } else {\n        return [this._fallback_language];\n      }\n    }\n\n    getLanguages() {\n      var i, lang_tag, languages, len, ref;\n\n      if (!this._enabled()) {\n        return null;\n      }\n\n      languages = {};\n      ref = this._getProjectLanguages();\n\n      for (i = 0, len = ref.length; i < len; i++) {\n        lang_tag = ref[i];\n        languages[lang_tag] = {\n          name: this.languages_names[lang_tag][1],\n          en: this.languages_names[lang_tag][0]\n        };\n      }\n\n      return languages;\n    }\n\n    _loadLangFileObject(language_tag, data) {\n      var package_keys, package_name, ref, results;\n      results = [];\n\n      for (package_name in data) {\n        package_keys = data[package_name]; // Translations that are added by loadTranslations() have higher priority\n\n        package_keys = _.extend({}, package_keys, ((ref = this._loadTranslations_cache[language_tag]) != null ? ref[package_name] : void 0) || {});\n        results.push(this.addResourceBundle(language_tag, package_name, package_keys));\n      }\n\n      return results;\n    }\n\n    loadTranslations(translations, namespace) {\n      var language_tag, project_languages, results, translation_keys;\n      project_languages = this._getProjectLanguages();\n      results = [];\n\n      for (language_tag in translations) {\n        translation_keys = translations[language_tag];\n\n        if (this._loadTranslations_cache[language_tag] == null) {\n          this._loadTranslations_cache[language_tag] = {};\n        }\n\n        if (this._loadTranslations_cache[language_tag][namespace] == null) {\n          this._loadTranslations_cache[language_tag][namespace] = {};\n        }\n\n        _.extend(this._loadTranslations_cache[language_tag][namespace], translation_keys);\n\n        this.addResourceBundle(language_tag, namespace, translation_keys);\n\n        if (Meteor.isClient && this.getLanguage() === language_tag) {\n          // Retranslate if session language updated\n          results.push(this._language_changed_tracker.changed());\n        } else {\n          results.push(void 0);\n        }\n      }\n\n      return results;\n    }\n\n  }\n\n  ;\n  TAPi18nBase.prototype._loaded_lang_session_key = \"TAPi18n::loaded_lang\";\n  TAPi18nBase.prototype._loadTranslations_cache = {};\n  return TAPi18nBase;\n}.call(this);","sourceMap":{"version":3,"sources":["/packages/rocketchat_tap-i18n/lib/tap_i18n/tap_i18n-common.coffee","/lib/tap_i18n/tap_i18n-common.coffee"],"names":["module","export","TAPi18nBase","TAPi18next","link","default","v","globals","fallback_language","init","resStore","fallbackLng","useCookie","EventEmitter","constructor","_fallback_language","_language_changed_tracker","Tracker","Dependency","_loaded_languages","conf","packages","languages_names","translations","Meteor","isClient","Session","set","_loaded_lang_session_key","_languageSpecificTranslators","_languageSpecificTranslatorsTrackers","isServer","server_translators","startup","_enabled","_registerHTTPMethod","__","_getPackageI18nextProxy","project_translations_domain","setLng","_enable","_onceEnabled","_getPackageDomain","package_name","replace","addResourceBundle","lang_tag","_getSpecificLangTranslator","lang","current_lang","translator","lng","fixLng","lang_translator","_getProjectLanguages","_","isArray","supported_languages","union","keys","getLanguages","i","languages","len","ref","length","name","en","_loadLangFileObject","language_tag","data","package_keys","results","extend","_loadTranslations_cache","push","loadTranslations","namespace","project_languages","translation_keys","getLanguage","changed","prototype","call"],"mappings":"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","file":"packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-common.coffee.map","sourcesContent":["import TAPi18next from '../tap_i18next/tap_i18next-1.7.3.js'\nimport { globals } from './globals'\n\nfallback_language = globals.fallback_language\n\nTAPi18next.init({ resStore: {}, fallbackLng: globals.fallback_language, useCookie: false });\n\nexport class TAPi18nBase extends EventEmitter\n  _loaded_lang_session_key: \"TAPi18n::loaded_lang\"\n\n  constructor: ->\n    super()\n    @_fallback_language = fallback_language\n\n    @_language_changed_tracker = new Tracker.Dependency\n\n    @_loaded_languages = [fallback_language] # stores the loaded languages, the fallback language is loaded automatically\n\n    @conf = null # If conf isn't null we assume that tap:i18n is enabled for the project.\n              # We assume conf is valid, we sterilize and validate it during the build process.\n\n    @packages = {} # Stores the packages' package-tap.i18n jsons\n\n    @languages_names = {} # Stores languages that we've found languages files for in the project dir.\n                                        # format:\n                                        # {\n                                        #    lang_tag: [lang_name_in_english, lang_name_in_local_language]\n                                        # }\n\n    @translations = {} # Stores the packages/project translations - Server side only\n                    # fallback_language translations are not stored here\n\n\n    if Meteor.isClient\n      Session.set @_loaded_lang_session_key, null\n\n      @_languageSpecificTranslators = {}\n      @_languageSpecificTranslatorsTrackers = {}\n\n    if Meteor.isServer\n      @server_translators = {}\n\n      Meteor.startup =>\n        # If tap-i18n is enabled for that project\n        if @_enabled()\n          @_registerHTTPMethod()\n\n    @__ = @_getPackageI18nextProxy(globals.project_translations_domain)\n\n    TAPi18next.setLng fallback_language\n\n  _enable: (conf) ->\n    # tap:i18n gets enabled for a project once a conf file is set for it.\n    # It can be either a conf object that was set by project-tap.i18n file or\n    # a default conf, which is being added if the project has lang files\n    # (*.i18n.json) but not project-tap.i18n\n    @conf = conf\n\n    @._onceEnabled()\n\n  _onceEnabled: () ->\n    # The arch specific code can use this for procedures that should be performed once\n    # tap:i18n gets enabled (project conf file is being set)\n    return\n\n  _enabled: ->\n    # read the comment of @conf\n    @conf?\n\n  _getPackageDomain: (package_name) ->\n    package_name.replace(/:/g, \"-\")\n\n  addResourceBundle: (lang_tag, package_name, translations) ->\n    TAPi18next.addResourceBundle(lang_tag, @_getPackageDomain(package_name), translations)\n\n  _getSpecificLangTranslator: (lang) ->\n    current_lang = TAPi18next.lng()\n\n    translator = null\n    TAPi18next.setLng lang, {fixLng: true}, (lang_translator) =>\n      translator = lang_translator\n\n    # Restore i18next lang that had been changed in the process of generating\n    # lang specific translator\n    TAPi18next.setLng current_lang\n\n    return translator\n\n  _getProjectLanguages: () ->\n    # Return an array of languages available for the current project\n    if @._enabled()\n      if _.isArray @.conf.supported_languages\n        return _.union([@._fallback_language], @.conf.supported_languages)\n      else\n        # If supported_languages is null, all the languages we found\n        # translations files to in the project level are considered supported.\n        # We use the @.languages_names array to tell which languages we found\n        # since for every i18n.json file we found in the project level we add\n        # an entry for its language to @.languages_names in the build process.\n        #\n        # We also know for certain that when tap-i18n is enabled the fallback\n        # lang is in @.languages_names\n        return _.keys @.languages_names\n    else\n      return [@._fallback_language]\n\n  getLanguages: ->\n    if not @._enabled()\n      return null\n\n    languages = {}\n    for lang_tag in @._getProjectLanguages()\n      languages[lang_tag] =\n        name: @.languages_names[lang_tag][1]\n        en: @.languages_names[lang_tag][0]\n\n    languages\n\n  _loadLangFileObject: (language_tag, data) ->\n    for package_name, package_keys of data\n      # Translations that are added by loadTranslations() have higher priority\n      package_keys = _.extend({}, package_keys, @_loadTranslations_cache[language_tag]?[package_name] or {})\n\n      @addResourceBundle(language_tag, package_name, package_keys)\n\n  _loadTranslations_cache: {}\n  loadTranslations: (translations, namespace) ->\n    project_languages = @_getProjectLanguages()\n\n    for language_tag, translation_keys of translations\n      if not @_loadTranslations_cache[language_tag]?\n        @_loadTranslations_cache[language_tag] = {}\n\n      if not @_loadTranslations_cache[language_tag][namespace]?\n        @_loadTranslations_cache[language_tag][namespace] = {}\n\n      _.extend(@_loadTranslations_cache[language_tag][namespace], translation_keys)\n\n      @addResourceBundle(language_tag, namespace, translation_keys)\n\n      if Meteor.isClient and @getLanguage() == language_tag\n        # Retranslate if session language updated\n        @_language_changed_tracker.changed()\n","var fallback_language;\n\nimport TAPi18next from '../tap_i18next/tap_i18next-1.7.3.js';\n\nimport {\n  globals\n} from './globals';\n\nfallback_language = globals.fallback_language;\n\nTAPi18next.init({\n  resStore: {},\n  fallbackLng: globals.fallback_language,\n  useCookie: false\n});\n\nexport var TAPi18nBase = (function() {\n  class TAPi18nBase extends EventEmitter {\n    constructor() {\n      super();\n      this._fallback_language = fallback_language;\n      this._language_changed_tracker = new Tracker.Dependency;\n      this._loaded_languages = [fallback_language]; // stores the loaded languages, the fallback language is loaded automatically\n      this.conf = null; // If conf isn't null we assume that tap:i18n is enabled for the project.\n      // We assume conf is valid, we sterilize and validate it during the build process.\n      this.packages = {}; // Stores the packages' package-tap.i18n jsons\n      this.languages_names = {}; // Stores languages that we've found languages files for in the project dir.\n      // format:\n      // {\n      //    lang_tag: [lang_name_in_english, lang_name_in_local_language]\n      // }\n      this.translations = {}; // Stores the packages/project translations - Server side only\n      // fallback_language translations are not stored here\n      if (Meteor.isClient) {\n        Session.set(this._loaded_lang_session_key, null);\n        this._languageSpecificTranslators = {};\n        this._languageSpecificTranslatorsTrackers = {};\n      }\n      if (Meteor.isServer) {\n        this.server_translators = {};\n        Meteor.startup(() => {\n          // If tap-i18n is enabled for that project\n          if (this._enabled()) {\n            return this._registerHTTPMethod();\n          }\n        });\n      }\n      this.__ = this._getPackageI18nextProxy(globals.project_translations_domain);\n      TAPi18next.setLng(fallback_language);\n    }\n\n    _enable(conf) {\n      // tap:i18n gets enabled for a project once a conf file is set for it.\n      // It can be either a conf object that was set by project-tap.i18n file or\n      // a default conf, which is being added if the project has lang files\n      // (*.i18n.json) but not project-tap.i18n\n      this.conf = conf;\n      return this._onceEnabled();\n    }\n\n    _onceEnabled() {}\n\n    // The arch specific code can use this for procedures that should be performed once\n    // tap:i18n gets enabled (project conf file is being set)\n    _enabled() {\n      // read the comment of @conf\n      return this.conf != null;\n    }\n\n    _getPackageDomain(package_name) {\n      return package_name.replace(/:/g, \"-\");\n    }\n\n    addResourceBundle(lang_tag, package_name, translations) {\n      return TAPi18next.addResourceBundle(lang_tag, this._getPackageDomain(package_name), translations);\n    }\n\n    _getSpecificLangTranslator(lang) {\n      var current_lang, translator;\n      current_lang = TAPi18next.lng();\n      translator = null;\n      TAPi18next.setLng(lang, {\n        fixLng: true\n      }, (lang_translator) => {\n        return translator = lang_translator;\n      });\n      // Restore i18next lang that had been changed in the process of generating\n      // lang specific translator\n      TAPi18next.setLng(current_lang);\n      return translator;\n    }\n\n    _getProjectLanguages() {\n      // Return an array of languages available for the current project\n      if (this._enabled()) {\n        if (_.isArray(this.conf.supported_languages)) {\n          return _.union([this._fallback_language], this.conf.supported_languages);\n        } else {\n          // If supported_languages is null, all the languages we found\n          // translations files to in the project level are considered supported.\n          // We use the @.languages_names array to tell which languages we found\n          // since for every i18n.json file we found in the project level we add\n          // an entry for its language to @.languages_names in the build process.\n\n          // We also know for certain that when tap-i18n is enabled the fallback\n          // lang is in @.languages_names\n          return _.keys(this.languages_names);\n        }\n      } else {\n        return [this._fallback_language];\n      }\n    }\n\n    getLanguages() {\n      var i, lang_tag, languages, len, ref;\n      if (!this._enabled()) {\n        return null;\n      }\n      languages = {};\n      ref = this._getProjectLanguages();\n      for (i = 0, len = ref.length; i < len; i++) {\n        lang_tag = ref[i];\n        languages[lang_tag] = {\n          name: this.languages_names[lang_tag][1],\n          en: this.languages_names[lang_tag][0]\n        };\n      }\n      return languages;\n    }\n\n    _loadLangFileObject(language_tag, data) {\n      var package_keys, package_name, ref, results;\n      results = [];\n      for (package_name in data) {\n        package_keys = data[package_name];\n        // Translations that are added by loadTranslations() have higher priority\n        package_keys = _.extend({}, package_keys, ((ref = this._loadTranslations_cache[language_tag]) != null ? ref[package_name] : void 0) || {});\n        results.push(this.addResourceBundle(language_tag, package_name, package_keys));\n      }\n      return results;\n    }\n\n    loadTranslations(translations, namespace) {\n      var language_tag, project_languages, results, translation_keys;\n      project_languages = this._getProjectLanguages();\n      results = [];\n      for (language_tag in translations) {\n        translation_keys = translations[language_tag];\n        if (this._loadTranslations_cache[language_tag] == null) {\n          this._loadTranslations_cache[language_tag] = {};\n        }\n        if (this._loadTranslations_cache[language_tag][namespace] == null) {\n          this._loadTranslations_cache[language_tag][namespace] = {};\n        }\n        _.extend(this._loadTranslations_cache[language_tag][namespace], translation_keys);\n        this.addResourceBundle(language_tag, namespace, translation_keys);\n        if (Meteor.isClient && this.getLanguage() === language_tag) {\n          // Retranslate if session language updated\n          results.push(this._language_changed_tracker.changed());\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    }\n\n  };\n\n  TAPi18nBase.prototype._loaded_lang_session_key = \"TAPi18n::loaded_lang\";\n\n  TAPi18nBase.prototype._loadTranslations_cache = {};\n\n  return TAPi18nBase;\n\n}).call(this);\n"]}}