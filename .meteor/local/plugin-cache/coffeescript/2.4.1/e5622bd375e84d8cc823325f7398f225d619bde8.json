{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee","passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee"}},"code":"module.export({\n  TAPi18nClient: () => TAPi18nClient\n});\nlet TAPi18nBase;\nmodule.link(\"./tap_i18n-common\", {\n  TAPi18nBase(v) {\n    TAPi18nBase = v;\n  }\n\n}, 0);\nlet globals;\nmodule.link(\"./globals\", {\n  globals(v) {\n    globals = v;\n  }\n\n}, 1);\nvar indexOf = [].indexOf;\n\nvar TAPi18nClient = function () {\n  class TAPi18nClient extends TAPi18nBase {\n    _getLanguageFilePath(lang_tag) {\n      var path;\n\n      if (!this._enabled()) {\n        return null;\n      }\n\n      path = this.conf.cdn_path != null ? this.conf.cdn_path : this.conf.i18n_files_route;\n      path = path.replace(/\\/$/, \"\");\n\n      if (Meteor.isCordova && path[0] === \"/\") {\n        path = Meteor.absoluteUrl().replace(/\\/+$/, \"\") + path;\n      }\n\n      return \"\".concat(path, \"/\").concat(lang_tag, \".json\");\n    }\n\n    _loadLanguage(languageTag) {\n      var dependencyLoadDfd, dfd, directDependencyLanguageTag, loadLanguageTag, project_languages; // Load languageTag and its dependencies languages to TAPi18next if we\n      // haven't loaded them already.\n      // languageTag dependencies languages are:\n      // * The base language if languageTag is a dialect.\n      // * The fallback language (en) if we haven't loaded it already.\n      // Returns a deferred object that resolves with no arguments if all files\n      // loaded successfully to TAPi18next and rejects with array of error\n      // messages otherwise\n      // Example:\n      // TAPi18n._loadLanguage(\"pt-BR\")\n      //   .done(function () {\n      //     console.log(\"languageLoaded successfully\");\n      //   })\n      //   .fail(function (messages) {\n      //     console.log(\"Couldn't load languageTag\", messages);\n      //   })\n      // The above example will attempt to load pt-BR, pt and en\n\n      dfd = new $.Deferred();\n\n      if (!this._enabled()) {\n        return dfd.reject(\"tap-i18n is not enabled in the project level, check tap-i18n README\");\n      }\n\n      project_languages = this._getProjectLanguages();\n\n      if (indexOf.call(project_languages, languageTag) >= 0) {\n        if (indexOf.call(this._loaded_languages, languageTag) < 0) {\n          loadLanguageTag = () => {\n            var jqXHR;\n            jqXHR = $.getJSON(this._getLanguageFilePath(languageTag));\n            jqXHR.done(data => {\n              this._loadLangFileObject(languageTag, data);\n\n              this._loaded_languages.push(languageTag);\n\n              return dfd.resolve();\n            });\n            return jqXHR.fail((xhr, error_code) => {\n              return dfd.reject(\"Couldn't load language '\".concat(languageTag, \"' JSON: \").concat(error_code));\n            });\n          };\n\n          directDependencyLanguageTag = indexOf.call(languageTag, \"-\") >= 0 ? languageTag.replace(/-.*/, \"\") : this._fallback_language; // load dependency language if it is part of the project and not the fallback language\n\n          if (languageTag !== this._fallback_language && indexOf.call(project_languages, directDependencyLanguageTag) >= 0) {\n            dependencyLoadDfd = this._loadLanguage(directDependencyLanguageTag);\n            dependencyLoadDfd.done(() => {\n              // All dependencies loaded successfully\n              return loadLanguageTag();\n            });\n            dependencyLoadDfd.fail(message => {\n              return dfd.reject(\"Loading process failed since dependency language '\".concat(directDependencyLanguageTag, \"' failed to load: \") + message);\n            });\n          } else {\n            loadLanguageTag();\n          }\n        } else {\n          // languageTag loaded already\n          dfd.resolve();\n        }\n      } else {\n        dfd.reject([\"Language \".concat(languageTag, \" is not supported\")]);\n      }\n\n      return dfd.promise();\n    }\n\n    _registerHelpers(package_name, template) {\n      var helpers, tapI18nextProxy, underscore_helper;\n\n      if (package_name !== globals.project_translations_domain) {\n        tapI18nextProxy = this._getPackageI18nextProxy(this.packages[package_name].namespace);\n      } else {\n        tapI18nextProxy = this._getPackageI18nextProxy(globals.project_translations_domain);\n      }\n\n      underscore_helper = function (key) {\n        var options;\n\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        options = args.pop().hash;\n\n        if (!_.isEmpty(args)) {\n          options.sprintf = args;\n        }\n\n        return tapI18nextProxy(key, options);\n      }; // template specific helpers\n\n\n      if (package_name !== globals.project_translations_domain) {\n        // {{_ }}\n        if (Template[template] != null && Template[template].helpers != null) {\n          helpers = {};\n          helpers[this.packages[package_name].helper_name] = underscore_helper;\n          Template[template].helpers(helpers);\n        }\n      } else {\n        // {{_ }}\n        // global helpers\n        UI.registerHelper(this.conf.helper_name, underscore_helper); // {{languageTag}}\n\n        UI.registerHelper(\"languageTag\", () => {\n          return this.getLanguage();\n        });\n      }\n    }\n\n    _getRegisterHelpersProxy(package_name) {\n      // A proxy to _registerHelpers where the package_name is fixed to package_name\n      return template => {\n        return this._registerHelpers(package_name, template);\n      };\n    }\n\n    _prepareLanguageSpecificTranslator(lang_tag) {\n      var dfd;\n      dfd = new $.Deferred().resolve().promise();\n\n      if (lang_tag in this._languageSpecificTranslatorsTrackers) {\n        return dfd;\n      }\n\n      this._languageSpecificTranslatorsTrackers[lang_tag] = new Tracker.Dependency();\n\n      if (!(lang_tag in this._languageSpecificTranslators)) {\n        dfd = this._loadLanguage(lang_tag).done(() => {\n          this._languageSpecificTranslators[lang_tag] = this._getSpecificLangTranslator(lang_tag);\n          return this._languageSpecificTranslatorsTrackers[lang_tag].changed();\n        });\n      }\n\n      return dfd;\n    }\n\n    _getPackageI18nextProxy(package_name) {\n      var _this = this;\n\n      // A proxy to TAPi18next.t where the namespace is preset to the package's\n      return function (key, options) {\n        let lang_tag = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n        // Devs get confused and use lang option instead of lng option, make lang\n        // alias of lng\n        if ((options != null ? options.lang : void 0) != null && (options != null ? options.lng : void 0) == null) {\n          options.lng = options.lang;\n        }\n\n        if ((options != null ? options.lng : void 0) != null && lang_tag == null) {\n          lang_tag = options.lng; // Remove options.lng so we won't pass it to the regular TAPi18next\n          // before the language specific translator is ready to keep behavior\n          // consistent.\n          // If lang is actually ready before the language specifc translator is\n          // ready, TAPi18next will translate to lang_tag if we won't remove\n          // options.lng.\n\n          delete options.lng;\n        }\n\n        if (lang_tag != null) {\n          _this._prepareLanguageSpecificTranslator(lang_tag);\n\n          _this._languageSpecificTranslatorsTrackers[lang_tag].depend();\n\n          if (lang_tag in _this._languageSpecificTranslators) {\n            return _this._languageSpecificTranslators[lang_tag](\"\".concat(_this._getPackageDomain(package_name), \":\").concat(key), options);\n          } else {\n            return TAPi18next.t(\"\".concat(_this._getPackageDomain(package_name), \":\").concat(key), options);\n          }\n        } // If inside a reactive computation, we want to invalidate the computation if the client lang changes\n\n\n        _this._language_changed_tracker.depend();\n\n        return TAPi18next.t(\"\".concat(_this._getPackageDomain(package_name), \":\").concat(key), options);\n      };\n    }\n\n    _onceEnabled() {\n      return this._registerHelpers(globals.project_translations_domain);\n    }\n\n    setLanguage(lang_tag) {\n      var isAborted, self;\n      self = this;\n\n      if (typeof this._abortPreviousSetLang === \"function\") {\n        this._abortPreviousSetLang();\n      }\n\n      isAborted = false;\n\n      this._abortPreviousSetLang = function () {\n        return isAborted = true;\n      };\n\n      return this._loadLanguage(lang_tag).then(() => {\n        if (!isAborted) {\n          TAPi18next.setLng(lang_tag);\n\n          this._language_changed_tracker.changed();\n\n          return Session.set(this._loaded_lang_session_key, lang_tag);\n        }\n      });\n    }\n\n    getLanguage() {\n      var session_lang;\n\n      if (!this._enabled()) {\n        return null;\n      }\n\n      session_lang = Session.get(this._loaded_lang_session_key);\n\n      if (session_lang != null) {\n        return session_lang;\n      } else {\n        return this._fallback_language;\n      }\n    }\n\n  }\n\n  ;\n  TAPi18nClient.prototype._languageSpecificTranslators = null;\n  TAPi18nClient.prototype._languageSpecificTranslatorsTrackers = null;\n  TAPi18nClient.prototype._abortPreviousSetLang = null;\n  return TAPi18nClient;\n}.call(this);","map":{"version":3,"sources":["packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-client.coffee"],"names":["module","export","TAPi18nClient","TAPi18nBase","link","v","globals","indexOf","_getLanguageFilePath","lang_tag","path","_enabled","conf","cdn_path","i18n_files_route","replace","Meteor","isCordova","absoluteUrl","_loadLanguage","languageTag","dependencyLoadDfd","dfd","directDependencyLanguageTag","loadLanguageTag","project_languages","$","Deferred","reject","_getProjectLanguages","call","_loaded_languages","jqXHR","getJSON","done","data","_loadLangFileObject","push","resolve","fail","xhr","error_code","_fallback_language","message","promise","_registerHelpers","package_name","template","helpers","tapI18nextProxy","underscore_helper","project_translations_domain","_getPackageI18nextProxy","packages","namespace","key","options","args","pop","hash","_","isEmpty","sprintf","Template","helper_name","UI","registerHelper","getLanguage","_getRegisterHelpersProxy","_prepareLanguageSpecificTranslator","_languageSpecificTranslatorsTrackers","Tracker","Dependency","_languageSpecificTranslators","_getSpecificLangTranslator","changed","lang","lng","depend","_getPackageDomain","TAPi18next","t","_language_changed_tracker","_onceEnabled","setLanguage","isAborted","self","_abortPreviousSetLang","then","setLng","Session","set","_loaded_lang_session_key","session_lang","get","prototype"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,aAAa,EAAC,MAAIA;AAAnB,CAAd;AAAiD,IAAIC,WAAJ;AAAgBH,MAAM,CAACI,IAAP,CAAY,mBAAZ,EAAgC;AAACD,EAAAA,WAAW,CAACE,CAAD,EAAG;AAACF,IAAAA,WAAW,GAACE,CAAZ;AAAc;;AAA9B,CAAhC,EAAgE,CAAhE;AAAmE,IAAIC,OAAJ;AAAYN,MAAM,CAACI,IAAP,CAAY,WAAZ,EAAwB;AAACE,EAAAA,OAAO,CAACD,CAAD,EAAG;AAACC,IAAAA,OAAO,GAACD,CAAR;AAAU;;AAAtB,CAAxB,EAAgD,CAAhD;AAAhJ,IAAIE,OAAO,GAAG,GAAGA,OAAjB;;AAUO,IAAIL,aAAa,GAAI,YAAW;AACrC,QAAMA,aAAN,SAA4BC,WAA5B,CAAwC;AACtCK,IAAAA,oBAAoB,CAACC,QAAD,EAAW;AAC7B,UAAIC,IAAJ;;AACA,UAAI,CAAC,KAAKC,QAAL,EAAL,EAAsB;AACpB,eAAO,IAAP;AACD;;AACDD,MAAAA,IAAI,GAAG,KAAKE,IAAL,CAAUC,QAAV,IAAsB,IAAtB,GAA6B,KAAKD,IAAL,CAAUC,QAAvC,GAAkD,KAAKD,IAAL,CAAUE,gBAAnE;AACAJ,MAAAA,IAAI,GAAGA,IAAI,CAACK,OAAL,CAAa,KAAb,EAAoB,EAApB,CAAP;;AACA,UAAIC,MAAM,CAACC,SAAP,IAAoBP,IAAI,CAAC,CAAD,CAAJ,KAAY,GAApC,EAAyC;AACvCA,QAAAA,IAAI,GAAGM,MAAM,CAACE,WAAP,GAAqBH,OAArB,CAA6B,MAA7B,EAAqC,EAArC,IAA2CL,IAAlD;AACD;;AACD,uBAAUA,IAAV,cAAkBD,QAAlB;AACD;;AAEDU,IAAAA,aAAa,CAACC,WAAD,EAAc;AACzB,UAAIC,iBAAJ,EAAuBC,GAAvB,EAA4BC,2BAA5B,EAAyDC,eAAzD,EAA0EC,iBAA1E,CADyB,CAEzB;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACAH,MAAAA,GAAG,GAAG,IAAII,CAAC,CAACC,QAAN,EAAN;;AACA,UAAI,CAAC,KAAKhB,QAAL,EAAL,EAAsB;AACpB,eAAOW,GAAG,CAACM,MAAJ,CAAW,qEAAX,CAAP;AACD;;AACDH,MAAAA,iBAAiB,GAAG,KAAKI,oBAAL,EAApB;;AACA,UAAItB,OAAO,CAACuB,IAAR,CAAaL,iBAAb,EAAgCL,WAAhC,KAAgD,CAApD,EAAuD;AACrD,YAAIb,OAAO,CAACuB,IAAR,CAAa,KAAKC,iBAAlB,EAAqCX,WAArC,IAAoD,CAAxD,EAA2D;AACzDI,UAAAA,eAAe,GAAG,MAAM;AACtB,gBAAIQ,KAAJ;AACAA,YAAAA,KAAK,GAAGN,CAAC,CAACO,OAAF,CAAU,KAAKzB,oBAAL,CAA0BY,WAA1B,CAAV,CAAR;AACAY,YAAAA,KAAK,CAACE,IAAN,CAAYC,IAAD,IAAU;AACnB,mBAAKC,mBAAL,CAAyBhB,WAAzB,EAAsCe,IAAtC;;AACA,mBAAKJ,iBAAL,CAAuBM,IAAvB,CAA4BjB,WAA5B;;AACA,qBAAOE,GAAG,CAACgB,OAAJ,EAAP;AACD,aAJD;AAKA,mBAAON,KAAK,CAACO,IAAN,CAAW,CAACC,GAAD,EAAMC,UAAN,KAAqB;AACrC,qBAAOnB,GAAG,CAACM,MAAJ,mCAAsCR,WAAtC,qBAA4DqB,UAA5D,EAAP;AACD,aAFM,CAAP;AAGD,WAXD;;AAYAlB,UAAAA,2BAA2B,GAAGhB,OAAO,CAACuB,IAAR,CAAaV,WAAb,EAA0B,GAA1B,KAAkC,CAAlC,GAAsCA,WAAW,CAACL,OAAZ,CAAoB,KAApB,EAA2B,EAA3B,CAAtC,GAAuE,KAAK2B,kBAA1G,CAbyD,CAczD;;AACA,cAAItB,WAAW,KAAK,KAAKsB,kBAArB,IAA2CnC,OAAO,CAACuB,IAAR,CAAaL,iBAAb,EAAgCF,2BAAhC,KAAgE,CAA/G,EAAkH;AAChHF,YAAAA,iBAAiB,GAAG,KAAKF,aAAL,CAAmBI,2BAAnB,CAApB;AACAF,YAAAA,iBAAiB,CAACa,IAAlB,CAAuB,MAAM;AAC3B;AACA,qBAAOV,eAAe,EAAtB;AACD,aAHD;AAIAH,YAAAA,iBAAiB,CAACkB,IAAlB,CAAwBI,OAAD,IAAa;AAClC,qBAAOrB,GAAG,CAACM,MAAJ,CAAW,4DAAqDL,2BAArD,0BAAuGoB,OAAlH,CAAP;AACD,aAFD;AAGD,WATD,MASO;AACLnB,YAAAA,eAAe;AAChB;AACF,SA3BD,MA2BO;AACL;AACAF,UAAAA,GAAG,CAACgB,OAAJ;AACD;AACF,OAhCD,MAgCO;AACLhB,QAAAA,GAAG,CAACM,MAAJ,CAAW,oBAAaR,WAAb,uBAAX;AACD;;AACD,aAAOE,GAAG,CAACsB,OAAJ,EAAP;AACD;;AAEDC,IAAAA,gBAAgB,CAACC,YAAD,EAAeC,QAAf,EAAyB;AACvC,UAAIC,OAAJ,EAAaC,eAAb,EAA8BC,iBAA9B;;AACA,UAAIJ,YAAY,KAAKxC,OAAO,CAAC6C,2BAA7B,EAA0D;AACxDF,QAAAA,eAAe,GAAG,KAAKG,uBAAL,CAA6B,KAAKC,QAAL,CAAcP,YAAd,EAA4BQ,SAAzD,CAAlB;AACD,OAFD,MAEO;AACLL,QAAAA,eAAe,GAAG,KAAKG,uBAAL,CAA6B9C,OAAO,CAAC6C,2BAArC,CAAlB;AACD;;AACDD,MAAAA,iBAAiB,GAAG,UAASK,GAAT,EAAuB;AACzC,YAAIC,OAAJ;;AADyC,0CAANC,IAAM;AAANA,UAAAA,IAAM;AAAA;;AAEzCD,QAAAA,OAAO,GAAIC,IAAI,CAACC,GAAL,EAAD,CAAaC,IAAvB;;AACA,YAAI,CAACC,CAAC,CAACC,OAAF,CAAUJ,IAAV,CAAL,EAAsB;AACpBD,UAAAA,OAAO,CAACM,OAAR,GAAkBL,IAAlB;AACD;;AACD,eAAOR,eAAe,CAACM,GAAD,EAAMC,OAAN,CAAtB;AACD,OAPD,CAPuC,CAevC;;;AACA,UAAIV,YAAY,KAAKxC,OAAO,CAAC6C,2BAA7B,EAA0D;AACxD;AACA,YAAKY,QAAQ,CAAChB,QAAD,CAAR,IAAsB,IAAvB,IAAiCgB,QAAQ,CAAChB,QAAD,CAAR,CAAmBC,OAAnB,IAA8B,IAAnE,EAA0E;AACxEA,UAAAA,OAAO,GAAG,EAAV;AACAA,UAAAA,OAAO,CAAC,KAAKK,QAAL,CAAcP,YAAd,EAA4BkB,WAA7B,CAAP,GAAmDd,iBAAnD;AACAa,UAAAA,QAAQ,CAAChB,QAAD,CAAR,CAAmBC,OAAnB,CAA2BA,OAA3B;AACD;AACF,OAPD,MAOO;AACL;AACA;AACAiB,QAAAA,EAAE,CAACC,cAAH,CAAkB,KAAKtD,IAAL,CAAUoD,WAA5B,EAAyCd,iBAAzC,EAHK,CAIL;;AACAe,QAAAA,EAAE,CAACC,cAAH,CAAkB,aAAlB,EAAiC,MAAM;AACrC,iBAAO,KAAKC,WAAL,EAAP;AACD,SAFD;AAGD;AACF;;AAEDC,IAAAA,wBAAwB,CAACtB,YAAD,EAAe;AACrC;AACA,aAAQC,QAAD,IAAc;AACnB,eAAO,KAAKF,gBAAL,CAAsBC,YAAtB,EAAoCC,QAApC,CAAP;AACD,OAFD;AAGD;;AAEDsB,IAAAA,kCAAkC,CAAC5D,QAAD,EAAW;AAC3C,UAAIa,GAAJ;AACAA,MAAAA,GAAG,GAAI,IAAII,CAAC,CAACC,QAAN,EAAD,CAAmBW,OAAnB,GAA6BM,OAA7B,EAAN;;AACA,UAAInC,QAAQ,IAAI,KAAK6D,oCAArB,EAA2D;AACzD,eAAOhD,GAAP;AACD;;AACD,WAAKgD,oCAAL,CAA0C7D,QAA1C,IAAsD,IAAI8D,OAAO,CAACC,UAAZ,EAAtD;;AACA,UAAI,EAAE/D,QAAQ,IAAI,KAAKgE,4BAAnB,CAAJ,EAAsD;AACpDnD,QAAAA,GAAG,GAAG,KAAKH,aAAL,CAAmBV,QAAnB,EAA6ByB,IAA7B,CAAkC,MAAM;AAC5C,eAAKuC,4BAAL,CAAkChE,QAAlC,IAA8C,KAAKiE,0BAAL,CAAgCjE,QAAhC,CAA9C;AACA,iBAAO,KAAK6D,oCAAL,CAA0C7D,QAA1C,EAAoDkE,OAApD,EAAP;AACD,SAHK,CAAN;AAID;;AACD,aAAOrD,GAAP;AACD;;AAED8B,IAAAA,uBAAuB,CAACN,YAAD,EAAe;AAAA;;AACpC;AACA,aAAO,UAACS,GAAD,EAAMC,OAAN,EAAmC;AAAA,YAApB/C,QAAoB,uEAAT,IAAS;;AACxC;AACA;AACA,YAAK,CAAC+C,OAAO,IAAI,IAAX,GAAkBA,OAAO,CAACoB,IAA1B,GAAiC,KAAK,CAAvC,KAA6C,IAA9C,IAAwD,CAACpB,OAAO,IAAI,IAAX,GAAkBA,OAAO,CAACqB,GAA1B,GAAgC,KAAK,CAAtC,KAA4C,IAAxG,EAA+G;AAC7GrB,UAAAA,OAAO,CAACqB,GAAR,GAAcrB,OAAO,CAACoB,IAAtB;AACD;;AACD,YAAK,CAACpB,OAAO,IAAI,IAAX,GAAkBA,OAAO,CAACqB,GAA1B,GAAgC,KAAK,CAAtC,KAA4C,IAA7C,IAAuDpE,QAAQ,IAAI,IAAvE,EAA8E;AAC5EA,UAAAA,QAAQ,GAAG+C,OAAO,CAACqB,GAAnB,CAD4E,CAE5E;AACA;AACA;AAEA;AACA;AACA;;AACA,iBAAOrB,OAAO,CAACqB,GAAf;AACD;;AACD,YAAIpE,QAAQ,IAAI,IAAhB,EAAsB;AACpB,UAAA,KAAI,CAAC4D,kCAAL,CAAwC5D,QAAxC;;AACA,UAAA,KAAI,CAAC6D,oCAAL,CAA0C7D,QAA1C,EAAoDqE,MAApD;;AACA,cAAIrE,QAAQ,IAAI,KAAI,CAACgE,4BAArB,EAAmD;AACjD,mBAAO,KAAI,CAACA,4BAAL,CAAkChE,QAAlC,YAA+C,KAAI,CAACsE,iBAAL,CAAuBjC,YAAvB,CAA/C,cAAuFS,GAAvF,GAA8FC,OAA9F,CAAP;AACD,WAFD,MAEO;AACL,mBAAOwB,UAAU,CAACC,CAAX,WAAgB,KAAI,CAACF,iBAAL,CAAuBjC,YAAvB,CAAhB,cAAwDS,GAAxD,GAA+DC,OAA/D,CAAP;AACD;AACF,SAzBuC,CA0BxC;;;AACA,QAAA,KAAI,CAAC0B,yBAAL,CAA+BJ,MAA/B;;AACA,eAAOE,UAAU,CAACC,CAAX,WAAgB,KAAI,CAACF,iBAAL,CAAuBjC,YAAvB,CAAhB,cAAwDS,GAAxD,GAA+DC,OAA/D,CAAP;AACD,OA7BD;AA8BD;;AAED2B,IAAAA,YAAY,GAAG;AACb,aAAO,KAAKtC,gBAAL,CAAsBvC,OAAO,CAAC6C,2BAA9B,CAAP;AACD;;AAEDiC,IAAAA,WAAW,CAAC3E,QAAD,EAAW;AACpB,UAAI4E,SAAJ,EAAeC,IAAf;AACAA,MAAAA,IAAI,GAAG,IAAP;;AACA,UAAI,OAAO,KAAKC,qBAAZ,KAAsC,UAA1C,EAAsD;AACpD,aAAKA,qBAAL;AACD;;AACDF,MAAAA,SAAS,GAAG,KAAZ;;AACA,WAAKE,qBAAL,GAA6B,YAAW;AACtC,eAAOF,SAAS,GAAG,IAAnB;AACD,OAFD;;AAGA,aAAO,KAAKlE,aAAL,CAAmBV,QAAnB,EAA6B+E,IAA7B,CAAkC,MAAM;AAC7C,YAAI,CAACH,SAAL,EAAgB;AACdL,UAAAA,UAAU,CAACS,MAAX,CAAkBhF,QAAlB;;AACA,eAAKyE,yBAAL,CAA+BP,OAA/B;;AACA,iBAAOe,OAAO,CAACC,GAAR,CAAY,KAAKC,wBAAjB,EAA2CnF,QAA3C,CAAP;AACD;AACF,OANM,CAAP;AAOD;;AAED0D,IAAAA,WAAW,GAAG;AACZ,UAAI0B,YAAJ;;AACA,UAAI,CAAC,KAAKlF,QAAL,EAAL,EAAsB;AACpB,eAAO,IAAP;AACD;;AACDkF,MAAAA,YAAY,GAAGH,OAAO,CAACI,GAAR,CAAY,KAAKF,wBAAjB,CAAf;;AACA,UAAIC,YAAY,IAAI,IAApB,EAA0B;AACxB,eAAOA,YAAP;AACD,OAFD,MAEO;AACL,eAAO,KAAKnD,kBAAZ;AACD;AACF;;AA7MqC;;AA+MvC;AAEDxC,EAAAA,aAAa,CAAC6F,SAAd,CAAwBtB,4BAAxB,GAAuD,IAAvD;AAEAvE,EAAAA,aAAa,CAAC6F,SAAd,CAAwBzB,oCAAxB,GAA+D,IAA/D;AAEApE,EAAAA,aAAa,CAAC6F,SAAd,CAAwBR,qBAAxB,GAAgD,IAAhD;AAEA,SAAOrF,aAAP;AAED,CA1N0B,CA0NxB4B,IA1NwB,CA0NnB,IA1NmB,CAApB","sourcesContent":["var indexOf = [].indexOf;\n\nimport {\n  TAPi18nBase\n} from './tap_i18n-common';\n\nimport {\n  globals\n} from './globals';\n\nexport var TAPi18nClient = (function() {\n  class TAPi18nClient extends TAPi18nBase {\n    _getLanguageFilePath(lang_tag) {\n      var path;\n      if (!this._enabled()) {\n        return null;\n      }\n      path = this.conf.cdn_path != null ? this.conf.cdn_path : this.conf.i18n_files_route;\n      path = path.replace(/\\/$/, \"\");\n      if (Meteor.isCordova && path[0] === \"/\") {\n        path = Meteor.absoluteUrl().replace(/\\/+$/, \"\") + path;\n      }\n      return `${path}/${lang_tag}.json`;\n    }\n\n    _loadLanguage(languageTag) {\n      var dependencyLoadDfd, dfd, directDependencyLanguageTag, loadLanguageTag, project_languages;\n      // Load languageTag and its dependencies languages to TAPi18next if we\n      // haven't loaded them already.\n\n      // languageTag dependencies languages are:\n      // * The base language if languageTag is a dialect.\n      // * The fallback language (en) if we haven't loaded it already.\n\n      // Returns a deferred object that resolves with no arguments if all files\n      // loaded successfully to TAPi18next and rejects with array of error\n      // messages otherwise\n\n      // Example:\n      // TAPi18n._loadLanguage(\"pt-BR\")\n      //   .done(function () {\n      //     console.log(\"languageLoaded successfully\");\n      //   })\n      //   .fail(function (messages) {\n      //     console.log(\"Couldn't load languageTag\", messages);\n      //   })\n\n      // The above example will attempt to load pt-BR, pt and en\n      dfd = new $.Deferred();\n      if (!this._enabled()) {\n        return dfd.reject(\"tap-i18n is not enabled in the project level, check tap-i18n README\");\n      }\n      project_languages = this._getProjectLanguages();\n      if (indexOf.call(project_languages, languageTag) >= 0) {\n        if (indexOf.call(this._loaded_languages, languageTag) < 0) {\n          loadLanguageTag = () => {\n            var jqXHR;\n            jqXHR = $.getJSON(this._getLanguageFilePath(languageTag));\n            jqXHR.done((data) => {\n              this._loadLangFileObject(languageTag, data);\n              this._loaded_languages.push(languageTag);\n              return dfd.resolve();\n            });\n            return jqXHR.fail((xhr, error_code) => {\n              return dfd.reject(`Couldn't load language '${languageTag}' JSON: ${error_code}`);\n            });\n          };\n          directDependencyLanguageTag = indexOf.call(languageTag, \"-\") >= 0 ? languageTag.replace(/-.*/, \"\") : this._fallback_language;\n          // load dependency language if it is part of the project and not the fallback language\n          if (languageTag !== this._fallback_language && indexOf.call(project_languages, directDependencyLanguageTag) >= 0) {\n            dependencyLoadDfd = this._loadLanguage(directDependencyLanguageTag);\n            dependencyLoadDfd.done(() => {\n              // All dependencies loaded successfully\n              return loadLanguageTag();\n            });\n            dependencyLoadDfd.fail((message) => {\n              return dfd.reject(`Loading process failed since dependency language '${directDependencyLanguageTag}' failed to load: ` + message);\n            });\n          } else {\n            loadLanguageTag();\n          }\n        } else {\n          // languageTag loaded already\n          dfd.resolve();\n        }\n      } else {\n        dfd.reject([`Language ${languageTag} is not supported`]);\n      }\n      return dfd.promise();\n    }\n\n    _registerHelpers(package_name, template) {\n      var helpers, tapI18nextProxy, underscore_helper;\n      if (package_name !== globals.project_translations_domain) {\n        tapI18nextProxy = this._getPackageI18nextProxy(this.packages[package_name].namespace);\n      } else {\n        tapI18nextProxy = this._getPackageI18nextProxy(globals.project_translations_domain);\n      }\n      underscore_helper = function(key, ...args) {\n        var options;\n        options = (args.pop()).hash;\n        if (!_.isEmpty(args)) {\n          options.sprintf = args;\n        }\n        return tapI18nextProxy(key, options);\n      };\n      // template specific helpers\n      if (package_name !== globals.project_translations_domain) {\n        // {{_ }}\n        if ((Template[template] != null) && (Template[template].helpers != null)) {\n          helpers = {};\n          helpers[this.packages[package_name].helper_name] = underscore_helper;\n          Template[template].helpers(helpers);\n        }\n      } else {\n        // {{_ }}\n        // global helpers\n        UI.registerHelper(this.conf.helper_name, underscore_helper);\n        // {{languageTag}}\n        UI.registerHelper(\"languageTag\", () => {\n          return this.getLanguage();\n        });\n      }\n    }\n\n    _getRegisterHelpersProxy(package_name) {\n      // A proxy to _registerHelpers where the package_name is fixed to package_name\n      return (template) => {\n        return this._registerHelpers(package_name, template);\n      };\n    }\n\n    _prepareLanguageSpecificTranslator(lang_tag) {\n      var dfd;\n      dfd = (new $.Deferred()).resolve().promise();\n      if (lang_tag in this._languageSpecificTranslatorsTrackers) {\n        return dfd;\n      }\n      this._languageSpecificTranslatorsTrackers[lang_tag] = new Tracker.Dependency;\n      if (!(lang_tag in this._languageSpecificTranslators)) {\n        dfd = this._loadLanguage(lang_tag).done(() => {\n          this._languageSpecificTranslators[lang_tag] = this._getSpecificLangTranslator(lang_tag);\n          return this._languageSpecificTranslatorsTrackers[lang_tag].changed();\n        });\n      }\n      return dfd;\n    }\n\n    _getPackageI18nextProxy(package_name) {\n      // A proxy to TAPi18next.t where the namespace is preset to the package's\n      return (key, options, lang_tag = null) => {\n        // Devs get confused and use lang option instead of lng option, make lang\n        // alias of lng\n        if (((options != null ? options.lang : void 0) != null) && ((options != null ? options.lng : void 0) == null)) {\n          options.lng = options.lang;\n        }\n        if (((options != null ? options.lng : void 0) != null) && (lang_tag == null)) {\n          lang_tag = options.lng;\n          // Remove options.lng so we won't pass it to the regular TAPi18next\n          // before the language specific translator is ready to keep behavior\n          // consistent.\n\n          // If lang is actually ready before the language specifc translator is\n          // ready, TAPi18next will translate to lang_tag if we won't remove\n          // options.lng.\n          delete options.lng;\n        }\n        if (lang_tag != null) {\n          this._prepareLanguageSpecificTranslator(lang_tag);\n          this._languageSpecificTranslatorsTrackers[lang_tag].depend();\n          if (lang_tag in this._languageSpecificTranslators) {\n            return this._languageSpecificTranslators[lang_tag](`${this._getPackageDomain(package_name)}:${key}`, options);\n          } else {\n            return TAPi18next.t(`${this._getPackageDomain(package_name)}:${key}`, options);\n          }\n        }\n        // If inside a reactive computation, we want to invalidate the computation if the client lang changes\n        this._language_changed_tracker.depend();\n        return TAPi18next.t(`${this._getPackageDomain(package_name)}:${key}`, options);\n      };\n    }\n\n    _onceEnabled() {\n      return this._registerHelpers(globals.project_translations_domain);\n    }\n\n    setLanguage(lang_tag) {\n      var isAborted, self;\n      self = this;\n      if (typeof this._abortPreviousSetLang === \"function\") {\n        this._abortPreviousSetLang();\n      }\n      isAborted = false;\n      this._abortPreviousSetLang = function() {\n        return isAborted = true;\n      };\n      return this._loadLanguage(lang_tag).then(() => {\n        if (!isAborted) {\n          TAPi18next.setLng(lang_tag);\n          this._language_changed_tracker.changed();\n          return Session.set(this._loaded_lang_session_key, lang_tag);\n        }\n      });\n    }\n\n    getLanguage() {\n      var session_lang;\n      if (!this._enabled()) {\n        return null;\n      }\n      session_lang = Session.get(this._loaded_lang_session_key);\n      if (session_lang != null) {\n        return session_lang;\n      } else {\n        return this._fallback_language;\n      }\n    }\n\n  };\n\n  TAPi18nClient.prototype._languageSpecificTranslators = null;\n\n  TAPi18nClient.prototype._languageSpecificTranslatorsTrackers = null;\n\n  TAPi18nClient.prototype._abortPreviousSetLang = null;\n\n  return TAPi18nClient;\n\n}).call(this);\n"]},"sourceType":"script","hash":"e5622bd375e84d8cc823325f7398f225d619bde8"}
