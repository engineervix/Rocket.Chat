{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppsProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/admin/apps/AppsProvider.tsx","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppsProvider.tsx","inputSourceMap":{"version":3,"file":"client/views/admin/apps/AppsProvider.tsx","sourceRoot":"","sources":["client/views/admin/apps/AppsProvider.tsx"],"names":[],"mappings":"AACA,OAAO,EAAE,kBAAkB,EAAE,MAAM,6BAA6B,CAAC;AACjE,OAAO,KAAK,EAAE,EAAE,SAAS,EAAM,UAAU,EAAW,WAAW,EAAE,MAAM,OAAO,CAAC;AAE/E,OAAO,EAAE,SAAS,EAAE,MAAM,2CAA2C,CAAC;AACtE,OAAO,EAAE,IAAI,EAAE,MAAM,0CAA0C,CAAC;AAChE,OAAO,EAAc,eAAe,EAAE,MAAM,yBAAyB,CAAC;AACtE,OAAO,EAAE,WAAW,EAAE,MAAM,eAAe,CAAC;AAC5C,OAAO,EAAE,cAAc,EAAE,MAAM,WAAW,CAAC;AAO3C,MAAM,iBAAiB,GAAG,CAAC,SAA2B,EAAgB,EAAE;IACvE,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,CAKrC,CAAC;IACJ,KAAK,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,IAAI,OAAO,EAAE;QACxC,IAAI,CAAC,aAAa,EAAE,EAAE,gBAAgB,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;KACnE;IACD,OAAO,GAAS,EAAE;QACjB,KAAK,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,IAAI,OAAO,EAAE;YACxC,IAAI,CAAC,aAAa,EAAE,EAAE,kBAAkB,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;SACrE;IACF,CAAC,CAAC;AACH,CAAC,CAAC;AAUF,MAAM,UAAU,GAAG,CAAC,IAAW,EAAS,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAEvH,MAAM,OAAO,GAAG,CACf,KAEC,EACD,MAAc,EAGb,EAAE;IACH,QAAQ,MAAM,CAAC,IAAI,EAAE;QACpB,KAAK,YAAY;YAChB,IAAI,KAAK,CAAC,KAAK,KAAK,eAAe,CAAC,QAAQ,EAAE;gBAC7C,OAAO,KAAK,CAAC;aACb;YACD,OAAO;gBACN,KAAK,EAAE,eAAe,CAAC,QAAQ;gBAC/B,MAAM,EAAE,MAAM,CAAC,MAAM;gBACrB,KAAK,EAAE;oBACN,IAAI,EAAE,UAAU,CACf,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;wBAC5B,IAAI,GAAG,CAAC,EAAE,KAAK,MAAM,CAAC,KAAK,EAAE;4BAC5B,OAAO,EAAE,GAAG,GAAG,EAAE,CAAC;yBAClB;wBACD,OAAO,GAAG,CAAC;oBACZ,CAAC,CAAC,CACF;iBACD;gBACD,KAAK,EAAE,SAAS;aAChB,CAAC;QACH,KAAK,QAAQ;YACZ,IAAI,KAAK,CAAC,KAAK,KAAK,eAAe,CAAC,QAAQ,EAAE;gBAC7C,OAAO,KAAK,CAAC;aACb;YACD,OAAO;gBACN,KAAK,EAAE,eAAe,CAAC,QAAQ;gBAC/B,MAAM,EAAE,KAAK,IAAmB,EAAE,CAAC,SAAS;gBAC5C,KAAK,EAAE;oBACN,IAAI,EAAE,UAAU,CACf,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;wBAC5B,IAAI,GAAG,CAAC,EAAE,KAAK,MAAM,CAAC,GAAG,CAAC,EAAE,EAAE;4BAC7B,OAAO,MAAM,CAAC,GAAG,CAAC;yBAClB;wBACD,OAAO,GAAG,CAAC;oBACZ,CAAC,CAAC,CACF;iBACD;gBACD,KAAK,EAAE,SAAS;aAChB,CAAC;QACH,KAAK,SAAS;YACb,OAAO;gBACN,MAAM,EAAE,KAAK,IAAmB,EAAE,CAAC,SAAS;gBAC5C,KAAK,EAAE,eAAe,CAAC,OAAO;gBAC9B,KAAK,EAAE,SAAS;gBAChB,KAAK,EAAE,SAAS;aAChB,CAAC;QACH,KAAK,SAAS;YACb,OAAO;gBACN,MAAM,EAAE,MAAM,CAAC,MAAM;gBACrB,KAAK,EAAE,eAAe,CAAC,QAAQ;gBAC/B,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;gBACxC,KAAK,EAAE,SAAS;aAChB,CAAC;QACH,KAAK,QAAQ;YACZ,IAAI,KAAK,CAAC,KAAK,KAAK,eAAe,CAAC,QAAQ,EAAE;gBAC7C,OAAO,KAAK,CAAC;aACb;YACD,OAAO;gBACN,MAAM,EAAE,MAAM,CAAC,MAAM;gBACrB,KAAK,EAAE,eAAe,CAAC,QAAQ;gBAC/B,KAAK,EAAE,EAAE,IAAI,EAAE,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,KAAK,MAAM,CAAC,KAAK,CAAC,EAAE;gBACzE,KAAK,EAAE,SAAS;aAChB,CAAC;QACH,KAAK,SAAS;YACb,OAAO;gBACN,MAAM,EAAE,MAAM,CAAC,MAAM;gBACrB,KAAK,EAAE,eAAe,CAAC,QAAQ;gBAC/B,KAAK,EAAE,SAAS;gBAChB,KAAK,EAAE,MAAM,CAAC,KAAK;aACnB,CAAC;QACH;YACC,OAAO,KAAK,CAAC;KACd;AACF,CAAC,CAAC;AAEF,MAAM,YAAY,GAAO,CAAC,EAAE,QAAQ,EAAE,EAAE,EAAE;IACzC,MAAM,CAAC,oBAAoB,EAAE,uBAAuB,CAAC,GAAG,UAAU,CAOhE,OAAO,EAAE;QACV,KAAK,EAAE,eAAe,CAAC,OAAO;QAC9B,KAAK,EAAE,SAAS;QAChB,KAAK,EAAE,SAAS;QAChB,MAAM,EAAE,KAAK,IAAI,EAAE,CAAC,SAAS;KAC7B,CAAC,CAAC;IAEH,MAAM,CAAC,kBAAkB,EAAE,qBAAqB,CAAC,GAAG,UAAU,CAO5D,OAAO,EAAE;QACV,KAAK,EAAE,eAAe,CAAC,OAAO;QAC9B,KAAK,EAAE,SAAS;QAChB,KAAK,EAAE,SAAS;QAChB,MAAM,EAAE,KAAK,IAAI,EAAE,CAAC,SAAS;KAC7B,CAAC,CAAC;IAEH,MAAM,KAAK,GAAG,WAAW,CAAC,KAAK,IAAmB,EAAE;QACnD,uBAAuB,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,IAAI,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC;QAC5E,qBAAqB,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,IAAI,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC;QAE1E,IAAI,aAAa,GAAU,EAAE,CAAC;QAC9B,IAAI,eAAe,GAAU,EAAE,CAAC;QAChC,IAAI,gBAAgB,GAAG,KAAK,CAAC;QAC7B,IAAI,kBAAkB,GAAG,KAAK,CAAC;QAE/B,IAAI;YACH,eAAe,GAAG,CAAC,MAAM,IAAI,CAAC,sBAAsB,EAAE,CAAU,CAAC;SACjE;QAAC,OAAO,CAAC,EAAE;YACX,uBAAuB,CAAC;gBACvB,IAAI,EAAE,SAAS;gBACf,KAAK,EAAE,CAAC;gBACR,MAAM,EAAE,KAAK;aACb,CAAC,CAAC;YACH,gBAAgB,GAAG,IAAI,CAAC;SACxB;QAED,IAAI;YACH,aAAa,GAAG,MAAM,IAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC,MAAa,EAAE,EAAE,CAC3D,MAAM,CAAC,GAAG,CAAC,CAAC,OAAY,EAAE,EAAE,CAAC,CAAC;gBAC7B,GAAG,OAAO;gBACV,SAAS,EAAE,IAAI;gBACf,WAAW,EAAE,KAAK;aAClB,CAAC,CAAC,CACH,CAAC;SACF;QAAC,OAAO,CAAC,EAAE;YACX,qBAAqB,CAAC;gBACrB,IAAI,EAAE,SAAS;gBACf,KAAK,EAAE,CAAC;gBACR,MAAM,EAAE,KAAK;aACb,CAAC,CAAC;YACH,kBAAkB,GAAG,IAAI,CAAC;SAC1B;QAED,MAAM,iBAAiB,GAAU,EAAE,CAAC;QACpC,MAAM,mBAAmB,GAAU,EAAE,CAAC;QAEtC,IAAI,CAAC,gBAAgB,EAAE;YACtB,eAAe,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,EAAE;gBAC/B,MAAM,QAAQ,GAAG,aAAa,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,KAAK,GAAG,CAAC,EAAE,CAAC,CAAC;gBACpE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,EAAE;oBAC7B,mBAAmB,CAAC,IAAI,CAAC;wBACxB,GAAG,GAAG;wBACN,MAAM,EAAE,SAAS;wBACjB,kBAAkB,EAAE,GAAG,CAAC,OAAO;wBAC/B,SAAS,EAAE,GAAG,CAAC,SAAS;qBACxB,CAAC,CAAC;oBAEH,OAAO;iBACP;gBACD,MAAM,CAAC,YAAY,CAAC,GAAG,aAAa,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;gBACzD,MAAM,OAAO,GAAG;oBACf,GAAG,GAAG;oBACN,SAAS,EAAE,IAAI;oBACf,GAAG,CAAC,YAAY,IAAI;wBACnB,MAAM,EAAE,YAAY,CAAC,MAAM;wBAC3B,OAAO,EAAE,YAAY,CAAC,OAAO;wBAC7B,iBAAiB,EAAE,YAAY,CAAC,iBAAiB;qBACjD,CAAC;oBACF,SAAS,EAAE,GAAG,CAAC,SAAS;oBACxB,kBAAkB,EAAE,GAAG,CAAC,OAAO;iBAC/B,CAAC;gBAEF,iBAAiB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBAChC,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACnC,CAAC,CAAC,CAAC;YACH,uBAAuB,CAAC;gBACvB,IAAI,EAAE,SAAS;gBACf,MAAM,EAAE,KAAK;gBACb,IAAI,EAAE,mBAAmB;aACzB,CAAC,CAAC;SACH;QAED,IAAI,CAAC,kBAAkB,EAAE;YACxB,IAAI,aAAa,CAAC,MAAM,EAAE;gBACzB,iBAAiB,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,CAAC;aACzC;YAED,qBAAqB,CAAC;gBACrB,IAAI,EAAE,SAAS;gBACf,MAAM,EAAE,KAAK;gBACb,IAAI,EAAE,iBAAiB;aACvB,CAAC,CAAC;SACH;IACF,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,cAAc,GAAG,kBAAkB,CAAC,SAAS,cAAc;QAChE,OAAO,CAAC,oBAAoB,EAAE,kBAAkB,CAAC,CAAC;IACnD,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACd,MAAM,uBAAuB,GAAG,KAAK,EAAE,KAAa,EAAiB,EAAE;YACtE,IAAI,cAA+B,CAAC;YACpC,IAAI,YAAiB,CAAC;YAEtB,IAAI;gBACH,YAAY,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;aACxC;YAAC,OAAO,KAAK,EAAE;gBACf,cAAc,CAAC,KAAK,CAAC,CAAC;gBACtB,MAAM,KAAK,CAAC;aACZ;YAED,IAAI;gBACH,cAAc,GAAG,MAAM,IAAI,CAAC,qBAAqB,CAAC,KAAK,EAAE,YAAY,CAAC,OAAO,CAAC,CAAC;aAC/E;YAAC,OAAO,KAAK,EAAE;gBACf,cAAc,CAAC,KAAK,CAAC,CAAC;aACtB;YAED,IAAI,cAAc,KAAK,SAAS,EAAE;gBACjC,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,iBAAiB,EAAE,GAAG,YAAY,CAAC;gBAC5D,MAAM,MAAM,GAAG;oBACd,GAAG,cAAc;oBACjB,SAAS,EAAE,IAAI;oBACf,MAAM;oBACN,OAAO;oBACP,iBAAiB;oBACjB,kBAAkB,EAAE,cAAc,CAAC,OAAO;iBAC1C,CAAC;gBAEF,MAAM,CAAC,EAAE,aAAa,CAAC,GAAG,cAAc,EAAE,CAAC;gBAE3C,uBAAuB,CAAC;oBACvB,IAAI,EAAE,QAAQ;oBACd,GAAG,EAAE,MAAM;oBACX,MAAM,EAAE,KAAK;iBACb,CAAC,CAAC;gBAEH,IAAI,aAAa,CAAC,KAAK,EAAE;oBACxB,qBAAqB,CAAC;wBACrB,IAAI,EAAE,SAAS;wBACf,IAAI,EAAE,CAAC,GAAG,aAAa,CAAC,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC;wBAC3C,MAAM,EAAE,KAAK;qBACb,CAAC,CAAC;oBACH,OAAO;iBACP;gBAED,qBAAqB,CAAC;oBACrB,IAAI,EAAE,SAAS;oBACf,IAAI,EAAE,CAAC,MAAM,CAAC;oBACd,MAAM,EAAE,KAAK;iBACb,CAAC,CAAC;gBAEH,OAAO;aACP;YAED,qBAAqB,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,EAAE,YAAY,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC;QAC7E,CAAC,CAAC;QACF,MAAM,SAAS,GAAG;YACjB,SAAS,EAAE,uBAAuB;YAClC,WAAW,EAAE,uBAAuB;YACpC,WAAW,EAAE,CAAC,KAAa,EAAQ,EAAE;gBACpC,MAAM,CAAC,WAAW,CAAC,GAAG,cAAc,EAAE,CAAC;gBACvC,MAAM,GAAG,GAAG,WAAW,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAkB,EAAE,EAAE,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC;gBAEnF,qBAAqB,CAAC;oBACrB,IAAI,EAAE,QAAQ;oBACd,KAAK;oBACL,MAAM,EAAE,KAAK;iBACb,CAAC,CAAC;gBAEH,IAAI,CAAC,GAAG,EAAE;oBACT,OAAO;iBACP;gBAED,uBAAuB,CAAC;oBACvB,IAAI,EAAE,QAAQ;oBACd,MAAM,EAAE,KAAK;oBACb,GAAG,EAAE;wBACJ,GAAG,GAAG;wBACN,OAAO,EAAE,GAAG,EAAE,kBAAkB;wBAChC,SAAS,EAAE,KAAK;wBAChB,kBAAkB,EAAE,GAAG,EAAE,kBAAkB;qBAC3C;iBACD,CAAC,CAAC;YACJ,CAAC;YACD,iBAAiB,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,EAAwC,EAAQ,EAAE;gBACpF,MAAM,CAAC,WAAW,CAAC,GAAG,cAAc,EAAE,CAAC;gBACvC,MAAM,GAAG,GAAG,WAAW,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAkB,EAAE,EAAE,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC;gBACnF,IAAI,CAAC,GAAG,EAAE;oBACT,OAAO;iBACP;gBAED,GAAG,CAAC,MAAM,GAAG,MAAM,CAAC;gBAEpB,qBAAqB,CAAC;oBACrB,IAAI,EAAE,QAAQ;oBACd,GAAG,EAAE;wBACJ,GAAG,GAAG;wBACN,MAAM;qBACN;oBACD,MAAM,EAAE,KAAK;iBACb,CAAC,CAAC;gBAEH,uBAAuB,CAAC;oBACvB,IAAI,EAAE,QAAQ;oBACd,GAAG,EAAE;wBACJ,GAAG,GAAG;wBACN,MAAM;qBACN;oBACD,MAAM,EAAE,KAAK;iBACb,CAAC,CAAC;YACJ,CAAC;YACD,mBAAmB,EAAE,CAAC,EAAE,KAAK,EAAqB,EAAQ,EAAE;gBAC3D,qBAAqB,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC;gBACpE,uBAAuB,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC;YACvE,CAAC;SACD,CAAC;QACF,MAAM,mBAAmB,GAAG,iBAAiB,CAAC,SAAS,CAAC,CAAC;QACzD,IAAI;YACH,KAAK,EAAE,CAAC;SACR;gBAAS;YACT,6CAA6C;YAC7C,OAAO,mBAAmB,CAAC;SAC3B;IACF,CAAC,EAAE,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC,CAAC;IAC5B,OAAO,CACN,CAAC,WAAW,CAAC,QAAQ,CACpB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CACnB,KAAK,CAAC,CAAC,EAAE,aAAa,EAAE,kBAAkB,EAAE,eAAe,EAAE,oBAAoB,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAClG,CACF,CAAC;AACH,CAAC,CAAC;AACF,eAAe,YAAY,CAAC","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, FC, useReducer, Reducer, useCallback } from 'react';\n\nimport { AppEvents } from '../../../../app/apps/client/communication';\nimport { Apps } from '../../../../app/apps/client/orchestrator';\nimport { AsyncState, AsyncStatePhase } from '../../../lib/asyncState';\nimport { AppsContext } from './AppsContext';\nimport { handleAPIError } from './helpers';\nimport { App } from './types';\n\ntype ListenersMapping = {\n\treadonly [P in keyof typeof AppEvents]?: (...args: any[]) => void;\n};\n\nconst registerListeners = (listeners: ListenersMapping): (() => void) => {\n\tconst entries = Object.entries(listeners) as Exclude<\n\t\t{\n\t\t\t[K in keyof ListenersMapping]: [K, ListenersMapping[K]];\n\t\t}[keyof ListenersMapping],\n\t\tundefined\n\t>[];\n\tfor (const [event, callback] of entries) {\n\t\tApps.getWsListener()?.registerListener(AppEvents[event], callback);\n\t}\n\treturn (): void => {\n\t\tfor (const [event, callback] of entries) {\n\t\t\tApps.getWsListener()?.unregisterListener(AppEvents[event], callback);\n\t\t}\n\t};\n};\n\ntype Action =\n\t| { type: 'request'; reload: () => Promise<void> }\n\t| { type: 'update'; app: App; reload: () => Promise<void> }\n\t| { type: 'delete'; appId: string; reload: () => Promise<void> }\n\t| { type: 'invalidate'; appId: string; reload: () => Promise<void> }\n\t| { type: 'success'; apps: App[]; reload: () => Promise<void> }\n\t| { type: 'failure'; error: Error; reload: () => Promise<void> };\n\nconst sortByName = (apps: App[]): App[] => apps.sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1));\n\nconst reducer = (\n\tstate: AsyncState<{ apps: App[] }> & {\n\t\treload: () => Promise<void>;\n\t},\n\taction: Action,\n): AsyncState<{ apps: App[] }> & {\n\treload: () => Promise<void>;\n} => {\n\tswitch (action.type) {\n\t\tcase 'invalidate':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: action.reload,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.appId) {\n\t\t\t\t\t\t\t\treturn { ...app };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'update':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.app.id) {\n\t\t\t\t\t\t\t\treturn action.app;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'request':\n\t\t\treturn {\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tphase: AsyncStatePhase.LOADING,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'success':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: sortByName(action.apps) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'delete':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: state.value.apps.filter(({ id }) => id !== action.appId) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'failure':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: action.error,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nconst AppsProvider: FC = ({ children }) => {\n\tconst [marketplaceAppsState, dispatchMarketplaceApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst [installedAppsState, dispatchInstalledApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst fetch = useCallback(async (): Promise<void> => {\n\t\tdispatchMarketplaceApps({ type: 'request', reload: async () => undefined });\n\t\tdispatchInstalledApps({ type: 'request', reload: async () => undefined });\n\n\t\tlet installedApps: App[] = [];\n\t\tlet marketplaceApps: App[] = [];\n\t\tlet marketplaceError = false;\n\t\tlet installedAppsError = false;\n\n\t\ttry {\n\t\t\tmarketplaceApps = (await Apps.getAppsFromMarketplace()) as App[];\n\t\t} catch (e) {\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tmarketplaceError = true;\n\t\t}\n\n\t\ttry {\n\t\t\tinstalledApps = await Apps.getApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tmarketplace: false,\n\t\t\t\t})),\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tinstalledAppsError = true;\n\t\t}\n\n\t\tconst installedAppsData: App[] = [];\n\t\tconst marketplaceAppsData: App[] = [];\n\n\t\tif (!marketplaceError) {\n\t\t\tmarketplaceApps.forEach((app) => {\n\t\t\t\tconst appIndex = installedApps.findIndex(({ id }) => id === app.id);\n\t\t\t\tif (!installedApps[appIndex]) {\n\t\t\t\t\tmarketplaceAppsData.push({\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus: undefined,\n\t\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst [installedApp] = installedApps.splice(appIndex, 1);\n\t\t\t\tconst appData = {\n\t\t\t\t\t...app,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\t...(installedApp && {\n\t\t\t\t\t\tstatus: installedApp.status,\n\t\t\t\t\t\tversion: installedApp.version,\n\t\t\t\t\t\tlicenseValidation: installedApp.licenseValidation,\n\t\t\t\t\t}),\n\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t};\n\n\t\t\t\tinstalledAppsData.push(appData);\n\t\t\t\tmarketplaceAppsData.push(appData);\n\t\t\t});\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: marketplaceAppsData,\n\t\t\t});\n\t\t}\n\n\t\tif (!installedAppsError) {\n\t\t\tif (installedApps.length) {\n\t\t\t\tinstalledAppsData.push(...installedApps);\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: installedAppsData,\n\t\t\t});\n\t\t}\n\t}, []);\n\n\tconst getCurrentData = useMutableCallback(function getCurrentData() {\n\t\treturn [marketplaceAppsState, installedAppsState];\n\t});\n\n\tuseEffect(() => {\n\t\tconst handleAppAddedOrUpdated = async (appId: string): Promise<void> => {\n\t\t\tlet marketplaceApp: App | undefined;\n\t\t\tlet installedApp: App;\n\n\t\t\ttry {\n\t\t\t\tinstalledApp = await Apps.getApp(appId);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tmarketplaceApp = await Apps.getAppFromMarketplace(appId, installedApp.version);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\n\t\t\tif (marketplaceApp !== undefined) {\n\t\t\t\tconst { status, version, licenseValidation } = installedApp;\n\t\t\t\tconst record = {\n\t\t\t\t\t...marketplaceApp,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tstatus,\n\t\t\t\t\tversion,\n\t\t\t\t\tlicenseValidation,\n\t\t\t\t\tmarketplaceVersion: marketplaceApp.version,\n\t\t\t\t};\n\n\t\t\t\tconst [, installedApps] = getCurrentData();\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: record,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (installedApps.value) {\n\t\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tapps: [...installedApps.value.apps, record],\n\t\t\t\t\t\treload: fetch,\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tapps: [record],\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({ type: 'update', app: installedApp, reload: fetch });\n\t\t};\n\t\tconst listeners = {\n\t\t\tAPP_ADDED: handleAppAddedOrUpdated,\n\t\t\tAPP_UPDATED: handleAppAddedOrUpdated,\n\t\t\tAPP_REMOVED: (appId: string): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'delete',\n\t\t\t\t\tappId,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\treload: fetch,\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tversion: app?.marketplaceVersion,\n\t\t\t\t\t\tinstalled: false,\n\t\t\t\t\t\tmarketplaceVersion: app?.marketplaceVersion,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_STATUS_CHANGE: ({ appId, status }: { appId: string; status: AppStatus }): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tapp.status = status;\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_SETTING_UPDATED: ({ appId }: { appId: string }): void => {\n\t\t\t\tdispatchInstalledApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t\tdispatchMarketplaceApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t},\n\t\t};\n\t\tconst unregisterListeners = registerListeners(listeners);\n\t\ttry {\n\t\t\tfetch();\n\t\t} finally {\n\t\t\t// eslint-disable-next-line no-unsafe-finally\n\t\t\treturn unregisterListeners;\n\t\t}\n\t}, [fetch, getCurrentData]);\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{ installedApps: installedAppsState, marketplaceApps: marketplaceAppsState, reload: fetch }}\n\t\t/>\n\t);\n};\nexport default AppsProvider;\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppsProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/apps/AppsProvider.tsx"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _toConsumableArray;\n\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 1);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 2);\n\nvar _createForOfIteratorHelperLoose;\n\nmodule.link(\"@babel/runtime/helpers/createForOfIteratorHelperLoose\", {\n  default: function (v) {\n    _createForOfIteratorHelperLoose = v;\n  }\n}, 3);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 4);\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 0);\nvar React, useEffect, useReducer, useCallback;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useReducer: function (v) {\n    useReducer = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  }\n}, 1);\nvar AppEvents;\nmodule.link(\"../../../../app/apps/client/communication\", {\n  AppEvents: function (v) {\n    AppEvents = v;\n  }\n}, 2);\nvar Apps;\nmodule.link(\"../../../../app/apps/client/orchestrator\", {\n  Apps: function (v) {\n    Apps = v;\n  }\n}, 3);\nvar AsyncStatePhase;\nmodule.link(\"../../../lib/asyncState\", {\n  AsyncStatePhase: function (v) {\n    AsyncStatePhase = v;\n  }\n}, 4);\nvar AppsContext;\nmodule.link(\"./AppsContext\", {\n  AppsContext: function (v) {\n    AppsContext = v;\n  }\n}, 5);\nvar handleAPIError;\nmodule.link(\"./helpers\", {\n  handleAPIError: function (v) {\n    handleAPIError = v;\n  }\n}, 6);\n\nvar registerListeners = function (listeners) {\n  var entries = Object.entries(listeners);\n\n  for (var _i = 0, _entries = entries; _i < _entries.length; _i++) {\n    var _Apps$getWsListener;\n\n    var _ref = _entries[_i];\n\n    var _ref2 = _slicedToArray(_ref, 2);\n\n    var event = _ref2[0];\n    var callback = _ref2[1];\n    (_Apps$getWsListener = Apps.getWsListener()) === null || _Apps$getWsListener === void 0 ? void 0 : _Apps$getWsListener.registerListener(AppEvents[event], callback);\n  }\n\n  return function () {\n    for (var _iterator = _createForOfIteratorHelperLoose(entries), _step; !(_step = _iterator()).done;) {\n      var _Apps$getWsListener2;\n\n      var _ref3 = _step.value;\n\n      var _ref4 = _slicedToArray(_ref3, 2);\n\n      var _event = _ref4[0];\n      var _callback = _ref4[1];\n      (_Apps$getWsListener2 = Apps.getWsListener()) === null || _Apps$getWsListener2 === void 0 ? void 0 : _Apps$getWsListener2.unregisterListener(AppEvents[_event], _callback);\n    }\n  };\n};\n\nvar sortByName = function (apps) {\n  return apps.sort(function (a, b) {\n    return a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1;\n  });\n};\n\nvar reducer = function (state, action) {\n  switch (action.type) {\n    case 'invalidate':\n      if (state.phase !== AsyncStatePhase.RESOLVED) {\n        return state;\n      }\n\n      return {\n        phase: AsyncStatePhase.RESOLVED,\n        reload: action.reload,\n        value: {\n          apps: sortByName(state.value.apps.map(function (app) {\n            if (app.id === action.appId) {\n              return _objectSpread({}, app);\n            }\n\n            return app;\n          }))\n        },\n        error: undefined\n      };\n\n    case 'update':\n      if (state.phase !== AsyncStatePhase.RESOLVED) {\n        return state;\n      }\n\n      return {\n        phase: AsyncStatePhase.RESOLVED,\n        reload: function () {\n          function _callee() {\n            return _regeneratorRuntime.async(function () {\n              function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      return _context.abrupt(\"return\", undefined);\n\n                    case 1:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }\n\n              return _callee$;\n            }(), null, null, null, Promise);\n          }\n\n          return _callee;\n        }(),\n        value: {\n          apps: sortByName(state.value.apps.map(function (app) {\n            if (app.id === action.app.id) {\n              return action.app;\n            }\n\n            return app;\n          }))\n        },\n        error: undefined\n      };\n\n    case 'request':\n      return {\n        reload: function () {\n          function _callee2() {\n            return _regeneratorRuntime.async(function () {\n              function _callee2$(_context2) {\n                while (1) {\n                  switch (_context2.prev = _context2.next) {\n                    case 0:\n                      return _context2.abrupt(\"return\", undefined);\n\n                    case 1:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }\n              }\n\n              return _callee2$;\n            }(), null, null, null, Promise);\n          }\n\n          return _callee2;\n        }(),\n        phase: AsyncStatePhase.LOADING,\n        value: undefined,\n        error: undefined\n      };\n\n    case 'success':\n      return {\n        reload: action.reload,\n        phase: AsyncStatePhase.RESOLVED,\n        value: {\n          apps: sortByName(action.apps)\n        },\n        error: undefined\n      };\n\n    case 'delete':\n      if (state.phase !== AsyncStatePhase.RESOLVED) {\n        return state;\n      }\n\n      return {\n        reload: action.reload,\n        phase: AsyncStatePhase.RESOLVED,\n        value: {\n          apps: state.value.apps.filter(function (_ref5) {\n            var id = _ref5.id;\n            return id !== action.appId;\n          })\n        },\n        error: undefined\n      };\n\n    case 'failure':\n      return {\n        reload: action.reload,\n        phase: AsyncStatePhase.REJECTED,\n        value: undefined,\n        error: action.error\n      };\n\n    default:\n      return state;\n  }\n};\n\nvar AppsProvider = function (_ref6) {\n  var children = _ref6.children;\n\n  var _useReducer = useReducer(reducer, {\n    phase: AsyncStatePhase.LOADING,\n    value: undefined,\n    error: undefined,\n    reload: function () {\n      function _callee3() {\n        return _regeneratorRuntime.async(function () {\n          function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  return _context3.abrupt(\"return\", undefined);\n\n                case 1:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }\n\n          return _callee3$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee3;\n    }()\n  }),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      marketplaceAppsState = _useReducer2[0],\n      dispatchMarketplaceApps = _useReducer2[1];\n\n  var _useReducer3 = useReducer(reducer, {\n    phase: AsyncStatePhase.LOADING,\n    value: undefined,\n    error: undefined,\n    reload: function () {\n      function _callee4() {\n        return _regeneratorRuntime.async(function () {\n          function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  return _context4.abrupt(\"return\", undefined);\n\n                case 1:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }\n\n          return _callee4$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee4;\n    }()\n  }),\n      _useReducer4 = _slicedToArray(_useReducer3, 2),\n      installedAppsState = _useReducer4[0],\n      dispatchInstalledApps = _useReducer4[1];\n\n  var fetch = useCallback(function () {\n    function _callee7() {\n      var installedApps, marketplaceApps, marketplaceError, installedAppsError, installedAppsData, marketplaceAppsData;\n      return _regeneratorRuntime.async(function () {\n        function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                dispatchMarketplaceApps({\n                  type: 'request',\n                  reload: function () {\n                    function _callee5() {\n                      return _regeneratorRuntime.async(function () {\n                        function _callee5$(_context5) {\n                          while (1) {\n                            switch (_context5.prev = _context5.next) {\n                              case 0:\n                                return _context5.abrupt(\"return\", undefined);\n\n                              case 1:\n                              case \"end\":\n                                return _context5.stop();\n                            }\n                          }\n                        }\n\n                        return _callee5$;\n                      }(), null, null, null, Promise);\n                    }\n\n                    return _callee5;\n                  }()\n                });\n                dispatchInstalledApps({\n                  type: 'request',\n                  reload: function () {\n                    function _callee6() {\n                      return _regeneratorRuntime.async(function () {\n                        function _callee6$(_context6) {\n                          while (1) {\n                            switch (_context6.prev = _context6.next) {\n                              case 0:\n                                return _context6.abrupt(\"return\", undefined);\n\n                              case 1:\n                              case \"end\":\n                                return _context6.stop();\n                            }\n                          }\n                        }\n\n                        return _callee6$;\n                      }(), null, null, null, Promise);\n                    }\n\n                    return _callee6;\n                  }()\n                });\n                installedApps = [];\n                marketplaceApps = [];\n                marketplaceError = false;\n                installedAppsError = false;\n                _context7.prev = 6;\n                _context7.next = 9;\n                return _regeneratorRuntime.awrap(Apps.getAppsFromMarketplace());\n\n              case 9:\n                marketplaceApps = _context7.sent;\n                _context7.next = 16;\n                break;\n\n              case 12:\n                _context7.prev = 12;\n                _context7.t0 = _context7[\"catch\"](6);\n                dispatchMarketplaceApps({\n                  type: 'failure',\n                  error: _context7.t0,\n                  reload: fetch\n                });\n                marketplaceError = true;\n\n              case 16:\n                _context7.prev = 16;\n                _context7.next = 19;\n                return _regeneratorRuntime.awrap(Apps.getApps().then(function (result) {\n                  return result.map(function (current) {\n                    return _objectSpread(_objectSpread({}, current), {}, {\n                      installed: true,\n                      marketplace: false\n                    });\n                  });\n                }));\n\n              case 19:\n                installedApps = _context7.sent;\n                _context7.next = 26;\n                break;\n\n              case 22:\n                _context7.prev = 22;\n                _context7.t1 = _context7[\"catch\"](16);\n                dispatchInstalledApps({\n                  type: 'failure',\n                  error: _context7.t1,\n                  reload: fetch\n                });\n                installedAppsError = true;\n\n              case 26:\n                installedAppsData = [];\n                marketplaceAppsData = [];\n\n                if (!marketplaceError) {\n                  marketplaceApps.forEach(function (app) {\n                    var appIndex = installedApps.findIndex(function (_ref7) {\n                      var id = _ref7.id;\n                      return id === app.id;\n                    });\n\n                    if (!installedApps[appIndex]) {\n                      marketplaceAppsData.push(_objectSpread(_objectSpread({}, app), {}, {\n                        status: undefined,\n                        marketplaceVersion: app.version,\n                        bundledIn: app.bundledIn\n                      }));\n                      return;\n                    }\n\n                    var _installedApps$splice = installedApps.splice(appIndex, 1),\n                        _installedApps$splice2 = _slicedToArray(_installedApps$splice, 1),\n                        installedApp = _installedApps$splice2[0];\n\n                    var appData = _objectSpread(_objectSpread(_objectSpread({}, app), {}, {\n                      installed: true\n                    }, installedApp && {\n                      status: installedApp.status,\n                      version: installedApp.version,\n                      licenseValidation: installedApp.licenseValidation\n                    }), {}, {\n                      bundledIn: app.bundledIn,\n                      marketplaceVersion: app.version\n                    });\n\n                    installedAppsData.push(appData);\n                    marketplaceAppsData.push(appData);\n                  });\n                  dispatchMarketplaceApps({\n                    type: 'success',\n                    reload: fetch,\n                    apps: marketplaceAppsData\n                  });\n                }\n\n                if (!installedAppsError) {\n                  if (installedApps.length) {\n                    installedAppsData.push.apply(installedAppsData, _toConsumableArray(installedApps));\n                  }\n\n                  dispatchInstalledApps({\n                    type: 'success',\n                    reload: fetch,\n                    apps: installedAppsData\n                  });\n                }\n\n              case 30:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }\n\n        return _callee7$;\n      }(), null, null, [[6, 12], [16, 22]], Promise);\n    }\n\n    return _callee7;\n  }(), []);\n  var getCurrentData = useMutableCallback(function () {\n    function getCurrentData() {\n      return [marketplaceAppsState, installedAppsState];\n    }\n\n    return getCurrentData;\n  }());\n  useEffect(function () {\n    var handleAppAddedOrUpdated = function () {\n      function _callee8(appId) {\n        var marketplaceApp, installedApp, _installedApp, status, version, licenseValidation, record, _getCurrentData, _getCurrentData2, installedApps;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee8$(_context8) {\n            while (1) {\n              switch (_context8.prev = _context8.next) {\n                case 0:\n                  _context8.prev = 0;\n                  _context8.next = 3;\n                  return _regeneratorRuntime.awrap(Apps.getApp(appId));\n\n                case 3:\n                  installedApp = _context8.sent;\n                  _context8.next = 10;\n                  break;\n\n                case 6:\n                  _context8.prev = 6;\n                  _context8.t0 = _context8[\"catch\"](0);\n                  handleAPIError(_context8.t0);\n                  throw _context8.t0;\n\n                case 10:\n                  _context8.prev = 10;\n                  _context8.next = 13;\n                  return _regeneratorRuntime.awrap(Apps.getAppFromMarketplace(appId, installedApp.version));\n\n                case 13:\n                  marketplaceApp = _context8.sent;\n                  _context8.next = 19;\n                  break;\n\n                case 16:\n                  _context8.prev = 16;\n                  _context8.t1 = _context8[\"catch\"](10);\n                  handleAPIError(_context8.t1);\n\n                case 19:\n                  if (!(marketplaceApp !== undefined)) {\n                    _context8.next = 29;\n                    break;\n                  }\n\n                  _installedApp = installedApp, status = _installedApp.status, version = _installedApp.version, licenseValidation = _installedApp.licenseValidation;\n                  record = _objectSpread(_objectSpread({}, marketplaceApp), {}, {\n                    installed: true,\n                    status: status,\n                    version: version,\n                    licenseValidation: licenseValidation,\n                    marketplaceVersion: marketplaceApp.version\n                  });\n                  _getCurrentData = getCurrentData(), _getCurrentData2 = _slicedToArray(_getCurrentData, 2), installedApps = _getCurrentData2[1];\n                  dispatchMarketplaceApps({\n                    type: 'update',\n                    app: record,\n                    reload: fetch\n                  });\n\n                  if (!installedApps.value) {\n                    _context8.next = 27;\n                    break;\n                  }\n\n                  dispatchInstalledApps({\n                    type: 'success',\n                    apps: [].concat(_toConsumableArray(installedApps.value.apps), [record]),\n                    reload: fetch\n                  });\n                  return _context8.abrupt(\"return\");\n\n                case 27:\n                  dispatchInstalledApps({\n                    type: 'success',\n                    apps: [record],\n                    reload: fetch\n                  });\n                  return _context8.abrupt(\"return\");\n\n                case 29:\n                  dispatchInstalledApps({\n                    type: 'update',\n                    app: installedApp,\n                    reload: fetch\n                  });\n\n                case 30:\n                case \"end\":\n                  return _context8.stop();\n              }\n            }\n          }\n\n          return _callee8$;\n        }(), null, null, [[0, 6], [10, 16]], Promise);\n      }\n\n      return _callee8;\n    }();\n\n    var listeners = {\n      APP_ADDED: handleAppAddedOrUpdated,\n      APP_UPDATED: handleAppAddedOrUpdated,\n      APP_REMOVED: function (appId) {\n        var _updatedData$value;\n\n        var _getCurrentData3 = getCurrentData(),\n            _getCurrentData4 = _slicedToArray(_getCurrentData3, 1),\n            updatedData = _getCurrentData4[0];\n\n        var app = (_updatedData$value = updatedData.value) === null || _updatedData$value === void 0 ? void 0 : _updatedData$value.apps.find(function (_ref8) {\n          var id = _ref8.id;\n          return id === appId;\n        });\n        dispatchInstalledApps({\n          type: 'delete',\n          appId: appId,\n          reload: fetch\n        });\n\n        if (!app) {\n          return;\n        }\n\n        dispatchMarketplaceApps({\n          type: 'update',\n          reload: fetch,\n          app: _objectSpread(_objectSpread({}, app), {}, {\n            version: app === null || app === void 0 ? void 0 : app.marketplaceVersion,\n            installed: false,\n            marketplaceVersion: app === null || app === void 0 ? void 0 : app.marketplaceVersion\n          })\n        });\n      },\n      APP_STATUS_CHANGE: function (_ref9) {\n        var _updatedData$value2;\n\n        var appId = _ref9.appId,\n            status = _ref9.status;\n\n        var _getCurrentData5 = getCurrentData(),\n            _getCurrentData6 = _slicedToArray(_getCurrentData5, 1),\n            updatedData = _getCurrentData6[0];\n\n        var app = (_updatedData$value2 = updatedData.value) === null || _updatedData$value2 === void 0 ? void 0 : _updatedData$value2.apps.find(function (_ref10) {\n          var id = _ref10.id;\n          return id === appId;\n        });\n\n        if (!app) {\n          return;\n        }\n\n        app.status = status;\n        dispatchInstalledApps({\n          type: 'update',\n          app: _objectSpread(_objectSpread({}, app), {}, {\n            status: status\n          }),\n          reload: fetch\n        });\n        dispatchMarketplaceApps({\n          type: 'update',\n          app: _objectSpread(_objectSpread({}, app), {}, {\n            status: status\n          }),\n          reload: fetch\n        });\n      },\n      APP_SETTING_UPDATED: function (_ref11) {\n        var appId = _ref11.appId;\n        dispatchInstalledApps({\n          type: 'invalidate',\n          appId: appId,\n          reload: fetch\n        });\n        dispatchMarketplaceApps({\n          type: 'invalidate',\n          appId: appId,\n          reload: fetch\n        });\n      }\n    };\n    var unregisterListeners = registerListeners(listeners);\n\n    try {\n      fetch();\n    } finally {\n      // eslint-disable-next-line no-unsafe-finally\n      return unregisterListeners;\n    }\n  }, [fetch, getCurrentData]);\n  return /*#__PURE__*/React.createElement(AppsContext.Provider, {\n    children: children,\n    value: {\n      installedApps: installedAppsState,\n      marketplaceApps: marketplaceAppsState,\n      reload: fetch\n    }\n  });\n};\n\nmodule.exportDefault(AppsProvider);","map":{"version":3,"sources":["client/views/admin/apps/AppsProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, FC, useReducer, Reducer, useCallback } from 'react';\n\nimport { AppEvents } from '../../../../app/apps/client/communication';\nimport { Apps } from '../../../../app/apps/client/orchestrator';\nimport { AsyncState, AsyncStatePhase } from '../../../lib/asyncState';\nimport { AppsContext } from './AppsContext';\nimport { handleAPIError } from './helpers';\nimport { App } from './types';\n\ntype ListenersMapping = {\n\treadonly [P in keyof typeof AppEvents]?: (...args: any[]) => void;\n};\n\nconst registerListeners = (listeners: ListenersMapping): (() => void) => {\n\tconst entries = Object.entries(listeners) as Exclude<\n\t\t{\n\t\t\t[K in keyof ListenersMapping]: [K, ListenersMapping[K]];\n\t\t}[keyof ListenersMapping],\n\t\tundefined\n\t>[];\n\tfor (const [event, callback] of entries) {\n\t\tApps.getWsListener()?.registerListener(AppEvents[event], callback);\n\t}\n\treturn (): void => {\n\t\tfor (const [event, callback] of entries) {\n\t\t\tApps.getWsListener()?.unregisterListener(AppEvents[event], callback);\n\t\t}\n\t};\n};\n\ntype Action =\n\t| { type: 'request'; reload: () => Promise<void> }\n\t| { type: 'update'; app: App; reload: () => Promise<void> }\n\t| { type: 'delete'; appId: string; reload: () => Promise<void> }\n\t| { type: 'invalidate'; appId: string; reload: () => Promise<void> }\n\t| { type: 'success'; apps: App[]; reload: () => Promise<void> }\n\t| { type: 'failure'; error: Error; reload: () => Promise<void> };\n\nconst sortByName = (apps: App[]): App[] => apps.sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1));\n\nconst reducer = (\n\tstate: AsyncState<{ apps: App[] }> & {\n\t\treload: () => Promise<void>;\n\t},\n\taction: Action,\n): AsyncState<{ apps: App[] }> & {\n\treload: () => Promise<void>;\n} => {\n\tswitch (action.type) {\n\t\tcase 'invalidate':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: action.reload,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.appId) {\n\t\t\t\t\t\t\t\treturn { ...app };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'update':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.app.id) {\n\t\t\t\t\t\t\t\treturn action.app;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'request':\n\t\t\treturn {\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tphase: AsyncStatePhase.LOADING,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'success':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: sortByName(action.apps) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'delete':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: state.value.apps.filter(({ id }) => id !== action.appId) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'failure':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: action.error,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nconst AppsProvider: FC = ({ children }) => {\n\tconst [marketplaceAppsState, dispatchMarketplaceApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst [installedAppsState, dispatchInstalledApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst fetch = useCallback(async (): Promise<void> => {\n\t\tdispatchMarketplaceApps({ type: 'request', reload: async () => undefined });\n\t\tdispatchInstalledApps({ type: 'request', reload: async () => undefined });\n\n\t\tlet installedApps: App[] = [];\n\t\tlet marketplaceApps: App[] = [];\n\t\tlet marketplaceError = false;\n\t\tlet installedAppsError = false;\n\n\t\ttry {\n\t\t\tmarketplaceApps = (await Apps.getAppsFromMarketplace()) as App[];\n\t\t} catch (e) {\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tmarketplaceError = true;\n\t\t}\n\n\t\ttry {\n\t\t\tinstalledApps = await Apps.getApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tmarketplace: false,\n\t\t\t\t})),\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tinstalledAppsError = true;\n\t\t}\n\n\t\tconst installedAppsData: App[] = [];\n\t\tconst marketplaceAppsData: App[] = [];\n\n\t\tif (!marketplaceError) {\n\t\t\tmarketplaceApps.forEach((app) => {\n\t\t\t\tconst appIndex = installedApps.findIndex(({ id }) => id === app.id);\n\t\t\t\tif (!installedApps[appIndex]) {\n\t\t\t\t\tmarketplaceAppsData.push({\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus: undefined,\n\t\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst [installedApp] = installedApps.splice(appIndex, 1);\n\t\t\t\tconst appData = {\n\t\t\t\t\t...app,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\t...(installedApp && {\n\t\t\t\t\t\tstatus: installedApp.status,\n\t\t\t\t\t\tversion: installedApp.version,\n\t\t\t\t\t\tlicenseValidation: installedApp.licenseValidation,\n\t\t\t\t\t}),\n\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t};\n\n\t\t\t\tinstalledAppsData.push(appData);\n\t\t\t\tmarketplaceAppsData.push(appData);\n\t\t\t});\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: marketplaceAppsData,\n\t\t\t});\n\t\t}\n\n\t\tif (!installedAppsError) {\n\t\t\tif (installedApps.length) {\n\t\t\t\tinstalledAppsData.push(...installedApps);\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: installedAppsData,\n\t\t\t});\n\t\t}\n\t}, []);\n\n\tconst getCurrentData = useMutableCallback(function getCurrentData() {\n\t\treturn [marketplaceAppsState, installedAppsState];\n\t});\n\n\tuseEffect(() => {\n\t\tconst handleAppAddedOrUpdated = async (appId: string): Promise<void> => {\n\t\t\tlet marketplaceApp: App | undefined;\n\t\t\tlet installedApp: App;\n\n\t\t\ttry {\n\t\t\t\tinstalledApp = await Apps.getApp(appId);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tmarketplaceApp = await Apps.getAppFromMarketplace(appId, installedApp.version);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\n\t\t\tif (marketplaceApp !== undefined) {\n\t\t\t\tconst { status, version, licenseValidation } = installedApp;\n\t\t\t\tconst record = {\n\t\t\t\t\t...marketplaceApp,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tstatus,\n\t\t\t\t\tversion,\n\t\t\t\t\tlicenseValidation,\n\t\t\t\t\tmarketplaceVersion: marketplaceApp.version,\n\t\t\t\t};\n\n\t\t\t\tconst [, installedApps] = getCurrentData();\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: record,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (installedApps.value) {\n\t\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tapps: [...installedApps.value.apps, record],\n\t\t\t\t\t\treload: fetch,\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tapps: [record],\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({ type: 'update', app: installedApp, reload: fetch });\n\t\t};\n\t\tconst listeners = {\n\t\t\tAPP_ADDED: handleAppAddedOrUpdated,\n\t\t\tAPP_UPDATED: handleAppAddedOrUpdated,\n\t\t\tAPP_REMOVED: (appId: string): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'delete',\n\t\t\t\t\tappId,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\treload: fetch,\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tversion: app?.marketplaceVersion,\n\t\t\t\t\t\tinstalled: false,\n\t\t\t\t\t\tmarketplaceVersion: app?.marketplaceVersion,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_STATUS_CHANGE: ({ appId, status }: { appId: string; status: AppStatus }): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tapp.status = status;\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_SETTING_UPDATED: ({ appId }: { appId: string }): void => {\n\t\t\t\tdispatchInstalledApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t\tdispatchMarketplaceApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t},\n\t\t};\n\t\tconst unregisterListeners = registerListeners(listeners);\n\t\ttry {\n\t\t\tfetch();\n\t\t} finally {\n\t\t\t// eslint-disable-next-line no-unsafe-finally\n\t\t\treturn unregisterListeners;\n\t\t}\n\t}, [fetch, getCurrentData]);\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{ installedApps: installedAppsState, marketplaceApps: marketplaceAppsState, reload: fetch }}\n\t\t/>\n\t);\n};\nexport default AppsProvider;\n"],"sourceRoot":""},"sourceType":"module","hash":"ab542a21c899a07d9f46b134d0e1ba89792304b1"}
