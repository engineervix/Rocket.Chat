{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/providers/RoomProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/providers/RoomProvider.tsx","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/providers/RoomProvider.tsx","inputSourceMap":{"version":3,"file":"client/views/room/providers/RoomProvider.tsx","sourceRoot":"","sources":["client/views/room/providers/RoomProvider.tsx"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,EAAa,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,OAAO,CAAC;AAEnE,OAAO,EAAE,UAAU,EAAE,MAAM,oBAAoB,CAAC;AAEhD,OAAO,EAAE,mBAAmB,EAAE,MAAM,+BAA+B,CAAC;AACpE,OAAO,EAAE,WAAW,EAAE,aAAa,EAAE,MAAM,0BAA0B,CAAC;AACtE,OAAO,EAAE,eAAe,EAAE,MAAM,yBAAyB,CAAC;AAC1D,OAAO,EAAE,eAAe,EAAE,MAAM,oCAAoC,CAAC;AACrE,OAAO,QAAQ,MAAM,kBAAkB,CAAC;AACxC,OAAO,EAAE,WAAW,EAAE,MAAM,yBAAyB,CAAC;AACtD,OAAO,eAAe,MAAM,mBAAmB,CAAC;AAOhD,MAAM,MAAM,GAAG,EAAE,CAAC;AAElB,MAAM,YAAY,GAAG,CAAC,EAAE,GAAG,EAAE,QAAQ,EAAS,EAAe,EAAE;IAC9D,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,aAAa,CAAC,GAAG,CAAC,CAAC;IAElD,MAAM,UAAU,GAAG,OAAO,CAAC,mBAAmB,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,CAAC;IAC7D,MAAM,OAAO,GAAG,OAAO,CAAC,GAAG,EAAE;QAC5B,IAAI,CAAC,IAAI,EAAE;YACV,OAAO,IAAI,CAAC;SACZ;QACD,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,OAAO;YACN,UAAU;YACV,GAAG;YACH,IAAI,EAAE,EAAE,GAAG,IAAI,EAAE,IAAI,EAAE,eAAe,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE;SAClE,CAAC;IACH,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,UAAU,CAAC,CAAC,CAAC;IAE5B,SAAS,CAAC,GAAG,EAAE;QACd,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACtB,OAAO,GAAS,EAAE;YACjB,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACvB,CAAC,CAAC;IACH,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;IAEV,SAAS,CAAC,GAAG,EAAE;QACd,IAAI,CAAC,UAAU,EAAE;YAChB,OAAO,GAAS,EAAE,CAAC,SAAS,CAAC;SAC7B;QAED,UAAU,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QAC1B,OAAO,GAAS,EAAE;YACjB,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QACxB,CAAC,CAAC;IACH,CAAC,EAAE,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC,CAAC;IAEtB,IAAI,KAAK,KAAK,eAAe,CAAC,OAAO,IAAI,CAAC,IAAI,EAAE;QAC/C,OAAO,CAAC,QAAQ,CAAC,AAAD,EAAG,CAAC;KACpB;IAED,OAAO,CACN,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,CACpC;GAAA,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,eAAe,CACzD;EAAA,EAAE,WAAW,CAAC,QAAQ,CAAC,CACvB,CAAC;AACH,CAAC,CAAC;AAEF,eAAe,IAAI,CAAC,YAAY,CAAC,CAAC","sourcesContent":["import React, { ReactNode, useMemo, memo, useEffect } from 'react';\n\nimport { UserAction } from '../../../../app/ui';\nimport { IRoom } from '../../../../definition/IRoom';\nimport { useUserSubscription } from '../../../contexts/UserContext';\nimport { RoomManager, useHandleRoom } from '../../../lib/RoomManager';\nimport { AsyncStatePhase } from '../../../lib/asyncState';\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\nimport Skeleton from '../Room/Skeleton';\nimport { RoomContext } from '../contexts/RoomContext';\nimport ToolboxProvider from './ToolboxProvider';\n\nexport type Props = {\n\tchildren: ReactNode;\n\trid: IRoom['_id'];\n};\n\nconst fields = {};\n\nconst RoomProvider = ({ rid, children }: Props): JSX.Element => {\n\tconst { phase, value: room } = useHandleRoom(rid);\n\n\tconst subscribed = Boolean(useUserSubscription(rid, fields));\n\tconst context = useMemo(() => {\n\t\tif (!room) {\n\t\t\treturn null;\n\t\t}\n\t\troom._id = rid;\n\t\treturn {\n\t\t\tsubscribed,\n\t\t\trid,\n\t\t\troom: { ...room, name: roomCoordinator.getRoomName(room.t, room) },\n\t\t};\n\t}, [room, rid, subscribed]);\n\n\tuseEffect(() => {\n\t\tRoomManager.open(rid);\n\t\treturn (): void => {\n\t\t\tRoomManager.back(rid);\n\t\t};\n\t}, [rid]);\n\n\tuseEffect(() => {\n\t\tif (!subscribed) {\n\t\t\treturn (): void => undefined;\n\t\t}\n\n\t\tUserAction.addStream(rid);\n\t\treturn (): void => {\n\t\t\tUserAction.cancel(rid);\n\t\t};\n\t}, [rid, subscribed]);\n\n\tif (phase === AsyncStatePhase.LOADING || !room) {\n\t\treturn <Skeleton />;\n\t}\n\n\treturn (\n\t\t<RoomContext.Provider value={context}>\n\t\t\t<ToolboxProvider room={room}>{children}</ToolboxProvider>\n\t\t</RoomContext.Provider>\n\t);\n};\n\nexport default memo(RoomProvider);\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/providers/RoomProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/providers/RoomProvider.tsx"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet React, useMemo, memo, useEffect;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  },\n\n  memo(v) {\n    memo = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  }\n\n}, 0);\nlet UserAction;\nmodule.link(\"../../../../app/ui\", {\n  UserAction(v) {\n    UserAction = v;\n  }\n\n}, 1);\nlet useUserSubscription;\nmodule.link(\"../../../contexts/UserContext\", {\n  useUserSubscription(v) {\n    useUserSubscription = v;\n  }\n\n}, 2);\nlet RoomManager, useHandleRoom;\nmodule.link(\"../../../lib/RoomManager\", {\n  RoomManager(v) {\n    RoomManager = v;\n  },\n\n  useHandleRoom(v) {\n    useHandleRoom = v;\n  }\n\n}, 3);\nlet AsyncStatePhase;\nmodule.link(\"../../../lib/asyncState\", {\n  AsyncStatePhase(v) {\n    AsyncStatePhase = v;\n  }\n\n}, 4);\nlet roomCoordinator;\nmodule.link(\"../../../lib/rooms/roomCoordinator\", {\n  roomCoordinator(v) {\n    roomCoordinator = v;\n  }\n\n}, 5);\nlet Skeleton;\nmodule.link(\"../Room/Skeleton\", {\n  default(v) {\n    Skeleton = v;\n  }\n\n}, 6);\nlet RoomContext;\nmodule.link(\"../contexts/RoomContext\", {\n  RoomContext(v) {\n    RoomContext = v;\n  }\n\n}, 7);\nlet ToolboxProvider;\nmodule.link(\"./ToolboxProvider\", {\n  default(v) {\n    ToolboxProvider = v;\n  }\n\n}, 8);\nconst fields = {};\n\nconst RoomProvider = _ref => {\n  let {\n    rid,\n    children\n  } = _ref;\n  const {\n    phase,\n    value: room\n  } = useHandleRoom(rid);\n  const subscribed = Boolean(useUserSubscription(rid, fields));\n  const context = useMemo(() => {\n    if (!room) {\n      return null;\n    }\n\n    room._id = rid;\n    return {\n      subscribed,\n      rid,\n      room: _objectSpread(_objectSpread({}, room), {}, {\n        name: roomCoordinator.getRoomName(room.t, room)\n      })\n    };\n  }, [room, rid, subscribed]);\n  useEffect(() => {\n    RoomManager.open(rid);\n    return () => {\n      RoomManager.back(rid);\n    };\n  }, [rid]);\n  useEffect(() => {\n    if (!subscribed) {\n      return () => undefined;\n    }\n\n    UserAction.addStream(rid);\n    return () => {\n      UserAction.cancel(rid);\n    };\n  }, [rid, subscribed]);\n\n  if (phase === AsyncStatePhase.LOADING || !room) {\n    return /*#__PURE__*/React.createElement(Skeleton, null);\n  }\n\n  return /*#__PURE__*/React.createElement(RoomContext.Provider, {\n    value: context\n  }, /*#__PURE__*/React.createElement(ToolboxProvider, {\n    room: room\n  }, children));\n};\n\nmodule.exportDefault( /*#__PURE__*/memo(RoomProvider));","map":{"version":3,"sources":["client/views/room/providers/RoomProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { ReactNode, useMemo, memo, useEffect } from 'react';\n\nimport { UserAction } from '../../../../app/ui';\nimport { IRoom } from '../../../../definition/IRoom';\nimport { useUserSubscription } from '../../../contexts/UserContext';\nimport { RoomManager, useHandleRoom } from '../../../lib/RoomManager';\nimport { AsyncStatePhase } from '../../../lib/asyncState';\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\nimport Skeleton from '../Room/Skeleton';\nimport { RoomContext } from '../contexts/RoomContext';\nimport ToolboxProvider from './ToolboxProvider';\n\nexport type Props = {\n\tchildren: ReactNode;\n\trid: IRoom['_id'];\n};\n\nconst fields = {};\n\nconst RoomProvider = ({ rid, children }: Props): JSX.Element => {\n\tconst { phase, value: room } = useHandleRoom(rid);\n\n\tconst subscribed = Boolean(useUserSubscription(rid, fields));\n\tconst context = useMemo(() => {\n\t\tif (!room) {\n\t\t\treturn null;\n\t\t}\n\t\troom._id = rid;\n\t\treturn {\n\t\t\tsubscribed,\n\t\t\trid,\n\t\t\troom: { ...room, name: roomCoordinator.getRoomName(room.t, room) },\n\t\t};\n\t}, [room, rid, subscribed]);\n\n\tuseEffect(() => {\n\t\tRoomManager.open(rid);\n\t\treturn (): void => {\n\t\t\tRoomManager.back(rid);\n\t\t};\n\t}, [rid]);\n\n\tuseEffect(() => {\n\t\tif (!subscribed) {\n\t\t\treturn (): void => undefined;\n\t\t}\n\n\t\tUserAction.addStream(rid);\n\t\treturn (): void => {\n\t\t\tUserAction.cancel(rid);\n\t\t};\n\t}, [rid, subscribed]);\n\n\tif (phase === AsyncStatePhase.LOADING || !room) {\n\t\treturn <Skeleton />;\n\t}\n\n\treturn (\n\t\t<RoomContext.Provider value={context}>\n\t\t\t<ToolboxProvider room={room}>{children}</ToolboxProvider>\n\t\t</RoomContext.Provider>\n\t);\n};\n\nexport default memo(RoomProvider);\n"],"sourceRoot":""},"sourceType":"module","hash":"af6282e77694eefc4fc7ed96043ca0a25e48e816"}
