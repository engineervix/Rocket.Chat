{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/hooks/useAppInfo.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/admin/apps/hooks/useAppInfo.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/hooks/useAppInfo.ts","inputSourceMap":{"version":3,"file":"client/views/admin/apps/hooks/useAppInfo.ts","sourceRoot":"","sources":["client/views/admin/apps/hooks/useAppInfo.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,EAAE,MAAM,OAAO,CAAC;AAExD,OAAO,EAAE,IAAI,EAAE,MAAM,6CAA6C,CAAC;AACnE,OAAO,EAAE,WAAW,EAAE,MAAM,gBAAgB,CAAC;AAE7C,OAAO,EAAE,cAAc,EAAE,MAAM,YAAY,CAAC;AAG5C,MAAM,YAAY,GAAG,KAAK,EAAE,KAAa,EAAE,UAAkB,EAA6B,EAAE;IAC3F,IAAI;QACH,MAAM,EAAE,SAAS,EAAE,GAAG,CAAC,MAAM,IAAI,CAAC,2BAA2B,CAAC,KAAK,EAAE,UAAU,CAAC,CAAQ,CAAC;QACzF,IAAI,CAAC,SAAS,EAAE;YACf,OAAO,EAAE,CAAC;SACV;QAED,OAAO,MAAM,OAAO,CAAC,GAAG,CACvB,SAAS,CAAC,GAAG,CAAC,KAAK,EAAE,MAAM,EAAE,EAAE;YAC9B,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YACzD,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAC/B,OAAO,MAAM,CAAC;QACf,CAAC,CAAC,CACF,CAAC;KACF;IAAC,OAAO,CAAC,EAAE;QACX,cAAc,CAAC,CAAC,CAAC,CAAC;QAClB,OAAO,EAAE,CAAC;KACV;AACF,CAAC,CAAC;AAEF,MAAM,WAAW,GAAG,KAAK,EAAE,KAAa,EAAE,SAAkB,EAA6D,EAAE;IAC1H,IAAI,CAAC,SAAS,EAAE;QACf,OAAO,EAAE,CAAC;KACV;IAED,IAAI;QACH,OAAO,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;KAClC;IAAC,OAAO,CAAC,EAAE;QACX,cAAc,CAAC,CAAC,CAAC,CAAC;QAClB,OAAO,EAAE,CAAC;KACV;AACF,CAAC,CAAC;AAEF,MAAM,OAAO,GAAG,KAAK,EAAE,KAAa,EAAE,SAAkB,EAAwC,EAAE;IACjG,IAAI,CAAC,SAAS,EAAE;QACf,OAAO,EAAE,CAAC;KACV;IAED,IAAI;QACH,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;KAC9B;IAAC,OAAO,CAAC,EAAE;QACX,cAAc,CAAC,CAAC,CAAC,CAAC;QAClB,OAAO,EAAE,CAAC;KACV;AACF,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,UAAU,GAAG,CAAC,KAAa,EAAuB,EAAE;IAChE,MAAM,EAAE,aAAa,EAAE,eAAe,EAAE,GAAG,UAAU,CAAC,WAAW,CAAC,CAAC;IAEnE,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,QAAQ,EAAW,CAAC;IAElD,SAAS,CAAC,GAAG,EAAE;QACd,MAAM,IAAI,GAAU,EAAE,CAAC;QAEvB,IAAI,eAAe,CAAC,KAAK,EAAE;YAC1B,IAAI,CAAC,IAAI,CAAC,GAAG,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;SACzC;QAED,IAAI,aAAa,CAAC,KAAK,EAAE;YACxB,IAAI,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;SACvC;QAED,MAAM,YAAY,GAAG,KAAK,IAAmB,EAAE;YAC9C,IAAI,CAAC,IAAI,EAAE,MAAM,IAAI,CAAC,KAAK,EAAE;gBAC5B,OAAO;aACP;YAED,MAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EAAE,KAAK,KAAK,CAAC,IAAI;gBACnD,GAAG,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAC7B,SAAS,EAAE,IAAI;gBACf,WAAW,EAAE,KAAK;aAClB,CAAC;YAEF,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;gBACrD,GAAG,CAAC,WAAW,KAAK,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,OAAO,CAAC;gBAClE,WAAW,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,SAAS,CAAC;gBAClC,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,SAAS,CAAC;aAC9B,CAAC,CAAC;YACH,UAAU,CAAC,EAAE,GAAG,GAAG,EAAE,SAAS,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC;QACnD,CAAC,CAAC;QAEF,YAAY,EAAE,CAAC;IAChB,CAAC,EAAE,CAAC,KAAK,EAAE,aAAa,EAAE,eAAe,CAAC,CAAC,CAAC;IAE5C,OAAO,OAAO,CAAC;AAChB,CAAC,CAAC","sourcesContent":["import { IApiEndpointMetadata } from '@rocket.chat/apps-engine/definition/api';\nimport { AppSettingsManager } from '@rocket.chat/apps-engine/server/managers/AppSettingsManager';\nimport { useState, useEffect, useContext } from 'react';\n\nimport { Apps } from '../../../../../app/apps/client/orchestrator';\nimport { AppsContext } from '../AppsContext';\nimport { AppInfo } from '../definitions/AppInfo';\nimport { handleAPIError } from '../helpers';\nimport { App } from '../types';\n\nconst getBundledIn = async (appId: string, appVersion: string): Promise<App['bundledIn']> => {\n\ttry {\n\t\tconst { bundledIn } = (await Apps.getLatestAppFromMarketplace(appId, appVersion)) as App;\n\t\tif (!bundledIn) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn await Promise.all(\n\t\t\tbundledIn.map(async (bundle) => {\n\t\t\t\tconst apps = await Apps.getAppsOnBundle(bundle.bundleId);\n\t\t\t\tbundle.apps = apps.slice(0, 4);\n\t\t\t\treturn bundle;\n\t\t\t}),\n\t\t);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nconst getSettings = async (appId: string, installed: boolean): Promise<ReturnType<AppSettingsManager['getAppSettings']>> => {\n\tif (!installed) {\n\t\treturn {};\n\t}\n\n\ttry {\n\t\treturn Apps.getAppSettings(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn {};\n\t}\n};\n\nconst getApis = async (appId: string, installed: boolean): Promise<Array<IApiEndpointMetadata>> => {\n\tif (!installed) {\n\t\treturn [];\n\t}\n\n\ttry {\n\t\treturn Apps.getAppApis(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nexport const useAppInfo = (appId: string): AppInfo | undefined => {\n\tconst { installedApps, marketplaceApps } = useContext(AppsContext);\n\n\tconst [appData, setAppData] = useState<AppInfo>();\n\n\tuseEffect(() => {\n\t\tconst apps: App[] = [];\n\n\t\tif (marketplaceApps.value) {\n\t\t\tapps.push(...marketplaceApps.value.apps);\n\t\t}\n\n\t\tif (installedApps.value) {\n\t\t\tapps.push(...installedApps.value.apps);\n\t\t}\n\n\t\tconst fetchAppInfo = async (): Promise<void> => {\n\t\t\tif (!apps?.length || !appId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst app = apps.find((app) => app.id === appId) ?? {\n\t\t\t\t...(await Apps.getApp(appId)),\n\t\t\t\tinstalled: true,\n\t\t\t\tmarketplace: false,\n\t\t\t};\n\n\t\t\tconst [bundledIn, settings, apis] = await Promise.all([\n\t\t\t\tapp.marketplace === false ? [] : getBundledIn(app.id, app.version),\n\t\t\t\tgetSettings(app.id, app.installed),\n\t\t\t\tgetApis(app.id, app.installed),\n\t\t\t]);\n\t\t\tsetAppData({ ...app, bundledIn, settings, apis });\n\t\t};\n\n\t\tfetchAppInfo();\n\t}, [appId, installedApps, marketplaceApps]);\n\n\treturn appData;\n};\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/hooks/useAppInfo.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/apps/hooks/useAppInfo.ts"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nmodule.export({\n  useAppInfo: () => useAppInfo\n});\nlet useState, useEffect, useContext;\nmodule.link(\"react\", {\n  useState(v) {\n    useState = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useContext(v) {\n    useContext = v;\n  }\n\n}, 0);\nlet Apps;\nmodule.link(\"../../../../../app/apps/client/orchestrator\", {\n  Apps(v) {\n    Apps = v;\n  }\n\n}, 1);\nlet AppsContext;\nmodule.link(\"../AppsContext\", {\n  AppsContext(v) {\n    AppsContext = v;\n  }\n\n}, 2);\nlet handleAPIError;\nmodule.link(\"../helpers\", {\n  handleAPIError(v) {\n    handleAPIError = v;\n  }\n\n}, 3);\n\nconst getBundledIn = async (appId, appVersion) => {\n  try {\n    const {\n      bundledIn\n    } = await Apps.getLatestAppFromMarketplace(appId, appVersion);\n\n    if (!bundledIn) {\n      return [];\n    }\n\n    return await Promise.all(bundledIn.map(async bundle => {\n      const apps = await Apps.getAppsOnBundle(bundle.bundleId);\n      bundle.apps = apps.slice(0, 4);\n      return bundle;\n    }));\n  } catch (e) {\n    handleAPIError(e);\n    return [];\n  }\n};\n\nconst getSettings = async (appId, installed) => {\n  if (!installed) {\n    return {};\n  }\n\n  try {\n    return Apps.getAppSettings(appId);\n  } catch (e) {\n    handleAPIError(e);\n    return {};\n  }\n};\n\nconst getApis = async (appId, installed) => {\n  if (!installed) {\n    return [];\n  }\n\n  try {\n    return Apps.getAppApis(appId);\n  } catch (e) {\n    handleAPIError(e);\n    return [];\n  }\n};\n\nconst useAppInfo = appId => {\n  const {\n    installedApps,\n    marketplaceApps\n  } = useContext(AppsContext);\n  const [appData, setAppData] = useState();\n  useEffect(() => {\n    const apps = [];\n\n    if (marketplaceApps.value) {\n      apps.push(...marketplaceApps.value.apps);\n    }\n\n    if (installedApps.value) {\n      apps.push(...installedApps.value.apps);\n    }\n\n    const fetchAppInfo = async () => {\n      var _apps$find;\n\n      if (!(apps !== null && apps !== void 0 && apps.length) || !appId) {\n        return;\n      }\n\n      const app = (_apps$find = apps.find(app => app.id === appId)) !== null && _apps$find !== void 0 ? _apps$find : _objectSpread(_objectSpread({}, await Apps.getApp(appId)), {}, {\n        installed: true,\n        marketplace: false\n      });\n      const [bundledIn, settings, apis] = await Promise.all([app.marketplace === false ? [] : getBundledIn(app.id, app.version), getSettings(app.id, app.installed), getApis(app.id, app.installed)]);\n      setAppData(_objectSpread(_objectSpread({}, app), {}, {\n        bundledIn,\n        settings,\n        apis\n      }));\n    };\n\n    fetchAppInfo();\n  }, [appId, installedApps, marketplaceApps]);\n  return appData;\n};","map":{"version":3,"sources":["client/views/admin/apps/hooks/useAppInfo.ts"],"names":[],"mappings":"AAEA,IAAA,aAAA;;AAAiB,MAAE,CAAA,IAAF,CAAa,sCAAb,EAAuC;AAAA,EAAA,OAAA,CAAA,CAAA,EAAA;AAAA,IAAA,aAAA,GAAA,CAAA;AAAA;;AAAA,CAAvC,EAAuC,CAAvC;AAAjB,MAAA,CAAO,MAAP,CAAS;AAAA,EAAA,UAAU,EAAA,MAAW;AAArB,CAAT;AAA0C,IAAA,QAAA,EAAc,SAAd,EAAc,UAAd;AAAc,MAAA,CAAA,IAAA,CAAA,OAAA,EAAA;AAAA,EAAA,QAAA,CAAA,CAAA,EAAA;AAAA,IAAA,QAAA,GAAA,CAAA;AAAA,GAAA;;AAAA,EAAA,SAAA,CAAA,CAAA,EAAA;AAAA,IAAA,SAAA,GAAA,CAAA;AAAA,GAAA;;AAAA,EAAA,UAAA,CAAA,CAAA,EAAA;AAAA,IAAA,UAAA,GAAA,CAAA;AAAA;;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,IAAA;AAAA,MAAA,CAAA,IAAA,CAAA,6CAAA,EAAA;AAAA,EAAA,IAAA,CAAA,CAAA,EAAA;AAAA,IAAA,IAAA,GAAA,CAAA;AAAA;;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,WAAA;AAAA,MAAA,CAAA,IAAA,CAAA,gBAAA,EAAA;AAAA,EAAA,WAAA,CAAA,CAAA,EAAA;AAAA,IAAA,WAAA,GAAA,CAAA;AAAA;;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,cAAA;AAAA,MAAA,CAAA,IAAA,CAAA,YAAA,EAAA;AAAA,EAAA,cAAA,CAAA,CAAA,EAAA;AAAA,IAAA,cAAA,GAAA,CAAA;AAAA;;AAAA,CAAA,EAAA,CAAA;;AAQxD,MAAM,YAAY,GAAG,OAAO,KAAP,EAAsB,UAAtB,KAAuE;AAC3F,MAAI;AACH,UAAM;AAAE,MAAA;AAAF,QAAiB,MAAM,IAAI,CAAC,2BAAL,CAAiC,KAAjC,EAAwC,UAAxC,CAA7B;;AACA,QAAI,CAAC,SAAL,EAAgB;AACf,aAAO,EAAP;AACA;;AAED,WAAO,MAAM,OAAO,CAAC,GAAR,CACZ,SAAS,CAAC,GAAV,CAAc,MAAO,MAAP,IAAiB;AAC9B,YAAM,IAAI,GAAG,MAAM,IAAI,CAAC,eAAL,CAAqB,MAAM,CAAC,QAA5B,CAAnB;AACA,MAAA,MAAM,CAAC,IAAP,GAAc,IAAI,CAAC,KAAL,CAAW,CAAX,EAAc,CAAd,CAAd;AACA,aAAO,MAAP;AACA,KAJD,CADY,CAAb;AAOA,GAbD,CAaE,OAAO,CAAP,EAAU;AACX,IAAA,cAAc,CAAC,CAAD,CAAd;AACA,WAAO,EAAP;AACA;AACD,CAlBD;;AAoBA,MAAM,WAAW,GAAG,OAAO,KAAP,EAAsB,SAAtB,KAAuG;AAC1H,MAAI,CAAC,SAAL,EAAgB;AACf,WAAO,EAAP;AACA;;AAED,MAAI;AACH,WAAO,IAAI,CAAC,cAAL,CAAoB,KAApB,CAAP;AACA,GAFD,CAEE,OAAO,CAAP,EAAU;AACX,IAAA,cAAc,CAAC,CAAD,CAAd;AACA,WAAO,EAAP;AACA;AACD,CAXD;;AAaA,MAAM,OAAO,GAAG,OAAO,KAAP,EAAsB,SAAtB,KAAkF;AACjG,MAAI,CAAC,SAAL,EAAgB;AACf,WAAO,EAAP;AACA;;AAED,MAAI;AACH,WAAO,IAAI,CAAC,UAAL,CAAgB,KAAhB,CAAP;AACA,GAFD,CAEE,OAAO,CAAP,EAAU;AACX,IAAA,cAAc,CAAC,CAAD,CAAd;AACA,WAAO,EAAP;AACA;AACD,CAXD;;AAaO,MAAM,UAAU,GAAI,KAAD,IAAuC;AAChE,QAAM;AAAE,IAAA,aAAF;AAAiB,IAAA;AAAjB,MAAqC,UAAU,CAAC,WAAD,CAArD;AAEA,QAAM,CAAC,OAAD,EAAU,UAAV,IAAwB,QAAQ,EAAtC;AAEA,EAAA,SAAS,CAAC,MAAK;AACd,UAAM,IAAI,GAAU,EAApB;;AAEA,QAAI,eAAe,CAAC,KAApB,EAA2B;AAC1B,MAAA,IAAI,CAAC,IAAL,CAAU,GAAG,eAAe,CAAC,KAAhB,CAAsB,IAAnC;AACA;;AAED,QAAI,aAAa,CAAC,KAAlB,EAAyB;AACxB,MAAA,IAAI,CAAC,IAAL,CAAU,GAAG,aAAa,CAAC,KAAd,CAAoB,IAAjC;AACA;;AAED,UAAM,YAAY,GAAG,YAA0B;AAAA;;AAC9C,UAAI,EAAC,IAAD,aAAC,IAAD,eAAC,IAAI,CAAE,MAAP,KAAiB,CAAC,KAAtB,EAA6B;AAC5B;AACA;;AAED,YAAM,GAAG,iBAAG,IAAI,CAAC,IAAL,CAAW,GAAD,IAAS,GAAG,CAAC,EAAJ,KAAW,KAA9B,CAAH,mFACJ,MAAM,IAAI,CAAC,MAAL,CAAY,KAAZ,CADF;AAER,QAAA,SAAS,EAAE,IAFH;AAGR,QAAA,WAAW,EAAE;AAHL,QAAT;AAMA,YAAM,CAAC,SAAD,EAAY,QAAZ,EAAsB,IAAtB,IAA8B,MAAM,OAAO,CAAC,GAAR,CAAY,CACrD,GAAG,CAAC,WAAJ,KAAoB,KAApB,GAA4B,EAA5B,GAAiC,YAAY,CAAC,GAAG,CAAC,EAAL,EAAS,GAAG,CAAC,OAAb,CADQ,EAErD,WAAW,CAAC,GAAG,CAAC,EAAL,EAAS,GAAG,CAAC,SAAb,CAF0C,EAGrD,OAAO,CAAC,GAAG,CAAC,EAAL,EAAS,GAAG,CAAC,SAAb,CAH8C,CAAZ,CAA1C;AAKA,MAAA,UAAU,iCAAM,GAAN;AAAW,QAAA,SAAX;AAAsB,QAAA,QAAtB;AAAgC,QAAA;AAAhC,SAAV;AACA,KAjBD;;AAmBA,IAAA,YAAY;AACZ,GA/BQ,EA+BN,CAAC,KAAD,EAAQ,aAAR,EAAuB,eAAvB,CA/BM,CAAT;AAiCA,SAAO,OAAP;AACA,CAvCM","sourcesContent":["import { IApiEndpointMetadata } from '@rocket.chat/apps-engine/definition/api';\nimport { AppSettingsManager } from '@rocket.chat/apps-engine/server/managers/AppSettingsManager';\nimport { useState, useEffect, useContext } from 'react';\n\nimport { Apps } from '../../../../../app/apps/client/orchestrator';\nimport { AppsContext } from '../AppsContext';\nimport { AppInfo } from '../definitions/AppInfo';\nimport { handleAPIError } from '../helpers';\nimport { App } from '../types';\n\nconst getBundledIn = async (appId: string, appVersion: string): Promise<App['bundledIn']> => {\n\ttry {\n\t\tconst { bundledIn } = (await Apps.getLatestAppFromMarketplace(appId, appVersion)) as App;\n\t\tif (!bundledIn) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn await Promise.all(\n\t\t\tbundledIn.map(async (bundle) => {\n\t\t\t\tconst apps = await Apps.getAppsOnBundle(bundle.bundleId);\n\t\t\t\tbundle.apps = apps.slice(0, 4);\n\t\t\t\treturn bundle;\n\t\t\t}),\n\t\t);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nconst getSettings = async (appId: string, installed: boolean): Promise<ReturnType<AppSettingsManager['getAppSettings']>> => {\n\tif (!installed) {\n\t\treturn {};\n\t}\n\n\ttry {\n\t\treturn Apps.getAppSettings(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn {};\n\t}\n};\n\nconst getApis = async (appId: string, installed: boolean): Promise<Array<IApiEndpointMetadata>> => {\n\tif (!installed) {\n\t\treturn [];\n\t}\n\n\ttry {\n\t\treturn Apps.getAppApis(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nexport const useAppInfo = (appId: string): AppInfo | undefined => {\n\tconst { installedApps, marketplaceApps } = useContext(AppsContext);\n\n\tconst [appData, setAppData] = useState<AppInfo>();\n\n\tuseEffect(() => {\n\t\tconst apps: App[] = [];\n\n\t\tif (marketplaceApps.value) {\n\t\t\tapps.push(...marketplaceApps.value.apps);\n\t\t}\n\n\t\tif (installedApps.value) {\n\t\t\tapps.push(...installedApps.value.apps);\n\t\t}\n\n\t\tconst fetchAppInfo = async (): Promise<void> => {\n\t\t\tif (!apps?.length || !appId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst app = apps.find((app) => app.id === appId) ?? {\n\t\t\t\t...(await Apps.getApp(appId)),\n\t\t\t\tinstalled: true,\n\t\t\t\tmarketplace: false,\n\t\t\t};\n\n\t\t\tconst [bundledIn, settings, apis] = await Promise.all([\n\t\t\t\tapp.marketplace === false ? [] : getBundledIn(app.id, app.version),\n\t\t\t\tgetSettings(app.id, app.installed),\n\t\t\t\tgetApis(app.id, app.installed),\n\t\t\t]);\n\t\t\tsetAppData({ ...app, bundledIn, settings, apis });\n\t\t};\n\n\t\tfetchAppInfo();\n\t}, [appId, installedApps, marketplaceApps]);\n\n\treturn appData;\n};\n"],"sourceRoot":""},"sourceType":"module","hash":"c1e5cc74d6ae4e177d266905b5ca6b168300d8c3"}
