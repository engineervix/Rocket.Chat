{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppsProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/admin/apps/AppsProvider.tsx","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppsProvider.tsx","inputSourceMap":{"version":3,"file":"client/views/admin/apps/AppsProvider.tsx","sourceRoot":"","sources":["client/views/admin/apps/AppsProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, FC, useReducer, Reducer, useCallback } from 'react';\n\nimport { AppEvents } from '../../../../app/apps/client/communication';\nimport { Apps } from '../../../../app/apps/client/orchestrator';\nimport { AsyncState, AsyncStatePhase } from '../../../lib/asyncState';\nimport { AppsContext } from './AppsContext';\nimport { handleAPIError } from './helpers';\nimport { App } from './types';\n\ntype ListenersMapping = {\n\treadonly [P in keyof typeof AppEvents]?: (...args: any[]) => void;\n};\n\nconst registerListeners = (listeners: ListenersMapping): (() => void) => {\n\tconst entries = Object.entries(listeners) as Exclude<\n\t\t{\n\t\t\t[K in keyof ListenersMapping]: [K, ListenersMapping[K]];\n\t\t}[keyof ListenersMapping],\n\t\tundefined\n\t>[];\n\tfor (const [event, callback] of entries) {\n\t\tApps.getWsListener()?.registerListener(AppEvents[event], callback);\n\t}\n\treturn (): void => {\n\t\tfor (const [event, callback] of entries) {\n\t\t\tApps.getWsListener()?.unregisterListener(AppEvents[event], callback);\n\t\t}\n\t};\n};\n\ntype Action =\n\t| { type: 'request'; reload: () => Promise<void> }\n\t| { type: 'update'; app: App; reload: () => Promise<void> }\n\t| { type: 'delete'; appId: string; reload: () => Promise<void> }\n\t| { type: 'invalidate'; appId: string; reload: () => Promise<void> }\n\t| { type: 'success'; apps: App[]; reload: () => Promise<void> }\n\t| { type: 'failure'; error: Error; reload: () => Promise<void> };\n\nconst sortByName = (apps: App[]): App[] => apps.sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1));\n\nconst reducer = (\n\tstate: AsyncState<{ apps: App[] }> & {\n\t\treload: () => Promise<void>;\n\t},\n\taction: Action,\n): AsyncState<{ apps: App[] }> & {\n\treload: () => Promise<void>;\n} => {\n\tswitch (action.type) {\n\t\tcase 'invalidate':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: action.reload,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.appId) {\n\t\t\t\t\t\t\t\treturn { ...app };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'update':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.app.id) {\n\t\t\t\t\t\t\t\treturn action.app;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'request':\n\t\t\treturn {\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tphase: AsyncStatePhase.LOADING,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'success':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: sortByName(action.apps) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'delete':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: state.value.apps.filter(({ id }) => id !== action.appId) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'failure':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: action.error,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nconst AppsProvider: FC = ({ children }) => {\n\tconst [marketplaceAppsState, dispatchMarketplaceApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst [installedAppsState, dispatchInstalledApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst fetch = useCallback(async (): Promise<void> => {\n\t\tdispatchMarketplaceApps({ type: 'request', reload: async () => undefined });\n\t\tdispatchInstalledApps({ type: 'request', reload: async () => undefined });\n\n\t\tlet installedApps: App[] = [];\n\t\tlet marketplaceApps: App[] = [];\n\t\tlet marketplaceError = false;\n\t\tlet installedAppsError = false;\n\n\t\ttry {\n\t\t\tmarketplaceApps = (await Apps.getAppsFromMarketplace()) as App[];\n\t\t} catch (e) {\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tmarketplaceError = true;\n\t\t}\n\n\t\ttry {\n\t\t\tinstalledApps = await Apps.getApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tmarketplace: false,\n\t\t\t\t})),\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tinstalledAppsError = true;\n\t\t}\n\n\t\tconst installedAppsData: App[] = [];\n\t\tconst marketplaceAppsData: App[] = [];\n\n\t\tif (!marketplaceError) {\n\t\t\tmarketplaceApps.forEach((app) => {\n\t\t\t\tconst appIndex = installedApps.findIndex(({ id }) => id === app.id);\n\t\t\t\tif (!installedApps[appIndex]) {\n\t\t\t\t\tmarketplaceAppsData.push({\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus: undefined,\n\t\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst [installedApp] = installedApps.splice(appIndex, 1);\n\t\t\t\tconst appData = {\n\t\t\t\t\t...app,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\t...(installedApp && {\n\t\t\t\t\t\tstatus: installedApp.status,\n\t\t\t\t\t\tversion: installedApp.version,\n\t\t\t\t\t\tlicenseValidation: installedApp.licenseValidation,\n\t\t\t\t\t}),\n\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t};\n\n\t\t\t\tinstalledAppsData.push(appData);\n\t\t\t\tmarketplaceAppsData.push(appData);\n\t\t\t});\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: marketplaceAppsData,\n\t\t\t});\n\t\t}\n\n\t\tif (!installedAppsError) {\n\t\t\tif (installedApps.length) {\n\t\t\t\tinstalledAppsData.push(...installedApps);\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: installedAppsData,\n\t\t\t});\n\t\t}\n\t}, []);\n\n\tconst getCurrentData = useMutableCallback(function getCurrentData() {\n\t\treturn [marketplaceAppsState, installedAppsState];\n\t});\n\n\tuseEffect(() => {\n\t\tconst handleAppAddedOrUpdated = async (appId: string): Promise<void> => {\n\t\t\tlet marketplaceApp: App | undefined;\n\t\t\tlet installedApp: App;\n\n\t\t\ttry {\n\t\t\t\tinstalledApp = await Apps.getApp(appId);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tmarketplaceApp = await Apps.getAppFromMarketplace(appId, installedApp.version);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\n\t\t\tif (marketplaceApp !== undefined) {\n\t\t\t\tconst { status, version, licenseValidation } = installedApp;\n\t\t\t\tconst record = {\n\t\t\t\t\t...marketplaceApp,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tstatus,\n\t\t\t\t\tversion,\n\t\t\t\t\tlicenseValidation,\n\t\t\t\t\tmarketplaceVersion: marketplaceApp.version,\n\t\t\t\t};\n\n\t\t\t\tconst [, installedApps] = getCurrentData();\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: record,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (installedApps.value) {\n\t\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tapps: [...installedApps.value.apps, record],\n\t\t\t\t\t\treload: fetch,\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tapps: [record],\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({ type: 'update', app: installedApp, reload: fetch });\n\t\t};\n\t\tconst listeners = {\n\t\t\tAPP_ADDED: handleAppAddedOrUpdated,\n\t\t\tAPP_UPDATED: handleAppAddedOrUpdated,\n\t\t\tAPP_REMOVED: (appId: string): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'delete',\n\t\t\t\t\tappId,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\treload: fetch,\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tversion: app?.marketplaceVersion,\n\t\t\t\t\t\tinstalled: false,\n\t\t\t\t\t\tmarketplaceVersion: app?.marketplaceVersion,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_STATUS_CHANGE: ({ appId, status }: { appId: string; status: AppStatus }): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tapp.status = status;\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_SETTING_UPDATED: ({ appId }: { appId: string }): void => {\n\t\t\t\tdispatchInstalledApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t\tdispatchMarketplaceApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t},\n\t\t};\n\t\tconst unregisterListeners = registerListeners(listeners);\n\t\ttry {\n\t\t\tfetch();\n\t\t} finally {\n\t\t\t// eslint-disable-next-line no-unsafe-finally\n\t\t\treturn unregisterListeners;\n\t\t}\n\t}, [fetch, getCurrentData]);\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{ installedApps: installedAppsState, marketplaceApps: marketplaceAppsState, reload: fetch }}\n\t\t/>\n\t);\n};\nexport default AppsProvider;\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppsProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/apps/AppsProvider.tsx"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n\n}, 0);\nlet React, useEffect, useReducer, useCallback;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useReducer(v) {\n    useReducer = v;\n  },\n\n  useCallback(v) {\n    useCallback = v;\n  }\n\n}, 1);\nlet AppEvents;\nmodule.link(\"../../../../app/apps/client/communication\", {\n  AppEvents(v) {\n    AppEvents = v;\n  }\n\n}, 2);\nlet Apps;\nmodule.link(\"../../../../app/apps/client/orchestrator\", {\n  Apps(v) {\n    Apps = v;\n  }\n\n}, 3);\nlet AsyncStatePhase;\nmodule.link(\"../../../lib/asyncState\", {\n  AsyncStatePhase(v) {\n    AsyncStatePhase = v;\n  }\n\n}, 4);\nlet AppsContext;\nmodule.link(\"./AppsContext\", {\n  AppsContext(v) {\n    AppsContext = v;\n  }\n\n}, 5);\nlet handleAPIError;\nmodule.link(\"./helpers\", {\n  handleAPIError(v) {\n    handleAPIError = v;\n  }\n\n}, 6);\n\nconst registerListeners = listeners => {\n  const entries = Object.entries(listeners);\n\n  for (const [event, callback] of entries) {\n    var _Apps$getWsListener;\n\n    (_Apps$getWsListener = Apps.getWsListener()) === null || _Apps$getWsListener === void 0 ? void 0 : _Apps$getWsListener.registerListener(AppEvents[event], callback);\n  }\n\n  return () => {\n    for (const [event, callback] of entries) {\n      var _Apps$getWsListener2;\n\n      (_Apps$getWsListener2 = Apps.getWsListener()) === null || _Apps$getWsListener2 === void 0 ? void 0 : _Apps$getWsListener2.unregisterListener(AppEvents[event], callback);\n    }\n  };\n};\n\nconst sortByName = apps => apps.sort((a, b) => a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1);\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'invalidate':\n      if (state.phase !== AsyncStatePhase.RESOLVED) {\n        return state;\n      }\n\n      return {\n        phase: AsyncStatePhase.RESOLVED,\n        reload: action.reload,\n        value: {\n          apps: sortByName(state.value.apps.map(app => {\n            if (app.id === action.appId) {\n              return _objectSpread({}, app);\n            }\n\n            return app;\n          }))\n        },\n        error: undefined\n      };\n\n    case 'update':\n      if (state.phase !== AsyncStatePhase.RESOLVED) {\n        return state;\n      }\n\n      return {\n        phase: AsyncStatePhase.RESOLVED,\n        reload: async () => undefined,\n        value: {\n          apps: sortByName(state.value.apps.map(app => {\n            if (app.id === action.app.id) {\n              return action.app;\n            }\n\n            return app;\n          }))\n        },\n        error: undefined\n      };\n\n    case 'request':\n      return {\n        reload: async () => undefined,\n        phase: AsyncStatePhase.LOADING,\n        value: undefined,\n        error: undefined\n      };\n\n    case 'success':\n      return {\n        reload: action.reload,\n        phase: AsyncStatePhase.RESOLVED,\n        value: {\n          apps: sortByName(action.apps)\n        },\n        error: undefined\n      };\n\n    case 'delete':\n      if (state.phase !== AsyncStatePhase.RESOLVED) {\n        return state;\n      }\n\n      return {\n        reload: action.reload,\n        phase: AsyncStatePhase.RESOLVED,\n        value: {\n          apps: state.value.apps.filter(_ref => {\n            let {\n              id\n            } = _ref;\n            return id !== action.appId;\n          })\n        },\n        error: undefined\n      };\n\n    case 'failure':\n      return {\n        reload: action.reload,\n        phase: AsyncStatePhase.REJECTED,\n        value: undefined,\n        error: action.error\n      };\n\n    default:\n      return state;\n  }\n};\n\nconst AppsProvider = _ref2 => {\n  let {\n    children\n  } = _ref2;\n  const [marketplaceAppsState, dispatchMarketplaceApps] = useReducer(reducer, {\n    phase: AsyncStatePhase.LOADING,\n    value: undefined,\n    error: undefined,\n    reload: async () => undefined\n  });\n  const [installedAppsState, dispatchInstalledApps] = useReducer(reducer, {\n    phase: AsyncStatePhase.LOADING,\n    value: undefined,\n    error: undefined,\n    reload: async () => undefined\n  });\n  const fetch = useCallback(async () => {\n    dispatchMarketplaceApps({\n      type: 'request',\n      reload: async () => undefined\n    });\n    dispatchInstalledApps({\n      type: 'request',\n      reload: async () => undefined\n    });\n    let installedApps = [];\n    let marketplaceApps = [];\n    let marketplaceError = false;\n    let installedAppsError = false;\n\n    try {\n      marketplaceApps = await Apps.getAppsFromMarketplace();\n    } catch (e) {\n      dispatchMarketplaceApps({\n        type: 'failure',\n        error: e,\n        reload: fetch\n      });\n      marketplaceError = true;\n    }\n\n    try {\n      installedApps = await Apps.getApps().then(result => result.map(current => _objectSpread(_objectSpread({}, current), {}, {\n        installed: true,\n        marketplace: false\n      })));\n    } catch (e) {\n      dispatchInstalledApps({\n        type: 'failure',\n        error: e,\n        reload: fetch\n      });\n      installedAppsError = true;\n    }\n\n    const installedAppsData = [];\n    const marketplaceAppsData = [];\n\n    if (!marketplaceError) {\n      marketplaceApps.forEach(app => {\n        const appIndex = installedApps.findIndex(_ref3 => {\n          let {\n            id\n          } = _ref3;\n          return id === app.id;\n        });\n\n        if (!installedApps[appIndex]) {\n          marketplaceAppsData.push(_objectSpread(_objectSpread({}, app), {}, {\n            status: undefined,\n            marketplaceVersion: app.version,\n            bundledIn: app.bundledIn\n          }));\n          return;\n        }\n\n        const [installedApp] = installedApps.splice(appIndex, 1);\n\n        const appData = _objectSpread(_objectSpread(_objectSpread({}, app), {}, {\n          installed: true\n        }, installedApp && {\n          status: installedApp.status,\n          version: installedApp.version,\n          licenseValidation: installedApp.licenseValidation\n        }), {}, {\n          bundledIn: app.bundledIn,\n          marketplaceVersion: app.version\n        });\n\n        installedAppsData.push(appData);\n        marketplaceAppsData.push(appData);\n      });\n      dispatchMarketplaceApps({\n        type: 'success',\n        reload: fetch,\n        apps: marketplaceAppsData\n      });\n    }\n\n    if (!installedAppsError) {\n      if (installedApps.length) {\n        installedAppsData.push(...installedApps);\n      }\n\n      dispatchInstalledApps({\n        type: 'success',\n        reload: fetch,\n        apps: installedAppsData\n      });\n    }\n  }, []);\n  const getCurrentData = useMutableCallback(function getCurrentData() {\n    return [marketplaceAppsState, installedAppsState];\n  });\n  useEffect(() => {\n    const handleAppAddedOrUpdated = async appId => {\n      let marketplaceApp;\n      let installedApp;\n\n      try {\n        installedApp = await Apps.getApp(appId);\n      } catch (error) {\n        handleAPIError(error);\n        throw error;\n      }\n\n      try {\n        marketplaceApp = await Apps.getAppFromMarketplace(appId, installedApp.version);\n      } catch (error) {\n        handleAPIError(error);\n      }\n\n      if (marketplaceApp !== undefined) {\n        const {\n          status,\n          version,\n          licenseValidation\n        } = installedApp;\n\n        const record = _objectSpread(_objectSpread({}, marketplaceApp), {}, {\n          installed: true,\n          status,\n          version,\n          licenseValidation,\n          marketplaceVersion: marketplaceApp.version\n        });\n\n        const [, installedApps] = getCurrentData();\n        dispatchMarketplaceApps({\n          type: 'update',\n          app: record,\n          reload: fetch\n        });\n\n        if (installedApps.value) {\n          dispatchInstalledApps({\n            type: 'success',\n            apps: [...installedApps.value.apps, record],\n            reload: fetch\n          });\n          return;\n        }\n\n        dispatchInstalledApps({\n          type: 'success',\n          apps: [record],\n          reload: fetch\n        });\n        return;\n      }\n\n      dispatchInstalledApps({\n        type: 'update',\n        app: installedApp,\n        reload: fetch\n      });\n    };\n\n    const listeners = {\n      APP_ADDED: handleAppAddedOrUpdated,\n      APP_UPDATED: handleAppAddedOrUpdated,\n      APP_REMOVED: appId => {\n        var _updatedData$value;\n\n        const [updatedData] = getCurrentData();\n        const app = (_updatedData$value = updatedData.value) === null || _updatedData$value === void 0 ? void 0 : _updatedData$value.apps.find(_ref4 => {\n          let {\n            id\n          } = _ref4;\n          return id === appId;\n        });\n        dispatchInstalledApps({\n          type: 'delete',\n          appId,\n          reload: fetch\n        });\n\n        if (!app) {\n          return;\n        }\n\n        dispatchMarketplaceApps({\n          type: 'update',\n          reload: fetch,\n          app: _objectSpread(_objectSpread({}, app), {}, {\n            version: app === null || app === void 0 ? void 0 : app.marketplaceVersion,\n            installed: false,\n            marketplaceVersion: app === null || app === void 0 ? void 0 : app.marketplaceVersion\n          })\n        });\n      },\n      APP_STATUS_CHANGE: _ref5 => {\n        var _updatedData$value2;\n\n        let {\n          appId,\n          status\n        } = _ref5;\n        const [updatedData] = getCurrentData();\n        const app = (_updatedData$value2 = updatedData.value) === null || _updatedData$value2 === void 0 ? void 0 : _updatedData$value2.apps.find(_ref6 => {\n          let {\n            id\n          } = _ref6;\n          return id === appId;\n        });\n\n        if (!app) {\n          return;\n        }\n\n        app.status = status;\n        dispatchInstalledApps({\n          type: 'update',\n          app: _objectSpread(_objectSpread({}, app), {}, {\n            status\n          }),\n          reload: fetch\n        });\n        dispatchMarketplaceApps({\n          type: 'update',\n          app: _objectSpread(_objectSpread({}, app), {}, {\n            status\n          }),\n          reload: fetch\n        });\n      },\n      APP_SETTING_UPDATED: _ref7 => {\n        let {\n          appId\n        } = _ref7;\n        dispatchInstalledApps({\n          type: 'invalidate',\n          appId,\n          reload: fetch\n        });\n        dispatchMarketplaceApps({\n          type: 'invalidate',\n          appId,\n          reload: fetch\n        });\n      }\n    };\n    const unregisterListeners = registerListeners(listeners);\n\n    try {\n      fetch();\n    } finally {\n      // eslint-disable-next-line no-unsafe-finally\n      return unregisterListeners;\n    }\n  }, [fetch, getCurrentData]);\n  return /*#__PURE__*/React.createElement(AppsContext.Provider, {\n    children: children,\n    value: {\n      installedApps: installedAppsState,\n      marketplaceApps: marketplaceAppsState,\n      reload: fetch\n    }\n  });\n};\n\nmodule.exportDefault(AppsProvider);","map":{"version":3,"sources":["client/views/admin/apps/AppsProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, FC, useReducer, Reducer, useCallback } from 'react';\n\nimport { AppEvents } from '../../../../app/apps/client/communication';\nimport { Apps } from '../../../../app/apps/client/orchestrator';\nimport { AsyncState, AsyncStatePhase } from '../../../lib/asyncState';\nimport { AppsContext } from './AppsContext';\nimport { handleAPIError } from './helpers';\nimport { App } from './types';\n\ntype ListenersMapping = {\n\treadonly [P in keyof typeof AppEvents]?: (...args: any[]) => void;\n};\n\nconst registerListeners = (listeners: ListenersMapping): (() => void) => {\n\tconst entries = Object.entries(listeners) as Exclude<\n\t\t{\n\t\t\t[K in keyof ListenersMapping]: [K, ListenersMapping[K]];\n\t\t}[keyof ListenersMapping],\n\t\tundefined\n\t>[];\n\tfor (const [event, callback] of entries) {\n\t\tApps.getWsListener()?.registerListener(AppEvents[event], callback);\n\t}\n\treturn (): void => {\n\t\tfor (const [event, callback] of entries) {\n\t\t\tApps.getWsListener()?.unregisterListener(AppEvents[event], callback);\n\t\t}\n\t};\n};\n\ntype Action =\n\t| { type: 'request'; reload: () => Promise<void> }\n\t| { type: 'update'; app: App; reload: () => Promise<void> }\n\t| { type: 'delete'; appId: string; reload: () => Promise<void> }\n\t| { type: 'invalidate'; appId: string; reload: () => Promise<void> }\n\t| { type: 'success'; apps: App[]; reload: () => Promise<void> }\n\t| { type: 'failure'; error: Error; reload: () => Promise<void> };\n\nconst sortByName = (apps: App[]): App[] => apps.sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1));\n\nconst reducer = (\n\tstate: AsyncState<{ apps: App[] }> & {\n\t\treload: () => Promise<void>;\n\t},\n\taction: Action,\n): AsyncState<{ apps: App[] }> & {\n\treload: () => Promise<void>;\n} => {\n\tswitch (action.type) {\n\t\tcase 'invalidate':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: action.reload,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.appId) {\n\t\t\t\t\t\t\t\treturn { ...app };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'update':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.app.id) {\n\t\t\t\t\t\t\t\treturn action.app;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'request':\n\t\t\treturn {\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tphase: AsyncStatePhase.LOADING,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'success':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: sortByName(action.apps) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'delete':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: state.value.apps.filter(({ id }) => id !== action.appId) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'failure':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: action.error,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nconst AppsProvider: FC = ({ children }) => {\n\tconst [marketplaceAppsState, dispatchMarketplaceApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst [installedAppsState, dispatchInstalledApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst fetch = useCallback(async (): Promise<void> => {\n\t\tdispatchMarketplaceApps({ type: 'request', reload: async () => undefined });\n\t\tdispatchInstalledApps({ type: 'request', reload: async () => undefined });\n\n\t\tlet installedApps: App[] = [];\n\t\tlet marketplaceApps: App[] = [];\n\t\tlet marketplaceError = false;\n\t\tlet installedAppsError = false;\n\n\t\ttry {\n\t\t\tmarketplaceApps = (await Apps.getAppsFromMarketplace()) as App[];\n\t\t} catch (e) {\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tmarketplaceError = true;\n\t\t}\n\n\t\ttry {\n\t\t\tinstalledApps = await Apps.getApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tmarketplace: false,\n\t\t\t\t})),\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tinstalledAppsError = true;\n\t\t}\n\n\t\tconst installedAppsData: App[] = [];\n\t\tconst marketplaceAppsData: App[] = [];\n\n\t\tif (!marketplaceError) {\n\t\t\tmarketplaceApps.forEach((app) => {\n\t\t\t\tconst appIndex = installedApps.findIndex(({ id }) => id === app.id);\n\t\t\t\tif (!installedApps[appIndex]) {\n\t\t\t\t\tmarketplaceAppsData.push({\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus: undefined,\n\t\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst [installedApp] = installedApps.splice(appIndex, 1);\n\t\t\t\tconst appData = {\n\t\t\t\t\t...app,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\t...(installedApp && {\n\t\t\t\t\t\tstatus: installedApp.status,\n\t\t\t\t\t\tversion: installedApp.version,\n\t\t\t\t\t\tlicenseValidation: installedApp.licenseValidation,\n\t\t\t\t\t}),\n\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t};\n\n\t\t\t\tinstalledAppsData.push(appData);\n\t\t\t\tmarketplaceAppsData.push(appData);\n\t\t\t});\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: marketplaceAppsData,\n\t\t\t});\n\t\t}\n\n\t\tif (!installedAppsError) {\n\t\t\tif (installedApps.length) {\n\t\t\t\tinstalledAppsData.push(...installedApps);\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: installedAppsData,\n\t\t\t});\n\t\t}\n\t}, []);\n\n\tconst getCurrentData = useMutableCallback(function getCurrentData() {\n\t\treturn [marketplaceAppsState, installedAppsState];\n\t});\n\n\tuseEffect(() => {\n\t\tconst handleAppAddedOrUpdated = async (appId: string): Promise<void> => {\n\t\t\tlet marketplaceApp: App | undefined;\n\t\t\tlet installedApp: App;\n\n\t\t\ttry {\n\t\t\t\tinstalledApp = await Apps.getApp(appId);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tmarketplaceApp = await Apps.getAppFromMarketplace(appId, installedApp.version);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\n\t\t\tif (marketplaceApp !== undefined) {\n\t\t\t\tconst { status, version, licenseValidation } = installedApp;\n\t\t\t\tconst record = {\n\t\t\t\t\t...marketplaceApp,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tstatus,\n\t\t\t\t\tversion,\n\t\t\t\t\tlicenseValidation,\n\t\t\t\t\tmarketplaceVersion: marketplaceApp.version,\n\t\t\t\t};\n\n\t\t\t\tconst [, installedApps] = getCurrentData();\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: record,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (installedApps.value) {\n\t\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tapps: [...installedApps.value.apps, record],\n\t\t\t\t\t\treload: fetch,\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tapps: [record],\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({ type: 'update', app: installedApp, reload: fetch });\n\t\t};\n\t\tconst listeners = {\n\t\t\tAPP_ADDED: handleAppAddedOrUpdated,\n\t\t\tAPP_UPDATED: handleAppAddedOrUpdated,\n\t\t\tAPP_REMOVED: (appId: string): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'delete',\n\t\t\t\t\tappId,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\treload: fetch,\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tversion: app?.marketplaceVersion,\n\t\t\t\t\t\tinstalled: false,\n\t\t\t\t\t\tmarketplaceVersion: app?.marketplaceVersion,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_STATUS_CHANGE: ({ appId, status }: { appId: string; status: AppStatus }): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tapp.status = status;\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_SETTING_UPDATED: ({ appId }: { appId: string }): void => {\n\t\t\t\tdispatchInstalledApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t\tdispatchMarketplaceApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t},\n\t\t};\n\t\tconst unregisterListeners = registerListeners(listeners);\n\t\ttry {\n\t\t\tfetch();\n\t\t} finally {\n\t\t\t// eslint-disable-next-line no-unsafe-finally\n\t\t\treturn unregisterListeners;\n\t\t}\n\t}, [fetch, getCurrentData]);\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{ installedApps: installedAppsState, marketplaceApps: marketplaceAppsState, reload: fetch }}\n\t\t/>\n\t);\n};\nexport default AppsProvider;\n"],"sourceRoot":""},"sourceType":"module","hash":"7290bd6c06fb881c8ae9d03cf43891f548693f5c"}
