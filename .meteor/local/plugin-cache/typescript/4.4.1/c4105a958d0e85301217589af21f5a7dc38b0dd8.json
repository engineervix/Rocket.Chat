{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/lib/rooms/coordinator.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"lib/rooms/coordinator.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/lib/rooms/coordinator.ts","inputSourceMap":{"version":3,"file":"lib/rooms/coordinator.ts","sourceRoot":"","sources":["lib/rooms/coordinator.ts"],"names":[],"mappings":"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","sourcesContent":["import { FlowRouter } from 'meteor/kadira:flow-router';\nimport type { RouteOptions } from 'meteor/kadira:flow-router';\n\nimport type {\n\tIRoomTypeConfig,\n\tIRoomTypeRouteConfig,\n\tIRoomTypeClientDirectives,\n\tIRoomTypeServerDirectives,\n\tRoomIdentification,\n} from '../../definition/IRoomTypeConfig';\nimport type { SettingValue } from '../../definition/ISetting';\nimport type { RoomType } from '../../definition/IRoom';\n\nexport abstract class RoomCoordinator {\n\troomTypes: Record<string, { config: IRoomTypeConfig; directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives }>;\n\n\troomTypesOrder: Array<{ identifier: string; order: number }>;\n\n\tmainOrder: number;\n\n\tconstructor() {\n\t\tthis.roomTypes = {};\n\t\tthis.roomTypesOrder = [];\n\t\tthis.mainOrder = 1;\n\t}\n\n\tprotected validateRoute(route: IRoomTypeRouteConfig): void {\n\t\tconst { name, path, action, link } = route;\n\n\t\tif (typeof name !== 'string' || name.length === 0) {\n\t\t\tthrow new Error('The route name must be a string.');\n\t\t}\n\n\t\tif (path !== undefined && (typeof path !== 'string' || path.length === 0)) {\n\t\t\tthrow new Error('The route path must be a string.');\n\t\t}\n\n\t\tif (!['undefined', 'function'].includes(typeof action)) {\n\t\t\tthrow new Error('The route action must be a function.');\n\t\t}\n\n\t\tif (!['undefined', 'function'].includes(typeof link)) {\n\t\t\tthrow new Error('The route link must be a function.');\n\t\t}\n\t}\n\n\tprotected validateRoomConfig(roomConfig: IRoomTypeConfig): void {\n\t\tconst { identifier, order, icon, header, label, route } = roomConfig;\n\n\t\tif (typeof identifier !== 'string' || identifier.length === 0) {\n\t\t\tthrow new Error('The identifier must be a string.');\n\t\t}\n\n\t\tif (typeof order !== 'number') {\n\t\t\tthrow new Error('The order must be a number.');\n\t\t}\n\n\t\tif (icon !== undefined && (typeof icon !== 'string' || icon.length === 0)) {\n\t\t\tthrow new Error('The icon must be a string.');\n\t\t}\n\n\t\tif (header !== undefined && (typeof header !== 'string' || header.length === 0)) {\n\t\t\tthrow new Error('The header must be a string.');\n\t\t}\n\n\t\tif (label !== undefined && (typeof label !== 'string' || label.length === 0)) {\n\t\t\tthrow new Error('The label must be a string.');\n\t\t}\n\n\t\tif (route !== undefined) {\n\t\t\tthis.validateRoute(route);\n\t\t}\n\t}\n\n\tprotected addRoomType(roomConfig: IRoomTypeConfig, directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives): void {\n\t\tthis.validateRoomConfig(roomConfig);\n\n\t\tif (this.roomTypes[roomConfig.identifier]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!roomConfig.order) {\n\t\t\troomConfig.order = this.mainOrder + 10;\n\t\t\tthis.mainOrder += 10;\n\t\t}\n\n\t\tthis.roomTypesOrder.push({\n\t\t\tidentifier: roomConfig.identifier,\n\t\t\torder: roomConfig.order,\n\t\t});\n\n\t\tthis.roomTypes[roomConfig.identifier] = { config: roomConfig, directives };\n\n\t\tif (roomConfig.route && roomConfig.route.path && roomConfig.route.name && roomConfig.route.action) {\n\t\t\tconst routeConfig = {\n\t\t\t\tname: roomConfig.route.name,\n\t\t\t\taction: roomConfig.route.action,\n\t\t\t};\n\n\t\t\treturn this.addRoute(roomConfig.route.path, routeConfig);\n\t\t}\n\t}\n\n\tprotected addRoute(path: string, routeConfig: RouteOptions): void {\n\t\tFlowRouter.route(path, routeConfig);\n\t}\n\n\tgetSetting(_settingId: string): SettingValue {\n\t\treturn undefined;\n\t}\n\n\tgetRoomTypeConfig(identifier: RoomType): IRoomTypeConfig & Pick<Required<IRoomTypeConfig>, 'route'>;\n\n\tgetRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined;\n\n\tgetRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined {\n\t\tif (!this.roomTypes[identifier]) {\n\t\t\tthrow new Error(`Room type with identifier ${identifier} does not exist.`);\n\t\t}\n\n\t\treturn this.roomTypes[identifier].config;\n\t}\n\n\tgetRouteLink(roomType: string, subData: RoomIdentification): string | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn FlowRouter.path(config.route.name, routeData);\n\t}\n\n\tgetURL(roomType: string, subData: RoomIdentification): string | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn FlowRouter.url(config.route.name, routeData);\n\t}\n\n\tgetRouteData(roomType: string, subData: RoomIdentification): Record<string, string> | false {\n\t\tif (!subData.rid && (subData as Record<string, string>)._id) {\n\t\t\tconsole.warn('Deprecated: RoomCoordinator.getRouteData received a room object');\n\t\t\tsubData.rid = (subData as Record<string, string>)._id;\n\t\t}\n\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route?.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\trid: subData.rid,\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t}\n\n\t\treturn routeData;\n\t}\n\n\tgetRouteNames(): Array<string> {\n\t\treturn Object.values(this.roomTypes)\n\t\t\t.map(({ config }) => config.route?.name)\n\t\t\t.filter(Boolean) as Array<string>;\n\t}\n\n\tgetRouteNameIdentifier(routeName: string): string | undefined {\n\t\tif (!routeName) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Object.keys(this.roomTypes).find((key) => this.roomTypes[key].config.route?.name === routeName);\n\t}\n\n\tisRouteNameKnown(routeName: string): boolean {\n\t\treturn Boolean(this.getRouteNameIdentifier(routeName));\n\t}\n\n\tgetRoomTypes(): Array<string> {\n\t\treturn Object.keys(this.roomTypes);\n\t}\n\n\tabstract openRoom(_type: string, _name: string, _render?: boolean): void;\n}\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/lib/rooms/coordinator.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"lib/rooms/coordinator.ts"}},"code":"var _typeof;\n\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 0);\nmodule.export({\n  RoomCoordinator: function () {\n    return RoomCoordinator;\n  }\n});\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 0);\n\nvar RoomCoordinator = /*#__PURE__*/function () {\n  function RoomCoordinator() {\n    this.roomTypes = void 0;\n    this.roomTypesOrder = void 0;\n    this.mainOrder = void 0;\n    this.roomTypes = {};\n    this.roomTypesOrder = [];\n    this.mainOrder = 1;\n  }\n\n  var _proto = RoomCoordinator.prototype;\n\n  _proto.validateRoute = function () {\n    function validateRoute(route) {\n      var name = route.name,\n          path = route.path,\n          action = route.action,\n          link = route.link;\n\n      if (typeof name !== 'string' || name.length === 0) {\n        throw new Error('The route name must be a string.');\n      }\n\n      if (path !== undefined && (typeof path !== 'string' || path.length === 0)) {\n        throw new Error('The route path must be a string.');\n      }\n\n      if (!['undefined', 'function'].includes(_typeof(action))) {\n        throw new Error('The route action must be a function.');\n      }\n\n      if (!['undefined', 'function'].includes(_typeof(link))) {\n        throw new Error('The route link must be a function.');\n      }\n    }\n\n    return validateRoute;\n  }();\n\n  _proto.validateRoomConfig = function () {\n    function validateRoomConfig(roomConfig) {\n      var identifier = roomConfig.identifier,\n          order = roomConfig.order,\n          icon = roomConfig.icon,\n          header = roomConfig.header,\n          label = roomConfig.label,\n          route = roomConfig.route;\n\n      if (typeof identifier !== 'string' || identifier.length === 0) {\n        throw new Error('The identifier must be a string.');\n      }\n\n      if (typeof order !== 'number') {\n        throw new Error('The order must be a number.');\n      }\n\n      if (icon !== undefined && (typeof icon !== 'string' || icon.length === 0)) {\n        throw new Error('The icon must be a string.');\n      }\n\n      if (header !== undefined && (typeof header !== 'string' || header.length === 0)) {\n        throw new Error('The header must be a string.');\n      }\n\n      if (label !== undefined && (typeof label !== 'string' || label.length === 0)) {\n        throw new Error('The label must be a string.');\n      }\n\n      if (route !== undefined) {\n        this.validateRoute(route);\n      }\n    }\n\n    return validateRoomConfig;\n  }();\n\n  _proto.addRoomType = function () {\n    function addRoomType(roomConfig, directives) {\n      this.validateRoomConfig(roomConfig);\n\n      if (this.roomTypes[roomConfig.identifier]) {\n        return;\n      }\n\n      if (!roomConfig.order) {\n        roomConfig.order = this.mainOrder + 10;\n        this.mainOrder += 10;\n      }\n\n      this.roomTypesOrder.push({\n        identifier: roomConfig.identifier,\n        order: roomConfig.order\n      });\n      this.roomTypes[roomConfig.identifier] = {\n        config: roomConfig,\n        directives: directives\n      };\n\n      if (roomConfig.route && roomConfig.route.path && roomConfig.route.name && roomConfig.route.action) {\n        var routeConfig = {\n          name: roomConfig.route.name,\n          action: roomConfig.route.action\n        };\n        return this.addRoute(roomConfig.route.path, routeConfig);\n      }\n    }\n\n    return addRoomType;\n  }();\n\n  _proto.addRoute = function () {\n    function addRoute(path, routeConfig) {\n      FlowRouter.route(path, routeConfig);\n    }\n\n    return addRoute;\n  }();\n\n  _proto.getSetting = function () {\n    function getSetting(_settingId) {\n      return undefined;\n    }\n\n    return getSetting;\n  }();\n\n  _proto.getRoomTypeConfig = function () {\n    function getRoomTypeConfig(identifier) {\n      if (!this.roomTypes[identifier]) {\n        throw new Error(\"Room type with identifier \" + identifier + \" does not exist.\");\n      }\n\n      return this.roomTypes[identifier].config;\n    }\n\n    return getRoomTypeConfig;\n  }();\n\n  _proto.getRouteLink = function () {\n    function getRouteLink(roomType, subData) {\n      var config = this.getRoomTypeConfig(roomType);\n\n      if (!(config !== null && config !== void 0 && config.route)) {\n        return false;\n      }\n\n      var routeData = this.getRouteData(roomType, subData);\n\n      if (!routeData) {\n        return false;\n      }\n\n      return FlowRouter.path(config.route.name, routeData);\n    }\n\n    return getRouteLink;\n  }();\n\n  _proto.getURL = function () {\n    function getURL(roomType, subData) {\n      var config = this.getRoomTypeConfig(roomType);\n\n      if (!(config !== null && config !== void 0 && config.route)) {\n        return false;\n      }\n\n      var routeData = this.getRouteData(roomType, subData);\n\n      if (!routeData) {\n        return false;\n      }\n\n      return FlowRouter.url(config.route.name, routeData);\n    }\n\n    return getURL;\n  }();\n\n  _proto.getRouteData = function () {\n    function getRouteData(roomType, subData) {\n      var _config$route;\n\n      if (!subData.rid && subData._id) {\n        console.warn('Deprecated: RoomCoordinator.getRouteData received a room object');\n        subData.rid = subData._id;\n      }\n\n      var config = this.getRoomTypeConfig(roomType);\n\n      if (!config) {\n        return false;\n      }\n\n      var routeData = {};\n\n      if ((_config$route = config.route) !== null && _config$route !== void 0 && _config$route.link) {\n        routeData = config.route.link(subData);\n      } else if (subData !== null && subData !== void 0 && subData.name) {\n        routeData = {\n          rid: subData.rid,\n          name: subData.name\n        };\n      }\n\n      return routeData;\n    }\n\n    return getRouteData;\n  }();\n\n  _proto.getRouteNames = function () {\n    function getRouteNames() {\n      return Object.values(this.roomTypes).map(function (_ref) {\n        var _config$route2;\n\n        var config = _ref.config;\n        return (_config$route2 = config.route) === null || _config$route2 === void 0 ? void 0 : _config$route2.name;\n      }).filter(Boolean);\n    }\n\n    return getRouteNames;\n  }();\n\n  _proto.getRouteNameIdentifier = function () {\n    function getRouteNameIdentifier(routeName) {\n      var _this = this;\n\n      if (!routeName) {\n        return;\n      }\n\n      return Object.keys(this.roomTypes).find(function (key) {\n        var _this$roomTypes$key$c;\n\n        return ((_this$roomTypes$key$c = _this.roomTypes[key].config.route) === null || _this$roomTypes$key$c === void 0 ? void 0 : _this$roomTypes$key$c.name) === routeName;\n      });\n    }\n\n    return getRouteNameIdentifier;\n  }();\n\n  _proto.isRouteNameKnown = function () {\n    function isRouteNameKnown(routeName) {\n      return Boolean(this.getRouteNameIdentifier(routeName));\n    }\n\n    return isRouteNameKnown;\n  }();\n\n  _proto.getRoomTypes = function () {\n    function getRoomTypes() {\n      return Object.keys(this.roomTypes);\n    }\n\n    return getRoomTypes;\n  }();\n\n  return RoomCoordinator;\n}();","map":{"version":3,"sources":["lib/rooms/coordinator.ts"],"names":[],"mappings":"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","sourcesContent":["import { FlowRouter } from 'meteor/kadira:flow-router';\nimport type { RouteOptions } from 'meteor/kadira:flow-router';\n\nimport type {\n\tIRoomTypeConfig,\n\tIRoomTypeRouteConfig,\n\tIRoomTypeClientDirectives,\n\tIRoomTypeServerDirectives,\n\tRoomIdentification,\n} from '../../definition/IRoomTypeConfig';\nimport type { SettingValue } from '../../definition/ISetting';\nimport type { RoomType } from '../../definition/IRoom';\n\nexport abstract class RoomCoordinator {\n\troomTypes: Record<string, { config: IRoomTypeConfig; directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives }>;\n\n\troomTypesOrder: Array<{ identifier: string; order: number }>;\n\n\tmainOrder: number;\n\n\tconstructor() {\n\t\tthis.roomTypes = {};\n\t\tthis.roomTypesOrder = [];\n\t\tthis.mainOrder = 1;\n\t}\n\n\tprotected validateRoute(route: IRoomTypeRouteConfig): void {\n\t\tconst { name, path, action, link } = route;\n\n\t\tif (typeof name !== 'string' || name.length === 0) {\n\t\t\tthrow new Error('The route name must be a string.');\n\t\t}\n\n\t\tif (path !== undefined && (typeof path !== 'string' || path.length === 0)) {\n\t\t\tthrow new Error('The route path must be a string.');\n\t\t}\n\n\t\tif (!['undefined', 'function'].includes(typeof action)) {\n\t\t\tthrow new Error('The route action must be a function.');\n\t\t}\n\n\t\tif (!['undefined', 'function'].includes(typeof link)) {\n\t\t\tthrow new Error('The route link must be a function.');\n\t\t}\n\t}\n\n\tprotected validateRoomConfig(roomConfig: IRoomTypeConfig): void {\n\t\tconst { identifier, order, icon, header, label, route } = roomConfig;\n\n\t\tif (typeof identifier !== 'string' || identifier.length === 0) {\n\t\t\tthrow new Error('The identifier must be a string.');\n\t\t}\n\n\t\tif (typeof order !== 'number') {\n\t\t\tthrow new Error('The order must be a number.');\n\t\t}\n\n\t\tif (icon !== undefined && (typeof icon !== 'string' || icon.length === 0)) {\n\t\t\tthrow new Error('The icon must be a string.');\n\t\t}\n\n\t\tif (header !== undefined && (typeof header !== 'string' || header.length === 0)) {\n\t\t\tthrow new Error('The header must be a string.');\n\t\t}\n\n\t\tif (label !== undefined && (typeof label !== 'string' || label.length === 0)) {\n\t\t\tthrow new Error('The label must be a string.');\n\t\t}\n\n\t\tif (route !== undefined) {\n\t\t\tthis.validateRoute(route);\n\t\t}\n\t}\n\n\tprotected addRoomType(roomConfig: IRoomTypeConfig, directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives): void {\n\t\tthis.validateRoomConfig(roomConfig);\n\n\t\tif (this.roomTypes[roomConfig.identifier]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!roomConfig.order) {\n\t\t\troomConfig.order = this.mainOrder + 10;\n\t\t\tthis.mainOrder += 10;\n\t\t}\n\n\t\tthis.roomTypesOrder.push({\n\t\t\tidentifier: roomConfig.identifier,\n\t\t\torder: roomConfig.order,\n\t\t});\n\n\t\tthis.roomTypes[roomConfig.identifier] = { config: roomConfig, directives };\n\n\t\tif (roomConfig.route && roomConfig.route.path && roomConfig.route.name && roomConfig.route.action) {\n\t\t\tconst routeConfig = {\n\t\t\t\tname: roomConfig.route.name,\n\t\t\t\taction: roomConfig.route.action,\n\t\t\t};\n\n\t\t\treturn this.addRoute(roomConfig.route.path, routeConfig);\n\t\t}\n\t}\n\n\tprotected addRoute(path: string, routeConfig: RouteOptions): void {\n\t\tFlowRouter.route(path, routeConfig);\n\t}\n\n\tgetSetting(_settingId: string): SettingValue {\n\t\treturn undefined;\n\t}\n\n\tgetRoomTypeConfig(identifier: RoomType): IRoomTypeConfig & Pick<Required<IRoomTypeConfig>, 'route'>;\n\n\tgetRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined;\n\n\tgetRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined {\n\t\tif (!this.roomTypes[identifier]) {\n\t\t\tthrow new Error(`Room type with identifier ${identifier} does not exist.`);\n\t\t}\n\n\t\treturn this.roomTypes[identifier].config;\n\t}\n\n\tgetRouteLink(roomType: string, subData: RoomIdentification): string | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn FlowRouter.path(config.route.name, routeData);\n\t}\n\n\tgetURL(roomType: string, subData: RoomIdentification): string | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn FlowRouter.url(config.route.name, routeData);\n\t}\n\n\tgetRouteData(roomType: string, subData: RoomIdentification): Record<string, string> | false {\n\t\tif (!subData.rid && (subData as Record<string, string>)._id) {\n\t\t\tconsole.warn('Deprecated: RoomCoordinator.getRouteData received a room object');\n\t\t\tsubData.rid = (subData as Record<string, string>)._id;\n\t\t}\n\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route?.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\trid: subData.rid,\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t}\n\n\t\treturn routeData;\n\t}\n\n\tgetRouteNames(): Array<string> {\n\t\treturn Object.values(this.roomTypes)\n\t\t\t.map(({ config }) => config.route?.name)\n\t\t\t.filter(Boolean) as Array<string>;\n\t}\n\n\tgetRouteNameIdentifier(routeName: string): string | undefined {\n\t\tif (!routeName) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Object.keys(this.roomTypes).find((key) => this.roomTypes[key].config.route?.name === routeName);\n\t}\n\n\tisRouteNameKnown(routeName: string): boolean {\n\t\treturn Boolean(this.getRouteNameIdentifier(routeName));\n\t}\n\n\tgetRoomTypes(): Array<string> {\n\t\treturn Object.keys(this.roomTypes);\n\t}\n\n\tabstract openRoom(_type: string, _name: string, _render?: boolean): void;\n}\n"],"sourceRoot":""},"sourceType":"module","hash":"c4105a958d0e85301217589af21f5a7dc38b0dd8"}
