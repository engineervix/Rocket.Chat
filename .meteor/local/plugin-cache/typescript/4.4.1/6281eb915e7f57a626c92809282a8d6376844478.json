{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/photoswipeContent.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui/client/views/app/photoswipeContent.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/photoswipeContent.ts","inputSourceMap":{"version":3,"file":"app/ui/client/views/app/photoswipeContent.ts","sourceRoot":"","sources":["app/ui/client/views/app/photoswipeContent.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Blaze } from 'meteor/blaze';\nimport { Template } from 'meteor/templating';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport type PhotoSwipe from 'photoswipe';\nimport type PhotoSwipeUiDefault from 'photoswipe/dist/photoswipe-ui-default';\n\nconst parseLength = (x: unknown): number | undefined => {\n\tconst length = typeof x === 'string' ? parseInt(x, 10) : undefined;\n\treturn Number.isFinite(length) ? length : undefined;\n};\n\nconst getImageSize = (src: string): Promise<[w: number, h: number]> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve([img.naturalWidth, img.naturalHeight]);\n\t\t});\n\n\t\timg.addEventListener('error', (error) => {\n\t\t\treject(error.error);\n\t\t});\n\n\t\timg.src = src;\n\t});\n\ntype Slide = PhotoSwipeUiDefault.Item & { description?: string };\n\nconst fromElementToSlide = async (element: Element): Promise<Slide | null> => {\n\tif (!(element instanceof HTMLElement)) {\n\t\treturn null;\n\t}\n\n\tconst title = element.dataset.title || element.title;\n\tconst { description } = element.dataset;\n\n\tif (element instanceof HTMLAnchorElement) {\n\t\tconst src = element.dataset.src || element.href;\n\t\tlet w = parseLength(element.dataset.width);\n\t\tlet h = parseLength(element.dataset.height);\n\n\t\tif (w === undefined || h === undefined) {\n\t\t\t[w, h] = await getImageSize(src);\n\t\t}\n\n\t\treturn { src, w, h, title, description };\n\t}\n\n\tif (element instanceof HTMLImageElement) {\n\t\tlet msrc: string | undefined;\n\t\tlet { src } = element;\n\t\tlet w: number | undefined = element.naturalWidth;\n\t\tlet h: number | undefined = element.naturalHeight;\n\n\t\tif (element.dataset.src) {\n\t\t\tmsrc = element.src;\n\t\t\tsrc = element.dataset.src;\n\t\t\tw = parseLength(element.dataset.width);\n\t\t\th = parseLength(element.dataset.height);\n\n\t\t\tif (w === undefined || h === undefined) {\n\t\t\t\t[w, h] = await getImageSize(src);\n\t\t\t}\n\t\t}\n\n\t\treturn { msrc, src, w, h, title, description };\n\t}\n\n\treturn null;\n};\n\nlet currentGallery: PhotoSwipe<PhotoSwipeUiDefault.Options> | null = null;\n\nconst initGallery = async (items: Slide[], options: PhotoSwipeUiDefault.Options): Promise<void> => {\n\tconst [\n\t\t{ default: PhotoSwipe },\n\t\t{ default: PhotoSwipeUiDefault }, // eslint-disable-line @typescript-eslint/camelcase\n\t] = await Promise.all([\n\t\timport('photoswipe'),\n\t\timport('photoswipe/dist/photoswipe-ui-default'),\n\t\t// @ts-ignore\n\t\timport('photoswipe/dist/photoswipe.css'),\n\t\t// @ts-ignore\n\t\timport('./photoswipeContent.html'),\n\t]);\n\n\tBlaze.render(Template.photoswipeContent, document.body);\n\n\tif (!currentGallery) {\n\t\tconst container = document.getElementById('pswp');\n\n\t\tif (!container) {\n\t\t\tthrow new Error('Photoswipe container element not found');\n\t\t}\n\n\t\tcurrentGallery = new PhotoSwipe(container, PhotoSwipeUiDefault, items, options);\n\n\t\tcurrentGallery.listen('destroy', () => {\n\t\t\tcurrentGallery = null;\n\t\t});\n\n\t\tcurrentGallery.init();\n\t}\n};\n\nconst defaultGalleryOptions: PhotoSwipeUiDefault.Options = {\n\tbgOpacity: 0.7,\n\tshowHideOpacity: true,\n\tcounterEl: false,\n\tshareEl: false,\n\tclickToCloseNonZoomable: false,\n\tindex: 0,\n\taddCaptionHTMLFn(item: Slide, captionEl: HTMLElement): boolean {\n\t\tcaptionEl.children[0].innerHTML = `\n\t\t\t${escapeHTML(item.title ?? '')}<br/>\n\t\t\t<small>${escapeHTML(item.description ?? '')}</small>\n\t\t`;\n\t\treturn true;\n\t},\n};\n\nconst createEventListenerFor =\n\t(className: string) =>\n\t(event: JQuery.ClickEvent): void => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst { currentTarget } = event;\n\n\t\tArray.from(document.querySelectorAll(className))\n\t\t\t.sort((a, b) => {\n\t\t\t\tif (a === currentTarget) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\n\t\t\t\tif (b === currentTarget) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\treturn 0;\n\t\t\t})\n\t\t\t.map((element) => fromElementToSlide(element))\n\t\t\t.reduce(\n\t\t\t\t(p, curr) =>\n\t\t\t\t\tp\n\t\t\t\t\t\t.then(() => curr)\n\t\t\t\t\t\t.then(async (slide) => {\n\t\t\t\t\t\t\tif (!slide) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!currentGallery) {\n\t\t\t\t\t\t\t\treturn initGallery([slide], defaultGalleryOptions);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcurrentGallery.items.push(slide);\n\t\t\t\t\t\t\tcurrentGallery.invalidateCurrItems();\n\t\t\t\t\t\t\tcurrentGallery.updateSize(true);\n\t\t\t\t\t\t}),\n\t\t\t\tPromise.resolve(),\n\t\t\t);\n\t};\n\nMeteor.startup(() => {\n\t$(document).on('click', '.gallery-item', createEventListenerFor('.gallery-item'));\n});\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/photoswipeContent.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/views/app/photoswipeContent.ts"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Blaze;\nmodule.link(\"meteor/blaze\", {\n  Blaze(v) {\n    Blaze = v;\n  }\n\n}, 1);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 2);\nlet escapeHTML;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeHTML(v) {\n    escapeHTML = v;\n  }\n\n}, 3);\n\nconst parseLength = x => {\n  const length = typeof x === 'string' ? parseInt(x, 10) : undefined;\n  return Number.isFinite(length) ? length : undefined;\n};\n\nconst getImageSize = src => new Promise((resolve, reject) => {\n  const img = new Image();\n  img.addEventListener('load', () => {\n    resolve([img.naturalWidth, img.naturalHeight]);\n  });\n  img.addEventListener('error', error => {\n    reject(error.error);\n  });\n  img.src = src;\n});\n\nconst fromElementToSlide = async element => {\n  if (!(element instanceof HTMLElement)) {\n    return null;\n  }\n\n  const title = element.dataset.title || element.title;\n  const {\n    description\n  } = element.dataset;\n\n  if (element instanceof HTMLAnchorElement) {\n    const src = element.dataset.src || element.href;\n    let w = parseLength(element.dataset.width);\n    let h = parseLength(element.dataset.height);\n\n    if (w === undefined || h === undefined) {\n      [w, h] = await getImageSize(src);\n    }\n\n    return {\n      src,\n      w,\n      h,\n      title,\n      description\n    };\n  }\n\n  if (element instanceof HTMLImageElement) {\n    let msrc;\n    let {\n      src\n    } = element;\n    let w = element.naturalWidth;\n    let h = element.naturalHeight;\n\n    if (element.dataset.src) {\n      msrc = element.src;\n      src = element.dataset.src;\n      w = parseLength(element.dataset.width);\n      h = parseLength(element.dataset.height);\n\n      if (w === undefined || h === undefined) {\n        [w, h] = await getImageSize(src);\n      }\n    }\n\n    return {\n      msrc,\n      src,\n      w,\n      h,\n      title,\n      description\n    };\n  }\n\n  return null;\n};\n\nlet currentGallery = null;\n\nconst initGallery = async (items, options) => {\n  const [{\n    default: PhotoSwipe\n  }, {\n    default: PhotoSwipeUiDefault\n  } // eslint-disable-line @typescript-eslint/camelcase\n  ] = await Promise.all([module.dynamicImport('photoswipe'), module.dynamicImport('photoswipe/dist/photoswipe-ui-default'), // @ts-ignore\n  module.dynamicImport('photoswipe/dist/photoswipe.css'), // @ts-ignore\n  module.dynamicImport('./photoswipeContent.html')]);\n  Blaze.render(Template.photoswipeContent, document.body);\n\n  if (!currentGallery) {\n    const container = document.getElementById('pswp');\n\n    if (!container) {\n      throw new Error('Photoswipe container element not found');\n    }\n\n    currentGallery = new PhotoSwipe(container, PhotoSwipeUiDefault, items, options);\n    currentGallery.listen('destroy', () => {\n      currentGallery = null;\n    });\n    currentGallery.init();\n  }\n};\n\nconst defaultGalleryOptions = {\n  bgOpacity: 0.7,\n  showHideOpacity: true,\n  counterEl: false,\n  shareEl: false,\n  clickToCloseNonZoomable: false,\n  index: 0,\n\n  addCaptionHTMLFn(item, captionEl) {\n    var _item$title, _item$description;\n\n    captionEl.children[0].innerHTML = \"\\n\\t\\t\\t\".concat(escapeHTML((_item$title = item.title) !== null && _item$title !== void 0 ? _item$title : ''), \"<br/>\\n\\t\\t\\t<small>\").concat(escapeHTML((_item$description = item.description) !== null && _item$description !== void 0 ? _item$description : ''), \"</small>\\n\\t\\t\");\n    return true;\n  }\n\n};\n\nconst createEventListenerFor = className => event => {\n  event.preventDefault();\n  event.stopPropagation();\n  const {\n    currentTarget\n  } = event;\n  Array.from(document.querySelectorAll(className)).sort((a, b) => {\n    if (a === currentTarget) {\n      return -1;\n    }\n\n    if (b === currentTarget) {\n      return 1;\n    }\n\n    return 0;\n  }).map(element => fromElementToSlide(element)).reduce((p, curr) => p.then(() => curr).then(async slide => {\n    if (!slide) {\n      return;\n    }\n\n    if (!currentGallery) {\n      return initGallery([slide], defaultGalleryOptions);\n    }\n\n    currentGallery.items.push(slide);\n    currentGallery.invalidateCurrItems();\n    currentGallery.updateSize(true);\n  }), Promise.resolve());\n};\n\nMeteor.startup(() => {\n  $(document).on('click', '.gallery-item', createEventListenerFor('.gallery-item'));\n});","map":{"version":3,"sources":["app/ui/client/views/app/photoswipeContent.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Blaze } from 'meteor/blaze';\nimport { Template } from 'meteor/templating';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport type PhotoSwipe from 'photoswipe';\nimport type PhotoSwipeUiDefault from 'photoswipe/dist/photoswipe-ui-default';\n\nconst parseLength = (x: unknown): number | undefined => {\n\tconst length = typeof x === 'string' ? parseInt(x, 10) : undefined;\n\treturn Number.isFinite(length) ? length : undefined;\n};\n\nconst getImageSize = (src: string): Promise<[w: number, h: number]> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve([img.naturalWidth, img.naturalHeight]);\n\t\t});\n\n\t\timg.addEventListener('error', (error) => {\n\t\t\treject(error.error);\n\t\t});\n\n\t\timg.src = src;\n\t});\n\ntype Slide = PhotoSwipeUiDefault.Item & { description?: string };\n\nconst fromElementToSlide = async (element: Element): Promise<Slide | null> => {\n\tif (!(element instanceof HTMLElement)) {\n\t\treturn null;\n\t}\n\n\tconst title = element.dataset.title || element.title;\n\tconst { description } = element.dataset;\n\n\tif (element instanceof HTMLAnchorElement) {\n\t\tconst src = element.dataset.src || element.href;\n\t\tlet w = parseLength(element.dataset.width);\n\t\tlet h = parseLength(element.dataset.height);\n\n\t\tif (w === undefined || h === undefined) {\n\t\t\t[w, h] = await getImageSize(src);\n\t\t}\n\n\t\treturn { src, w, h, title, description };\n\t}\n\n\tif (element instanceof HTMLImageElement) {\n\t\tlet msrc: string | undefined;\n\t\tlet { src } = element;\n\t\tlet w: number | undefined = element.naturalWidth;\n\t\tlet h: number | undefined = element.naturalHeight;\n\n\t\tif (element.dataset.src) {\n\t\t\tmsrc = element.src;\n\t\t\tsrc = element.dataset.src;\n\t\t\tw = parseLength(element.dataset.width);\n\t\t\th = parseLength(element.dataset.height);\n\n\t\t\tif (w === undefined || h === undefined) {\n\t\t\t\t[w, h] = await getImageSize(src);\n\t\t\t}\n\t\t}\n\n\t\treturn { msrc, src, w, h, title, description };\n\t}\n\n\treturn null;\n};\n\nlet currentGallery: PhotoSwipe<PhotoSwipeUiDefault.Options> | null = null;\n\nconst initGallery = async (items: Slide[], options: PhotoSwipeUiDefault.Options): Promise<void> => {\n\tconst [\n\t\t{ default: PhotoSwipe },\n\t\t{ default: PhotoSwipeUiDefault }, // eslint-disable-line @typescript-eslint/camelcase\n\t] = await Promise.all([\n\t\timport('photoswipe'),\n\t\timport('photoswipe/dist/photoswipe-ui-default'),\n\t\t// @ts-ignore\n\t\timport('photoswipe/dist/photoswipe.css'),\n\t\t// @ts-ignore\n\t\timport('./photoswipeContent.html'),\n\t]);\n\n\tBlaze.render(Template.photoswipeContent, document.body);\n\n\tif (!currentGallery) {\n\t\tconst container = document.getElementById('pswp');\n\n\t\tif (!container) {\n\t\t\tthrow new Error('Photoswipe container element not found');\n\t\t}\n\n\t\tcurrentGallery = new PhotoSwipe(container, PhotoSwipeUiDefault, items, options);\n\n\t\tcurrentGallery.listen('destroy', () => {\n\t\t\tcurrentGallery = null;\n\t\t});\n\n\t\tcurrentGallery.init();\n\t}\n};\n\nconst defaultGalleryOptions: PhotoSwipeUiDefault.Options = {\n\tbgOpacity: 0.7,\n\tshowHideOpacity: true,\n\tcounterEl: false,\n\tshareEl: false,\n\tclickToCloseNonZoomable: false,\n\tindex: 0,\n\taddCaptionHTMLFn(item: Slide, captionEl: HTMLElement): boolean {\n\t\tcaptionEl.children[0].innerHTML = `\n\t\t\t${escapeHTML(item.title ?? '')}<br/>\n\t\t\t<small>${escapeHTML(item.description ?? '')}</small>\n\t\t`;\n\t\treturn true;\n\t},\n};\n\nconst createEventListenerFor =\n\t(className: string) =>\n\t(event: JQuery.ClickEvent): void => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst { currentTarget } = event;\n\n\t\tArray.from(document.querySelectorAll(className))\n\t\t\t.sort((a, b) => {\n\t\t\t\tif (a === currentTarget) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\n\t\t\t\tif (b === currentTarget) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\treturn 0;\n\t\t\t})\n\t\t\t.map((element) => fromElementToSlide(element))\n\t\t\t.reduce(\n\t\t\t\t(p, curr) =>\n\t\t\t\t\tp\n\t\t\t\t\t\t.then(() => curr)\n\t\t\t\t\t\t.then(async (slide) => {\n\t\t\t\t\t\t\tif (!slide) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!currentGallery) {\n\t\t\t\t\t\t\t\treturn initGallery([slide], defaultGalleryOptions);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcurrentGallery.items.push(slide);\n\t\t\t\t\t\t\tcurrentGallery.invalidateCurrItems();\n\t\t\t\t\t\t\tcurrentGallery.updateSize(true);\n\t\t\t\t\t\t}),\n\t\t\t\tPromise.resolve(),\n\t\t\t);\n\t};\n\nMeteor.startup(() => {\n\t$(document).on('click', '.gallery-item', createEventListenerFor('.gallery-item'));\n});\n"],"sourceRoot":""},"sourceType":"module","hash":"6281eb915e7f57a626c92809282a8d6376844478"}
