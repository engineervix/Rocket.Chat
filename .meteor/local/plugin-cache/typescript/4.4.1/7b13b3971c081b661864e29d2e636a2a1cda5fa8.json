{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/startup/theme.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/startup/theme.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/startup/theme.ts","inputSourceMap":{"version":3,"file":"client/startup/theme.ts","sourceRoot":"","sources":["client/startup/theme.ts"],"names":[],"mappings":"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","sourcesContent":["import createLess from 'less/browser';\nimport { Meteor } from 'meteor/meteor';\nimport _ from 'underscore';\n\nimport { settings } from '../../app/settings/client';\nimport { ISetting, ISettingColor } from '../../definition/ISetting';\n\nconst variables = new Map();\nconst lessExpressions = new Map([\n\t['default-action-color', 'darken(@secondary-background-color, 15%)'],\n\t['default-action-contrast', 'contrast(@default-action-color, #444444)'],\n\t['primary-background-contrast', 'contrast(@primary-background-color, #444444)'],\n\t['primary-action-contrast', 'contrast(@primary-action-color, #444444)'],\n\t['secondary-background-contrast', 'contrast(@secondary-background-color, #444444)'],\n\t['secondary-action-contrast', 'contrast(@secondary-action-color, #444444)'],\n\t['selection-background', 'lighten(@selection-color, 30%)'],\n\t['success-background', 'lighten(@success-color, 45%)'],\n\t['success-border', 'lighten(@success-color, 30%)'],\n\t['error-background', 'lighten(@error-color, 45%)'],\n\t['error-border', 'lighten(@error-color, 30%)'],\n\t['error-contrast', 'contrast(@error-color)'],\n\t['pending-background', 'lighten(@pending-color, 45%)'],\n\t['pending-border', 'lighten(@pending-color, 30%)'],\n\t['transparent-darkest', 'rgba(17, 12, 12, 0.5)'],\n\t['transparent-darker', 'rgba(0, 0, 0, 0.15)'],\n\t['transparent-dark', 'rgba(15, 34, 0, 0.05)'],\n\t['transparent-light', 'rgba(255, 255, 255, 0.1)'],\n\t['transparent-lighter', 'rgba(255, 255, 255, 0.3)'],\n\t['transparent-lightest', 'rgba(255, 255, 255, 0.6)'],\n]);\n\nconst less = createLess(window, {});\n\nconst compileLess = async (): Promise<string> => {\n\tif (lessExpressions.size === 0) {\n\t\treturn '';\n\t}\n\n\tconst lessCode = [\n\t\t...Array.from(variables.entries(), ([name, value]) => `@${name}: ${value};`),\n\t\t...Array.from(lessExpressions.entries(), ([name, expression]) => `@${name}: ${expression};`),\n\t\t':root {',\n\t\t...Array.from(lessExpressions.entries(), ([name]) => `--${name}: @${name};`),\n\t\t'}',\n\t].join('\\n');\n\n\ttry {\n\t\tconst { css } = await less.render(lessCode);\n\t\treturn css;\n\t} catch (error) {\n\t\tconsole.error(error);\n\t\treturn '';\n\t}\n};\n\nlet cssVariablesElement: HTMLStyleElement | null = null;\n\nconst updateCssVariables = _.debounce(async () => {\n\tif (!cssVariablesElement) {\n\t\tcssVariablesElement = document.querySelector('#css-variables');\n\t}\n\n\tif (!cssVariablesElement) {\n\t\treturn;\n\t}\n\n\tcssVariablesElement.innerHTML = [\n\t\t':root {',\n\t\t...Array.from(variables.entries(), ([name, value]) => `--${name}: ${value};`),\n\t\t'}',\n\t\tawait compileLess(),\n\t].join('\\n');\n}, 50);\n\nconst handleThemeColorChanged = ({ _id, value, editor }: ISettingColor): void => {\n\tif (typeof value !== 'string') {\n\t\treturn;\n\t}\n\ttry {\n\t\tconst name = /^theme-color-(.*)$/.exec(_id)?.[1];\n\n\t\tif (!name) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst legacy = name.slice(0, 3) !== 'rc-';\n\n\t\tif (editor === 'color') {\n\t\t\tvariables.set(name, value);\n\t\t\treturn;\n\t\t}\n\n\t\tif (legacy) {\n\t\t\tlessExpressions.set(name, value);\n\t\t\treturn;\n\t\t}\n\n\t\tvariables.set(name, `var(--${value})`);\n\t} finally {\n\t\tupdateCssVariables();\n\t}\n};\n\nconst handleThemeFontChanged = ({ _id, value }: ISetting & { value: string }): void => {\n\ttry {\n\t\tconst name = /^theme-font-(.*)$/.exec(_id)?.[1];\n\t\tif (!name) {\n\t\t\treturn;\n\t\t}\n\n\t\tvariables.set(name, value);\n\t} finally {\n\t\tupdateCssVariables();\n\t}\n};\n\nMeteor.startup(() => {\n\tsettings.collection.find({ _id: /^theme-color-/i }, { fields: { value: 1, editor: 1 } }).observe({\n\t\tadded: handleThemeColorChanged,\n\t\tchanged: handleThemeColorChanged,\n\t});\n\n\tsettings.collection.find({ _id: /^theme-font-/i }, { fields: { value: 1 } }).observe({\n\t\tadded: handleThemeFontChanged,\n\t\tchanged: handleThemeFontChanged,\n\t});\n});\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/startup/theme.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/startup/theme.ts"}},"code":"let createLess;\nmodule.link(\"less/browser\", {\n  default(v) {\n    createLess = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 2);\nlet settings;\nmodule.link(\"../../app/settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 3);\nconst variables = new Map();\nconst lessExpressions = new Map([['default-action-color', 'darken(@secondary-background-color, 15%)'], ['default-action-contrast', 'contrast(@default-action-color, #444444)'], ['primary-background-contrast', 'contrast(@primary-background-color, #444444)'], ['primary-action-contrast', 'contrast(@primary-action-color, #444444)'], ['secondary-background-contrast', 'contrast(@secondary-background-color, #444444)'], ['secondary-action-contrast', 'contrast(@secondary-action-color, #444444)'], ['selection-background', 'lighten(@selection-color, 30%)'], ['success-background', 'lighten(@success-color, 45%)'], ['success-border', 'lighten(@success-color, 30%)'], ['error-background', 'lighten(@error-color, 45%)'], ['error-border', 'lighten(@error-color, 30%)'], ['error-contrast', 'contrast(@error-color)'], ['pending-background', 'lighten(@pending-color, 45%)'], ['pending-border', 'lighten(@pending-color, 30%)'], ['transparent-darkest', 'rgba(17, 12, 12, 0.5)'], ['transparent-darker', 'rgba(0, 0, 0, 0.15)'], ['transparent-dark', 'rgba(15, 34, 0, 0.05)'], ['transparent-light', 'rgba(255, 255, 255, 0.1)'], ['transparent-lighter', 'rgba(255, 255, 255, 0.3)'], ['transparent-lightest', 'rgba(255, 255, 255, 0.6)']]);\nconst less = createLess(window, {});\n\nconst compileLess = async () => {\n  if (lessExpressions.size === 0) {\n    return '';\n  }\n\n  const lessCode = [...Array.from(variables.entries(), _ref => {\n    let [name, value] = _ref;\n    return \"@\".concat(name, \": \").concat(value, \";\");\n  }), ...Array.from(lessExpressions.entries(), _ref2 => {\n    let [name, expression] = _ref2;\n    return \"@\".concat(name, \": \").concat(expression, \";\");\n  }), ':root {', ...Array.from(lessExpressions.entries(), _ref3 => {\n    let [name] = _ref3;\n    return \"--\".concat(name, \": @\").concat(name, \";\");\n  }), '}'].join('\\n');\n\n  try {\n    const {\n      css\n    } = await less.render(lessCode);\n    return css;\n  } catch (error) {\n    console.error(error);\n    return '';\n  }\n};\n\nlet cssVariablesElement = null;\n\nconst updateCssVariables = _.debounce(async () => {\n  if (!cssVariablesElement) {\n    cssVariablesElement = document.querySelector('#css-variables');\n  }\n\n  if (!cssVariablesElement) {\n    return;\n  }\n\n  cssVariablesElement.innerHTML = [':root {', ...Array.from(variables.entries(), _ref4 => {\n    let [name, value] = _ref4;\n    return \"--\".concat(name, \": \").concat(value, \";\");\n  }), '}', await compileLess()].join('\\n');\n}, 50);\n\nconst handleThemeColorChanged = _ref5 => {\n  let {\n    _id,\n    value,\n    editor\n  } = _ref5;\n\n  if (typeof value !== 'string') {\n    return;\n  }\n\n  try {\n    var _$exec;\n\n    const name = (_$exec = /^theme-color-(.*)$/.exec(_id)) === null || _$exec === void 0 ? void 0 : _$exec[1];\n\n    if (!name) {\n      return;\n    }\n\n    const legacy = name.slice(0, 3) !== 'rc-';\n\n    if (editor === 'color') {\n      variables.set(name, value);\n      return;\n    }\n\n    if (legacy) {\n      lessExpressions.set(name, value);\n      return;\n    }\n\n    variables.set(name, \"var(--\".concat(value, \")\"));\n  } finally {\n    updateCssVariables();\n  }\n};\n\nconst handleThemeFontChanged = _ref6 => {\n  let {\n    _id,\n    value\n  } = _ref6;\n\n  try {\n    var _$exec2;\n\n    const name = (_$exec2 = /^theme-font-(.*)$/.exec(_id)) === null || _$exec2 === void 0 ? void 0 : _$exec2[1];\n\n    if (!name) {\n      return;\n    }\n\n    variables.set(name, value);\n  } finally {\n    updateCssVariables();\n  }\n};\n\nMeteor.startup(() => {\n  settings.collection.find({\n    _id: /^theme-color-/i\n  }, {\n    fields: {\n      value: 1,\n      editor: 1\n    }\n  }).observe({\n    added: handleThemeColorChanged,\n    changed: handleThemeColorChanged\n  });\n  settings.collection.find({\n    _id: /^theme-font-/i\n  }, {\n    fields: {\n      value: 1\n    }\n  }).observe({\n    added: handleThemeFontChanged,\n    changed: handleThemeFontChanged\n  });\n});","map":{"version":3,"sources":["client/startup/theme.ts"],"names":[],"mappings":"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","sourcesContent":["import createLess from 'less/browser';\nimport { Meteor } from 'meteor/meteor';\nimport _ from 'underscore';\n\nimport { settings } from '../../app/settings/client';\nimport { ISetting, ISettingColor } from '../../definition/ISetting';\n\nconst variables = new Map();\nconst lessExpressions = new Map([\n\t['default-action-color', 'darken(@secondary-background-color, 15%)'],\n\t['default-action-contrast', 'contrast(@default-action-color, #444444)'],\n\t['primary-background-contrast', 'contrast(@primary-background-color, #444444)'],\n\t['primary-action-contrast', 'contrast(@primary-action-color, #444444)'],\n\t['secondary-background-contrast', 'contrast(@secondary-background-color, #444444)'],\n\t['secondary-action-contrast', 'contrast(@secondary-action-color, #444444)'],\n\t['selection-background', 'lighten(@selection-color, 30%)'],\n\t['success-background', 'lighten(@success-color, 45%)'],\n\t['success-border', 'lighten(@success-color, 30%)'],\n\t['error-background', 'lighten(@error-color, 45%)'],\n\t['error-border', 'lighten(@error-color, 30%)'],\n\t['error-contrast', 'contrast(@error-color)'],\n\t['pending-background', 'lighten(@pending-color, 45%)'],\n\t['pending-border', 'lighten(@pending-color, 30%)'],\n\t['transparent-darkest', 'rgba(17, 12, 12, 0.5)'],\n\t['transparent-darker', 'rgba(0, 0, 0, 0.15)'],\n\t['transparent-dark', 'rgba(15, 34, 0, 0.05)'],\n\t['transparent-light', 'rgba(255, 255, 255, 0.1)'],\n\t['transparent-lighter', 'rgba(255, 255, 255, 0.3)'],\n\t['transparent-lightest', 'rgba(255, 255, 255, 0.6)'],\n]);\n\nconst less = createLess(window, {});\n\nconst compileLess = async (): Promise<string> => {\n\tif (lessExpressions.size === 0) {\n\t\treturn '';\n\t}\n\n\tconst lessCode = [\n\t\t...Array.from(variables.entries(), ([name, value]) => `@${name}: ${value};`),\n\t\t...Array.from(lessExpressions.entries(), ([name, expression]) => `@${name}: ${expression};`),\n\t\t':root {',\n\t\t...Array.from(lessExpressions.entries(), ([name]) => `--${name}: @${name};`),\n\t\t'}',\n\t].join('\\n');\n\n\ttry {\n\t\tconst { css } = await less.render(lessCode);\n\t\treturn css;\n\t} catch (error) {\n\t\tconsole.error(error);\n\t\treturn '';\n\t}\n};\n\nlet cssVariablesElement: HTMLStyleElement | null = null;\n\nconst updateCssVariables = _.debounce(async () => {\n\tif (!cssVariablesElement) {\n\t\tcssVariablesElement = document.querySelector('#css-variables');\n\t}\n\n\tif (!cssVariablesElement) {\n\t\treturn;\n\t}\n\n\tcssVariablesElement.innerHTML = [\n\t\t':root {',\n\t\t...Array.from(variables.entries(), ([name, value]) => `--${name}: ${value};`),\n\t\t'}',\n\t\tawait compileLess(),\n\t].join('\\n');\n}, 50);\n\nconst handleThemeColorChanged = ({ _id, value, editor }: ISettingColor): void => {\n\tif (typeof value !== 'string') {\n\t\treturn;\n\t}\n\ttry {\n\t\tconst name = /^theme-color-(.*)$/.exec(_id)?.[1];\n\n\t\tif (!name) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst legacy = name.slice(0, 3) !== 'rc-';\n\n\t\tif (editor === 'color') {\n\t\t\tvariables.set(name, value);\n\t\t\treturn;\n\t\t}\n\n\t\tif (legacy) {\n\t\t\tlessExpressions.set(name, value);\n\t\t\treturn;\n\t\t}\n\n\t\tvariables.set(name, `var(--${value})`);\n\t} finally {\n\t\tupdateCssVariables();\n\t}\n};\n\nconst handleThemeFontChanged = ({ _id, value }: ISetting & { value: string }): void => {\n\ttry {\n\t\tconst name = /^theme-font-(.*)$/.exec(_id)?.[1];\n\t\tif (!name) {\n\t\t\treturn;\n\t\t}\n\n\t\tvariables.set(name, value);\n\t} finally {\n\t\tupdateCssVariables();\n\t}\n};\n\nMeteor.startup(() => {\n\tsettings.collection.find({ _id: /^theme-color-/i }, { fields: { value: 1, editor: 1 } }).observe({\n\t\tadded: handleThemeColorChanged,\n\t\tchanged: handleThemeColorChanged,\n\t});\n\n\tsettings.collection.find({ _id: /^theme-font-/i }, { fields: { value: 1 } }).observe({\n\t\tadded: handleThemeFontChanged,\n\t\tchanged: handleThemeFontChanged,\n\t});\n});\n"],"sourceRoot":""},"sourceType":"module","hash":"7b13b3971c081b661864e29d2e636a2a1cda5fa8"}
