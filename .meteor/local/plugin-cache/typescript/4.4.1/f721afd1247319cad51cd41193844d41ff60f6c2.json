{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/lib/minimongo/bson.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/lib/minimongo/bson.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/lib/minimongo/bson.ts","inputSourceMap":{"version":3,"file":"client/lib/minimongo/bson.ts","sourceRoot":"","sources":["client/lib/minimongo/bson.ts"],"names":[],"mappings":"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","sourcesContent":["import { BSONType } from './types';\n\nexport const getBSONType = <T>(v: T): BSONType => {\n\tif (typeof v === 'number') {\n\t\treturn BSONType.Double;\n\t}\n\n\tif (typeof v === 'string') {\n\t\treturn BSONType.String;\n\t}\n\n\tif (typeof v === 'boolean') {\n\t\treturn BSONType.Boolean;\n\t}\n\n\tif (Array.isArray(v)) {\n\t\treturn BSONType.Array;\n\t}\n\n\tif (v === null) {\n\t\treturn BSONType.Null;\n\t}\n\n\tif (v instanceof RegExp) {\n\t\treturn BSONType.Regex;\n\t}\n\n\tif (typeof v === 'function') {\n\t\treturn BSONType.JavaScript;\n\t}\n\n\tif (v instanceof Date) {\n\t\treturn BSONType.Date;\n\t}\n\n\tif (v instanceof Uint8Array) {\n\t\treturn BSONType.BinData;\n\t}\n\n\treturn BSONType.Object;\n};\n\nconst getBSONTypeOrder = (type: BSONType): number => {\n\tswitch (type) {\n\t\tcase BSONType.Null:\n\t\t\treturn 0;\n\n\t\tcase BSONType.Double:\n\t\tcase BSONType.Int:\n\t\tcase BSONType.Long:\n\t\t\treturn 1;\n\n\t\tcase BSONType.String:\n\t\tcase BSONType.Symbol:\n\t\t\treturn 2;\n\n\t\tcase BSONType.Object:\n\t\t\treturn 3;\n\n\t\tcase BSONType.Array:\n\t\t\treturn 4;\n\n\t\tcase BSONType.BinData:\n\t\t\treturn 5;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn 6;\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn 7;\n\n\t\tcase BSONType.Date:\n\t\tcase BSONType.Timestamp:\n\t\t\treturn 8;\n\n\t\tcase BSONType.Regex:\n\t\t\treturn 9;\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\treturn 100;\n\n\t\tdefault:\n\t\t\treturn -1;\n\t}\n};\n\ntype ObjectID = {\n\ttoHexString(): string;\n\tequals(otherID: ObjectID): boolean;\n};\n\nexport const compareBSONValues = (a: unknown, b: unknown): number => {\n\tif (a === undefined) {\n\t\treturn b === undefined ? 0 : -1;\n\t}\n\n\tif (b === undefined) {\n\t\treturn 1;\n\t}\n\n\tconst ta = getBSONType(a);\n\tconst oa = getBSONTypeOrder(ta);\n\n\tconst tb = getBSONType(b);\n\tconst ob = getBSONTypeOrder(tb);\n\n\tif (oa !== ob) {\n\t\treturn oa < ob ? -1 : 1;\n\t}\n\n\tif (ta !== tb) {\n\t\tthrow Error('Missing type coercion logic in compareBSONValues');\n\t}\n\n\tswitch (ta) {\n\t\tcase BSONType.Double:\n\t\t\treturn (a as number) - (b as number);\n\n\t\tcase BSONType.String:\n\t\t\treturn (a as string).localeCompare(b as string);\n\n\t\tcase BSONType.Object:\n\t\t\treturn compareBSONValues(\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(a as Record<string, unknown>)),\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(b as Record<string, unknown>)),\n\t\t\t);\n\n\t\tcase BSONType.Array: {\n\t\t\tfor (let i = 0; ; i++) {\n\t\t\t\tif (i === (a as unknown[]).length) {\n\t\t\t\t\treturn i === (b as unknown[]).length ? 0 : -1;\n\t\t\t\t}\n\n\t\t\t\tif (i === (b as unknown[]).length) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tconst s = compareBSONValues((a as unknown[])[i], (b as unknown[])[i]);\n\t\t\t\tif (s !== 0) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcase BSONType.BinData: {\n\t\t\tif ((a as Uint8Array).length !== (b as Uint8Array).length) {\n\t\t\t\treturn (a as Uint8Array).length - (b as Uint8Array).length;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < (a as Uint8Array).length; i++) {\n\t\t\t\tif ((a as Uint8Array)[i] === (b as Uint8Array)[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn (a as Uint8Array)[i] < (b as Uint8Array)[i] ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tcase BSONType.Null:\n\t\tcase BSONType.Undefined:\n\t\t\treturn 0;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn (a as ObjectID).toHexString().localeCompare((b as ObjectID).toHexString());\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn Number(a) - Number(b);\n\n\t\tcase BSONType.Date:\n\t\t\treturn (a as Date).getTime() - (b as Date).getTime();\n\n\t\tcase BSONType.Regex:\n\t\t\tthrow Error('Sorting not supported on regular expression');\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\tthrow Error('Sorting not supported on Javascript code');\n\t}\n\n\tthrow Error('Unknown type to sort');\n};\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/lib/minimongo/bson.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/minimongo/bson.ts"}},"code":"var _toConsumableArray;\n\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 0);\nmodule.export({\n  getBSONType: function () {\n    return getBSONType;\n  },\n  compareBSONValues: function () {\n    return compareBSONValues;\n  }\n});\nvar BSONType;\nmodule.link(\"./types\", {\n  BSONType: function (v) {\n    BSONType = v;\n  }\n}, 0);\n\nvar getBSONType = function (v) {\n  if (typeof v === 'number') {\n    return BSONType.Double;\n  }\n\n  if (typeof v === 'string') {\n    return BSONType.String;\n  }\n\n  if (typeof v === 'boolean') {\n    return BSONType.Boolean;\n  }\n\n  if (Array.isArray(v)) {\n    return BSONType.Array;\n  }\n\n  if (v === null) {\n    return BSONType.Null;\n  }\n\n  if (v instanceof RegExp) {\n    return BSONType.Regex;\n  }\n\n  if (typeof v === 'function') {\n    return BSONType.JavaScript;\n  }\n\n  if (v instanceof Date) {\n    return BSONType.Date;\n  }\n\n  if (v instanceof Uint8Array) {\n    return BSONType.BinData;\n  }\n\n  return BSONType.Object;\n};\n\nvar getBSONTypeOrder = function (type) {\n  switch (type) {\n    case BSONType.Null:\n      return 0;\n\n    case BSONType.Double:\n    case BSONType.Int:\n    case BSONType.Long:\n      return 1;\n\n    case BSONType.String:\n    case BSONType.Symbol:\n      return 2;\n\n    case BSONType.Object:\n      return 3;\n\n    case BSONType.Array:\n      return 4;\n\n    case BSONType.BinData:\n      return 5;\n\n    case BSONType.ObjectId:\n      return 6;\n\n    case BSONType.Boolean:\n      return 7;\n\n    case BSONType.Date:\n    case BSONType.Timestamp:\n      return 8;\n\n    case BSONType.Regex:\n      return 9;\n\n    case BSONType.JavaScript:\n    case BSONType.JavaScriptWithScope:\n      return 100;\n\n    default:\n      return -1;\n  }\n};\n\nvar compareBSONValues = function (a, b) {\n  var _Array$prototype$conc, _Array$prototype$conc2;\n\n  if (a === undefined) {\n    return b === undefined ? 0 : -1;\n  }\n\n  if (b === undefined) {\n    return 1;\n  }\n\n  var ta = getBSONType(a);\n  var oa = getBSONTypeOrder(ta);\n  var tb = getBSONType(b);\n  var ob = getBSONTypeOrder(tb);\n\n  if (oa !== ob) {\n    return oa < ob ? -1 : 1;\n  }\n\n  if (ta !== tb) {\n    throw Error('Missing type coercion logic in compareBSONValues');\n  }\n\n  switch (ta) {\n    case BSONType.Double:\n      return a - b;\n\n    case BSONType.String:\n      return a.localeCompare(b);\n\n    case BSONType.Object:\n      return compareBSONValues((_Array$prototype$conc = Array.prototype.concat).call.apply(_Array$prototype$conc, [[]].concat(_toConsumableArray(Object.entries(a)))), (_Array$prototype$conc2 = Array.prototype.concat).call.apply(_Array$prototype$conc2, [[]].concat(_toConsumableArray(Object.entries(b)))));\n\n    case BSONType.Array:\n      {\n        for (var i = 0;; i++) {\n          if (i === a.length) {\n            return i === b.length ? 0 : -1;\n          }\n\n          if (i === b.length) {\n            return 1;\n          }\n\n          var s = compareBSONValues(a[i], b[i]);\n\n          if (s !== 0) {\n            return s;\n          }\n        }\n      }\n\n    case BSONType.BinData:\n      {\n        if (a.length !== b.length) {\n          return a.length - b.length;\n        }\n\n        for (var _i = 0; _i < a.length; _i++) {\n          if (a[_i] === b[_i]) {\n            continue;\n          }\n\n          return a[_i] < b[_i] ? -1 : 1;\n        }\n\n        return 0;\n      }\n\n    case BSONType.Null:\n    case BSONType.Undefined:\n      return 0;\n\n    case BSONType.ObjectId:\n      return a.toHexString().localeCompare(b.toHexString());\n\n    case BSONType.Boolean:\n      return Number(a) - Number(b);\n\n    case BSONType.Date:\n      return a.getTime() - b.getTime();\n\n    case BSONType.Regex:\n      throw Error('Sorting not supported on regular expression');\n\n    case BSONType.JavaScript:\n    case BSONType.JavaScriptWithScope:\n      throw Error('Sorting not supported on Javascript code');\n  }\n\n  throw Error('Unknown type to sort');\n};","map":{"version":3,"sources":["client/lib/minimongo/bson.ts"],"names":[],"mappings":"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","sourcesContent":["import { BSONType } from './types';\n\nexport const getBSONType = <T>(v: T): BSONType => {\n\tif (typeof v === 'number') {\n\t\treturn BSONType.Double;\n\t}\n\n\tif (typeof v === 'string') {\n\t\treturn BSONType.String;\n\t}\n\n\tif (typeof v === 'boolean') {\n\t\treturn BSONType.Boolean;\n\t}\n\n\tif (Array.isArray(v)) {\n\t\treturn BSONType.Array;\n\t}\n\n\tif (v === null) {\n\t\treturn BSONType.Null;\n\t}\n\n\tif (v instanceof RegExp) {\n\t\treturn BSONType.Regex;\n\t}\n\n\tif (typeof v === 'function') {\n\t\treturn BSONType.JavaScript;\n\t}\n\n\tif (v instanceof Date) {\n\t\treturn BSONType.Date;\n\t}\n\n\tif (v instanceof Uint8Array) {\n\t\treturn BSONType.BinData;\n\t}\n\n\treturn BSONType.Object;\n};\n\nconst getBSONTypeOrder = (type: BSONType): number => {\n\tswitch (type) {\n\t\tcase BSONType.Null:\n\t\t\treturn 0;\n\n\t\tcase BSONType.Double:\n\t\tcase BSONType.Int:\n\t\tcase BSONType.Long:\n\t\t\treturn 1;\n\n\t\tcase BSONType.String:\n\t\tcase BSONType.Symbol:\n\t\t\treturn 2;\n\n\t\tcase BSONType.Object:\n\t\t\treturn 3;\n\n\t\tcase BSONType.Array:\n\t\t\treturn 4;\n\n\t\tcase BSONType.BinData:\n\t\t\treturn 5;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn 6;\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn 7;\n\n\t\tcase BSONType.Date:\n\t\tcase BSONType.Timestamp:\n\t\t\treturn 8;\n\n\t\tcase BSONType.Regex:\n\t\t\treturn 9;\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\treturn 100;\n\n\t\tdefault:\n\t\t\treturn -1;\n\t}\n};\n\ntype ObjectID = {\n\ttoHexString(): string;\n\tequals(otherID: ObjectID): boolean;\n};\n\nexport const compareBSONValues = (a: unknown, b: unknown): number => {\n\tif (a === undefined) {\n\t\treturn b === undefined ? 0 : -1;\n\t}\n\n\tif (b === undefined) {\n\t\treturn 1;\n\t}\n\n\tconst ta = getBSONType(a);\n\tconst oa = getBSONTypeOrder(ta);\n\n\tconst tb = getBSONType(b);\n\tconst ob = getBSONTypeOrder(tb);\n\n\tif (oa !== ob) {\n\t\treturn oa < ob ? -1 : 1;\n\t}\n\n\tif (ta !== tb) {\n\t\tthrow Error('Missing type coercion logic in compareBSONValues');\n\t}\n\n\tswitch (ta) {\n\t\tcase BSONType.Double:\n\t\t\treturn (a as number) - (b as number);\n\n\t\tcase BSONType.String:\n\t\t\treturn (a as string).localeCompare(b as string);\n\n\t\tcase BSONType.Object:\n\t\t\treturn compareBSONValues(\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(a as Record<string, unknown>)),\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(b as Record<string, unknown>)),\n\t\t\t);\n\n\t\tcase BSONType.Array: {\n\t\t\tfor (let i = 0; ; i++) {\n\t\t\t\tif (i === (a as unknown[]).length) {\n\t\t\t\t\treturn i === (b as unknown[]).length ? 0 : -1;\n\t\t\t\t}\n\n\t\t\t\tif (i === (b as unknown[]).length) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tconst s = compareBSONValues((a as unknown[])[i], (b as unknown[])[i]);\n\t\t\t\tif (s !== 0) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcase BSONType.BinData: {\n\t\t\tif ((a as Uint8Array).length !== (b as Uint8Array).length) {\n\t\t\t\treturn (a as Uint8Array).length - (b as Uint8Array).length;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < (a as Uint8Array).length; i++) {\n\t\t\t\tif ((a as Uint8Array)[i] === (b as Uint8Array)[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn (a as Uint8Array)[i] < (b as Uint8Array)[i] ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tcase BSONType.Null:\n\t\tcase BSONType.Undefined:\n\t\t\treturn 0;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn (a as ObjectID).toHexString().localeCompare((b as ObjectID).toHexString());\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn Number(a) - Number(b);\n\n\t\tcase BSONType.Date:\n\t\t\treturn (a as Date).getTime() - (b as Date).getTime();\n\n\t\tcase BSONType.Regex:\n\t\t\tthrow Error('Sorting not supported on regular expression');\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\tthrow Error('Sorting not supported on Javascript code');\n\t}\n\n\tthrow Error('Unknown type to sort');\n};\n"],"sourceRoot":""},"sourceType":"module","hash":"f721afd1247319cad51cd41193844d41ff60f6c2"}
