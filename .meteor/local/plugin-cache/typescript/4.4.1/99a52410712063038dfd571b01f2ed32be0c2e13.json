{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/meet/MeetPage.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/meet/MeetPage.tsx","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/meet/MeetPage.tsx","inputSourceMap":{"version":3,"file":"client/views/meet/MeetPage.tsx","sourceRoot":"","sources":["client/views/meet/MeetPage.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Button, Box, Icon, Flex } from '@rocket.chat/fuselage';\nimport { Meteor } from 'meteor/meteor';\nimport React, { useEffect, useState, useCallback, FC } from 'react';\n\nimport { APIClient } from '../../../app/utils/client';\nimport UserAvatar from '../../components/avatar/UserAvatar';\nimport { useRouteParameter, useQueryStringParameter } from '../../contexts/RouterContext';\nimport NotFoundPage from '../notFound/NotFoundPage';\nimport PageLoading from '../root/PageLoading';\nimport CallPage from './CallPage';\nimport './styles.css';\n\nconst MeetPage: FC = () => {\n\tconst [isRoomMember, setIsRoomMember] = useState(false);\n\tconst [status, setStatus] = useState(null);\n\tconst [visitorId, setVisitorId] = useState(null);\n\tconst roomId = useRouteParameter('rid');\n\tconst visitorToken = useQueryStringParameter('token');\n\tconst layout = useQueryStringParameter('layout');\n\tconst [visitorName, setVisitorName] = useState('');\n\tconst [agentName, setAgentName] = useState('');\n\tconst [callStartTime, setCallStartTime] = useState(undefined);\n\n\tconst isMobileDevice = (): boolean => window.innerWidth <= 450;\n\tconst closeCallTab = (): void => window.close();\n\n\tconst setupCallForVisitor = useCallback(async () => {\n\t\tconst room = await APIClient.v1.get(`livechat/room?token=${visitorToken}&rid=${roomId}`);\n\t\tif (room?.room?.v?.token === visitorToken) {\n\t\t\tsetVisitorId(room.room.v._id);\n\t\t\tsetVisitorName(room.room.fname);\n\t\t\troom?.room?.responseBy?.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n\t\t\tsetStatus(room?.room?.callStatus || 'ended');\n\t\t\tsetCallStartTime(room.room.webRtcCallStartTime);\n\t\t\treturn setIsRoomMember(true);\n\t\t}\n\t}, [visitorToken, roomId]);\n\n\tconst setupCallForAgent = useCallback(async () => {\n\t\tconst room = await APIClient.v1.get(`rooms.info?roomId=${roomId}`);\n\t\tif (room?.room?.servedBy?._id === Meteor.userId()) {\n\t\t\tsetVisitorName(room.room.fname);\n\t\t\troom?.room?.responseBy?.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n\t\t\tsetStatus(room?.room?.callStatus || 'ended');\n\t\t\tsetCallStartTime(room.room.webRtcCallStartTime);\n\t\t\treturn setIsRoomMember(true);\n\t\t}\n\t}, [roomId]);\n\n\tuseEffect(() => {\n\t\tif (visitorToken) {\n\t\t\tsetupCallForVisitor();\n\t\t\treturn;\n\t\t}\n\t\tsetupCallForAgent();\n\t}, [setupCallForAgent, setupCallForVisitor, visitorToken]);\n\tif (status === null) {\n\t\treturn <PageLoading></PageLoading>;\n\t}\n\tif (!isRoomMember) {\n\t\treturn <NotFoundPage></NotFoundPage>;\n\t}\n\tif (status === 'ended') {\n\t\treturn (\n\t\t\t<Flex.Container direction='column' justifyContent='center'>\n\t\t\t\t<Box width='full' minHeight='sh' alignItems='center' backgroundColor='neutral-900' overflow='hidden' position='relative'>\n\t\t\t\t\t<Box\n\t\t\t\t\t\tposition='absolute'\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop: '5%',\n\t\t\t\t\t\t\tright: '2%',\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName='Self_Video'\n\t\t\t\t\t\tbackgroundColor='#2F343D'\n\t\t\t\t\t\talignItems='center'\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tusername={visitorToken ? visitorName : agentName}\n\t\t\t\t\t\t\tclassName='rcx-message__avatar'\n\t\t\t\t\t\t\tsize={isMobileDevice() ? 'x32' : 'x48'}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Box\n\t\t\t\t\t\tposition='absolute'\n\t\t\t\t\t\tzIndex={1}\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop: isMobileDevice() ? '30%' : '20%',\n\t\t\t\t\t\t\tdisplay: 'flex',\n\t\t\t\t\t\t\tjustifyContent: 'center',\n\t\t\t\t\t\t\tflexDirection: 'column',\n\t\t\t\t\t\t}}\n\t\t\t\t\t\talignItems='center'\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tusername={visitorToken ? agentName : visitorName}\n\t\t\t\t\t\t\tclassName='rcx-message__avatar'\n\t\t\t\t\t\t\tsize='x124'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<p style={{ color: 'white', fontSize: 16, margin: 15 }}>{'Call Ended!'}</p>\n\t\t\t\t\t\t<p\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tcolor: 'white',\n\t\t\t\t\t\t\t\tfontSize: isMobileDevice() ? 15 : 22,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{visitorToken ? agentName : visitorName}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Box position='absolute' alignItems='center' style={{ bottom: '20%' }}>\n\t\t\t\t\t\t<Button square title='Close Window' onClick={closeCallTab} backgroundColor='#2F343D' borderColor='#2F343D'>\n\t\t\t\t\t\t\t<Icon name='cross' size='x16' color='white' />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Box>\n\t\t\t\t</Box>\n\t\t\t</Flex.Container>\n\t\t);\n\t}\n\n\treturn (\n\t\t<CallPage\n\t\t\troomId={roomId}\n\t\t\tstatus={status}\n\t\t\tvisitorToken={visitorToken}\n\t\t\tvisitorId={visitorId}\n\t\t\tsetStatus={setStatus}\n\t\t\tvisitorName={visitorName}\n\t\t\tagentName={agentName}\n\t\t\tlayout={layout}\n\t\t\tcallStartTime={callStartTime}\n\t\t/>\n\t);\n};\n\nexport default MeetPage;\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/meet/MeetPage.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/meet/MeetPage.tsx"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\nvar Button, Box, Icon, Flex;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Button: function (v) {\n    Button = v;\n  },\n  Box: function (v) {\n    Box = v;\n  },\n  Icon: function (v) {\n    Icon = v;\n  },\n  Flex: function (v) {\n    Flex = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar React, useEffect, useState, useCallback;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useState: function (v) {\n    useState = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  }\n}, 2);\nvar APIClient;\nmodule.link(\"../../../app/utils/client\", {\n  APIClient: function (v) {\n    APIClient = v;\n  }\n}, 3);\nvar UserAvatar;\nmodule.link(\"../../components/avatar/UserAvatar\", {\n  \"default\": function (v) {\n    UserAvatar = v;\n  }\n}, 4);\nvar useRouteParameter, useQueryStringParameter;\nmodule.link(\"../../contexts/RouterContext\", {\n  useRouteParameter: function (v) {\n    useRouteParameter = v;\n  },\n  useQueryStringParameter: function (v) {\n    useQueryStringParameter = v;\n  }\n}, 5);\nvar NotFoundPage;\nmodule.link(\"../notFound/NotFoundPage\", {\n  \"default\": function (v) {\n    NotFoundPage = v;\n  }\n}, 6);\nvar PageLoading;\nmodule.link(\"../root/PageLoading\", {\n  \"default\": function (v) {\n    PageLoading = v;\n  }\n}, 7);\nvar CallPage;\nmodule.link(\"./CallPage\", {\n  \"default\": function (v) {\n    CallPage = v;\n  }\n}, 8);\nmodule.link(\"./styles.css\");\n\nvar MeetPage = function () {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isRoomMember = _useState2[0],\n      setIsRoomMember = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      status = _useState4[0],\n      setStatus = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      visitorId = _useState6[0],\n      setVisitorId = _useState6[1];\n\n  var roomId = useRouteParameter('rid');\n  var visitorToken = useQueryStringParameter('token');\n  var layout = useQueryStringParameter('layout');\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      visitorName = _useState8[0],\n      setVisitorName = _useState8[1];\n\n  var _useState9 = useState(''),\n      _useState10 = _slicedToArray(_useState9, 2),\n      agentName = _useState10[0],\n      setAgentName = _useState10[1];\n\n  var _useState11 = useState(undefined),\n      _useState12 = _slicedToArray(_useState11, 2),\n      callStartTime = _useState12[0],\n      setCallStartTime = _useState12[1];\n\n  var isMobileDevice = function () {\n    return window.innerWidth <= 450;\n  };\n\n  var closeCallTab = function () {\n    return window.close();\n  };\n\n  var setupCallForVisitor = useCallback(function () {\n    function _callee() {\n      var _room$room, _room$room$v;\n\n      var room, _room$room2, _room$room2$responseB, _room$room3;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return _regeneratorRuntime.awrap(APIClient.v1.get(\"livechat/room?token=\" + visitorToken + \"&rid=\" + roomId));\n\n              case 2:\n                room = _context.sent;\n\n                if (!((room === null || room === void 0 ? void 0 : (_room$room = room.room) === null || _room$room === void 0 ? void 0 : (_room$room$v = _room$room.v) === null || _room$room$v === void 0 ? void 0 : _room$room$v.token) === visitorToken)) {\n                  _context.next = 10;\n                  break;\n                }\n\n                setVisitorId(room.room.v._id);\n                setVisitorName(room.room.fname);\n                room !== null && room !== void 0 && (_room$room2 = room.room) !== null && _room$room2 !== void 0 && (_room$room2$responseB = _room$room2.responseBy) !== null && _room$room2$responseB !== void 0 && _room$room2$responseB.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n                setStatus((room === null || room === void 0 ? void 0 : (_room$room3 = room.room) === null || _room$room3 === void 0 ? void 0 : _room$room3.callStatus) || 'ended');\n                setCallStartTime(room.room.webRtcCallStartTime);\n                return _context.abrupt(\"return\", setIsRoomMember(true));\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee;\n  }(), [visitorToken, roomId]);\n  var setupCallForAgent = useCallback(function () {\n    function _callee2() {\n      var _room$room4, _room$room4$servedBy;\n\n      var room, _room$room5, _room$room5$responseB, _room$room6;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _regeneratorRuntime.awrap(APIClient.v1.get(\"rooms.info?roomId=\" + roomId));\n\n              case 2:\n                room = _context2.sent;\n\n                if (!((room === null || room === void 0 ? void 0 : (_room$room4 = room.room) === null || _room$room4 === void 0 ? void 0 : (_room$room4$servedBy = _room$room4.servedBy) === null || _room$room4$servedBy === void 0 ? void 0 : _room$room4$servedBy._id) === Meteor.userId())) {\n                  _context2.next = 9;\n                  break;\n                }\n\n                setVisitorName(room.room.fname);\n                room !== null && room !== void 0 && (_room$room5 = room.room) !== null && _room$room5 !== void 0 && (_room$room5$responseB = _room$room5.responseBy) !== null && _room$room5$responseB !== void 0 && _room$room5$responseB.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n                setStatus((room === null || room === void 0 ? void 0 : (_room$room6 = room.room) === null || _room$room6 === void 0 ? void 0 : _room$room6.callStatus) || 'ended');\n                setCallStartTime(room.room.webRtcCallStartTime);\n                return _context2.abrupt(\"return\", setIsRoomMember(true));\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }\n\n        return _callee2$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee2;\n  }(), [roomId]);\n  useEffect(function () {\n    if (visitorToken) {\n      setupCallForVisitor();\n      return;\n    }\n\n    setupCallForAgent();\n  }, [setupCallForAgent, setupCallForVisitor, visitorToken]);\n\n  if (status === null) {\n    return /*#__PURE__*/React.createElement(PageLoading, null);\n  }\n\n  if (!isRoomMember) {\n    return /*#__PURE__*/React.createElement(NotFoundPage, null);\n  }\n\n  if (status === 'ended') {\n    return /*#__PURE__*/React.createElement(Flex.Container, {\n      direction: \"column\",\n      justifyContent: \"center\"\n    }, /*#__PURE__*/React.createElement(Box, {\n      width: \"full\",\n      minHeight: \"sh\",\n      alignItems: \"center\",\n      backgroundColor: \"neutral-900\",\n      overflow: \"hidden\",\n      position: \"relative\"\n    }, /*#__PURE__*/React.createElement(Box, {\n      position: \"absolute\",\n      style: {\n        top: '5%',\n        right: '2%'\n      },\n      className: \"Self_Video\",\n      backgroundColor: \"#2F343D\",\n      alignItems: \"center\"\n    }, /*#__PURE__*/React.createElement(UserAvatar, {\n      style: {\n        display: 'block',\n        margin: 'auto'\n      },\n      username: visitorToken ? visitorName : agentName,\n      className: \"rcx-message__avatar\",\n      size: isMobileDevice() ? 'x32' : 'x48'\n    })), /*#__PURE__*/React.createElement(Box, {\n      position: \"absolute\",\n      zIndex: 1,\n      style: {\n        top: isMobileDevice() ? '30%' : '20%',\n        display: 'flex',\n        justifyContent: 'center',\n        flexDirection: 'column'\n      },\n      alignItems: \"center\"\n    }, /*#__PURE__*/React.createElement(UserAvatar, {\n      style: {\n        display: 'block',\n        margin: 'auto'\n      },\n      username: visitorToken ? agentName : visitorName,\n      className: \"rcx-message__avatar\",\n      size: \"x124\"\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      style: {\n        color: 'white',\n        fontSize: 16,\n        margin: 15\n      }\n    }, 'Call Ended!'), /*#__PURE__*/React.createElement(\"p\", {\n      style: {\n        color: 'white',\n        fontSize: isMobileDevice() ? 15 : 22\n      }\n    }, visitorToken ? agentName : visitorName)), /*#__PURE__*/React.createElement(Box, {\n      position: \"absolute\",\n      alignItems: \"center\",\n      style: {\n        bottom: '20%'\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      square: true,\n      title: \"Close Window\",\n      onClick: closeCallTab,\n      backgroundColor: \"#2F343D\",\n      borderColor: \"#2F343D\"\n    }, /*#__PURE__*/React.createElement(Icon, {\n      name: \"cross\",\n      size: \"x16\",\n      color: \"white\"\n    })))));\n  }\n\n  return /*#__PURE__*/React.createElement(CallPage, {\n    roomId: roomId,\n    status: status,\n    visitorToken: visitorToken,\n    visitorId: visitorId,\n    setStatus: setStatus,\n    visitorName: visitorName,\n    agentName: agentName,\n    layout: layout,\n    callStartTime: callStartTime\n  });\n};\n\nmodule.exportDefault(MeetPage);","map":{"version":3,"sources":["client/views/meet/MeetPage.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Button, Box, Icon, Flex } from '@rocket.chat/fuselage';\nimport { Meteor } from 'meteor/meteor';\nimport React, { useEffect, useState, useCallback, FC } from 'react';\n\nimport { APIClient } from '../../../app/utils/client';\nimport UserAvatar from '../../components/avatar/UserAvatar';\nimport { useRouteParameter, useQueryStringParameter } from '../../contexts/RouterContext';\nimport NotFoundPage from '../notFound/NotFoundPage';\nimport PageLoading from '../root/PageLoading';\nimport CallPage from './CallPage';\nimport './styles.css';\n\nconst MeetPage: FC = () => {\n\tconst [isRoomMember, setIsRoomMember] = useState(false);\n\tconst [status, setStatus] = useState(null);\n\tconst [visitorId, setVisitorId] = useState(null);\n\tconst roomId = useRouteParameter('rid');\n\tconst visitorToken = useQueryStringParameter('token');\n\tconst layout = useQueryStringParameter('layout');\n\tconst [visitorName, setVisitorName] = useState('');\n\tconst [agentName, setAgentName] = useState('');\n\tconst [callStartTime, setCallStartTime] = useState(undefined);\n\n\tconst isMobileDevice = (): boolean => window.innerWidth <= 450;\n\tconst closeCallTab = (): void => window.close();\n\n\tconst setupCallForVisitor = useCallback(async () => {\n\t\tconst room = await APIClient.v1.get(`livechat/room?token=${visitorToken}&rid=${roomId}`);\n\t\tif (room?.room?.v?.token === visitorToken) {\n\t\t\tsetVisitorId(room.room.v._id);\n\t\t\tsetVisitorName(room.room.fname);\n\t\t\troom?.room?.responseBy?.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n\t\t\tsetStatus(room?.room?.callStatus || 'ended');\n\t\t\tsetCallStartTime(room.room.webRtcCallStartTime);\n\t\t\treturn setIsRoomMember(true);\n\t\t}\n\t}, [visitorToken, roomId]);\n\n\tconst setupCallForAgent = useCallback(async () => {\n\t\tconst room = await APIClient.v1.get(`rooms.info?roomId=${roomId}`);\n\t\tif (room?.room?.servedBy?._id === Meteor.userId()) {\n\t\t\tsetVisitorName(room.room.fname);\n\t\t\troom?.room?.responseBy?.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n\t\t\tsetStatus(room?.room?.callStatus || 'ended');\n\t\t\tsetCallStartTime(room.room.webRtcCallStartTime);\n\t\t\treturn setIsRoomMember(true);\n\t\t}\n\t}, [roomId]);\n\n\tuseEffect(() => {\n\t\tif (visitorToken) {\n\t\t\tsetupCallForVisitor();\n\t\t\treturn;\n\t\t}\n\t\tsetupCallForAgent();\n\t}, [setupCallForAgent, setupCallForVisitor, visitorToken]);\n\tif (status === null) {\n\t\treturn <PageLoading></PageLoading>;\n\t}\n\tif (!isRoomMember) {\n\t\treturn <NotFoundPage></NotFoundPage>;\n\t}\n\tif (status === 'ended') {\n\t\treturn (\n\t\t\t<Flex.Container direction='column' justifyContent='center'>\n\t\t\t\t<Box width='full' minHeight='sh' alignItems='center' backgroundColor='neutral-900' overflow='hidden' position='relative'>\n\t\t\t\t\t<Box\n\t\t\t\t\t\tposition='absolute'\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop: '5%',\n\t\t\t\t\t\t\tright: '2%',\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName='Self_Video'\n\t\t\t\t\t\tbackgroundColor='#2F343D'\n\t\t\t\t\t\talignItems='center'\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tusername={visitorToken ? visitorName : agentName}\n\t\t\t\t\t\t\tclassName='rcx-message__avatar'\n\t\t\t\t\t\t\tsize={isMobileDevice() ? 'x32' : 'x48'}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Box\n\t\t\t\t\t\tposition='absolute'\n\t\t\t\t\t\tzIndex={1}\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop: isMobileDevice() ? '30%' : '20%',\n\t\t\t\t\t\t\tdisplay: 'flex',\n\t\t\t\t\t\t\tjustifyContent: 'center',\n\t\t\t\t\t\t\tflexDirection: 'column',\n\t\t\t\t\t\t}}\n\t\t\t\t\t\talignItems='center'\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tusername={visitorToken ? agentName : visitorName}\n\t\t\t\t\t\t\tclassName='rcx-message__avatar'\n\t\t\t\t\t\t\tsize='x124'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<p style={{ color: 'white', fontSize: 16, margin: 15 }}>{'Call Ended!'}</p>\n\t\t\t\t\t\t<p\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tcolor: 'white',\n\t\t\t\t\t\t\t\tfontSize: isMobileDevice() ? 15 : 22,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{visitorToken ? agentName : visitorName}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Box position='absolute' alignItems='center' style={{ bottom: '20%' }}>\n\t\t\t\t\t\t<Button square title='Close Window' onClick={closeCallTab} backgroundColor='#2F343D' borderColor='#2F343D'>\n\t\t\t\t\t\t\t<Icon name='cross' size='x16' color='white' />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Box>\n\t\t\t\t</Box>\n\t\t\t</Flex.Container>\n\t\t);\n\t}\n\n\treturn (\n\t\t<CallPage\n\t\t\troomId={roomId}\n\t\t\tstatus={status}\n\t\t\tvisitorToken={visitorToken}\n\t\t\tvisitorId={visitorId}\n\t\t\tsetStatus={setStatus}\n\t\t\tvisitorName={visitorName}\n\t\t\tagentName={agentName}\n\t\t\tlayout={layout}\n\t\t\tcallStartTime={callStartTime}\n\t\t/>\n\t);\n};\n\nexport default MeetPage;\n"],"sourceRoot":""},"sourceType":"module","hash":"99a52410712063038dfd571b01f2ed32be0c2e13"}
