{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/facebook/FacebookPageContainer.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/omnichannel/facebook/FacebookPageContainer.tsx","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/facebook/FacebookPageContainer.tsx","inputSourceMap":{"version":3,"file":"client/views/omnichannel/facebook/FacebookPageContainer.tsx","sourceRoot":"","sources":["client/views/omnichannel/facebook/FacebookPageContainer.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Callout } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { FC } from 'react';\n\nimport Page from '../../../components/Page';\nimport PageSkeleton from '../../../components/PageSkeleton';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { AsyncStatePhase } from '../../../hooks/useAsyncState';\nimport { useMethodData } from '../../../hooks/useMethodData';\nimport FacebookPage from './FacebookPage';\n\ntype PageItem = {\n\tname: string;\n\tsubscribed: boolean;\n\tid: string;\n};\n\ntype PageData = {\n\tpages: PageItem[];\n};\n\ntype InitialStateData = {\n\tenabled: boolean;\n\thasToken: boolean;\n};\n\nconst initialStateArgs = [\n\t{\n\t\taction: 'initialState',\n\t},\n];\n\nconst listPageArgs = [\n\t{\n\t\taction: 'list-pages',\n\t},\n];\n\nconst FacebookPageContainer: FC = () => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst {\n\t\tvalue: initialStateData,\n\t\tphase: state,\n\t\treload: reloadInitial,\n\t} = useMethodData<InitialStateData>('livechat:facebook', initialStateArgs);\n\n\tconst { value: pagesData, phase: listState, reload: reloadData } = useMethodData<PageData>('livechat:facebook', listPageArgs);\n\n\tconst { enabled, hasToken } = initialStateData || { enabled: false, hasToken: false };\n\tconst { pages } = pagesData || { pages: [] };\n\n\tconst livechatFacebook = useMethod('livechat:facebook');\n\n\tconst onToggle = useMutableCallback(async (id, isSubscribed, setSubscribed) => {\n\t\tsetSubscribed(!isSubscribed);\n\t\ttry {\n\t\t\tconst action = isSubscribed ? 'unsubscribe' : 'subscribe';\n\t\t\tawait livechatFacebook({\n\t\t\t\taction,\n\t\t\t\tpage: id,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\tsetSubscribed(isSubscribed);\n\t\t}\n\t});\n\n\tconst onDisable = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tawait livechatFacebook({ action: 'disable' });\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Integration_disabled') });\n\t\t\treloadInitial();\n\t\t\treloadData();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst openOauthWindow = (url: string, callback: () => void): void => {\n\t\tconst oauthWindow = window.open(url, 'facebook-integration-oauth', 'width=600,height=400');\n\t\tconst checkInterval = setInterval(() => {\n\t\t\tif (oauthWindow?.closed) {\n\t\t\t\tclearInterval(checkInterval);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}, 300);\n\t};\n\n\tconst onEnable = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await livechatFacebook({ action: 'enable' });\n\t\t\tif (result?.url) {\n\t\t\t\topenOauthWindow(result?.url, () => {\n\t\t\t\t\tonEnable();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treloadInitial();\n\t\t\t\treloadData();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tif (state === AsyncStatePhase.LOADING || listState === AsyncStatePhase.LOADING) {\n\t\treturn <PageSkeleton />;\n\t}\n\n\tif (state === AsyncStatePhase.REJECTED) {\n\t\treturn (\n\t\t\t<Page>\n\t\t\t\t<Page.Header title={t('Edit_Custom_Field')} />\n\t\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t\t<Callout type='danger'>{t('Error')}</Callout>\n\t\t\t\t</Page.ScrollableContentWithShadow>\n\t\t\t</Page>\n\t\t);\n\t}\n\n\tif (enabled && hasToken && listState === AsyncStatePhase.REJECTED) {\n\t\tonEnable();\n\t}\n\n\treturn (\n\t\t<FacebookPage\n\t\t\tpages={pages}\n\t\t\tenabled={enabled}\n\t\t\thasToken={hasToken}\n\t\t\tonToggle={onToggle}\n\t\t\tonRefresh={reloadData}\n\t\t\tonDisable={onDisable}\n\t\t\tonEnable={onEnable}\n\t\t/>\n\t);\n};\n\nexport default FacebookPageContainer;\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/facebook/FacebookPageContainer.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/omnichannel/facebook/FacebookPageContainer.tsx"}},"code":"let Callout;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Callout(v) {\n    Callout = v;\n  }\n\n}, 0);\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n\n}, 1);\nlet React;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  }\n\n}, 2);\nlet Page;\nmodule.link(\"../../../components/Page\", {\n  default(v) {\n    Page = v;\n  }\n\n}, 3);\nlet PageSkeleton;\nmodule.link(\"../../../components/PageSkeleton\", {\n  default(v) {\n    PageSkeleton = v;\n  }\n\n}, 4);\nlet useMethod;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useMethod(v) {\n    useMethod = v;\n  }\n\n}, 5);\nlet useToastMessageDispatch;\nmodule.link(\"../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n\n}, 6);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 7);\nlet AsyncStatePhase;\nmodule.link(\"../../../hooks/useAsyncState\", {\n  AsyncStatePhase(v) {\n    AsyncStatePhase = v;\n  }\n\n}, 8);\nlet useMethodData;\nmodule.link(\"../../../hooks/useMethodData\", {\n  useMethodData(v) {\n    useMethodData = v;\n  }\n\n}, 9);\nlet FacebookPage;\nmodule.link(\"./FacebookPage\", {\n  default(v) {\n    FacebookPage = v;\n  }\n\n}, 10);\nconst initialStateArgs = [{\n  action: 'initialState'\n}];\nconst listPageArgs = [{\n  action: 'list-pages'\n}];\n\nconst FacebookPageContainer = () => {\n  const t = useTranslation();\n  const dispatchToastMessage = useToastMessageDispatch();\n  const {\n    value: initialStateData,\n    phase: state,\n    reload: reloadInitial\n  } = useMethodData('livechat:facebook', initialStateArgs);\n  const {\n    value: pagesData,\n    phase: listState,\n    reload: reloadData\n  } = useMethodData('livechat:facebook', listPageArgs);\n  const {\n    enabled,\n    hasToken\n  } = initialStateData || {\n    enabled: false,\n    hasToken: false\n  };\n  const {\n    pages\n  } = pagesData || {\n    pages: []\n  };\n  const livechatFacebook = useMethod('livechat:facebook');\n  const onToggle = useMutableCallback(async (id, isSubscribed, setSubscribed) => {\n    setSubscribed(!isSubscribed);\n\n    try {\n      const action = isSubscribed ? 'unsubscribe' : 'subscribe';\n      await livechatFacebook({\n        action,\n        page: id\n      });\n    } catch (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n      setSubscribed(isSubscribed);\n    }\n  });\n  const onDisable = useMutableCallback(async () => {\n    try {\n      await livechatFacebook({\n        action: 'disable'\n      });\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Integration_disabled')\n      });\n      reloadInitial();\n      reloadData();\n    } catch (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    }\n  });\n\n  const openOauthWindow = (url, callback) => {\n    const oauthWindow = window.open(url, 'facebook-integration-oauth', 'width=600,height=400');\n    const checkInterval = setInterval(() => {\n      if (oauthWindow !== null && oauthWindow !== void 0 && oauthWindow.closed) {\n        clearInterval(checkInterval);\n        callback();\n      }\n    }, 300);\n  };\n\n  const onEnable = useMutableCallback(async () => {\n    try {\n      const result = await livechatFacebook({\n        action: 'enable'\n      });\n\n      if (result !== null && result !== void 0 && result.url) {\n        openOauthWindow(result === null || result === void 0 ? void 0 : result.url, () => {\n          onEnable();\n        });\n      } else {\n        reloadInitial();\n        reloadData();\n      }\n    } catch (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    }\n  });\n\n  if (state === AsyncStatePhase.LOADING || listState === AsyncStatePhase.LOADING) {\n    return /*#__PURE__*/React.createElement(PageSkeleton, null);\n  }\n\n  if (state === AsyncStatePhase.REJECTED) {\n    return /*#__PURE__*/React.createElement(Page, null, /*#__PURE__*/React.createElement(Page.Header, {\n      title: t('Edit_Custom_Field')\n    }), /*#__PURE__*/React.createElement(Page.ScrollableContentWithShadow, null, /*#__PURE__*/React.createElement(Callout, {\n      type: \"danger\"\n    }, t('Error'))));\n  }\n\n  if (enabled && hasToken && listState === AsyncStatePhase.REJECTED) {\n    onEnable();\n  }\n\n  return /*#__PURE__*/React.createElement(FacebookPage, {\n    pages: pages,\n    enabled: enabled,\n    hasToken: hasToken,\n    onToggle: onToggle,\n    onRefresh: reloadData,\n    onDisable: onDisable,\n    onEnable: onEnable\n  });\n};\n\nmodule.exportDefault(FacebookPageContainer);","map":{"version":3,"sources":["client/views/omnichannel/facebook/FacebookPageContainer.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Callout } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { FC } from 'react';\n\nimport Page from '../../../components/Page';\nimport PageSkeleton from '../../../components/PageSkeleton';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { AsyncStatePhase } from '../../../hooks/useAsyncState';\nimport { useMethodData } from '../../../hooks/useMethodData';\nimport FacebookPage from './FacebookPage';\n\ntype PageItem = {\n\tname: string;\n\tsubscribed: boolean;\n\tid: string;\n};\n\ntype PageData = {\n\tpages: PageItem[];\n};\n\ntype InitialStateData = {\n\tenabled: boolean;\n\thasToken: boolean;\n};\n\nconst initialStateArgs = [\n\t{\n\t\taction: 'initialState',\n\t},\n];\n\nconst listPageArgs = [\n\t{\n\t\taction: 'list-pages',\n\t},\n];\n\nconst FacebookPageContainer: FC = () => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst {\n\t\tvalue: initialStateData,\n\t\tphase: state,\n\t\treload: reloadInitial,\n\t} = useMethodData<InitialStateData>('livechat:facebook', initialStateArgs);\n\n\tconst { value: pagesData, phase: listState, reload: reloadData } = useMethodData<PageData>('livechat:facebook', listPageArgs);\n\n\tconst { enabled, hasToken } = initialStateData || { enabled: false, hasToken: false };\n\tconst { pages } = pagesData || { pages: [] };\n\n\tconst livechatFacebook = useMethod('livechat:facebook');\n\n\tconst onToggle = useMutableCallback(async (id, isSubscribed, setSubscribed) => {\n\t\tsetSubscribed(!isSubscribed);\n\t\ttry {\n\t\t\tconst action = isSubscribed ? 'unsubscribe' : 'subscribe';\n\t\t\tawait livechatFacebook({\n\t\t\t\taction,\n\t\t\t\tpage: id,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\tsetSubscribed(isSubscribed);\n\t\t}\n\t});\n\n\tconst onDisable = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tawait livechatFacebook({ action: 'disable' });\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Integration_disabled') });\n\t\t\treloadInitial();\n\t\t\treloadData();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst openOauthWindow = (url: string, callback: () => void): void => {\n\t\tconst oauthWindow = window.open(url, 'facebook-integration-oauth', 'width=600,height=400');\n\t\tconst checkInterval = setInterval(() => {\n\t\t\tif (oauthWindow?.closed) {\n\t\t\t\tclearInterval(checkInterval);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}, 300);\n\t};\n\n\tconst onEnable = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await livechatFacebook({ action: 'enable' });\n\t\t\tif (result?.url) {\n\t\t\t\topenOauthWindow(result?.url, () => {\n\t\t\t\t\tonEnable();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treloadInitial();\n\t\t\t\treloadData();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tif (state === AsyncStatePhase.LOADING || listState === AsyncStatePhase.LOADING) {\n\t\treturn <PageSkeleton />;\n\t}\n\n\tif (state === AsyncStatePhase.REJECTED) {\n\t\treturn (\n\t\t\t<Page>\n\t\t\t\t<Page.Header title={t('Edit_Custom_Field')} />\n\t\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t\t<Callout type='danger'>{t('Error')}</Callout>\n\t\t\t\t</Page.ScrollableContentWithShadow>\n\t\t\t</Page>\n\t\t);\n\t}\n\n\tif (enabled && hasToken && listState === AsyncStatePhase.REJECTED) {\n\t\tonEnable();\n\t}\n\n\treturn (\n\t\t<FacebookPage\n\t\t\tpages={pages}\n\t\t\tenabled={enabled}\n\t\t\thasToken={hasToken}\n\t\t\tonToggle={onToggle}\n\t\t\tonRefresh={reloadData}\n\t\t\tonDisable={onDisable}\n\t\t\tonEnable={onEnable}\n\t\t/>\n\t);\n};\n\nexport default FacebookPageContainer;\n"],"sourceRoot":""},"sourceType":"module","hash":"0a08bd46848afd05141080fb56fb51b27e9148ad"}
