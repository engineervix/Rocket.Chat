{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/hooks/useAppInfo.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/admin/apps/hooks/useAppInfo.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/hooks/useAppInfo.ts","inputSourceMap":{"version":3,"file":"client/views/admin/apps/hooks/useAppInfo.ts","sourceRoot":"","sources":["client/views/admin/apps/hooks/useAppInfo.ts"],"names":[],"mappings":"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","sourcesContent":["import { IApiEndpointMetadata } from '@rocket.chat/apps-engine/definition/api';\nimport { AppSettingsManager } from '@rocket.chat/apps-engine/server/managers/AppSettingsManager';\nimport { useState, useEffect, useContext } from 'react';\n\nimport { Apps } from '../../../../../app/apps/client/orchestrator';\nimport { AppsContext } from '../AppsContext';\nimport { AppInfo } from '../definitions/AppInfo';\nimport { handleAPIError } from '../helpers';\nimport { App } from '../types';\n\nconst getBundledIn = async (appId: string, appVersion: string): Promise<App['bundledIn']> => {\n\ttry {\n\t\tconst { bundledIn } = (await Apps.getLatestAppFromMarketplace(appId, appVersion)) as App;\n\t\tif (!bundledIn) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn await Promise.all(\n\t\t\tbundledIn.map(async (bundle) => {\n\t\t\t\tconst apps = await Apps.getAppsOnBundle(bundle.bundleId);\n\t\t\t\tbundle.apps = apps.slice(0, 4);\n\t\t\t\treturn bundle;\n\t\t\t}),\n\t\t);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nconst getSettings = async (appId: string, installed: boolean): Promise<ReturnType<AppSettingsManager['getAppSettings']>> => {\n\tif (!installed) {\n\t\treturn {};\n\t}\n\n\ttry {\n\t\treturn Apps.getAppSettings(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn {};\n\t}\n};\n\nconst getApis = async (appId: string, installed: boolean): Promise<Array<IApiEndpointMetadata>> => {\n\tif (!installed) {\n\t\treturn [];\n\t}\n\n\ttry {\n\t\treturn Apps.getAppApis(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nexport const useAppInfo = (appId: string): AppInfo | undefined => {\n\tconst { installedApps, marketplaceApps } = useContext(AppsContext);\n\n\tconst [appData, setAppData] = useState<AppInfo>();\n\n\tuseEffect(() => {\n\t\tconst apps: App[] = [];\n\n\t\tif (marketplaceApps.value) {\n\t\t\tapps.push(...marketplaceApps.value.apps);\n\t\t}\n\n\t\tif (installedApps.value) {\n\t\t\tapps.push(...installedApps.value.apps);\n\t\t}\n\n\t\tconst fetchAppInfo = async (): Promise<void> => {\n\t\t\tif (!apps?.length || !appId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst app = apps.find((app) => app.id === appId) ?? {\n\t\t\t\t...(await Apps.getApp(appId)),\n\t\t\t\tinstalled: true,\n\t\t\t\tmarketplace: false,\n\t\t\t};\n\n\t\t\tconst [bundledIn, settings, apis] = await Promise.all([\n\t\t\t\tapp.marketplace === false ? [] : getBundledIn(app.id, app.version),\n\t\t\t\tgetSettings(app.id, app.installed),\n\t\t\t\tgetApis(app.id, app.installed),\n\t\t\t]);\n\t\t\tsetAppData({ ...app, bundledIn, settings, apis });\n\t\t};\n\n\t\tfetchAppInfo();\n\t}, [appId, installedApps, marketplaceApps]);\n\n\treturn appData;\n};\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/hooks/useAppInfo.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/apps/hooks/useAppInfo.ts"}},"code":"var _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\n\nvar _toConsumableArray;\n\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 1);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 2);\n\nvar _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 3);\nmodule.export({\n  useAppInfo: function () {\n    return useAppInfo;\n  }\n});\nvar useState, useEffect, useContext;\nmodule.link(\"react\", {\n  useState: function (v) {\n    useState = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useContext: function (v) {\n    useContext = v;\n  }\n}, 0);\nvar Apps;\nmodule.link(\"../../../../../app/apps/client/orchestrator\", {\n  Apps: function (v) {\n    Apps = v;\n  }\n}, 1);\nvar AppsContext;\nmodule.link(\"../AppsContext\", {\n  AppsContext: function (v) {\n    AppsContext = v;\n  }\n}, 2);\nvar handleAPIError;\nmodule.link(\"../helpers\", {\n  handleAPIError: function (v) {\n    handleAPIError = v;\n  }\n}, 3);\n\nvar getBundledIn = function () {\n  function _callee2(appId, appVersion) {\n    var _await$Apps$getLatest, bundledIn;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return _regeneratorRuntime.awrap(Apps.getLatestAppFromMarketplace(appId, appVersion));\n\n            case 3:\n              _await$Apps$getLatest = _context2.sent;\n              bundledIn = _await$Apps$getLatest.bundledIn;\n\n              if (bundledIn) {\n                _context2.next = 7;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", []);\n\n            case 7:\n              _context2.next = 9;\n              return _regeneratorRuntime.awrap(Promise.all(bundledIn.map(function () {\n                function _callee(bundle) {\n                  var apps;\n                  return _regeneratorRuntime.async(function () {\n                    function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            _context.next = 2;\n                            return _regeneratorRuntime.awrap(Apps.getAppsOnBundle(bundle.bundleId));\n\n                          case 2:\n                            apps = _context.sent;\n                            bundle.apps = apps.slice(0, 4);\n                            return _context.abrupt(\"return\", bundle);\n\n                          case 5:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }\n\n                    return _callee$;\n                  }(), null, null, null, Promise);\n                }\n\n                return _callee;\n              }())));\n\n            case 9:\n              return _context2.abrupt(\"return\", _context2.sent);\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](0);\n              handleAPIError(_context2.t0);\n              return _context2.abrupt(\"return\", []);\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }\n\n      return _callee2$;\n    }(), null, null, [[0, 12]], Promise);\n  }\n\n  return _callee2;\n}();\n\nvar getSettings = function () {\n  function _callee3(appId, installed) {\n    return _regeneratorRuntime.async(function () {\n      function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (installed) {\n                _context3.next = 2;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", {});\n\n            case 2:\n              _context3.prev = 2;\n              return _context3.abrupt(\"return\", Apps.getAppSettings(appId));\n\n            case 6:\n              _context3.prev = 6;\n              _context3.t0 = _context3[\"catch\"](2);\n              handleAPIError(_context3.t0);\n              return _context3.abrupt(\"return\", {});\n\n            case 10:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }\n\n      return _callee3$;\n    }(), null, null, [[2, 6]], Promise);\n  }\n\n  return _callee3;\n}();\n\nvar getApis = function () {\n  function _callee4(appId, installed) {\n    return _regeneratorRuntime.async(function () {\n      function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (installed) {\n                _context4.next = 2;\n                break;\n              }\n\n              return _context4.abrupt(\"return\", []);\n\n            case 2:\n              _context4.prev = 2;\n              return _context4.abrupt(\"return\", Apps.getAppApis(appId));\n\n            case 6:\n              _context4.prev = 6;\n              _context4.t0 = _context4[\"catch\"](2);\n              handleAPIError(_context4.t0);\n              return _context4.abrupt(\"return\", []);\n\n            case 10:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }\n\n      return _callee4$;\n    }(), null, null, [[2, 6]], Promise);\n  }\n\n  return _callee4;\n}();\n\nvar useAppInfo = function (appId) {\n  var _useContext = useContext(AppsContext),\n      installedApps = _useContext.installedApps,\n      marketplaceApps = _useContext.marketplaceApps;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      appData = _useState2[0],\n      setAppData = _useState2[1];\n\n  useEffect(function () {\n    var apps = [];\n\n    if (marketplaceApps.value) {\n      apps.push.apply(apps, _toConsumableArray(marketplaceApps.value.apps));\n    }\n\n    if (installedApps.value) {\n      apps.push.apply(apps, _toConsumableArray(installedApps.value.apps));\n    }\n\n    var fetchAppInfo = function () {\n      function _callee5() {\n        var _apps$find;\n\n        var app, _await$Promise$all, _await$Promise$all2, bundledIn, settings, apis;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee5$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  if (!(!(apps !== null && apps !== void 0 && apps.length) || !appId)) {\n                    _context5.next = 2;\n                    break;\n                  }\n\n                  return _context5.abrupt(\"return\");\n\n                case 2:\n                  if (!((_apps$find = apps.find(function (app) {\n                    return app.id === appId;\n                  })) !== null && _apps$find !== void 0)) {\n                    _context5.next = 6;\n                    break;\n                  }\n\n                  _context5.t0 = _apps$find;\n                  _context5.next = 16;\n                  break;\n\n                case 6:\n                  _context5.t1 = _objectSpread;\n                  _context5.t2 = _objectSpread;\n                  _context5.t3 = {};\n                  _context5.next = 11;\n                  return _regeneratorRuntime.awrap(Apps.getApp(appId));\n\n                case 11:\n                  _context5.t4 = _context5.sent;\n                  _context5.t5 = (0, _context5.t2)(_context5.t3, _context5.t4);\n                  _context5.t6 = {};\n                  _context5.t7 = {\n                    installed: true,\n                    marketplace: false\n                  };\n                  _context5.t0 = (0, _context5.t1)(_context5.t5, _context5.t6, _context5.t7);\n\n                case 16:\n                  app = _context5.t0;\n                  _context5.next = 19;\n                  return _regeneratorRuntime.awrap(Promise.all([app.marketplace === false ? [] : getBundledIn(app.id, app.version), getSettings(app.id, app.installed), getApis(app.id, app.installed)]));\n\n                case 19:\n                  _await$Promise$all = _context5.sent;\n                  _await$Promise$all2 = _slicedToArray(_await$Promise$all, 3);\n                  bundledIn = _await$Promise$all2[0];\n                  settings = _await$Promise$all2[1];\n                  apis = _await$Promise$all2[2];\n                  setAppData(_objectSpread(_objectSpread({}, app), {}, {\n                    bundledIn: bundledIn,\n                    settings: settings,\n                    apis: apis\n                  }));\n\n                case 25:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }\n\n          return _callee5$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee5;\n    }();\n\n    fetchAppInfo();\n  }, [appId, installedApps, marketplaceApps]);\n  return appData;\n};","map":{"version":3,"sources":["client/views/admin/apps/hooks/useAppInfo.ts"],"names":[],"mappings":"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","sourcesContent":["import { IApiEndpointMetadata } from '@rocket.chat/apps-engine/definition/api';\nimport { AppSettingsManager } from '@rocket.chat/apps-engine/server/managers/AppSettingsManager';\nimport { useState, useEffect, useContext } from 'react';\n\nimport { Apps } from '../../../../../app/apps/client/orchestrator';\nimport { AppsContext } from '../AppsContext';\nimport { AppInfo } from '../definitions/AppInfo';\nimport { handleAPIError } from '../helpers';\nimport { App } from '../types';\n\nconst getBundledIn = async (appId: string, appVersion: string): Promise<App['bundledIn']> => {\n\ttry {\n\t\tconst { bundledIn } = (await Apps.getLatestAppFromMarketplace(appId, appVersion)) as App;\n\t\tif (!bundledIn) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn await Promise.all(\n\t\t\tbundledIn.map(async (bundle) => {\n\t\t\t\tconst apps = await Apps.getAppsOnBundle(bundle.bundleId);\n\t\t\t\tbundle.apps = apps.slice(0, 4);\n\t\t\t\treturn bundle;\n\t\t\t}),\n\t\t);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nconst getSettings = async (appId: string, installed: boolean): Promise<ReturnType<AppSettingsManager['getAppSettings']>> => {\n\tif (!installed) {\n\t\treturn {};\n\t}\n\n\ttry {\n\t\treturn Apps.getAppSettings(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn {};\n\t}\n};\n\nconst getApis = async (appId: string, installed: boolean): Promise<Array<IApiEndpointMetadata>> => {\n\tif (!installed) {\n\t\treturn [];\n\t}\n\n\ttry {\n\t\treturn Apps.getAppApis(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nexport const useAppInfo = (appId: string): AppInfo | undefined => {\n\tconst { installedApps, marketplaceApps } = useContext(AppsContext);\n\n\tconst [appData, setAppData] = useState<AppInfo>();\n\n\tuseEffect(() => {\n\t\tconst apps: App[] = [];\n\n\t\tif (marketplaceApps.value) {\n\t\t\tapps.push(...marketplaceApps.value.apps);\n\t\t}\n\n\t\tif (installedApps.value) {\n\t\t\tapps.push(...installedApps.value.apps);\n\t\t}\n\n\t\tconst fetchAppInfo = async (): Promise<void> => {\n\t\t\tif (!apps?.length || !appId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst app = apps.find((app) => app.id === appId) ?? {\n\t\t\t\t...(await Apps.getApp(appId)),\n\t\t\t\tinstalled: true,\n\t\t\t\tmarketplace: false,\n\t\t\t};\n\n\t\t\tconst [bundledIn, settings, apis] = await Promise.all([\n\t\t\t\tapp.marketplace === false ? [] : getBundledIn(app.id, app.version),\n\t\t\t\tgetSettings(app.id, app.installed),\n\t\t\t\tgetApis(app.id, app.installed),\n\t\t\t]);\n\t\t\tsetAppData({ ...app, bundledIn, settings, apis });\n\t\t};\n\n\t\tfetchAppInfo();\n\t}, [appId, installedApps, marketplaceApps]);\n\n\treturn appData;\n};\n"],"sourceRoot":""},"sourceType":"module","hash":"8895b96a7a16d0e0e993d8dc0b4d42bb0e4faa15"}
