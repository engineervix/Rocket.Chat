{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/hooks/useWebRTC.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/hooks/useWebRTC.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/hooks/useWebRTC.ts","inputSourceMap":{"version":3,"file":"client/views/room/hooks/useWebRTC.ts","sourceRoot":"","sources":["client/views/room/hooks/useWebRTC.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useState } from 'react';\n\nimport { WebRTC } from '../../../../app/webrtc/client';\n\ntype callParams = {\n\taudio: boolean;\n\tvideo: boolean;\n};\n\nexport type useWebRTCProps = {\n\tshouldAllowCalls: boolean;\n\tcallInProgress: boolean;\n\tvideoAvaliable: boolean;\n\tshowUserWebRTC: boolean;\n\tmainVideoUrl: () => MediaStream | void;\n\tscreenShareEnabled: boolean;\n\tselfVideoUrl: MediaStream;\n\taudioAndVideoEnabled: boolean;\n\taudioEnabled: boolean;\n\tvideoEnabled: boolean;\n\tremoteVideoItems: Array<MediaStream>;\n\tisVideoActive: () => boolean;\n\thandleStopCall: () => void;\n\tscreenShareAvailable: boolean;\n\ttoggleScreenShare: () => void;\n\ttoggleOverlay: () => void;\n\ttoggleVideo: () => void;\n\ttoggleAudio: () => void;\n\toverlayEnabled: boolean;\n\tjoinCall: (params: callParams) => void;\n\tstartCall: (params: callParams) => void;\n\tmainVideo: string;\n\tsetMainVideo: (value: string) => void;\n};\n\nexport const useWebRTC = (rid: string): useWebRTCProps => {\n\tconst getWebRTCInstance = useCallback(() => WebRTC.getInstanceByRoomId(rid), [rid]);\n\tconst webRTCInstance = getWebRTCInstance();\n\tconst videoAvaliable = webRTCInstance != null;\n\n\tconst [mainVideo, setMainVideo] = useState<string>('$auto');\n\n\tconst getShouldAllowCalls = (): boolean => {\n\t\tif (!webRTCInstance) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { localUrl, remoteItems } = webRTCInstance;\n\t\tconst r = remoteItems.get() || [];\n\t\tif (localUrl.get() === null && r.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst isVideoActive = (): boolean => {\n\t\tlet { remoteItems } = getWebRTCInstance();\n\t\tconst { localUrl } = getWebRTCInstance();\n\t\tremoteItems = remoteItems.get() || [];\n\t\treturn localUrl.get() != null || remoteItems.length > 0;\n\t};\n\n\tconst mainVideoUrl = (): void => {\n\t\tif (mainVideo === '$self') {\n\t\t\treturn webRTCInstance?.localUrl.get();\n\t\t}\n\n\t\tif (mainVideo === '$auto') {\n\t\t\tconst remoteItems = webRTCInstance?.remoteItems.get() || [];\n\t\t\tif (remoteItems.length > 0) {\n\t\t\t\treturn remoteItems[0].url;\n\t\t\t}\n\t\t\treturn webRTCInstance?.localUrl.get();\n\t\t}\n\n\t\tif (webRTCInstance?.remoteItemsById.get()[mainVideo] != null) {\n\t\t\treturn webRTCInstance?.remoteItemsById.get()[mainVideo].url;\n\t\t}\n\n\t\tsetMainVideo('$auto');\n\t};\n\n\tconst showUserWebRTC = videoAvaliable && isVideoActive();\n\n\tconst shouldAllowCalls = getShouldAllowCalls();\n\tconst callInProgress = webRTCInstance?.callInProgress.get();\n\tconst overlayEnabled = webRTCInstance?.overlayEnabled.get();\n\tconst audioEnabled = webRTCInstance?.audioEnabled.get();\n\tconst videoEnabled = webRTCInstance?.videoEnabled.get();\n\tconst audioAndVideoEnabled = webRTCInstance?.audioEnabled.get() && webRTCInstance?.videoEnabled.get();\n\n\tconst screenShareEnabled = webRTCInstance?.screenShareEnabled.get();\n\tconst remoteVideoItems = webRTCInstance?.remoteItems.get();\n\tconst selfVideoUrl = webRTCInstance?.localUrl.get();\n\n\tconst handleStopCall = (): void => webRTCInstance?.stop();\n\tconst toggleOverlay = (): void => (overlayEnabled ? webRTCInstance?.overlayEnabled.set(false) : webRTCInstance?.overlayEnabled.set(true));\n\tconst toggleScreenShare = (): void => (screenShareEnabled ? webRTCInstance?.disableScreenShare() : webRTCInstance?.enableScreenShare());\n\tconst toggleVideo = (): void => (videoEnabled ? webRTCInstance?.disableVideo() : webRTCInstance?.enableVideo());\n\tconst toggleAudio = (): void => (audioEnabled ? webRTCInstance?.disableAudio() : webRTCInstance?.enableAudio());\n\n\tconst joinCall = (params: callParams): void => webRTCInstance?.joinCall(params);\n\tconst startCall = (params: callParams): void => webRTCInstance?.startCall(params);\n\n\treturn {\n\t\tshouldAllowCalls,\n\t\tcallInProgress,\n\t\tvideoAvaliable,\n\t\tshowUserWebRTC,\n\t\tmainVideoUrl,\n\t\tscreenShareEnabled,\n\t\tselfVideoUrl,\n\t\taudioAndVideoEnabled,\n\t\taudioEnabled,\n\t\tvideoEnabled,\n\t\tremoteVideoItems,\n\t\tisVideoActive,\n\t\thandleStopCall,\n\t\tscreenShareAvailable: webRTCInstance?.screenShareAvailable,\n\t\ttoggleScreenShare,\n\t\ttoggleOverlay,\n\t\ttoggleVideo,\n\t\ttoggleAudio,\n\t\toverlayEnabled,\n\t\tjoinCall,\n\t\tstartCall,\n\t\tmainVideo,\n\t\tsetMainVideo,\n\t};\n};\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/hooks/useWebRTC.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/hooks/useWebRTC.ts"}},"code":"module.export({\n  useWebRTC: () => useWebRTC\n});\nlet useCallback, useState;\nmodule.link(\"react\", {\n  useCallback(v) {\n    useCallback = v;\n  },\n\n  useState(v) {\n    useState = v;\n  }\n\n}, 0);\nlet WebRTC;\nmodule.link(\"../../../../app/webrtc/client\", {\n  WebRTC(v) {\n    WebRTC = v;\n  }\n\n}, 1);\n\nconst useWebRTC = rid => {\n  const getWebRTCInstance = useCallback(() => WebRTC.getInstanceByRoomId(rid), [rid]);\n  const webRTCInstance = getWebRTCInstance();\n  const videoAvaliable = webRTCInstance != null;\n  const [mainVideo, setMainVideo] = useState('$auto');\n\n  const getShouldAllowCalls = () => {\n    if (!webRTCInstance) {\n      return false;\n    }\n\n    const {\n      localUrl,\n      remoteItems\n    } = webRTCInstance;\n    const r = remoteItems.get() || [];\n\n    if (localUrl.get() === null && r.length === 0) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const isVideoActive = () => {\n    let {\n      remoteItems\n    } = getWebRTCInstance();\n    const {\n      localUrl\n    } = getWebRTCInstance();\n    remoteItems = remoteItems.get() || [];\n    return localUrl.get() != null || remoteItems.length > 0;\n  };\n\n  const mainVideoUrl = () => {\n    if (mainVideo === '$self') {\n      return webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.localUrl.get();\n    }\n\n    if (mainVideo === '$auto') {\n      const remoteItems = (webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.remoteItems.get()) || [];\n\n      if (remoteItems.length > 0) {\n        return remoteItems[0].url;\n      }\n\n      return webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.localUrl.get();\n    }\n\n    if ((webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.remoteItemsById.get()[mainVideo]) != null) {\n      return webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.remoteItemsById.get()[mainVideo].url;\n    }\n\n    setMainVideo('$auto');\n  };\n\n  const showUserWebRTC = videoAvaliable && isVideoActive();\n  const shouldAllowCalls = getShouldAllowCalls();\n  const callInProgress = webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.callInProgress.get();\n  const overlayEnabled = webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.overlayEnabled.get();\n  const audioEnabled = webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.audioEnabled.get();\n  const videoEnabled = webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.videoEnabled.get();\n  const audioAndVideoEnabled = (webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.audioEnabled.get()) && (webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.videoEnabled.get());\n  const screenShareEnabled = webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.screenShareEnabled.get();\n  const remoteVideoItems = webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.remoteItems.get();\n  const selfVideoUrl = webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.localUrl.get();\n\n  const handleStopCall = () => webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.stop();\n\n  const toggleOverlay = () => overlayEnabled ? webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.overlayEnabled.set(false) : webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.overlayEnabled.set(true);\n\n  const toggleScreenShare = () => screenShareEnabled ? webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.disableScreenShare() : webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.enableScreenShare();\n\n  const toggleVideo = () => videoEnabled ? webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.disableVideo() : webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.enableVideo();\n\n  const toggleAudio = () => audioEnabled ? webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.disableAudio() : webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.enableAudio();\n\n  const joinCall = params => webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.joinCall(params);\n\n  const startCall = params => webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.startCall(params);\n\n  return {\n    shouldAllowCalls,\n    callInProgress,\n    videoAvaliable,\n    showUserWebRTC,\n    mainVideoUrl,\n    screenShareEnabled,\n    selfVideoUrl,\n    audioAndVideoEnabled,\n    audioEnabled,\n    videoEnabled,\n    remoteVideoItems,\n    isVideoActive,\n    handleStopCall,\n    screenShareAvailable: webRTCInstance === null || webRTCInstance === void 0 ? void 0 : webRTCInstance.screenShareAvailable,\n    toggleScreenShare,\n    toggleOverlay,\n    toggleVideo,\n    toggleAudio,\n    overlayEnabled,\n    joinCall,\n    startCall,\n    mainVideo,\n    setMainVideo\n  };\n};","map":{"version":3,"sources":["client/views/room/hooks/useWebRTC.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useState } from 'react';\n\nimport { WebRTC } from '../../../../app/webrtc/client';\n\ntype callParams = {\n\taudio: boolean;\n\tvideo: boolean;\n};\n\nexport type useWebRTCProps = {\n\tshouldAllowCalls: boolean;\n\tcallInProgress: boolean;\n\tvideoAvaliable: boolean;\n\tshowUserWebRTC: boolean;\n\tmainVideoUrl: () => MediaStream | void;\n\tscreenShareEnabled: boolean;\n\tselfVideoUrl: MediaStream;\n\taudioAndVideoEnabled: boolean;\n\taudioEnabled: boolean;\n\tvideoEnabled: boolean;\n\tremoteVideoItems: Array<MediaStream>;\n\tisVideoActive: () => boolean;\n\thandleStopCall: () => void;\n\tscreenShareAvailable: boolean;\n\ttoggleScreenShare: () => void;\n\ttoggleOverlay: () => void;\n\ttoggleVideo: () => void;\n\ttoggleAudio: () => void;\n\toverlayEnabled: boolean;\n\tjoinCall: (params: callParams) => void;\n\tstartCall: (params: callParams) => void;\n\tmainVideo: string;\n\tsetMainVideo: (value: string) => void;\n};\n\nexport const useWebRTC = (rid: string): useWebRTCProps => {\n\tconst getWebRTCInstance = useCallback(() => WebRTC.getInstanceByRoomId(rid), [rid]);\n\tconst webRTCInstance = getWebRTCInstance();\n\tconst videoAvaliable = webRTCInstance != null;\n\n\tconst [mainVideo, setMainVideo] = useState<string>('$auto');\n\n\tconst getShouldAllowCalls = (): boolean => {\n\t\tif (!webRTCInstance) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { localUrl, remoteItems } = webRTCInstance;\n\t\tconst r = remoteItems.get() || [];\n\t\tif (localUrl.get() === null && r.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst isVideoActive = (): boolean => {\n\t\tlet { remoteItems } = getWebRTCInstance();\n\t\tconst { localUrl } = getWebRTCInstance();\n\t\tremoteItems = remoteItems.get() || [];\n\t\treturn localUrl.get() != null || remoteItems.length > 0;\n\t};\n\n\tconst mainVideoUrl = (): void => {\n\t\tif (mainVideo === '$self') {\n\t\t\treturn webRTCInstance?.localUrl.get();\n\t\t}\n\n\t\tif (mainVideo === '$auto') {\n\t\t\tconst remoteItems = webRTCInstance?.remoteItems.get() || [];\n\t\t\tif (remoteItems.length > 0) {\n\t\t\t\treturn remoteItems[0].url;\n\t\t\t}\n\t\t\treturn webRTCInstance?.localUrl.get();\n\t\t}\n\n\t\tif (webRTCInstance?.remoteItemsById.get()[mainVideo] != null) {\n\t\t\treturn webRTCInstance?.remoteItemsById.get()[mainVideo].url;\n\t\t}\n\n\t\tsetMainVideo('$auto');\n\t};\n\n\tconst showUserWebRTC = videoAvaliable && isVideoActive();\n\n\tconst shouldAllowCalls = getShouldAllowCalls();\n\tconst callInProgress = webRTCInstance?.callInProgress.get();\n\tconst overlayEnabled = webRTCInstance?.overlayEnabled.get();\n\tconst audioEnabled = webRTCInstance?.audioEnabled.get();\n\tconst videoEnabled = webRTCInstance?.videoEnabled.get();\n\tconst audioAndVideoEnabled = webRTCInstance?.audioEnabled.get() && webRTCInstance?.videoEnabled.get();\n\n\tconst screenShareEnabled = webRTCInstance?.screenShareEnabled.get();\n\tconst remoteVideoItems = webRTCInstance?.remoteItems.get();\n\tconst selfVideoUrl = webRTCInstance?.localUrl.get();\n\n\tconst handleStopCall = (): void => webRTCInstance?.stop();\n\tconst toggleOverlay = (): void => (overlayEnabled ? webRTCInstance?.overlayEnabled.set(false) : webRTCInstance?.overlayEnabled.set(true));\n\tconst toggleScreenShare = (): void => (screenShareEnabled ? webRTCInstance?.disableScreenShare() : webRTCInstance?.enableScreenShare());\n\tconst toggleVideo = (): void => (videoEnabled ? webRTCInstance?.disableVideo() : webRTCInstance?.enableVideo());\n\tconst toggleAudio = (): void => (audioEnabled ? webRTCInstance?.disableAudio() : webRTCInstance?.enableAudio());\n\n\tconst joinCall = (params: callParams): void => webRTCInstance?.joinCall(params);\n\tconst startCall = (params: callParams): void => webRTCInstance?.startCall(params);\n\n\treturn {\n\t\tshouldAllowCalls,\n\t\tcallInProgress,\n\t\tvideoAvaliable,\n\t\tshowUserWebRTC,\n\t\tmainVideoUrl,\n\t\tscreenShareEnabled,\n\t\tselfVideoUrl,\n\t\taudioAndVideoEnabled,\n\t\taudioEnabled,\n\t\tvideoEnabled,\n\t\tremoteVideoItems,\n\t\tisVideoActive,\n\t\thandleStopCall,\n\t\tscreenShareAvailable: webRTCInstance?.screenShareAvailable,\n\t\ttoggleScreenShare,\n\t\ttoggleOverlay,\n\t\ttoggleVideo,\n\t\ttoggleAudio,\n\t\toverlayEnabled,\n\t\tjoinCall,\n\t\tstartCall,\n\t\tmainVideo,\n\t\tsetMainVideo,\n\t};\n};\n"],"sourceRoot":""},"sourceType":"module","hash":"72db033fdb0795b084fdaf168bb8278aad2942fa"}
