{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/lib/rooms/roomCoordinator.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/lib/rooms/roomCoordinator.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/lib/rooms/roomCoordinator.ts","inputSourceMap":{"version":3,"file":"client/lib/rooms/roomCoordinator.ts","sourceRoot":"","sources":["client/lib/rooms/roomCoordinator.ts"],"names":[],"mappings":"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","sourcesContent":["import { FlowRouter } from 'meteor/kadira:flow-router';\nimport type { RouteOptions } from 'meteor/kadira:flow-router';\nimport _ from 'underscore';\n\nimport { hasPermission } from '../../../app/authorization/client';\nimport { ChatRoom, ChatSubscription } from '../../../app/models/client';\nimport { openRoom } from '../../../app/ui-utils/client/lib/openRoom';\nimport type { IRoom, RoomType } from '../../../definition/IRoom';\nimport type { IRoomTypeConfig, IRoomTypeClientDirectives, RoomIdentification } from '../../../definition/IRoomTypeConfig';\nimport { RoomSettingsEnum, RoomMemberActions, UiTextContext } from '../../../definition/IRoomTypeConfig';\nimport type { IUser } from '../../../definition/IUser';\nimport type { AtLeast, ValueOf } from '../../../definition/utils';\nimport { RoomCoordinator } from '../../../lib/rooms/coordinator';\nimport { roomExit } from './roomExit';\n\nclass RoomCoordinatorClient extends RoomCoordinator {\n\tadd(roomConfig: IRoomTypeConfig, directives: Partial<IRoomTypeClientDirectives>): void {\n\t\tthis.addRoomType(roomConfig, {\n\t\t\tallowRoomSettingChange(_room: Partial<IRoom>, _setting: ValueOf<typeof RoomSettingsEnum>): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tallowMemberAction(_room: Partial<IRoom>, _action: ValueOf<typeof RoomMemberActions>): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\troomName(_room: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tisGroupChat(_room: Partial<IRoom>): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\topenCustomProfileTab(_instance: any, _room: IRoom, _username: string): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetUiText(_context: ValueOf<typeof UiTextContext>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tcondition(): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tgetAvatarPath(_room): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tgetIcon(_room: Partial<IRoom>): string | undefined {\n\t\t\t\treturn this.config.icon;\n\t\t\t},\n\t\t\tgetUserStatus(_roomId: string): string | undefined {\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tfindRoom(_identifier: string): IRoom | undefined {\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tshowJoinLink(_roomId: string): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tisLivechatRoom(): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tcanSendMessage(rid: string): boolean {\n\t\t\t\treturn ChatSubscription.find({ rid }).count() > 0;\n\t\t\t},\n\t\t\t...directives,\n\t\t\tconfig: roomConfig,\n\t\t});\n\t}\n\n\tprotected addRoute(path: string, routeConfig: RouteOptions): void {\n\t\tsuper.addRoute(path, { ...routeConfig, triggersExit: [roomExit] });\n\t}\n\n\tgetRoomDirectives(roomType: string): IRoomTypeClientDirectives | undefined {\n\t\treturn this.roomTypes[roomType]?.directives as IRoomTypeClientDirectives;\n\t}\n\n\tgetRoomTypeById(rid: string): RoomType | undefined {\n\t\tconst room = ChatRoom.findOne({ _id: rid, t: { $exists: true, $ne: null } }, { fields: { t: 1 } });\n\t\treturn room?.t;\n\t}\n\n\tgetRoomDirectivesById(rid: string): IRoomTypeClientDirectives | undefined {\n\t\tconst roomType = this.getRoomTypeById(rid);\n\t\tif (roomType) {\n\t\t\treturn this.getRoomDirectives(roomType);\n\t\t}\n\t}\n\n\tgetRoomTypeConfigById(rid: string): IRoomTypeConfig | undefined {\n\t\tconst roomType = this.getRoomTypeById(rid);\n\t\tif (roomType) {\n\t\t\treturn this.getRoomTypeConfig(roomType);\n\t\t}\n\t}\n\n\topenRoom(type: string, name: string, render = true): void {\n\t\topenRoom(type, name, render);\n\t}\n\n\tgetIcon(room: Partial<IRoom>): string | undefined {\n\t\treturn room?.t && this.getRoomDirectives(room.t)?.getIcon(room);\n\t}\n\n\topenRouteLink(roomType: RoomType, subData: RoomIdentification, queryParams?: Record<string, string>): void {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tFlowRouter.go(config.route.name, routeData, queryParams);\n\t}\n\n\tisLivechatRoom(roomType: string): boolean {\n\t\treturn Boolean(this.getRoomDirectives(roomType)?.isLivechatRoom());\n\t}\n\n\tgetRoomName(roomType: string, roomData: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\treturn this.getRoomDirectives(roomType)?.roomName(roomData) ?? '';\n\t}\n\n\treadOnly(rid: string, user: AtLeast<IUser, 'username'>): boolean {\n\t\tconst fields = {\n\t\t\tro: 1,\n\t\t\tt: 1,\n\t\t\t...(user && { muted: 1, unmuted: 1 }),\n\t\t};\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields });\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst directives = this.getRoomDirectives(room.t);\n\t\tif (directives?.readOnly) {\n\t\t\treturn directives.readOnly(rid, user);\n\t\t}\n\n\t\tif (!user?.username) {\n\t\t\treturn Boolean(room.ro);\n\t\t}\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Array.isArray(room.muted) && room.muted.indexOf(user.username) !== -1) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (room.ro) {\n\t\t\tif (Array.isArray(room.unmuted) && room.unmuted.indexOf(user.username) !== -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (hasPermission('post-readonly', room._id)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// #ToDo: Move this out of the RoomCoordinator\n\tarchived(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { archived: 1 } });\n\t\treturn Boolean(room?.archived);\n\t}\n\n\tverifyCanSendMessage(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { t: 1 } });\n\t\tif (!room?.t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Boolean(this.getRoomDirectives(room.t)?.canSendMessage(rid));\n\t}\n\n\tgetSortedTypes(): Array<{ config: IRoomTypeConfig; directives: IRoomTypeClientDirectives }> {\n\t\treturn _.sortBy(this.roomTypesOrder, 'order')\n\t\t\t.map((type) => this.roomTypes[type.identifier] as { config: IRoomTypeConfig; directives: IRoomTypeClientDirectives })\n\t\t\t.filter((type) => type.directives.condition());\n\t}\n}\n\nexport const roomCoordinator = new RoomCoordinatorClient();\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/lib/rooms/roomCoordinator.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/rooms/roomCoordinator.ts"}},"code":"var _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\n\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 1);\nmodule.export({\n  roomCoordinator: function () {\n    return roomCoordinator;\n  }\n});\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 0);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 1);\nvar hasPermission;\nmodule.link(\"../../../app/authorization/client\", {\n  hasPermission: function (v) {\n    hasPermission = v;\n  }\n}, 2);\nvar ChatRoom, ChatSubscription;\nmodule.link(\"../../../app/models/client\", {\n  ChatRoom: function (v) {\n    ChatRoom = v;\n  },\n  ChatSubscription: function (v) {\n    ChatSubscription = v;\n  }\n}, 3);\n\nvar _openRoom;\n\nmodule.link(\"../../../app/ui-utils/client/lib/openRoom\", {\n  openRoom: function (v) {\n    _openRoom = v;\n  }\n}, 4);\nvar RoomCoordinator;\nmodule.link(\"../../../lib/rooms/coordinator\", {\n  RoomCoordinator: function (v) {\n    RoomCoordinator = v;\n  }\n}, 5);\nvar roomExit;\nmodule.link(\"./roomExit\", {\n  roomExit: function (v) {\n    roomExit = v;\n  }\n}, 6);\n\nvar RoomCoordinatorClient = /*#__PURE__*/function (_RoomCoordinator) {\n  _inheritsLoose(RoomCoordinatorClient, _RoomCoordinator);\n\n  function RoomCoordinatorClient() {\n    return _RoomCoordinator.apply(this, arguments) || this;\n  }\n\n  var _proto = RoomCoordinatorClient.prototype;\n\n  _proto.add = function () {\n    function add(roomConfig, directives) {\n      this.addRoomType(roomConfig, _objectSpread(_objectSpread({\n        allowRoomSettingChange: function (_room, _setting) {\n          return true;\n        },\n        allowMemberAction: function (_room, _action) {\n          return false;\n        },\n        roomName: function (_room) {\n          return '';\n        },\n        isGroupChat: function (_room) {\n          return false;\n        },\n        openCustomProfileTab: function (_instance, _room, _username) {\n          return false;\n        },\n        getUiText: function (_context) {\n          return '';\n        },\n        condition: function () {\n          return true;\n        },\n        getAvatarPath: function (_room) {\n          return '';\n        },\n        getIcon: function (_room) {\n          return this.config.icon;\n        },\n        getUserStatus: function (_roomId) {\n          return undefined;\n        },\n        findRoom: function (_identifier) {\n          return undefined;\n        },\n        showJoinLink: function (_roomId) {\n          return false;\n        },\n        isLivechatRoom: function () {\n          return false;\n        },\n        canSendMessage: function (rid) {\n          return ChatSubscription.find({\n            rid: rid\n          }).count() > 0;\n        }\n      }, directives), {}, {\n        config: roomConfig\n      }));\n    }\n\n    return add;\n  }();\n\n  _proto.addRoute = function () {\n    function addRoute(path, routeConfig) {\n      _RoomCoordinator.prototype.addRoute.call(this, path, _objectSpread(_objectSpread({}, routeConfig), {}, {\n        triggersExit: [roomExit]\n      }));\n    }\n\n    return addRoute;\n  }();\n\n  _proto.getRoomDirectives = function () {\n    function getRoomDirectives(roomType) {\n      var _this$roomTypes$roomT;\n\n      return (_this$roomTypes$roomT = this.roomTypes[roomType]) === null || _this$roomTypes$roomT === void 0 ? void 0 : _this$roomTypes$roomT.directives;\n    }\n\n    return getRoomDirectives;\n  }();\n\n  _proto.getRoomTypeById = function () {\n    function getRoomTypeById(rid) {\n      var room = ChatRoom.findOne({\n        _id: rid,\n        t: {\n          $exists: true,\n          $ne: null\n        }\n      }, {\n        fields: {\n          t: 1\n        }\n      });\n      return room === null || room === void 0 ? void 0 : room.t;\n    }\n\n    return getRoomTypeById;\n  }();\n\n  _proto.getRoomDirectivesById = function () {\n    function getRoomDirectivesById(rid) {\n      var roomType = this.getRoomTypeById(rid);\n\n      if (roomType) {\n        return this.getRoomDirectives(roomType);\n      }\n    }\n\n    return getRoomDirectivesById;\n  }();\n\n  _proto.getRoomTypeConfigById = function () {\n    function getRoomTypeConfigById(rid) {\n      var roomType = this.getRoomTypeById(rid);\n\n      if (roomType) {\n        return this.getRoomTypeConfig(roomType);\n      }\n    }\n\n    return getRoomTypeConfigById;\n  }();\n\n  _proto.openRoom = function () {\n    function openRoom(type, name) {\n      var render = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n\n      _openRoom(type, name, render);\n    }\n\n    return openRoom;\n  }();\n\n  _proto.getIcon = function () {\n    function getIcon(room) {\n      var _this$getRoomDirectiv;\n\n      return (room === null || room === void 0 ? void 0 : room.t) && ((_this$getRoomDirectiv = this.getRoomDirectives(room.t)) === null || _this$getRoomDirectiv === void 0 ? void 0 : _this$getRoomDirectiv.getIcon(room));\n    }\n\n    return getIcon;\n  }();\n\n  _proto.openRouteLink = function () {\n    function openRouteLink(roomType, subData, queryParams) {\n      var config = this.getRoomTypeConfig(roomType);\n\n      if (!(config !== null && config !== void 0 && config.route)) {\n        return;\n      }\n\n      var routeData = {};\n\n      if (config.route.link) {\n        routeData = config.route.link(subData);\n      } else if (subData !== null && subData !== void 0 && subData.name) {\n        routeData = {\n          name: subData.name\n        };\n      } else {\n        return;\n      }\n\n      FlowRouter.go(config.route.name, routeData, queryParams);\n    }\n\n    return openRouteLink;\n  }();\n\n  _proto.isLivechatRoom = function () {\n    function isLivechatRoom(roomType) {\n      var _this$getRoomDirectiv2;\n\n      return Boolean((_this$getRoomDirectiv2 = this.getRoomDirectives(roomType)) === null || _this$getRoomDirectiv2 === void 0 ? void 0 : _this$getRoomDirectiv2.isLivechatRoom());\n    }\n\n    return isLivechatRoom;\n  }();\n\n  _proto.getRoomName = function () {\n    function getRoomName(roomType, roomData) {\n      var _this$getRoomDirectiv3, _this$getRoomDirectiv4;\n\n      return (_this$getRoomDirectiv3 = (_this$getRoomDirectiv4 = this.getRoomDirectives(roomType)) === null || _this$getRoomDirectiv4 === void 0 ? void 0 : _this$getRoomDirectiv4.roomName(roomData)) !== null && _this$getRoomDirectiv3 !== void 0 ? _this$getRoomDirectiv3 : '';\n    }\n\n    return getRoomName;\n  }();\n\n  _proto.readOnly = function () {\n    function readOnly(rid, user) {\n      var fields = _objectSpread({\n        ro: 1,\n        t: 1\n      }, user && {\n        muted: 1,\n        unmuted: 1\n      });\n\n      var room = ChatRoom.findOne({\n        _id: rid\n      }, {\n        fields: fields\n      });\n\n      if (!room) {\n        return false;\n      }\n\n      var directives = this.getRoomDirectives(room.t);\n\n      if (directives !== null && directives !== void 0 && directives.readOnly) {\n        return directives.readOnly(rid, user);\n      }\n\n      if (!(user !== null && user !== void 0 && user.username)) {\n        return Boolean(room.ro);\n      }\n\n      if (!room) {\n        return false;\n      }\n\n      if (Array.isArray(room.muted) && room.muted.indexOf(user.username) !== -1) {\n        return true;\n      }\n\n      if (room.ro) {\n        if (Array.isArray(room.unmuted) && room.unmuted.indexOf(user.username) !== -1) {\n          return false;\n        }\n\n        if (hasPermission('post-readonly', room._id)) {\n          return false;\n        }\n\n        return true;\n      }\n\n      return false;\n    }\n\n    return readOnly;\n  }() // #ToDo: Move this out of the RoomCoordinator\n  ;\n\n  _proto.archived = function () {\n    function archived(rid) {\n      var room = ChatRoom.findOne({\n        _id: rid\n      }, {\n        fields: {\n          archived: 1\n        }\n      });\n      return Boolean(room === null || room === void 0 ? void 0 : room.archived);\n    }\n\n    return archived;\n  }();\n\n  _proto.verifyCanSendMessage = function () {\n    function verifyCanSendMessage(rid) {\n      var _this$getRoomDirectiv5;\n\n      var room = ChatRoom.findOne({\n        _id: rid\n      }, {\n        fields: {\n          t: 1\n        }\n      });\n\n      if (!(room !== null && room !== void 0 && room.t)) {\n        return false;\n      }\n\n      return Boolean((_this$getRoomDirectiv5 = this.getRoomDirectives(room.t)) === null || _this$getRoomDirectiv5 === void 0 ? void 0 : _this$getRoomDirectiv5.canSendMessage(rid));\n    }\n\n    return verifyCanSendMessage;\n  }();\n\n  _proto.getSortedTypes = function () {\n    function getSortedTypes() {\n      var _this = this;\n\n      return _.sortBy(this.roomTypesOrder, 'order').map(function (type) {\n        return _this.roomTypes[type.identifier];\n      }).filter(function (type) {\n        return type.directives.condition();\n      });\n    }\n\n    return getSortedTypes;\n  }();\n\n  return RoomCoordinatorClient;\n}(RoomCoordinator);\n\nvar roomCoordinator = new RoomCoordinatorClient();","map":{"version":3,"sources":["client/lib/rooms/roomCoordinator.ts"],"names":[],"mappings":"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","sourcesContent":["import { FlowRouter } from 'meteor/kadira:flow-router';\nimport type { RouteOptions } from 'meteor/kadira:flow-router';\nimport _ from 'underscore';\n\nimport { hasPermission } from '../../../app/authorization/client';\nimport { ChatRoom, ChatSubscription } from '../../../app/models/client';\nimport { openRoom } from '../../../app/ui-utils/client/lib/openRoom';\nimport type { IRoom, RoomType } from '../../../definition/IRoom';\nimport type { IRoomTypeConfig, IRoomTypeClientDirectives, RoomIdentification } from '../../../definition/IRoomTypeConfig';\nimport { RoomSettingsEnum, RoomMemberActions, UiTextContext } from '../../../definition/IRoomTypeConfig';\nimport type { IUser } from '../../../definition/IUser';\nimport type { AtLeast, ValueOf } from '../../../definition/utils';\nimport { RoomCoordinator } from '../../../lib/rooms/coordinator';\nimport { roomExit } from './roomExit';\n\nclass RoomCoordinatorClient extends RoomCoordinator {\n\tadd(roomConfig: IRoomTypeConfig, directives: Partial<IRoomTypeClientDirectives>): void {\n\t\tthis.addRoomType(roomConfig, {\n\t\t\tallowRoomSettingChange(_room: Partial<IRoom>, _setting: ValueOf<typeof RoomSettingsEnum>): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tallowMemberAction(_room: Partial<IRoom>, _action: ValueOf<typeof RoomMemberActions>): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\troomName(_room: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tisGroupChat(_room: Partial<IRoom>): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\topenCustomProfileTab(_instance: any, _room: IRoom, _username: string): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetUiText(_context: ValueOf<typeof UiTextContext>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tcondition(): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tgetAvatarPath(_room): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tgetIcon(_room: Partial<IRoom>): string | undefined {\n\t\t\t\treturn this.config.icon;\n\t\t\t},\n\t\t\tgetUserStatus(_roomId: string): string | undefined {\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tfindRoom(_identifier: string): IRoom | undefined {\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tshowJoinLink(_roomId: string): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tisLivechatRoom(): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tcanSendMessage(rid: string): boolean {\n\t\t\t\treturn ChatSubscription.find({ rid }).count() > 0;\n\t\t\t},\n\t\t\t...directives,\n\t\t\tconfig: roomConfig,\n\t\t});\n\t}\n\n\tprotected addRoute(path: string, routeConfig: RouteOptions): void {\n\t\tsuper.addRoute(path, { ...routeConfig, triggersExit: [roomExit] });\n\t}\n\n\tgetRoomDirectives(roomType: string): IRoomTypeClientDirectives | undefined {\n\t\treturn this.roomTypes[roomType]?.directives as IRoomTypeClientDirectives;\n\t}\n\n\tgetRoomTypeById(rid: string): RoomType | undefined {\n\t\tconst room = ChatRoom.findOne({ _id: rid, t: { $exists: true, $ne: null } }, { fields: { t: 1 } });\n\t\treturn room?.t;\n\t}\n\n\tgetRoomDirectivesById(rid: string): IRoomTypeClientDirectives | undefined {\n\t\tconst roomType = this.getRoomTypeById(rid);\n\t\tif (roomType) {\n\t\t\treturn this.getRoomDirectives(roomType);\n\t\t}\n\t}\n\n\tgetRoomTypeConfigById(rid: string): IRoomTypeConfig | undefined {\n\t\tconst roomType = this.getRoomTypeById(rid);\n\t\tif (roomType) {\n\t\t\treturn this.getRoomTypeConfig(roomType);\n\t\t}\n\t}\n\n\topenRoom(type: string, name: string, render = true): void {\n\t\topenRoom(type, name, render);\n\t}\n\n\tgetIcon(room: Partial<IRoom>): string | undefined {\n\t\treturn room?.t && this.getRoomDirectives(room.t)?.getIcon(room);\n\t}\n\n\topenRouteLink(roomType: RoomType, subData: RoomIdentification, queryParams?: Record<string, string>): void {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tFlowRouter.go(config.route.name, routeData, queryParams);\n\t}\n\n\tisLivechatRoom(roomType: string): boolean {\n\t\treturn Boolean(this.getRoomDirectives(roomType)?.isLivechatRoom());\n\t}\n\n\tgetRoomName(roomType: string, roomData: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\treturn this.getRoomDirectives(roomType)?.roomName(roomData) ?? '';\n\t}\n\n\treadOnly(rid: string, user: AtLeast<IUser, 'username'>): boolean {\n\t\tconst fields = {\n\t\t\tro: 1,\n\t\t\tt: 1,\n\t\t\t...(user && { muted: 1, unmuted: 1 }),\n\t\t};\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields });\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst directives = this.getRoomDirectives(room.t);\n\t\tif (directives?.readOnly) {\n\t\t\treturn directives.readOnly(rid, user);\n\t\t}\n\n\t\tif (!user?.username) {\n\t\t\treturn Boolean(room.ro);\n\t\t}\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Array.isArray(room.muted) && room.muted.indexOf(user.username) !== -1) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (room.ro) {\n\t\t\tif (Array.isArray(room.unmuted) && room.unmuted.indexOf(user.username) !== -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (hasPermission('post-readonly', room._id)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// #ToDo: Move this out of the RoomCoordinator\n\tarchived(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { archived: 1 } });\n\t\treturn Boolean(room?.archived);\n\t}\n\n\tverifyCanSendMessage(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { t: 1 } });\n\t\tif (!room?.t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Boolean(this.getRoomDirectives(room.t)?.canSendMessage(rid));\n\t}\n\n\tgetSortedTypes(): Array<{ config: IRoomTypeConfig; directives: IRoomTypeClientDirectives }> {\n\t\treturn _.sortBy(this.roomTypesOrder, 'order')\n\t\t\t.map((type) => this.roomTypes[type.identifier] as { config: IRoomTypeConfig; directives: IRoomTypeClientDirectives })\n\t\t\t.filter((type) => type.directives.condition());\n\t}\n}\n\nexport const roomCoordinator = new RoomCoordinatorClient();\n"],"sourceRoot":""},"sourceType":"module","hash":"98ad5ace1c61b38f99d9b0c0d56458e9f62d8386"}
