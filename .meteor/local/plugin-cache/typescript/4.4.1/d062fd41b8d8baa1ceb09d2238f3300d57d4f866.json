{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/sidebar/sections/components/OmnichannelCallToggleReady.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/sidebar/sections/components/OmnichannelCallToggleReady.tsx","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/sidebar/sections/components/OmnichannelCallToggleReady.tsx","inputSourceMap":{"version":3,"file":"client/sidebar/sections/components/OmnichannelCallToggleReady.tsx","sourceRoot":"","sources":["client/sidebar/sections/components/OmnichannelCallToggleReady.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Sidebar } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { ReactElement, useEffect, useState } from 'react';\n\nimport { useCallClient, useCallerInfo, useCallActions } from '../../../contexts/CallContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\n\nexport const OmnichannelCallToggleReady = (): ReactElement => {\n\tconst [agentEnabled, setAgentEnabled] = useState(false); // TODO: get from AgentInfo\n\tconst t = useTranslation();\n\tconst [registered, setRegistered] = useState(false);\n\tconst voipClient = useCallClient();\n\tconst [onCall, setOnCall] = useState(false);\n\tconst callerInfo = useCallerInfo();\n\tconst callActions = useCallActions();\n\n\tconst getTooltip = (): string => {\n\t\tif (!registered) {\n\t\t\treturn t('Enable');\n\t\t}\n\t\tif (!onCall) {\n\t\t\t// Color for this state still not defined\n\t\t\treturn t('Disable');\n\t\t}\n\n\t\treturn t('Cannot_disable_while_on_call');\n\t};\n\n\tconst voipCallIcon = {\n\t\ttitle: getTooltip(),\n\t\tcolor: registered ? 'success' : undefined,\n\t\ticon: registered ? 'phone' : 'phone-disabled',\n\t} as const;\n\n\tuseEffect(() => {\n\t\t// Any of the 2 states means the user is already talking\n\t\tsetOnCall(['IN_CALL', 'ON_HOLD'].includes(callerInfo.state));\n\t}, [callerInfo]);\n\n\tuseEffect(() => {\n\t\tlet agentEnabled = false;\n\t\tconst state = voipClient.getRegistrarState();\n\t\tif (state === 'registered') {\n\t\t\tagentEnabled = true;\n\t\t}\n\t\tsetAgentEnabled(agentEnabled);\n\t\tsetRegistered(agentEnabled);\n\t}, [voipClient]);\n\n\t// TODO: move registration flow to context provider\n\tconst handleVoipCallStatusChange = useMutableCallback((): void => {\n\t\tif (onCall) {\n\t\t\treturn;\n\t\t}\n\t\t// TODO: backend set voip call status\n\t\t// voipClient.setVoipCallStatus(!registered);\n\t\tif (agentEnabled) {\n\t\t\tcallerInfo.state === 'OFFER_RECEIVED' && callActions.reject();\n\t\t\tsetAgentEnabled(false);\n\t\t\tvoipClient.unregister();\n\t\t\treturn;\n\t\t}\n\t\tsetAgentEnabled(true);\n\t\tvoipClient.register();\n\t});\n\n\tconst onUnregistrationError = useMutableCallback((): void => {\n\t\tsetRegistered(false);\n\t\tsetAgentEnabled(false);\n\t});\n\n\tconst onUnregistered = useMutableCallback((): void => {\n\t\tsetRegistered(!registered);\n\t});\n\n\tconst onRegistrationError = useMutableCallback((): void => {\n\t\tsetRegistered(false);\n\t\tsetAgentEnabled(false);\n\t});\n\n\tconst onRegistered = useMutableCallback((): void => {\n\t\tsetRegistered(!registered);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!voipClient) {\n\t\t\treturn;\n\t\t}\n\t\tvoipClient.on('registered', onRegistered);\n\t\tvoipClient.on('registrationerror', onRegistrationError);\n\t\tvoipClient.on('unregistered', onUnregistered);\n\t\tvoipClient.on('unregistrationerror', onUnregistrationError);\n\n\t\treturn (): void => {\n\t\t\tvoipClient.off('registered', onRegistered);\n\t\t\tvoipClient.off('registrationerror', onRegistrationError);\n\t\t\tvoipClient.off('unregistered', onUnregistered);\n\t\t\tvoipClient.off('unregistrationerror', onUnregistrationError);\n\t\t};\n\t}, [onRegistered, onRegistrationError, onUnregistered, onUnregistrationError, voipClient]);\n\n\treturn <Sidebar.TopBar.Action {...voipCallIcon} onClick={handleVoipCallStatusChange} disabled={onCall} />;\n};\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/sidebar/sections/components/OmnichannelCallToggleReady.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/sidebar/sections/components/OmnichannelCallToggleReady.tsx"}},"code":"let _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default(v) {\n    _extends = v;\n  }\n\n}, 0);\nmodule.export({\n  OmnichannelCallToggleReady: () => OmnichannelCallToggleReady\n});\nlet Sidebar;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Sidebar(v) {\n    Sidebar = v;\n  }\n\n}, 0);\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n\n}, 1);\nlet React, useEffect, useState;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useState(v) {\n    useState = v;\n  }\n\n}, 2);\nlet useCallClient, useCallerInfo, useCallActions;\nmodule.link(\"../../../contexts/CallContext\", {\n  useCallClient(v) {\n    useCallClient = v;\n  },\n\n  useCallerInfo(v) {\n    useCallerInfo = v;\n  },\n\n  useCallActions(v) {\n    useCallActions = v;\n  }\n\n}, 3);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 4);\n\nconst OmnichannelCallToggleReady = () => {\n  const [agentEnabled, setAgentEnabled] = useState(false); // TODO: get from AgentInfo\n\n  const t = useTranslation();\n  const [registered, setRegistered] = useState(false);\n  const voipClient = useCallClient();\n  const [onCall, setOnCall] = useState(false);\n  const callerInfo = useCallerInfo();\n  const callActions = useCallActions();\n\n  const getTooltip = () => {\n    if (!registered) {\n      return t('Enable');\n    }\n\n    if (!onCall) {\n      // Color for this state still not defined\n      return t('Disable');\n    }\n\n    return t('Cannot_disable_while_on_call');\n  };\n\n  const voipCallIcon = {\n    title: getTooltip(),\n    color: registered ? 'success' : undefined,\n    icon: registered ? 'phone' : 'phone-disabled'\n  };\n  useEffect(() => {\n    // Any of the 2 states means the user is already talking\n    setOnCall(['IN_CALL', 'ON_HOLD'].includes(callerInfo.state));\n  }, [callerInfo]);\n  useEffect(() => {\n    let agentEnabled = false;\n    const state = voipClient.getRegistrarState();\n\n    if (state === 'registered') {\n      agentEnabled = true;\n    }\n\n    setAgentEnabled(agentEnabled);\n    setRegistered(agentEnabled);\n  }, [voipClient]); // TODO: move registration flow to context provider\n\n  const handleVoipCallStatusChange = useMutableCallback(() => {\n    if (onCall) {\n      return;\n    } // TODO: backend set voip call status\n    // voipClient.setVoipCallStatus(!registered);\n\n\n    if (agentEnabled) {\n      callerInfo.state === 'OFFER_RECEIVED' && callActions.reject();\n      setAgentEnabled(false);\n      voipClient.unregister();\n      return;\n    }\n\n    setAgentEnabled(true);\n    voipClient.register();\n  });\n  const onUnregistrationError = useMutableCallback(() => {\n    setRegistered(false);\n    setAgentEnabled(false);\n  });\n  const onUnregistered = useMutableCallback(() => {\n    setRegistered(!registered);\n  });\n  const onRegistrationError = useMutableCallback(() => {\n    setRegistered(false);\n    setAgentEnabled(false);\n  });\n  const onRegistered = useMutableCallback(() => {\n    setRegistered(!registered);\n  });\n  useEffect(() => {\n    if (!voipClient) {\n      return;\n    }\n\n    voipClient.on('registered', onRegistered);\n    voipClient.on('registrationerror', onRegistrationError);\n    voipClient.on('unregistered', onUnregistered);\n    voipClient.on('unregistrationerror', onUnregistrationError);\n    return () => {\n      voipClient.off('registered', onRegistered);\n      voipClient.off('registrationerror', onRegistrationError);\n      voipClient.off('unregistered', onUnregistered);\n      voipClient.off('unregistrationerror', onUnregistrationError);\n    };\n  }, [onRegistered, onRegistrationError, onUnregistered, onUnregistrationError, voipClient]);\n  return /*#__PURE__*/React.createElement(Sidebar.TopBar.Action, _extends({}, voipCallIcon, {\n    onClick: handleVoipCallStatusChange,\n    disabled: onCall\n  }));\n};","map":{"version":3,"sources":["client/sidebar/sections/components/OmnichannelCallToggleReady.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Sidebar } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { ReactElement, useEffect, useState } from 'react';\n\nimport { useCallClient, useCallerInfo, useCallActions } from '../../../contexts/CallContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\n\nexport const OmnichannelCallToggleReady = (): ReactElement => {\n\tconst [agentEnabled, setAgentEnabled] = useState(false); // TODO: get from AgentInfo\n\tconst t = useTranslation();\n\tconst [registered, setRegistered] = useState(false);\n\tconst voipClient = useCallClient();\n\tconst [onCall, setOnCall] = useState(false);\n\tconst callerInfo = useCallerInfo();\n\tconst callActions = useCallActions();\n\n\tconst getTooltip = (): string => {\n\t\tif (!registered) {\n\t\t\treturn t('Enable');\n\t\t}\n\t\tif (!onCall) {\n\t\t\t// Color for this state still not defined\n\t\t\treturn t('Disable');\n\t\t}\n\n\t\treturn t('Cannot_disable_while_on_call');\n\t};\n\n\tconst voipCallIcon = {\n\t\ttitle: getTooltip(),\n\t\tcolor: registered ? 'success' : undefined,\n\t\ticon: registered ? 'phone' : 'phone-disabled',\n\t} as const;\n\n\tuseEffect(() => {\n\t\t// Any of the 2 states means the user is already talking\n\t\tsetOnCall(['IN_CALL', 'ON_HOLD'].includes(callerInfo.state));\n\t}, [callerInfo]);\n\n\tuseEffect(() => {\n\t\tlet agentEnabled = false;\n\t\tconst state = voipClient.getRegistrarState();\n\t\tif (state === 'registered') {\n\t\t\tagentEnabled = true;\n\t\t}\n\t\tsetAgentEnabled(agentEnabled);\n\t\tsetRegistered(agentEnabled);\n\t}, [voipClient]);\n\n\t// TODO: move registration flow to context provider\n\tconst handleVoipCallStatusChange = useMutableCallback((): void => {\n\t\tif (onCall) {\n\t\t\treturn;\n\t\t}\n\t\t// TODO: backend set voip call status\n\t\t// voipClient.setVoipCallStatus(!registered);\n\t\tif (agentEnabled) {\n\t\t\tcallerInfo.state === 'OFFER_RECEIVED' && callActions.reject();\n\t\t\tsetAgentEnabled(false);\n\t\t\tvoipClient.unregister();\n\t\t\treturn;\n\t\t}\n\t\tsetAgentEnabled(true);\n\t\tvoipClient.register();\n\t});\n\n\tconst onUnregistrationError = useMutableCallback((): void => {\n\t\tsetRegistered(false);\n\t\tsetAgentEnabled(false);\n\t});\n\n\tconst onUnregistered = useMutableCallback((): void => {\n\t\tsetRegistered(!registered);\n\t});\n\n\tconst onRegistrationError = useMutableCallback((): void => {\n\t\tsetRegistered(false);\n\t\tsetAgentEnabled(false);\n\t});\n\n\tconst onRegistered = useMutableCallback((): void => {\n\t\tsetRegistered(!registered);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!voipClient) {\n\t\t\treturn;\n\t\t}\n\t\tvoipClient.on('registered', onRegistered);\n\t\tvoipClient.on('registrationerror', onRegistrationError);\n\t\tvoipClient.on('unregistered', onUnregistered);\n\t\tvoipClient.on('unregistrationerror', onUnregistrationError);\n\n\t\treturn (): void => {\n\t\t\tvoipClient.off('registered', onRegistered);\n\t\t\tvoipClient.off('registrationerror', onRegistrationError);\n\t\t\tvoipClient.off('unregistered', onUnregistered);\n\t\t\tvoipClient.off('unregistrationerror', onUnregistrationError);\n\t\t};\n\t}, [onRegistered, onRegistrationError, onUnregistered, onUnregistrationError, voipClient]);\n\n\treturn <Sidebar.TopBar.Action {...voipCallIcon} onClick={handleVoipCallStatusChange} disabled={onCall} />;\n};\n"],"sourceRoot":""},"sourceType":"module","hash":"d062fd41b8d8baa1ceb09d2238f3300d57d4f866"}
