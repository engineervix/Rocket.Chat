{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/photoswipeContent.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui/client/views/app/photoswipeContent.ts","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/photoswipeContent.ts","inputSourceMap":{"version":3,"file":"app/ui/client/views/app/photoswipeContent.ts","sourceRoot":"","sources":["app/ui/client/views/app/photoswipeContent.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Blaze } from 'meteor/blaze';\nimport { Template } from 'meteor/templating';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport type PhotoSwipe from 'photoswipe';\nimport type PhotoSwipeUiDefault from 'photoswipe/dist/photoswipe-ui-default';\n\nconst parseLength = (x: unknown): number | undefined => {\n\tconst length = typeof x === 'string' ? parseInt(x, 10) : undefined;\n\treturn Number.isFinite(length) ? length : undefined;\n};\n\nconst getImageSize = (src: string): Promise<[w: number, h: number]> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve([img.naturalWidth, img.naturalHeight]);\n\t\t});\n\n\t\timg.addEventListener('error', (error) => {\n\t\t\treject(error.error);\n\t\t});\n\n\t\timg.src = src;\n\t});\n\ntype Slide = PhotoSwipeUiDefault.Item & { description?: string };\n\nconst fromElementToSlide = async (element: Element): Promise<Slide | null> => {\n\tif (!(element instanceof HTMLElement)) {\n\t\treturn null;\n\t}\n\n\tconst title = element.dataset.title || element.title;\n\tconst { description } = element.dataset;\n\n\tif (element instanceof HTMLAnchorElement) {\n\t\tconst src = element.dataset.src || element.href;\n\t\tlet w = parseLength(element.dataset.width);\n\t\tlet h = parseLength(element.dataset.height);\n\n\t\tif (w === undefined || h === undefined) {\n\t\t\t[w, h] = await getImageSize(src);\n\t\t}\n\n\t\treturn { src, w, h, title, description };\n\t}\n\n\tif (element instanceof HTMLImageElement) {\n\t\tlet msrc: string | undefined;\n\t\tlet { src } = element;\n\t\tlet w: number | undefined = element.naturalWidth;\n\t\tlet h: number | undefined = element.naturalHeight;\n\n\t\tif (element.dataset.src) {\n\t\t\tmsrc = element.src;\n\t\t\tsrc = element.dataset.src;\n\t\t\tw = parseLength(element.dataset.width);\n\t\t\th = parseLength(element.dataset.height);\n\n\t\t\tif (w === undefined || h === undefined) {\n\t\t\t\t[w, h] = await getImageSize(src);\n\t\t\t}\n\t\t}\n\n\t\treturn { msrc, src, w, h, title, description };\n\t}\n\n\treturn null;\n};\n\nlet currentGallery: PhotoSwipe<PhotoSwipeUiDefault.Options> | null = null;\n\nconst initGallery = async (items: Slide[], options: PhotoSwipeUiDefault.Options): Promise<void> => {\n\tconst [\n\t\t{ default: PhotoSwipe },\n\t\t{ default: PhotoSwipeUiDefault }, // eslint-disable-line @typescript-eslint/camelcase\n\t] = await Promise.all([\n\t\timport('photoswipe'),\n\t\timport('photoswipe/dist/photoswipe-ui-default'),\n\t\t// @ts-ignore\n\t\timport('photoswipe/dist/photoswipe.css'),\n\t\t// @ts-ignore\n\t\timport('./photoswipeContent.html'),\n\t]);\n\n\tBlaze.render(Template.photoswipeContent, document.body);\n\n\tif (!currentGallery) {\n\t\tconst container = document.getElementById('pswp');\n\n\t\tif (!container) {\n\t\t\tthrow new Error('Photoswipe container element not found');\n\t\t}\n\n\t\tcurrentGallery = new PhotoSwipe(container, PhotoSwipeUiDefault, items, options);\n\n\t\tcurrentGallery.listen('destroy', () => {\n\t\t\tcurrentGallery = null;\n\t\t});\n\n\t\tcurrentGallery.init();\n\t}\n};\n\nconst defaultGalleryOptions: PhotoSwipeUiDefault.Options = {\n\tbgOpacity: 0.7,\n\tshowHideOpacity: true,\n\tcounterEl: false,\n\tshareEl: false,\n\tclickToCloseNonZoomable: false,\n\tindex: 0,\n\taddCaptionHTMLFn(item: Slide, captionEl: HTMLElement): boolean {\n\t\tcaptionEl.children[0].innerHTML = `\n\t\t\t${escapeHTML(item.title ?? '')}<br/>\n\t\t\t<small>${escapeHTML(item.description ?? '')}</small>\n\t\t`;\n\t\treturn true;\n\t},\n};\n\nconst createEventListenerFor =\n\t(className: string) =>\n\t(event: JQuery.ClickEvent): void => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst { currentTarget } = event;\n\n\t\tArray.from(document.querySelectorAll(className))\n\t\t\t.sort((a, b) => {\n\t\t\t\tif (a === currentTarget) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\n\t\t\t\tif (b === currentTarget) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\treturn 0;\n\t\t\t})\n\t\t\t.map((element) => fromElementToSlide(element))\n\t\t\t.reduce(\n\t\t\t\t(p, curr) =>\n\t\t\t\t\tp\n\t\t\t\t\t\t.then(() => curr)\n\t\t\t\t\t\t.then(async (slide) => {\n\t\t\t\t\t\t\tif (!slide) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!currentGallery) {\n\t\t\t\t\t\t\t\treturn initGallery([slide], defaultGalleryOptions);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcurrentGallery.items.push(slide);\n\t\t\t\t\t\t\tcurrentGallery.invalidateCurrItems();\n\t\t\t\t\t\t\tcurrentGallery.updateSize(true);\n\t\t\t\t\t\t}),\n\t\t\t\tPromise.resolve(),\n\t\t\t);\n\t};\n\nMeteor.startup(() => {\n\t$(document).on('click', '.gallery-item', createEventListenerFor('.gallery-item'));\n});\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/photoswipeContent.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/views/app/photoswipeContent.ts"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Blaze;\nmodule.link(\"meteor/blaze\", {\n  Blaze: function (v) {\n    Blaze = v;\n  }\n}, 1);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 2);\nvar escapeHTML;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeHTML: function (v) {\n    escapeHTML = v;\n  }\n}, 3);\n\nvar parseLength = function (x) {\n  var length = typeof x === 'string' ? parseInt(x, 10) : undefined;\n  return Number.isFinite(length) ? length : undefined;\n};\n\nvar getImageSize = function (src) {\n  return new Promise(function (resolve, reject) {\n    var img = new Image();\n    img.addEventListener('load', function () {\n      resolve([img.naturalWidth, img.naturalHeight]);\n    });\n    img.addEventListener('error', function (error) {\n      reject(error.error);\n    });\n    img.src = src;\n  });\n};\n\nvar fromElementToSlide = function () {\n  function _callee(element) {\n    var title, description, src, w, h, _await$getImageSize, _await$getImageSize2, msrc, _src, _w, _h, _await$getImageSize3, _await$getImageSize4;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (element instanceof HTMLElement) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", null);\n\n            case 2:\n              title = element.dataset.title || element.title;\n              description = element.dataset.description;\n\n              if (!(element instanceof HTMLAnchorElement)) {\n                _context.next = 16;\n                break;\n              }\n\n              src = element.dataset.src || element.href;\n              w = parseLength(element.dataset.width);\n              h = parseLength(element.dataset.height);\n\n              if (!(w === undefined || h === undefined)) {\n                _context.next = 15;\n                break;\n              }\n\n              _context.next = 11;\n              return _regeneratorRuntime.awrap(getImageSize(src));\n\n            case 11:\n              _await$getImageSize = _context.sent;\n              _await$getImageSize2 = _slicedToArray(_await$getImageSize, 2);\n              w = _await$getImageSize2[0];\n              h = _await$getImageSize2[1];\n\n            case 15:\n              return _context.abrupt(\"return\", {\n                src: src,\n                w: w,\n                h: h,\n                title: title,\n                description: description\n              });\n\n            case 16:\n              if (!(element instanceof HTMLImageElement)) {\n                _context.next = 33;\n                break;\n              }\n\n              _src = element.src;\n              _w = element.naturalWidth;\n              _h = element.naturalHeight;\n\n              if (!element.dataset.src) {\n                _context.next = 32;\n                break;\n              }\n\n              msrc = element.src;\n              _src = element.dataset.src;\n              _w = parseLength(element.dataset.width);\n              _h = parseLength(element.dataset.height);\n\n              if (!(_w === undefined || _h === undefined)) {\n                _context.next = 32;\n                break;\n              }\n\n              _context.next = 28;\n              return _regeneratorRuntime.awrap(getImageSize(_src));\n\n            case 28:\n              _await$getImageSize3 = _context.sent;\n              _await$getImageSize4 = _slicedToArray(_await$getImageSize3, 2);\n              _w = _await$getImageSize4[0];\n              _h = _await$getImageSize4[1];\n\n            case 32:\n              return _context.abrupt(\"return\", {\n                msrc: msrc,\n                src: _src,\n                w: _w,\n                h: _h,\n                title: title,\n                description: description\n              });\n\n            case 33:\n              return _context.abrupt(\"return\", null);\n\n            case 34:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }\n\n      return _callee$;\n    }(), null, null, null, Promise);\n  }\n\n  return _callee;\n}();\n\nvar currentGallery = null;\n\nvar initGallery = function () {\n  function _callee2(items, options) {\n    var _await$Promise$all, _await$Promise$all2, PhotoSwipe, PhotoSwipeUiDefault, container;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(Promise.all([module.dynamicImport('photoswipe'), module.dynamicImport('photoswipe/dist/photoswipe-ui-default'), // @ts-ignore\n              module.dynamicImport('photoswipe/dist/photoswipe.css'), // @ts-ignore\n              module.dynamicImport('./photoswipeContent.html')]));\n\n            case 2:\n              _await$Promise$all = _context2.sent;\n              _await$Promise$all2 = _slicedToArray(_await$Promise$all, 2);\n              PhotoSwipe = _await$Promise$all2[0].default;\n              PhotoSwipeUiDefault = _await$Promise$all2[1].default;\n              Blaze.render(Template.photoswipeContent, document.body);\n\n              if (currentGallery) {\n                _context2.next = 14;\n                break;\n              }\n\n              container = document.getElementById('pswp');\n\n              if (container) {\n                _context2.next = 11;\n                break;\n              }\n\n              throw new Error('Photoswipe container element not found');\n\n            case 11:\n              currentGallery = new PhotoSwipe(container, PhotoSwipeUiDefault, items, options);\n              currentGallery.listen('destroy', function () {\n                currentGallery = null;\n              });\n              currentGallery.init();\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }\n\n      return _callee2$;\n    }(), null, null, null, Promise);\n  }\n\n  return _callee2;\n}();\n\nvar defaultGalleryOptions = {\n  bgOpacity: 0.7,\n  showHideOpacity: true,\n  counterEl: false,\n  shareEl: false,\n  clickToCloseNonZoomable: false,\n  index: 0,\n  addCaptionHTMLFn: function (item, captionEl) {\n    var _item$title, _item$description;\n\n    captionEl.children[0].innerHTML = \"\\n\\t\\t\\t\" + escapeHTML((_item$title = item.title) !== null && _item$title !== void 0 ? _item$title : '') + \"<br/>\\n\\t\\t\\t<small>\" + escapeHTML((_item$description = item.description) !== null && _item$description !== void 0 ? _item$description : '') + \"</small>\\n\\t\\t\";\n    return true;\n  }\n};\n\nvar createEventListenerFor = function (className) {\n  return function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    var currentTarget = event.currentTarget;\n    Array.from(document.querySelectorAll(className)).sort(function (a, b) {\n      if (a === currentTarget) {\n        return -1;\n      }\n\n      if (b === currentTarget) {\n        return 1;\n      }\n\n      return 0;\n    }).map(function (element) {\n      return fromElementToSlide(element);\n    }).reduce(function (p, curr) {\n      return p.then(function () {\n        return curr;\n      }).then(function () {\n        function _callee3(slide) {\n          return _regeneratorRuntime.async(function () {\n            function _callee3$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    if (slide) {\n                      _context3.next = 2;\n                      break;\n                    }\n\n                    return _context3.abrupt(\"return\");\n\n                  case 2:\n                    if (currentGallery) {\n                      _context3.next = 4;\n                      break;\n                    }\n\n                    return _context3.abrupt(\"return\", initGallery([slide], defaultGalleryOptions));\n\n                  case 4:\n                    currentGallery.items.push(slide);\n                    currentGallery.invalidateCurrItems();\n                    currentGallery.updateSize(true);\n\n                  case 7:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }\n\n            return _callee3$;\n          }(), null, null, null, Promise);\n        }\n\n        return _callee3;\n      }());\n    }, Promise.resolve());\n  };\n};\n\nMeteor.startup(function () {\n  $(document).on('click', '.gallery-item', createEventListenerFor('.gallery-item'));\n});","map":{"version":3,"sources":["app/ui/client/views/app/photoswipeContent.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Blaze } from 'meteor/blaze';\nimport { Template } from 'meteor/templating';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport type PhotoSwipe from 'photoswipe';\nimport type PhotoSwipeUiDefault from 'photoswipe/dist/photoswipe-ui-default';\n\nconst parseLength = (x: unknown): number | undefined => {\n\tconst length = typeof x === 'string' ? parseInt(x, 10) : undefined;\n\treturn Number.isFinite(length) ? length : undefined;\n};\n\nconst getImageSize = (src: string): Promise<[w: number, h: number]> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve([img.naturalWidth, img.naturalHeight]);\n\t\t});\n\n\t\timg.addEventListener('error', (error) => {\n\t\t\treject(error.error);\n\t\t});\n\n\t\timg.src = src;\n\t});\n\ntype Slide = PhotoSwipeUiDefault.Item & { description?: string };\n\nconst fromElementToSlide = async (element: Element): Promise<Slide | null> => {\n\tif (!(element instanceof HTMLElement)) {\n\t\treturn null;\n\t}\n\n\tconst title = element.dataset.title || element.title;\n\tconst { description } = element.dataset;\n\n\tif (element instanceof HTMLAnchorElement) {\n\t\tconst src = element.dataset.src || element.href;\n\t\tlet w = parseLength(element.dataset.width);\n\t\tlet h = parseLength(element.dataset.height);\n\n\t\tif (w === undefined || h === undefined) {\n\t\t\t[w, h] = await getImageSize(src);\n\t\t}\n\n\t\treturn { src, w, h, title, description };\n\t}\n\n\tif (element instanceof HTMLImageElement) {\n\t\tlet msrc: string | undefined;\n\t\tlet { src } = element;\n\t\tlet w: number | undefined = element.naturalWidth;\n\t\tlet h: number | undefined = element.naturalHeight;\n\n\t\tif (element.dataset.src) {\n\t\t\tmsrc = element.src;\n\t\t\tsrc = element.dataset.src;\n\t\t\tw = parseLength(element.dataset.width);\n\t\t\th = parseLength(element.dataset.height);\n\n\t\t\tif (w === undefined || h === undefined) {\n\t\t\t\t[w, h] = await getImageSize(src);\n\t\t\t}\n\t\t}\n\n\t\treturn { msrc, src, w, h, title, description };\n\t}\n\n\treturn null;\n};\n\nlet currentGallery: PhotoSwipe<PhotoSwipeUiDefault.Options> | null = null;\n\nconst initGallery = async (items: Slide[], options: PhotoSwipeUiDefault.Options): Promise<void> => {\n\tconst [\n\t\t{ default: PhotoSwipe },\n\t\t{ default: PhotoSwipeUiDefault }, // eslint-disable-line @typescript-eslint/camelcase\n\t] = await Promise.all([\n\t\timport('photoswipe'),\n\t\timport('photoswipe/dist/photoswipe-ui-default'),\n\t\t// @ts-ignore\n\t\timport('photoswipe/dist/photoswipe.css'),\n\t\t// @ts-ignore\n\t\timport('./photoswipeContent.html'),\n\t]);\n\n\tBlaze.render(Template.photoswipeContent, document.body);\n\n\tif (!currentGallery) {\n\t\tconst container = document.getElementById('pswp');\n\n\t\tif (!container) {\n\t\t\tthrow new Error('Photoswipe container element not found');\n\t\t}\n\n\t\tcurrentGallery = new PhotoSwipe(container, PhotoSwipeUiDefault, items, options);\n\n\t\tcurrentGallery.listen('destroy', () => {\n\t\t\tcurrentGallery = null;\n\t\t});\n\n\t\tcurrentGallery.init();\n\t}\n};\n\nconst defaultGalleryOptions: PhotoSwipeUiDefault.Options = {\n\tbgOpacity: 0.7,\n\tshowHideOpacity: true,\n\tcounterEl: false,\n\tshareEl: false,\n\tclickToCloseNonZoomable: false,\n\tindex: 0,\n\taddCaptionHTMLFn(item: Slide, captionEl: HTMLElement): boolean {\n\t\tcaptionEl.children[0].innerHTML = `\n\t\t\t${escapeHTML(item.title ?? '')}<br/>\n\t\t\t<small>${escapeHTML(item.description ?? '')}</small>\n\t\t`;\n\t\treturn true;\n\t},\n};\n\nconst createEventListenerFor =\n\t(className: string) =>\n\t(event: JQuery.ClickEvent): void => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst { currentTarget } = event;\n\n\t\tArray.from(document.querySelectorAll(className))\n\t\t\t.sort((a, b) => {\n\t\t\t\tif (a === currentTarget) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\n\t\t\t\tif (b === currentTarget) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\treturn 0;\n\t\t\t})\n\t\t\t.map((element) => fromElementToSlide(element))\n\t\t\t.reduce(\n\t\t\t\t(p, curr) =>\n\t\t\t\t\tp\n\t\t\t\t\t\t.then(() => curr)\n\t\t\t\t\t\t.then(async (slide) => {\n\t\t\t\t\t\t\tif (!slide) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!currentGallery) {\n\t\t\t\t\t\t\t\treturn initGallery([slide], defaultGalleryOptions);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcurrentGallery.items.push(slide);\n\t\t\t\t\t\t\tcurrentGallery.invalidateCurrItems();\n\t\t\t\t\t\t\tcurrentGallery.updateSize(true);\n\t\t\t\t\t\t}),\n\t\t\t\tPromise.resolve(),\n\t\t\t);\n\t};\n\nMeteor.startup(() => {\n\t$(document).on('click', '.gallery-item', createEventListenerFor('.gallery-item'));\n});\n"],"sourceRoot":""},"sourceType":"module","hash":"81a479a3961a923cfa9b7f0db8f3752bcab91067"}
