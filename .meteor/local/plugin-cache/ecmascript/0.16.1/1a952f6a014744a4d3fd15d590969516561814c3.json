{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/postcss/build.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"packages/postcss/build.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/postcss/build.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/postcss/build.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/postcss/build.js"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet CssTools;\nmodule.link(\"meteor/minifier-css\", {\n  CssTools(v) {\n    CssTools = v;\n  }\n\n}, 0);\nlet postcss;\nmodule.link(\"postcss\", {\n  default(v) {\n    postcss = v;\n  }\n\n}, 1);\nlet postcssrc;\nmodule.link(\"postcss-load-config\", {\n  default(v) {\n    postcssrc = v;\n  }\n\n}, 2);\nlet SourceMapConsumer, SourceMapGenerator;\nmodule.link(\"source-map\", {\n  SourceMapConsumer(v) {\n    SourceMapConsumer = v;\n  },\n\n  SourceMapGenerator(v) {\n    SourceMapGenerator = v;\n  }\n\n}, 3);\nlet loaded = false;\nlet postcssConfigPlugins = [];\nlet postcssConfigParser = null;\nlet postcssConfigExcludedPackages = [];\n\nconst loadPostcssConfig = () => Promise.asyncApply(() => {\n  if (loaded) {\n    return;\n  }\n\n  try {\n    const config = Promise.await(postcssrc({\n      meteor: true\n    }));\n    postcssConfigPlugins = config.plugins || [];\n    postcssConfigParser = config.options.parser || null;\n    postcssConfigExcludedPackages = config.options.excludedPackages || [];\n  } catch (error) {\n    if (error.message.indexOf('No PostCSS Config found') < 0) {\n      throw error;\n    }\n  } finally {\n    loaded = true;\n  }\n});\n\nconst isImportFile = _ref => {\n  let {\n    _source: {\n      url\n    }\n  } = _ref;\n  return /\\.import\\.css$/.test(url) || /(?:^|\\/)imports\\//.test(url);\n};\n\nconst isInExcludedPackages = pathInBundle => postcssConfigExcludedPackages.some(packageName => pathInBundle.indexOf(\"packages/\".concat(packageName.replace(':', '_'), \"/\")) > -1);\n\nconst handleFileError = (file, error) => {\n  if (error.name === 'CssSyntaxError') {\n    file.error({\n      message: error.message,\n      line: error.line,\n      column: error.column\n    });\n    return;\n  }\n\n  if (error.reason) {\n    file.error({\n      message: error.reason,\n      line: error.line,\n      column: error.column\n    });\n    return;\n  }\n\n  file.error({\n    message: error.message\n  });\n};\n\nconst getAbstractSyntaxTree = file => Promise.asyncApply(() => {\n  const filename = file.getPathInBundle();\n\n  if (isInExcludedPackages(filename)) {\n    return Object.assign(CssTools.parseCss(file.getContentsAsString(), {\n      source: filename,\n      position: true\n    }), {\n      filename\n    });\n  }\n\n  try {\n    const postcssResult = Promise.await(postcss(postcssConfigPlugins).process(file.getContentsAsString(), {\n      from: process.cwd() + file._source.url,\n      parser: postcssConfigParser\n    }));\n    postcssResult.warnings().forEach(warn => {\n      process.stderr.write(warn.toString());\n    });\n    return Object.assign(CssTools.parseCss(postcssResult.css, {\n      source: filename,\n      position: true\n    }), {\n      filename\n    });\n  } catch (error) {\n    if (error.name === 'CssSyntaxError') {\n      error.message = \"\".concat(error.message, \"\\n\\nCss Syntax Error.\\n\\n\").concat(error.message).concat(error.showSourceCode());\n    }\n\n    handleFileError(file, error);\n    return {\n      type: 'stylesheet',\n      stylesheet: {\n        rules: []\n      },\n      filename\n    };\n  }\n});\n\nconst mergeCssFiles = files => Promise.asyncApply(() => {\n  const cssAsts = Promise.await(Promise.all(files.map(getAbstractSyntaxTree)));\n  const mergedCssAst = CssTools.mergeCssAsts(cssAsts, (filename, msg) => {\n    console.warn(\"\".concat(filename, \": warn: \").concat(msg));\n  });\n  const {\n    code,\n    map\n  } = CssTools.stringifyCss(mergedCssAst, {\n    sourcemap: true,\n    inputSourcemaps: false\n  });\n\n  if (!code) {\n    return {\n      code: ''\n    };\n  }\n\n  const mapFilenameToFile = files.reduce((obj, file) => _objectSpread(_objectSpread({}, obj), {}, {\n    [file.getPathInBundle()]: file\n  }), {});\n  map.sourcesContent = map.sources.map(filename => mapFilenameToFile[filename].getContentsAsString()); // yes, this await is needed\n\n  const consumer = Promise.await(new SourceMapConsumer(map));\n  const newMap = SourceMapGenerator.fromSourceMap(consumer);\n  consumer.destroy();\n  files.filter(file => file.getSourceMap()).forEach(file => {\n    newMap.applySourceMap(new SourceMapConsumer(file.getSourceMap()), file.getPathInBundle());\n  });\n  return {\n    code,\n    sourceMap: newMap.toString()\n  };\n});\n\nconst processFilesForBundle = function () {\n  return Promise.asyncApply(() => {\n    let files = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let {\n      minifyMode\n    } = arguments.length > 1 ? arguments[1] : undefined;\n\n    if (!files.length) {\n      return;\n    }\n\n    Promise.await(loadPostcssConfig());\n    const filesToMerge = files.filter(file => !isImportFile(file));\n    const {\n      code,\n      sourceMap\n    } = Promise.await(mergeCssFiles(filesToMerge));\n\n    if (minifyMode === 'development') {\n      files[0].addStylesheet({\n        data: code,\n        sourceMap,\n        path: 'merged-stylesheets.css'\n      });\n      return;\n    }\n\n    const minifiedFiles = CssTools.minifyCss(code);\n    minifiedFiles.forEach(data => {\n      files[0].addStylesheet({\n        data\n      });\n    });\n  });\n};\n\nPlugin.registerMinifier({\n  extensions: ['css']\n}, () => ({\n  processFilesForBundle\n}));","map":{"version":3,"sources":["packages/postcss/build.js"],"names":["_objectSpread","module","link","default","v","CssTools","postcss","postcssrc","SourceMapConsumer","SourceMapGenerator","loaded","postcssConfigPlugins","postcssConfigParser","postcssConfigExcludedPackages","loadPostcssConfig","config","meteor","plugins","options","parser","excludedPackages","error","message","indexOf","isImportFile","_source","url","test","isInExcludedPackages","pathInBundle","some","packageName","replace","handleFileError","file","name","line","column","reason","getAbstractSyntaxTree","filename","getPathInBundle","Object","assign","parseCss","getContentsAsString","source","position","postcssResult","process","from","cwd","warnings","forEach","warn","stderr","write","toString","css","showSourceCode","type","stylesheet","rules","mergeCssFiles","files","cssAsts","Promise","all","map","mergedCssAst","mergeCssAsts","msg","console","code","stringifyCss","sourcemap","inputSourcemaps","mapFilenameToFile","reduce","obj","sourcesContent","sources","consumer","newMap","fromSourceMap","destroy","filter","getSourceMap","applySourceMap","sourceMap","processFilesForBundle","minifyMode","length","filesToMerge","addStylesheet","data","path","minifiedFiles","minifyCss","Plugin","registerMinifier","extensions"],"mappings":"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","sourcesContent":["import { CssTools } from 'meteor/minifier-css';\nimport postcss from 'postcss';\nimport postcssrc from 'postcss-load-config';\nimport { SourceMapConsumer, SourceMapGenerator } from 'source-map';\n\nlet loaded = false;\nlet postcssConfigPlugins = [];\nlet postcssConfigParser = null;\nlet postcssConfigExcludedPackages = [];\n\nconst loadPostcssConfig = async () => {\n\tif (loaded) {\n\t\treturn;\n\t}\n\n\ttry {\n\t\tconst config = await postcssrc({ meteor: true });\n\t\tpostcssConfigPlugins = config.plugins || [];\n\t\tpostcssConfigParser = config.options.parser || null;\n\t\tpostcssConfigExcludedPackages = config.options.excludedPackages || [];\n\t} catch (error) {\n\t\tif (error.message.indexOf('No PostCSS Config found') < 0) {\n\t\t\tthrow error;\n\t\t}\n\t} finally {\n\t\tloaded = true;\n\t}\n};\n\nconst isImportFile = ({ _source: { url } }) => /\\.import\\.css$/.test(url) || /(?:^|\\/)imports\\//.test(url);\n\nconst isInExcludedPackages = (pathInBundle) =>\n\tpostcssConfigExcludedPackages.some((packageName) => pathInBundle.indexOf(`packages/${packageName.replace(':', '_')}/`) > -1);\n\nconst handleFileError = (file, error) => {\n\tif (error.name === 'CssSyntaxError') {\n\t\tfile.error({\n\t\t\tmessage: error.message,\n\t\t\tline: error.line,\n\t\t\tcolumn: error.column,\n\t\t});\n\t\treturn;\n\t}\n\n\tif (error.reason) {\n\t\tfile.error({\n\t\t\tmessage: error.reason,\n\t\t\tline: error.line,\n\t\t\tcolumn: error.column,\n\t\t});\n\t\treturn;\n\t}\n\n\tfile.error({ message: error.message });\n};\n\nconst getAbstractSyntaxTree = async (file) => {\n\tconst filename = file.getPathInBundle();\n\n\tif (isInExcludedPackages(filename)) {\n\t\treturn Object.assign(\n\t\t\tCssTools.parseCss(file.getContentsAsString(), {\n\t\t\t\tsource: filename,\n\t\t\t\tposition: true,\n\t\t\t}),\n\t\t\t{ filename },\n\t\t);\n\t}\n\n\ttry {\n\t\tconst postcssResult = await postcss(postcssConfigPlugins).process(file.getContentsAsString(), {\n\t\t\tfrom: process.cwd() + file._source.url,\n\t\t\tparser: postcssConfigParser,\n\t\t});\n\n\t\tpostcssResult.warnings().forEach((warn) => {\n\t\t\tprocess.stderr.write(warn.toString());\n\t\t});\n\n\t\treturn Object.assign(\n\t\t\tCssTools.parseCss(postcssResult.css, {\n\t\t\t\tsource: filename,\n\t\t\t\tposition: true,\n\t\t\t}),\n\t\t\t{ filename },\n\t\t);\n\t} catch (error) {\n\t\tif (error.name === 'CssSyntaxError') {\n\t\t\terror.message = `${error.message}\\n\\nCss Syntax Error.\\n\\n${error.message}${error.showSourceCode()}`;\n\t\t}\n\n\t\thandleFileError(file, error);\n\n\t\treturn {\n\t\t\ttype: 'stylesheet',\n\t\t\tstylesheet: {\n\t\t\t\trules: [],\n\t\t\t},\n\t\t\tfilename,\n\t\t};\n\t}\n};\n\nconst mergeCssFiles = async (files) => {\n\tconst cssAsts = await Promise.all(files.map(getAbstractSyntaxTree));\n\n\tconst mergedCssAst = CssTools.mergeCssAsts(cssAsts, (filename, msg) => {\n\t\tconsole.warn(`${filename}: warn: ${msg}`);\n\t});\n\n\tconst { code, map } = CssTools.stringifyCss(mergedCssAst, {\n\t\tsourcemap: true,\n\t\tinputSourcemaps: false,\n\t});\n\n\tif (!code) {\n\t\treturn {\n\t\t\tcode: '',\n\t\t};\n\t}\n\n\tconst mapFilenameToFile = files.reduce(\n\t\t(obj, file) => ({\n\t\t\t...obj,\n\t\t\t[file.getPathInBundle()]: file,\n\t\t}),\n\t\t{},\n\t);\n\n\tmap.sourcesContent = map.sources.map((filename) => mapFilenameToFile[filename].getContentsAsString());\n\n\t// yes, this await is needed\n\tconst consumer = await new SourceMapConsumer(map);\n\n\tconst newMap = SourceMapGenerator.fromSourceMap(consumer);\n\n\tconsumer.destroy();\n\n\tfiles\n\t\t.filter((file) => file.getSourceMap())\n\t\t.forEach((file) => {\n\t\t\tnewMap.applySourceMap(new SourceMapConsumer(file.getSourceMap()), file.getPathInBundle());\n\t\t});\n\n\treturn {\n\t\tcode,\n\t\tsourceMap: newMap.toString(),\n\t};\n};\n\nconst processFilesForBundle = async (files = [], { minifyMode }) => {\n\tif (!files.length) {\n\t\treturn;\n\t}\n\n\tawait loadPostcssConfig();\n\n\tconst filesToMerge = files.filter((file) => !isImportFile(file));\n\n\tconst { code, sourceMap } = await mergeCssFiles(filesToMerge);\n\n\tif (minifyMode === 'development') {\n\t\tfiles[0].addStylesheet({\n\t\t\tdata: code,\n\t\t\tsourceMap,\n\t\t\tpath: 'merged-stylesheets.css',\n\t\t});\n\t\treturn;\n\t}\n\n\tconst minifiedFiles = CssTools.minifyCss(code);\n\n\tminifiedFiles.forEach((data) => {\n\t\tfiles[0].addStylesheet({ data });\n\t});\n};\n\nPlugin.registerMinifier({ extensions: ['css'] }, () => ({\n\tprocessFilesForBundle,\n}));\n"]},"sourceType":"module","hash":"1a952f6a014744a4d3fd15d590969516561814c3"}
