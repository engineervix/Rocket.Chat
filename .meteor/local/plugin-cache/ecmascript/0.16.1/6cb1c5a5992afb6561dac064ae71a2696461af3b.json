{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/message.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-message/client/message.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/message.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/message.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/message.js"}},"code":"var _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\n\nvar _toConsumableArray;\n\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 1);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 2);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 0);\nvar dompurify;\nmodule.link(\"dompurify\", {\n  \"default\": function (v) {\n    dompurify = v;\n  }\n}, 1);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 4);\nvar TAPi18n;\nmodule.link(\"meteor/rocketchat:tap-i18n\", {\n  TAPi18n: function (v) {\n    TAPi18n = v;\n  }\n}, 5);\nvar escapeHTML;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeHTML: function (v) {\n    escapeHTML = v;\n  }\n}, 6);\nvar timeAgo;\nmodule.link(\"../../../client/lib/utils/timeAgo\", {\n  timeAgo: function (v) {\n    timeAgo = v;\n  }\n}, 7);\nvar formatDateAndTime;\nmodule.link(\"../../../client/lib/utils/formatDateAndTime\", {\n  formatDateAndTime: function (v) {\n    formatDateAndTime = v;\n  }\n}, 8);\nvar normalizeThreadTitle;\nmodule.link(\"../../threads/client/lib/normalizeThreadTitle\", {\n  normalizeThreadTitle: function (v) {\n    normalizeThreadTitle = v;\n  }\n}, 9);\nvar MessageTypes, MessageAction;\nmodule.link(\"../../ui-utils/client\", {\n  MessageTypes: function (v) {\n    MessageTypes = v;\n  },\n  MessageAction: function (v) {\n    MessageAction = v;\n  }\n}, 10);\nvar RoomRoles, UserRoles, Roles;\nmodule.link(\"../../models/client\", {\n  RoomRoles: function (v) {\n    RoomRoles = v;\n  },\n  UserRoles: function (v) {\n    UserRoles = v;\n  },\n  Roles: function (v) {\n    Roles = v;\n  }\n}, 11);\nvar Markdown;\nmodule.link(\"../../markdown/client\", {\n  Markdown: function (v) {\n    Markdown = v;\n  }\n}, 12);\nvar t;\nmodule.link(\"../../utils\", {\n  t: function (v) {\n    t = v;\n  }\n}, 13);\nvar AutoTranslate;\nmodule.link(\"../../autotranslate/client\", {\n  AutoTranslate: function (v) {\n    AutoTranslate = v;\n  }\n}, 14);\nvar renderMentions;\nmodule.link(\"../../mentions/client/client\", {\n  renderMentions: function (v) {\n    renderMentions = v;\n  }\n}, 15);\nvar renderMessageBody;\nmodule.link(\"../../../client/lib/utils/renderMessageBody\", {\n  renderMessageBody: function (v) {\n    renderMessageBody = v;\n  }\n}, 16);\nvar settings;\nmodule.link(\"../../settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 17);\nvar formatTime;\nmodule.link(\"../../../client/lib/utils/formatTime\", {\n  formatTime: function (v) {\n    formatTime = v;\n  }\n}, 18);\nvar formatDate;\nmodule.link(\"../../../client/lib/utils/formatDate\", {\n  formatDate: function (v) {\n    formatDate = v;\n  }\n}, 19);\nmodule.link(\"./messageThread\");\nmodule.link(\"./message.html\");\nvar roomCoordinator;\nmodule.link(\"../../../client/lib/rooms/roomCoordinator\", {\n  roomCoordinator: function (v) {\n    roomCoordinator = v;\n  }\n}, 20);\n\nvar renderBody = function (msg, settings) {\n  var searchedText = msg.searchedText ? msg.searchedText : '';\n  var isSystemMessage = MessageTypes.isSystemMessage(msg);\n  var messageType = MessageTypes.getType(msg) || {};\n\n  if (messageType.render) {\n    msg = messageType.render(msg);\n  } else if (messageType.template) {// render template\n  } else if (messageType.message) {\n    msg.msg = escapeHTML(msg.msg);\n    msg = TAPi18n.__(messageType.message, _objectSpread({}, typeof messageType.data === 'function' && messageType.data(msg)));\n    msg = dompurify.sanitize(msg);\n  } else if (msg.u && msg.u.username === settings.Chatops_Username) {\n    msg.html = msg.msg;\n    msg = renderMentions(msg);\n    msg = msg.html;\n  } else {\n    msg = renderMessageBody(msg);\n  }\n\n  if (isSystemMessage) {\n    msg.html = Markdown.parse(msg.html);\n  }\n\n  if (searchedText) {\n    msg = msg.replace(new RegExp(searchedText, 'gi'), function (str) {\n      return \"<mark>\" + str + \"</mark>\";\n    });\n  }\n\n  return msg;\n};\n\nTemplate.message.helpers({\n  enableMessageParserEarlyAdoption: function () {\n    var enableMessageParserEarlyAdoption = this.settings.enableMessageParserEarlyAdoption,\n        msg = this.msg;\n    return enableMessageParserEarlyAdoption && msg.md;\n  },\n  unread: function () {\n    var _subscription$tunread;\n\n    var msg = this.msg,\n        subscription = this.subscription;\n    return subscription === null || subscription === void 0 ? void 0 : (_subscription$tunread = subscription.tunread) === null || _subscription$tunread === void 0 ? void 0 : _subscription$tunread.includes(msg._id);\n  },\n  mention: function () {\n    var _subscription$tunread2;\n\n    var msg = this.msg,\n        subscription = this.subscription;\n    return subscription === null || subscription === void 0 ? void 0 : (_subscription$tunread2 = subscription.tunreadUser) === null || _subscription$tunread2 === void 0 ? void 0 : _subscription$tunread2.includes(msg._id);\n  },\n  all: function () {\n    var _subscription$tunread3;\n\n    var msg = this.msg,\n        subscription = this.subscription;\n    return subscription === null || subscription === void 0 ? void 0 : (_subscription$tunread3 = subscription.tunreadGroup) === null || _subscription$tunread3 === void 0 ? void 0 : _subscription$tunread3.includes(msg._id);\n  },\n  following: function () {\n    var msg = this.msg,\n        u = this.u;\n    return msg.replies && msg.replies.indexOf(u._id) > -1;\n  },\n  body: function () {\n    var msg = this.msg,\n        settings = this.settings;\n    return Tracker.nonreactive(function () {\n      return renderBody(msg, settings);\n    });\n  },\n  i18nReplyCounter: function () {\n    var msg = this.msg;\n\n    if (msg.tcount === 1) {\n      return 'reply_counter';\n    }\n\n    return 'reply_counter_plural';\n  },\n  i18nDiscussionCounter: function () {\n    var msg = this.msg;\n    return \"<span class='reply-counter'>\" + msg.dcount + \"</span>\";\n  },\n  formatDateAndTime: formatDateAndTime,\n  encodeURI: function (text) {\n    return encodeURI(text);\n  },\n  broadcast: function () {\n    var msg = this.msg,\n        _this$room = this.room,\n        room = _this$room === void 0 ? {} : _this$room,\n        u = this.u;\n    return !msg.private && !msg.t && msg.u._id !== u._id && room && room.broadcast;\n  },\n  isIgnored: function () {\n    var ignored = this.ignored,\n        msg = this.msg;\n    var isIgnored = typeof ignored !== 'undefined' ? ignored : msg.ignored;\n    return isIgnored;\n  },\n  ignoredClass: function () {\n    var ignored = this.ignored,\n        msg = this.msg;\n    var isIgnored = typeof ignored !== 'undefined' ? ignored : msg.ignored;\n    return isIgnored ? 'message--ignored' : '';\n  },\n  isDecrypting: function () {\n    var msg = this.msg;\n    return msg.e2e === 'pending';\n  },\n  isBot: function () {\n    var msg = this.msg;\n    return msg.bot && 'bot';\n  },\n  hasAttachments: function () {\n    var _msg$attachments;\n\n    var msg = this.msg;\n    return (_msg$attachments = msg.attachments) === null || _msg$attachments === void 0 ? void 0 : _msg$attachments.length;\n  },\n  roleTags: function () {\n    var msg = this.msg,\n        hideRoles = this.hideRoles,\n        settings = this.settings;\n\n    if (settings.hideRoles || hideRoles) {\n      return [];\n    }\n\n    if (!msg.u || !msg.u._id) {\n      return [];\n    }\n\n    var userRoles = UserRoles.findOne(msg.u._id);\n    var roomRoles = RoomRoles.findOne({\n      'u._id': msg.u._id,\n      'rid': msg.rid\n    });\n    var roles = [].concat(_toConsumableArray(userRoles && userRoles.roles || []), _toConsumableArray(roomRoles && roomRoles.roles || []));\n    return Roles.find({\n      _id: {\n        $in: roles\n      },\n      description: {\n        $exists: 1,\n        $ne: ''\n      }\n    }, {\n      fields: {\n        description: 1\n      }\n    });\n  },\n  isGroupable: function () {\n    var msg = this.msg,\n        _this$room2 = this.room,\n        room = _this$room2 === void 0 ? {} : _this$room2,\n        settings = this.settings,\n        groupable = this.groupable;\n\n    if (groupable === false || settings.allowGroup === false || room.broadcast || msg.groupable === false || MessageTypes.isSystemMessage(msg) && !msg.tmid) {\n      return 'false';\n    }\n  },\n  avatarFromUsername: function () {\n    var msg = this.msg;\n\n    if (msg.avatar != null && msg.avatar[0] === '@') {\n      return msg.avatar.replace(/^@/, '');\n    }\n  },\n  avatarFromMessage: function () {\n    var msg = this.msg;\n\n    if (msg && msg.avatar) {\n      return encodeURI(msg.avatar);\n    }\n\n    return '';\n  },\n  getName: function () {\n    var msg = this.msg,\n        settings = this.settings;\n\n    if (msg.alias) {\n      return msg.alias;\n    }\n\n    if (!msg.u) {\n      return '';\n    }\n\n    return settings.UI_Use_Real_Name && msg.u.name || msg.u.username;\n  },\n  showUsername: function () {\n    var msg = this.msg,\n        settings = this.settings;\n    return msg.alias || settings.UI_Use_Real_Name && msg.u && msg.u.name;\n  },\n  own: function () {\n    var msg = this.msg,\n        _this$u = this.u,\n        u = _this$u === void 0 ? {} : _this$u;\n\n    if (msg.u && msg.u._id === u._id) {\n      return 'own';\n    }\n  },\n  t: function () {\n    var msg = this.msg;\n    return msg.t;\n  },\n  timestamp: function () {\n    var msg = this.msg;\n    return +msg.ts;\n  },\n  chatops: function () {\n    var msg = this.msg,\n        settings = this.settings;\n\n    if (msg.u && msg.u.username === settings.Chatops_Username) {\n      return 'chatops-message';\n    }\n  },\n  time: function () {\n    var msg = this.msg,\n        useTimeAgo = this.timeAgo;\n    return useTimeAgo ? timeAgo(msg.ts) : formatTime(msg.ts);\n  },\n  date: function () {\n    var msg = this.msg;\n    return formatDate(msg.ts);\n  },\n  isTemp: function () {\n    var msg = this.msg;\n\n    if (msg.temp === true) {\n      return 'temp';\n    }\n  },\n  threadMessage: function () {\n    var msg = this.msg;\n    return normalizeThreadTitle(msg);\n  },\n  bodyClass: function () {\n    var msg = this.msg;\n    return MessageTypes.isSystemMessage(msg) ? 'color-info-font-color' : 'color-primary-font-color';\n  },\n  system: function (returnClass) {\n    var msg = this.msg;\n\n    if (MessageTypes.isSystemMessage(msg)) {\n      if (returnClass) {\n        return 'color-info-font-color';\n      }\n\n      return 'system';\n    }\n  },\n  showTranslated: function () {\n    var msg = this.msg,\n        subscription = this.subscription,\n        settings = this.settings,\n        u = this.u;\n\n    if (settings.AutoTranslate_Enabled && msg.u && msg.u._id !== u._id && !MessageTypes.isSystemMessage(msg)) {\n      var autoTranslate = subscription && subscription.autoTranslate;\n      return msg.autoTranslateFetching || !!autoTranslate !== !!msg.autoTranslateShowInverse && msg.translations && msg.translations[settings.translateLanguage];\n    }\n  },\n  translationProvider: function () {\n    var _AutoTranslate$provid;\n\n    var instance = Template.instance();\n    var translationProvider = instance.data.msg.translationProvider;\n    return translationProvider && ((_AutoTranslate$provid = AutoTranslate.providersMetadata[translationProvider]) === null || _AutoTranslate$provid === void 0 ? void 0 : _AutoTranslate$provid.displayName);\n  },\n  edited: function () {\n    var msg = this.msg;\n    return msg.editedAt && !MessageTypes.isSystemMessage(msg);\n  },\n  editTime: function () {\n    var msg = this.msg;\n    return msg.editedAt ? formatDateAndTime(msg.editedAt) : '';\n  },\n  editedBy: function () {\n    var msg = this.msg;\n\n    if (!msg.editedAt) {\n      return '';\n    } // try to return the username of the editor,\n    // otherwise a special \"?\" character that will be\n    // rendered as a special avatar\n\n\n    return msg.editedBy && msg.editedBy.username || '?';\n  },\n  label: function () {\n    var msg = this.msg;\n\n    if (msg.i18nLabel) {\n      return t(msg.i18nLabel);\n    }\n\n    if (msg.label) {\n      return msg.label;\n    }\n  },\n  hasOembed: function () {\n    var msg = this.msg,\n        settings = this.settings; // there is no URLs, there is no template to show the oembed (oembed package removed) or oembed is not enable\n\n    if (!(msg.urls && msg.urls.length > 0) || !Template.oembedBaseWidget || !settings.API_Embed) {\n      return false;\n    } // check if oembed is disabled for message's sender\n\n\n    if ((settings.API_EmbedDisabledFor || '').split(',').map(function (username) {\n      return username.trim();\n    }).includes(msg.u && msg.u.username)) {\n      return false;\n    }\n\n    return true;\n  },\n  reactions: function () {\n    var _this$msg$reactions = this.msg.reactions,\n        reactions = _this$msg$reactions === void 0 ? {} : _this$msg$reactions,\n        _this$u2 = this.u,\n        myUsername = _this$u2.username,\n        myName = _this$u2.name;\n    return Object.entries(reactions).map(function (_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n          emoji = _ref2[0],\n          reaction = _ref2[1];\n\n      var myDisplayName = reaction.names ? myName : \"@\" + myUsername;\n      var displayNames = reaction.names || reaction.usernames.map(function (username) {\n        return \"@\" + username;\n      });\n      var selectedDisplayNames = displayNames.slice(0, 15).filter(function (displayName) {\n        return displayName !== myDisplayName;\n      });\n\n      if (displayNames.some(function (displayName) {\n        return displayName === myDisplayName;\n      })) {\n        selectedDisplayNames.unshift(t('You'));\n      }\n\n      var usernames;\n\n      if (displayNames.length > 15) {\n        usernames = selectedDisplayNames.join(', ') + \" \" + t('And_more', {\n          length: displayNames.length - 15\n        }).toLowerCase();\n      } else if (displayNames.length > 1) {\n        usernames = selectedDisplayNames.slice(0, -1).join(', ') + \" \" + t('and') + \" \" + selectedDisplayNames[selectedDisplayNames.length - 1];\n      } else {\n        usernames = selectedDisplayNames[0];\n      }\n\n      return {\n        emoji: emoji,\n        count: displayNames.length,\n        usernames: usernames,\n        reaction: \" \" + t('Reacted_with').toLowerCase() + \" \" + emoji,\n        userReacted: displayNames.indexOf(myDisplayName) > -1\n      };\n    });\n  },\n  markUserReaction: function (reaction) {\n    if (reaction.userReacted) {\n      return {\n        \"class\": 'selected'\n      };\n    }\n  },\n  hideReactions: function () {\n    var msg = this.msg;\n\n    if (_.isEmpty(msg.reactions)) {\n      return 'hidden';\n    }\n  },\n  hideAddReaction: function () {\n    var room = this.room,\n        u = this.u,\n        msg = this.msg,\n        subscription = this.subscription;\n\n    if (!room) {\n      return true;\n    }\n\n    if (!subscription) {\n      return true;\n    }\n\n    if (msg.private) {\n      return true;\n    }\n\n    if (roomCoordinator.readOnly(room._id, u) && !room.reactWhenReadOnly) {\n      return true;\n    }\n  },\n  hideMessageActions: function () {\n    var msg = this.msg;\n    return msg.private || MessageTypes.isSystemMessage(msg);\n  },\n  actionLinks: function () {\n    var msg = this.msg; // remove 'method_id' and 'params' properties\n\n    return _.map(msg.actionLinks, function (actionLink, key) {\n      return _.extend({\n        id: key\n      }, _.omit(actionLink, 'method_id', 'params'));\n    });\n  },\n  hideActionLinks: function () {\n    var msg = this.msg;\n\n    if (_.isEmpty(msg.actionLinks)) {\n      return 'hidden';\n    }\n  },\n  injectMessage: function (data, _ref3) {\n    var _id = _ref3._id,\n        rid = _ref3.rid;\n    data.msg = {\n      _id: _id,\n      rid: rid\n    };\n  },\n  injectIndex: function (data, index) {\n    data.index = index;\n  },\n  injectSettings: function (data, settings) {\n    data.settings = settings;\n  },\n  className: function () {\n    return this.msg.className;\n  },\n  channelName: function () {\n    var subscription = this.subscription; // const subscription = Subscriptions.findOne({ rid: this.rid });\n\n    return subscription && subscription.name;\n  },\n  roomIcon: function () {\n    var room = this.room;\n\n    if (room && room.t === 'd') {\n      return 'at';\n    }\n\n    return roomCoordinator.getIcon(room);\n  },\n  customClass: function () {\n    var customClass = this.customClass;\n    return customClass;\n  },\n  fromSearch: function () {\n    var customClass = this.customClass;\n    return customClass === 'search';\n  },\n  actionContext: function () {\n    var msg = this.msg;\n    return msg.actionContext;\n  },\n  messageActions: function (group) {\n    var msg = this.msg,\n        ctx = this.context;\n    var messageGroup = group;\n    var context = ctx || msg.actionContext;\n\n    if (!group) {\n      messageGroup = 'message';\n    }\n\n    if (!context) {\n      context = 'message';\n    }\n\n    return MessageAction.getButtons(this, context, messageGroup);\n  },\n  isSnippet: function () {\n    var msg = this.msg;\n    return msg.actionContext === 'snippeted';\n  },\n  isThreadReply: function () {\n    var groupable = this.groupable,\n        _this$msg = this.msg,\n        tmid = _this$msg.tmid,\n        t = _this$msg.t,\n        _groupable = _this$msg.groupable,\n        showreply = this.settings.showreply;\n    return !(groupable === true || _groupable === true) && !!(tmid && showreply && (!t || t === 'e2e'));\n  },\n  shouldHideBody: function () {\n    var _this$msg2 = this.msg,\n        tmid = _this$msg2.tmid,\n        actionContext = _this$msg2.actionContext,\n        showreply = this.settings.showreply,\n        context = this.context;\n    return showreply && tmid && !(actionContext || context);\n  },\n  collapsed: function () {\n    var _this$msg3 = this.msg,\n        tmid = _this$msg3.tmid,\n        collapsed = _this$msg3.collapsed,\n        showreply = this.settings.showreply,\n        shouldCollapseReplies = this.shouldCollapseReplies;\n    var isCollapsedThreadReply = shouldCollapseReplies && tmid && showreply && collapsed !== false;\n\n    if (isCollapsedThreadReply) {\n      return 'collapsed';\n    }\n  },\n  collapseSwitchClass: function () {\n    var _this$msg$collapsed = this.msg.collapsed,\n        collapsed = _this$msg$collapsed === void 0 ? true : _this$msg$collapsed;\n    return collapsed ? 'icon-right-dir' : 'icon-down-dir';\n  },\n  parentMessage: function () {\n    var threadMsg = this.msg.threadMsg;\n    return threadMsg;\n  },\n  showStar: function () {\n    var msg = this.msg;\n    return msg.starred && msg.starred.length > 0 && msg.starred.find(function (star) {\n      return star._id === Meteor.userId();\n    }) && !(msg.actionContext === 'starred' || this.context === 'starred');\n  },\n  readReceipt: function () {\n    if (!settings.get('Message_Read_Receipt_Enabled')) {\n      return;\n    }\n\n    return {\n      readByEveryone: !this.msg.unread && 'read' || 'color-component-color'\n    };\n  }\n});\n\nvar hasTempClass = function (node) {\n  return node.classList.contains('temp');\n};\n\nvar getPreviousSentMessage = function (currentNode) {\n  if (hasTempClass(currentNode)) {\n    return currentNode.previousElementSibling;\n  }\n\n  if (currentNode.previousElementSibling != null) {\n    var previousValid = currentNode.previousElementSibling;\n\n    while (previousValid != null && (hasTempClass(previousValid) || !previousValid.classList.contains('message'))) {\n      previousValid = previousValid.previousElementSibling;\n    }\n\n    return previousValid;\n  }\n};\n\nvar isNewDay = function (currentNode, previousNode, forceDate, showDateSeparator) {\n  if (!showDateSeparator) {\n    return false;\n  }\n\n  if (forceDate || !previousNode) {\n    return true;\n  }\n\n  var currentDataset = currentNode.dataset;\n  var previousDataset = previousNode.dataset;\n  var previousMessageDate = new Date(parseInt(previousDataset.timestamp));\n  var currentMessageDate = new Date(parseInt(currentDataset.timestamp));\n\n  if (previousMessageDate.toDateString() !== currentMessageDate.toDateString()) {\n    return true;\n  }\n\n  return false;\n};\n\nvar isSequential = function (currentNode, previousNode, forceDate, period, showDateSeparator, shouldCollapseReplies) {\n  if (!previousNode) {\n    return false;\n  }\n\n  if (showDateSeparator && forceDate) {\n    return false;\n  }\n\n  var currentDataset = currentNode.dataset;\n  var previousDataset = previousNode.dataset;\n  var previousMessageDate = new Date(parseInt(previousDataset.timestamp));\n  var currentMessageDate = new Date(parseInt(currentDataset.timestamp));\n\n  if (showDateSeparator && previousMessageDate.toDateString() !== currentMessageDate.toDateString()) {\n    return false;\n  }\n\n  if (!shouldCollapseReplies && currentDataset.tmid) {\n    return previousDataset.id === currentDataset.tmid || previousDataset.tmid === currentDataset.tmid;\n  }\n\n  if (previousDataset.tmid && !currentDataset.tmid) {\n    return false;\n  }\n\n  if ([previousDataset.groupable, currentDataset.groupable].includes('false')) {\n    return false;\n  }\n\n  if (previousDataset.username !== currentDataset.username) {\n    return false;\n  }\n\n  if (previousDataset.alias !== currentDataset.alias) {\n    return false;\n  }\n\n  if (parseInt(currentDataset.timestamp) - parseInt(previousDataset.timestamp) <= period) {\n    return true;\n  }\n\n  return false;\n};\n\nvar processSequentials = function (_ref4) {\n  var index = _ref4.index,\n      currentNode = _ref4.currentNode,\n      settings = _ref4.settings,\n      forceDate = _ref4.forceDate,\n      _ref4$showDateSeparat = _ref4.showDateSeparator,\n      showDateSeparator = _ref4$showDateSeparat === void 0 ? true : _ref4$showDateSeparat,\n      groupable = _ref4.groupable,\n      shouldCollapseReplies = _ref4.shouldCollapseReplies;\n\n  if (!showDateSeparator && !groupable) {\n    return;\n  } // const currentDataset = currentNode.dataset;\n\n\n  var previousNode = (index === undefined || index > 0) && getPreviousSentMessage(currentNode);\n  var nextNode = currentNode.nextElementSibling;\n\n  if (!previousNode) {\n    setTimeout(function () {\n      currentNode.dispatchEvent(new CustomEvent('MessageGroup', {\n        bubbles: true\n      }));\n    }, 100);\n  }\n\n  if (isSequential(currentNode, previousNode, forceDate, settings.Message_GroupingPeriod, showDateSeparator, shouldCollapseReplies)) {\n    currentNode.classList.add('sequential');\n  } else {\n    currentNode.classList.remove('sequential');\n  }\n\n  if (isNewDay(currentNode, previousNode, forceDate, showDateSeparator)) {\n    currentNode.classList.add('new-day');\n  } else {\n    currentNode.classList.remove('new-day');\n  }\n\n  if (nextNode && nextNode.dataset) {\n    if (isSequential(nextNode, currentNode, forceDate, settings.Message_GroupingPeriod, showDateSeparator, shouldCollapseReplies)) {\n      nextNode.classList.add('sequential');\n    } else {\n      nextNode.classList.remove('sequential');\n    }\n\n    if (isNewDay(nextNode, currentNode, forceDate, showDateSeparator)) {\n      nextNode.classList.add('new-day');\n    } else {\n      nextNode.classList.remove('new-day');\n    }\n  }\n};\n\nTemplate.message.onRendered(function () {\n  var currentNode = this.firstNode;\n  this.autorun(function () {\n    return processSequentials(_objectSpread({\n      currentNode: currentNode\n    }, Template.currentData()));\n  });\n});","map":{"version":3,"sources":["app/ui-message/client/message.js"],"names":["_slicedToArray","module","link","default","v","_toConsumableArray","_objectSpread","_","dompurify","Meteor","Tracker","Template","TAPi18n","escapeHTML","timeAgo","formatDateAndTime","normalizeThreadTitle","MessageTypes","MessageAction","RoomRoles","UserRoles","Roles","Markdown","t","AutoTranslate","renderMentions","renderMessageBody","settings","formatTime","formatDate","roomCoordinator","renderBody","msg","searchedText","isSystemMessage","messageType","getType","render","template","message","__","data","sanitize","u","username","Chatops_Username","html","parse","replace","RegExp","str","helpers","enableMessageParserEarlyAdoption","md","unread","subscription","tunread","includes","_id","mention","tunreadUser","all","tunreadGroup","following","replies","indexOf","body","nonreactive","i18nReplyCounter","tcount","i18nDiscussionCounter","dcount","encodeURI","text","broadcast","room","private","isIgnored","ignored","ignoredClass","isDecrypting","e2e","isBot","bot","hasAttachments","attachments","length","roleTags","hideRoles","userRoles","findOne","roomRoles","rid","roles","find","$in","description","$exists","$ne","fields","isGroupable","groupable","allowGroup","tmid","avatarFromUsername","avatar","avatarFromMessage","getName","alias","UI_Use_Real_Name","name","showUsername","own","timestamp","ts","chatops","time","useTimeAgo","date","isTemp","temp","threadMessage","bodyClass","system","returnClass","showTranslated","AutoTranslate_Enabled","autoTranslate","autoTranslateFetching","autoTranslateShowInverse","translations","translateLanguage","translationProvider","instance","providersMetadata","displayName","edited","editedAt","editTime","editedBy","label","i18nLabel","hasOembed","urls","oembedBaseWidget","API_Embed","API_EmbedDisabledFor","split","map","trim","reactions","myUsername","myName","Object","entries","emoji","reaction","myDisplayName","names","displayNames","usernames","selectedDisplayNames","slice","filter","some","unshift","join","toLowerCase","count","userReacted","markUserReaction","hideReactions","isEmpty","hideAddReaction","readOnly","reactWhenReadOnly","hideMessageActions","actionLinks","actionLink","key","extend","id","omit","hideActionLinks","injectMessage","injectIndex","index","injectSettings","className","channelName","roomIcon","getIcon","customClass","fromSearch","actionContext","messageActions","group","ctx","context","messageGroup","getButtons","isSnippet","isThreadReply","_groupable","showreply","shouldHideBody","collapsed","shouldCollapseReplies","isCollapsedThreadReply","collapseSwitchClass","parentMessage","threadMsg","showStar","starred","star","userId","readReceipt","get","readByEveryone","hasTempClass","node","classList","contains","getPreviousSentMessage","currentNode","previousElementSibling","previousValid","isNewDay","previousNode","forceDate","showDateSeparator","currentDataset","dataset","previousDataset","previousMessageDate","Date","parseInt","currentMessageDate","toDateString","isSequential","period","processSequentials","undefined","nextNode","nextElementSibling","setTimeout","dispatchEvent","CustomEvent","bubbles","Message_GroupingPeriod","add","remove","onRendered","firstNode","autorun","currentData"],"mappings":"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","sourcesContent":["import _ from 'underscore';\nimport dompurify from 'dompurify';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { Template } from 'meteor/templating';\nimport { TAPi18n } from 'meteor/rocketchat:tap-i18n';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\n\nimport { timeAgo } from '../../../client/lib/utils/timeAgo';\nimport { formatDateAndTime } from '../../../client/lib/utils/formatDateAndTime';\nimport { normalizeThreadTitle } from '../../threads/client/lib/normalizeThreadTitle';\nimport { MessageTypes, MessageAction } from '../../ui-utils/client';\nimport { RoomRoles, UserRoles, Roles } from '../../models/client';\nimport { Markdown } from '../../markdown/client';\nimport { t } from '../../utils';\nimport { AutoTranslate } from '../../autotranslate/client';\nimport { renderMentions } from '../../mentions/client/client';\nimport { renderMessageBody } from '../../../client/lib/utils/renderMessageBody';\nimport { settings } from '../../settings/client';\nimport { formatTime } from '../../../client/lib/utils/formatTime';\nimport { formatDate } from '../../../client/lib/utils/formatDate';\nimport './messageThread';\nimport './message.html';\nimport { roomCoordinator } from '../../../client/lib/rooms/roomCoordinator';\n\nconst renderBody = (msg, settings) => {\n\tconst searchedText = msg.searchedText ? msg.searchedText : '';\n\tconst isSystemMessage = MessageTypes.isSystemMessage(msg);\n\tconst messageType = MessageTypes.getType(msg) || {};\n\n\tif (messageType.render) {\n\t\tmsg = messageType.render(msg);\n\t} else if (messageType.template) {\n\t\t// render template\n\t} else if (messageType.message) {\n\t\tmsg.msg = escapeHTML(msg.msg);\n\t\tmsg = TAPi18n.__(messageType.message, { ...(typeof messageType.data === 'function' && messageType.data(msg)) });\n\t\tmsg = dompurify.sanitize(msg);\n\t} else if (msg.u && msg.u.username === settings.Chatops_Username) {\n\t\tmsg.html = msg.msg;\n\t\tmsg = renderMentions(msg);\n\t\tmsg = msg.html;\n\t} else {\n\t\tmsg = renderMessageBody(msg);\n\t}\n\n\tif (isSystemMessage) {\n\t\tmsg.html = Markdown.parse(msg.html);\n\t}\n\n\tif (searchedText) {\n\t\tmsg = msg.replace(new RegExp(searchedText, 'gi'), (str) => `<mark>${str}</mark>`);\n\t}\n\n\treturn msg;\n};\n\nTemplate.message.helpers({\n\tenableMessageParserEarlyAdoption() {\n\t\tconst {\n\t\t\tsettings: { enableMessageParserEarlyAdoption },\n\t\t\tmsg,\n\t\t} = this;\n\t\treturn enableMessageParserEarlyAdoption && msg.md;\n\t},\n\tunread() {\n\t\tconst { msg, subscription } = this;\n\t\treturn subscription?.tunread?.includes(msg._id);\n\t},\n\tmention() {\n\t\tconst { msg, subscription } = this;\n\t\treturn subscription?.tunreadUser?.includes(msg._id);\n\t},\n\n\tall() {\n\t\tconst { msg, subscription } = this;\n\t\treturn subscription?.tunreadGroup?.includes(msg._id);\n\t},\n\tfollowing() {\n\t\tconst { msg, u } = this;\n\t\treturn msg.replies && msg.replies.indexOf(u._id) > -1;\n\t},\n\tbody() {\n\t\tconst { msg, settings } = this;\n\t\treturn Tracker.nonreactive(() => renderBody(msg, settings));\n\t},\n\ti18nReplyCounter() {\n\t\tconst { msg } = this;\n\t\tif (msg.tcount === 1) {\n\t\t\treturn 'reply_counter';\n\t\t}\n\t\treturn 'reply_counter_plural';\n\t},\n\ti18nDiscussionCounter() {\n\t\tconst { msg } = this;\n\t\treturn `<span class='reply-counter'>${msg.dcount}</span>`;\n\t},\n\tformatDateAndTime,\n\tencodeURI(text) {\n\t\treturn encodeURI(text);\n\t},\n\tbroadcast() {\n\t\tconst { msg, room = {}, u } = this;\n\t\treturn !msg.private && !msg.t && msg.u._id !== u._id && room && room.broadcast;\n\t},\n\tisIgnored() {\n\t\tconst { ignored, msg } = this;\n\t\tconst isIgnored = typeof ignored !== 'undefined' ? ignored : msg.ignored;\n\t\treturn isIgnored;\n\t},\n\tignoredClass() {\n\t\tconst { ignored, msg } = this;\n\t\tconst isIgnored = typeof ignored !== 'undefined' ? ignored : msg.ignored;\n\t\treturn isIgnored ? 'message--ignored' : '';\n\t},\n\tisDecrypting() {\n\t\tconst { msg } = this;\n\t\treturn msg.e2e === 'pending';\n\t},\n\tisBot() {\n\t\tconst { msg } = this;\n\t\treturn msg.bot && 'bot';\n\t},\n\thasAttachments() {\n\t\tconst { msg } = this;\n\t\treturn msg.attachments?.length;\n\t},\n\troleTags() {\n\t\tconst { msg, hideRoles, settings } = this;\n\t\tif (settings.hideRoles || hideRoles) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (!msg.u || !msg.u._id) {\n\t\t\treturn [];\n\t\t}\n\t\tconst userRoles = UserRoles.findOne(msg.u._id);\n\t\tconst roomRoles = RoomRoles.findOne({\n\t\t\t'u._id': msg.u._id,\n\t\t\t'rid': msg.rid,\n\t\t});\n\t\tconst roles = [...((userRoles && userRoles.roles) || []), ...((roomRoles && roomRoles.roles) || [])];\n\t\treturn Roles.find(\n\t\t\t{\n\t\t\t\t_id: {\n\t\t\t\t\t$in: roles,\n\t\t\t\t},\n\t\t\t\tdescription: {\n\t\t\t\t\t$exists: 1,\n\t\t\t\t\t$ne: '',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\tdescription: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t},\n\tisGroupable() {\n\t\tconst { msg, room = {}, settings, groupable } = this;\n\t\tif (\n\t\t\tgroupable === false ||\n\t\t\tsettings.allowGroup === false ||\n\t\t\troom.broadcast ||\n\t\t\tmsg.groupable === false ||\n\t\t\t(MessageTypes.isSystemMessage(msg) && !msg.tmid)\n\t\t) {\n\t\t\treturn 'false';\n\t\t}\n\t},\n\tavatarFromUsername() {\n\t\tconst { msg } = this;\n\n\t\tif (msg.avatar != null && msg.avatar[0] === '@') {\n\t\t\treturn msg.avatar.replace(/^@/, '');\n\t\t}\n\t},\n\tavatarFromMessage() {\n\t\tconst { msg } = this;\n\t\tif (msg && msg.avatar) {\n\t\t\treturn encodeURI(msg.avatar);\n\t\t}\n\t\treturn '';\n\t},\n\tgetName() {\n\t\tconst { msg, settings } = this;\n\t\tif (msg.alias) {\n\t\t\treturn msg.alias;\n\t\t}\n\t\tif (!msg.u) {\n\t\t\treturn '';\n\t\t}\n\t\treturn (settings.UI_Use_Real_Name && msg.u.name) || msg.u.username;\n\t},\n\tshowUsername() {\n\t\tconst { msg, settings } = this;\n\t\treturn msg.alias || (settings.UI_Use_Real_Name && msg.u && msg.u.name);\n\t},\n\town() {\n\t\tconst { msg, u = {} } = this;\n\t\tif (msg.u && msg.u._id === u._id) {\n\t\t\treturn 'own';\n\t\t}\n\t},\n\tt() {\n\t\tconst { msg } = this;\n\t\treturn msg.t;\n\t},\n\ttimestamp() {\n\t\tconst { msg } = this;\n\t\treturn +msg.ts;\n\t},\n\tchatops() {\n\t\tconst { msg, settings } = this;\n\t\tif (msg.u && msg.u.username === settings.Chatops_Username) {\n\t\t\treturn 'chatops-message';\n\t\t}\n\t},\n\ttime() {\n\t\tconst { msg, timeAgo: useTimeAgo } = this;\n\n\t\treturn useTimeAgo ? timeAgo(msg.ts) : formatTime(msg.ts);\n\t},\n\tdate() {\n\t\tconst { msg } = this;\n\t\treturn formatDate(msg.ts);\n\t},\n\tisTemp() {\n\t\tconst { msg } = this;\n\t\tif (msg.temp === true) {\n\t\t\treturn 'temp';\n\t\t}\n\t},\n\tthreadMessage() {\n\t\tconst { msg } = this;\n\t\treturn normalizeThreadTitle(msg);\n\t},\n\tbodyClass() {\n\t\tconst { msg } = this;\n\t\treturn MessageTypes.isSystemMessage(msg) ? 'color-info-font-color' : 'color-primary-font-color';\n\t},\n\tsystem(returnClass) {\n\t\tconst { msg } = this;\n\t\tif (MessageTypes.isSystemMessage(msg)) {\n\t\t\tif (returnClass) {\n\t\t\t\treturn 'color-info-font-color';\n\t\t\t}\n\t\t\treturn 'system';\n\t\t}\n\t},\n\tshowTranslated() {\n\t\tconst { msg, subscription, settings, u } = this;\n\t\tif (settings.AutoTranslate_Enabled && msg.u && msg.u._id !== u._id && !MessageTypes.isSystemMessage(msg)) {\n\t\t\tconst autoTranslate = subscription && subscription.autoTranslate;\n\t\t\treturn (\n\t\t\t\tmsg.autoTranslateFetching ||\n\t\t\t\t(!!autoTranslate !== !!msg.autoTranslateShowInverse && msg.translations && msg.translations[settings.translateLanguage])\n\t\t\t);\n\t\t}\n\t},\n\ttranslationProvider() {\n\t\tconst instance = Template.instance();\n\t\tconst { translationProvider } = instance.data.msg;\n\t\treturn translationProvider && AutoTranslate.providersMetadata[translationProvider]?.displayName;\n\t},\n\tedited() {\n\t\tconst { msg } = this;\n\t\treturn msg.editedAt && !MessageTypes.isSystemMessage(msg);\n\t},\n\teditTime() {\n\t\tconst { msg } = this;\n\t\treturn msg.editedAt ? formatDateAndTime(msg.editedAt) : '';\n\t},\n\teditedBy() {\n\t\tconst { msg } = this;\n\t\tif (!msg.editedAt) {\n\t\t\treturn '';\n\t\t}\n\t\t// try to return the username of the editor,\n\t\t// otherwise a special \"?\" character that will be\n\t\t// rendered as a special avatar\n\t\treturn (msg.editedBy && msg.editedBy.username) || '?';\n\t},\n\tlabel() {\n\t\tconst { msg } = this;\n\n\t\tif (msg.i18nLabel) {\n\t\t\treturn t(msg.i18nLabel);\n\t\t}\n\t\tif (msg.label) {\n\t\t\treturn msg.label;\n\t\t}\n\t},\n\thasOembed() {\n\t\tconst { msg, settings } = this;\n\t\t// there is no URLs, there is no template to show the oembed (oembed package removed) or oembed is not enable\n\t\tif (!(msg.urls && msg.urls.length > 0) || !Template.oembedBaseWidget || !settings.API_Embed) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// check if oembed is disabled for message's sender\n\t\tif (\n\t\t\t(settings.API_EmbedDisabledFor || '')\n\t\t\t\t.split(',')\n\t\t\t\t.map((username) => username.trim())\n\t\t\t\t.includes(msg.u && msg.u.username)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\treactions() {\n\t\tconst {\n\t\t\tmsg: { reactions = {} },\n\t\t\tu: { username: myUsername, name: myName },\n\t\t} = this;\n\n\t\treturn Object.entries(reactions).map(([emoji, reaction]) => {\n\t\t\tconst myDisplayName = reaction.names ? myName : `@${myUsername}`;\n\t\t\tconst displayNames = reaction.names || reaction.usernames.map((username) => `@${username}`);\n\t\t\tconst selectedDisplayNames = displayNames.slice(0, 15).filter((displayName) => displayName !== myDisplayName);\n\n\t\t\tif (displayNames.some((displayName) => displayName === myDisplayName)) {\n\t\t\t\tselectedDisplayNames.unshift(t('You'));\n\t\t\t}\n\n\t\t\tlet usernames;\n\n\t\t\tif (displayNames.length > 15) {\n\t\t\t\tusernames = `${selectedDisplayNames.join(', ')} ${t('And_more', {\n\t\t\t\t\tlength: displayNames.length - 15,\n\t\t\t\t}).toLowerCase()}`;\n\t\t\t} else if (displayNames.length > 1) {\n\t\t\t\tusernames = `${selectedDisplayNames.slice(0, -1).join(', ')} ${t('and')} ${selectedDisplayNames[selectedDisplayNames.length - 1]}`;\n\t\t\t} else {\n\t\t\t\tusernames = selectedDisplayNames[0];\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\temoji,\n\t\t\t\tcount: displayNames.length,\n\t\t\t\tusernames,\n\t\t\t\treaction: ` ${t('Reacted_with').toLowerCase()} ${emoji}`,\n\t\t\t\tuserReacted: displayNames.indexOf(myDisplayName) > -1,\n\t\t\t};\n\t\t});\n\t},\n\tmarkUserReaction(reaction) {\n\t\tif (reaction.userReacted) {\n\t\t\treturn {\n\t\t\t\tclass: 'selected',\n\t\t\t};\n\t\t}\n\t},\n\thideReactions() {\n\t\tconst { msg } = this;\n\t\tif (_.isEmpty(msg.reactions)) {\n\t\t\treturn 'hidden';\n\t\t}\n\t},\n\thideAddReaction() {\n\t\tconst { room, u, msg, subscription } = this;\n\n\t\tif (!room) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!subscription) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (msg.private) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (roomCoordinator.readOnly(room._id, u) && !room.reactWhenReadOnly) {\n\t\t\treturn true;\n\t\t}\n\t},\n\thideMessageActions() {\n\t\tconst { msg } = this;\n\n\t\treturn msg.private || MessageTypes.isSystemMessage(msg);\n\t},\n\tactionLinks() {\n\t\tconst { msg } = this;\n\t\t// remove 'method_id' and 'params' properties\n\t\treturn _.map(msg.actionLinks, function (actionLink, key) {\n\t\t\treturn _.extend(\n\t\t\t\t{\n\t\t\t\t\tid: key,\n\t\t\t\t},\n\t\t\t\t_.omit(actionLink, 'method_id', 'params'),\n\t\t\t);\n\t\t});\n\t},\n\thideActionLinks() {\n\t\tconst { msg } = this;\n\t\tif (_.isEmpty(msg.actionLinks)) {\n\t\t\treturn 'hidden';\n\t\t}\n\t},\n\tinjectMessage(data, { _id, rid }) {\n\t\tdata.msg = { _id, rid };\n\t},\n\tinjectIndex(data, index) {\n\t\tdata.index = index;\n\t},\n\tinjectSettings(data, settings) {\n\t\tdata.settings = settings;\n\t},\n\tclassName() {\n\t\treturn this.msg.className;\n\t},\n\tchannelName() {\n\t\tconst { subscription } = this;\n\t\t// const subscription = Subscriptions.findOne({ rid: this.rid });\n\t\treturn subscription && subscription.name;\n\t},\n\troomIcon() {\n\t\tconst { room } = this;\n\t\tif (room && room.t === 'd') {\n\t\t\treturn 'at';\n\t\t}\n\t\treturn roomCoordinator.getIcon(room);\n\t},\n\tcustomClass() {\n\t\tconst { customClass } = this;\n\t\treturn customClass;\n\t},\n\tfromSearch() {\n\t\tconst { customClass } = this;\n\t\treturn customClass === 'search';\n\t},\n\tactionContext() {\n\t\tconst { msg } = this;\n\t\treturn msg.actionContext;\n\t},\n\tmessageActions(group) {\n\t\tconst { msg, context: ctx } = this;\n\t\tlet messageGroup = group;\n\t\tlet context = ctx || msg.actionContext;\n\n\t\tif (!group) {\n\t\t\tmessageGroup = 'message';\n\t\t}\n\n\t\tif (!context) {\n\t\t\tcontext = 'message';\n\t\t}\n\n\t\treturn MessageAction.getButtons(this, context, messageGroup);\n\t},\n\tisSnippet() {\n\t\tconst { msg } = this;\n\t\treturn msg.actionContext === 'snippeted';\n\t},\n\tisThreadReply() {\n\t\tconst {\n\t\t\tgroupable,\n\t\t\tmsg: { tmid, t, groupable: _groupable },\n\t\t\tsettings: { showreply },\n\t\t} = this;\n\t\treturn !(groupable === true || _groupable === true) && !!(tmid && showreply && (!t || t === 'e2e'));\n\t},\n\tshouldHideBody() {\n\t\tconst {\n\t\t\tmsg: { tmid, actionContext },\n\t\t\tsettings: { showreply },\n\t\t\tcontext,\n\t\t} = this;\n\t\treturn showreply && tmid && !(actionContext || context);\n\t},\n\tcollapsed() {\n\t\tconst {\n\t\t\tmsg: { tmid, collapsed },\n\t\t\tsettings: { showreply },\n\t\t\tshouldCollapseReplies,\n\t\t} = this;\n\t\tconst isCollapsedThreadReply = shouldCollapseReplies && tmid && showreply && collapsed !== false;\n\t\tif (isCollapsedThreadReply) {\n\t\t\treturn 'collapsed';\n\t\t}\n\t},\n\tcollapseSwitchClass() {\n\t\tconst {\n\t\t\tmsg: { collapsed = true },\n\t\t} = this;\n\t\treturn collapsed ? 'icon-right-dir' : 'icon-down-dir';\n\t},\n\tparentMessage() {\n\t\tconst {\n\t\t\tmsg: { threadMsg },\n\t\t} = this;\n\t\treturn threadMsg;\n\t},\n\tshowStar() {\n\t\tconst { msg } = this;\n\t\treturn (\n\t\t\tmsg.starred &&\n\t\t\tmsg.starred.length > 0 &&\n\t\t\tmsg.starred.find((star) => star._id === Meteor.userId()) &&\n\t\t\t!(msg.actionContext === 'starred' || this.context === 'starred')\n\t\t);\n\t},\n\treadReceipt() {\n\t\tif (!settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\treadByEveryone: (!this.msg.unread && 'read') || 'color-component-color',\n\t\t};\n\t},\n});\n\nconst hasTempClass = (node) => node.classList.contains('temp');\n\nconst getPreviousSentMessage = (currentNode) => {\n\tif (hasTempClass(currentNode)) {\n\t\treturn currentNode.previousElementSibling;\n\t}\n\tif (currentNode.previousElementSibling != null) {\n\t\tlet previousValid = currentNode.previousElementSibling;\n\t\twhile (previousValid != null && (hasTempClass(previousValid) || !previousValid.classList.contains('message'))) {\n\t\t\tpreviousValid = previousValid.previousElementSibling;\n\t\t}\n\t\treturn previousValid;\n\t}\n};\n\nconst isNewDay = (currentNode, previousNode, forceDate, showDateSeparator) => {\n\tif (!showDateSeparator) {\n\t\treturn false;\n\t}\n\n\tif (forceDate || !previousNode) {\n\t\treturn true;\n\t}\n\n\tconst { dataset: currentDataset } = currentNode;\n\tconst { dataset: previousDataset } = previousNode;\n\tconst previousMessageDate = new Date(parseInt(previousDataset.timestamp));\n\tconst currentMessageDate = new Date(parseInt(currentDataset.timestamp));\n\n\tif (previousMessageDate.toDateString() !== currentMessageDate.toDateString()) {\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\nconst isSequential = (currentNode, previousNode, forceDate, period, showDateSeparator, shouldCollapseReplies) => {\n\tif (!previousNode) {\n\t\treturn false;\n\t}\n\n\tif (showDateSeparator && forceDate) {\n\t\treturn false;\n\t}\n\n\tconst { dataset: currentDataset } = currentNode;\n\tconst { dataset: previousDataset } = previousNode;\n\tconst previousMessageDate = new Date(parseInt(previousDataset.timestamp));\n\tconst currentMessageDate = new Date(parseInt(currentDataset.timestamp));\n\n\tif (showDateSeparator && previousMessageDate.toDateString() !== currentMessageDate.toDateString()) {\n\t\treturn false;\n\t}\n\n\tif (!shouldCollapseReplies && currentDataset.tmid) {\n\t\treturn previousDataset.id === currentDataset.tmid || previousDataset.tmid === currentDataset.tmid;\n\t}\n\n\tif (previousDataset.tmid && !currentDataset.tmid) {\n\t\treturn false;\n\t}\n\n\tif ([previousDataset.groupable, currentDataset.groupable].includes('false')) {\n\t\treturn false;\n\t}\n\n\tif (previousDataset.username !== currentDataset.username) {\n\t\treturn false;\n\t}\n\n\tif (previousDataset.alias !== currentDataset.alias) {\n\t\treturn false;\n\t}\n\n\tif (parseInt(currentDataset.timestamp) - parseInt(previousDataset.timestamp) <= period) {\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\nconst processSequentials = ({ index, currentNode, settings, forceDate, showDateSeparator = true, groupable, shouldCollapseReplies }) => {\n\tif (!showDateSeparator && !groupable) {\n\t\treturn;\n\t}\n\t// const currentDataset = currentNode.dataset;\n\tconst previousNode = (index === undefined || index > 0) && getPreviousSentMessage(currentNode);\n\tconst nextNode = currentNode.nextElementSibling;\n\n\tif (!previousNode) {\n\t\tsetTimeout(() => {\n\t\t\tcurrentNode.dispatchEvent(new CustomEvent('MessageGroup', { bubbles: true }));\n\t\t}, 100);\n\t}\n\tif (isSequential(currentNode, previousNode, forceDate, settings.Message_GroupingPeriod, showDateSeparator, shouldCollapseReplies)) {\n\t\tcurrentNode.classList.add('sequential');\n\t} else {\n\t\tcurrentNode.classList.remove('sequential');\n\t}\n\n\tif (isNewDay(currentNode, previousNode, forceDate, showDateSeparator)) {\n\t\tcurrentNode.classList.add('new-day');\n\t} else {\n\t\tcurrentNode.classList.remove('new-day');\n\t}\n\n\tif (nextNode && nextNode.dataset) {\n\t\tif (isSequential(nextNode, currentNode, forceDate, settings.Message_GroupingPeriod, showDateSeparator, shouldCollapseReplies)) {\n\t\t\tnextNode.classList.add('sequential');\n\t\t} else {\n\t\t\tnextNode.classList.remove('sequential');\n\t\t}\n\n\t\tif (isNewDay(nextNode, currentNode, forceDate, showDateSeparator)) {\n\t\t\tnextNode.classList.add('new-day');\n\t\t} else {\n\t\t\tnextNode.classList.remove('new-day');\n\t\t}\n\t}\n};\n\nTemplate.message.onRendered(function () {\n\tconst currentNode = this.firstNode;\n\tthis.autorun(() => processSequentials({ currentNode, ...Template.currentData() }));\n});\n"]},"sourceType":"module","hash":"6cb1c5a5992afb6561dac064ae71a2696461af3b"}
