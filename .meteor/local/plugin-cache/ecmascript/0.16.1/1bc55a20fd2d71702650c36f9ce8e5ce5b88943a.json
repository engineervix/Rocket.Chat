{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/popup/messagePopupSlashCommandPreview.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-message/client/popup/messagePopupSlashCommandPreview.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/popup/messagePopupSlashCommandPreview.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/popup/messagePopupSlashCommandPreview.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/popup/messagePopupSlashCommandPreview.js"}},"code":"var _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 3);\nvar slashCommands;\nmodule.link(\"../../../utils\", {\n  slashCommands: function (v) {\n    slashCommands = v;\n  }\n}, 4);\nvar hasAtLeastOnePermission;\nmodule.link(\"../../../authorization\", {\n  hasAtLeastOnePermission: function (v) {\n    hasAtLeastOnePermission = v;\n  }\n}, 5);\nmodule.link(\"./messagePopupSlashCommandPreview.html\");\nvar keys = {\n  TAB: 9,\n  ENTER: 13,\n  ESC: 27,\n  ARROW_LEFT: 37,\n  ARROW_UP: 38,\n  ARROW_RIGHT: 39,\n  ARROW_DOWN: 40\n};\n\nfunction getCursorPosition(input) {\n  if (!input) {\n    return;\n  }\n\n  if (input.selectionStart) {\n    return input.selectionStart;\n  }\n\n  if (document.selection) {\n    input.focus();\n    var sel = document.selection.createRange();\n    var selLen = document.selection.createRange().text.length;\n    sel.moveStart('character', -input.value.length);\n    return sel.text.length - selLen;\n  }\n}\n\nTemplate.messagePopupSlashCommandPreview.onCreated(function () {\n  this.open = new ReactiveVar(false);\n  this.isLoading = new ReactiveVar(true);\n  this.preview = new ReactiveVar();\n  this.selectedItem = new ReactiveVar();\n  this.commandName = new ReactiveVar('');\n  this.commandArgs = new ReactiveVar(''); // regex ensures a command is entered into the input\n  // such as \"/testing \" before continuing\n\n  this.matchSelectorRegex = /(?:^)(\\/[\\w\\d\\S]+ )[^]*$/;\n  this.selectorRegex = /(\\/[\\w\\d\\S]+ )([^]*)$/;\n  this.replaceRegex = /(\\/[\\w\\d\\S]+ )[^]*$/; // WHAT'S THIS\n\n  this.dragging = false;\n  var template = this;\n  template.fetchPreviews = _.debounce(function () {\n    function _previewFetcher(cmd, args) {\n      var command = cmd;\n      var params = args;\n      var _template$data = template.data,\n          rid = _template$data.rid,\n          tmid = _template$data.tmid;\n      Meteor.call('getSlashCommandPreviews', {\n        cmd: cmd,\n        params: params,\n        msg: {\n          rid: rid,\n          tmid: tmid\n        }\n      }, function (err, preview) {\n        if (err) {\n          return;\n        }\n\n        if (!preview || !Array.isArray(preview.items)) {\n          template.preview.set({\n            i18nTitle: 'No_results_found_for',\n            items: []\n          });\n        } else {\n          template.preview.set(preview);\n        }\n\n        template.commandName.set(command);\n        template.commandArgs.set(params);\n        template.isLoading.set(false);\n        Meteor.defer(function () {\n          template.verifySelection();\n        });\n      });\n    }\n\n    return _previewFetcher;\n  }(), 500);\n\n  template.enterKeyAction = function () {\n    var current = template.find('.popup-item.selected');\n\n    if (!current) {\n      return;\n    }\n\n    var selectedId = current.getAttribute('data-id');\n\n    if (!selectedId) {\n      return;\n    }\n\n    var cmd = template.commandName.curValue;\n    var params = template.commandArgs.curValue;\n\n    if (!cmd || !params) {\n      return;\n    }\n\n    var item = template.preview.curValue.items.find(function (i) {\n      return i.id === selectedId;\n    });\n\n    if (!item) {\n      return;\n    }\n\n    var _template$data2 = template.data,\n        rid = _template$data2.rid,\n        tmid = _template$data2.tmid;\n    Meteor.call('executeSlashCommandPreview', {\n      cmd: cmd,\n      params: params,\n      msg: {\n        rid: rid,\n        tmid: tmid\n      }\n    }, item, function (err) {\n      if (err) {\n        console.warn(err);\n      }\n    });\n    template.open.set(false);\n    template.inputBox.value = '';\n    template.preview.set();\n    template.commandName.set('');\n    template.commandArgs.set('');\n  };\n\n  template.selectionLogic = function () {\n    var inputValueAtCursor = template.inputBox.value.substr(0, getCursorPosition(template.inputBox));\n\n    if (!template.matchSelectorRegex.test(inputValueAtCursor)) {\n      template.open.set(false);\n      return;\n    }\n\n    var matches = inputValueAtCursor.match(template.selectorRegex);\n    var cmd = matches[1].replace('/', '').trim().toLowerCase();\n    var command = slashCommands.commands[cmd]; // Ensure the command they're typing actually exists\n    // And it provides a command preview\n    // And if it provides a permission to check, they have permission to run the command\n\n    var rid = template.data.rid;\n\n    if (!command || !command.providesPreview || command.permission && !hasAtLeastOnePermission(command.permission, rid)) {\n      template.open.set(false);\n      return;\n    }\n\n    var args = matches[2]; // Check to verify there are no additional arguments passed,\n    // Because we we don't care about what it if there isn't\n\n    if (!args) {\n      template.open.set(false);\n      return;\n    } // If they haven't changed a thing, show what we already got\n\n\n    if (template.commandName.curValue === cmd && template.commandArgs.curValue === args && template.preview.curValue) {\n      template.isLoading.set(false);\n      template.open.set(true);\n      return;\n    }\n\n    template.isLoading.set(true);\n    template.open.set(true); // Fetch and display them\n\n    template.fetchPreviews(cmd, args);\n  };\n\n  template.verifySelection = function () {\n    var current = template.find('.popup-item.selected');\n\n    if (!current) {\n      var first = template.find('.popup-item');\n\n      if (first) {\n        first.className += ' selected sidebar-item__popup-active';\n      }\n    }\n  }; // Typing data\n\n\n  template.onInputKeyup = function (event) {\n    if (template.open.curValue === true && event.which === keys.ESC) {\n      template.open.set(false);\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    if (event.which === keys.ARROW_UP || event.which === keys.ARROW_DOWN) {\n      // Arrow up and down are for navigating the choices\n      return;\n    }\n\n    template.selectionLogic();\n  }; // Using the keyboard to navigate the options\n\n\n  template.onInputKeydown = function (event) {\n    if (!template.open.curValue || template.isLoading.curValue) {\n      return;\n    }\n\n    if (event.which === keys.ENTER) {\n      // || event.which === keys.TAB) { <-- does using tab to select make sense?\n      template.enterKeyAction();\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    if (event.which === keys.ARROW_UP) {\n      template.up();\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    if (event.which === keys.ARROW_DOWN) {\n      template.down();\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  };\n\n  template.up = function () {\n    var current = template.find('.popup-item.selected');\n    var previous = $(current).prev('.popup-item')[0] || template.find('.popup-item:last-child');\n\n    if (previous != null) {\n      current.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n      previous.className += ' selected sidebar-item__popup-active';\n    }\n  };\n\n  template.down = function () {\n    var current = template.find('.popup-item.selected');\n    var next = $(current).next('.popup-item')[0] || template.find('.popup-item');\n\n    if (next && next.classList.contains('popup-item')) {\n      current.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n      next.className += ' selected sidebar-item__popup-active';\n    }\n  };\n\n  template.onFocus = function () {\n    template.clickingItem = false;\n\n    if (template.open.curValue) {\n      return;\n    }\n\n    template.selectionLogic();\n  };\n\n  template.onBlur = function () {\n    if (template.clickingItem) {\n      return;\n    }\n\n    return template.open.set(false);\n  };\n});\nTemplate.messagePopupSlashCommandPreview.onRendered(function () {\n  function _messagePopupSlashCommandPreviewRendered() {\n    if (!this.data.getInput) {\n      throw Error('Somethign wrong happened.');\n    }\n\n    this.inputBox = this.data.getInput();\n    $(this.inputBox).on('keyup', this.onInputKeyup.bind(this));\n    $(this.inputBox).on('keydown', this.onInputKeydown.bind(this));\n    $(this.inputBox).on('focus', this.onFocus.bind(this));\n    $(this.inputBox).on('blur', this.onBlur.bind(this));\n    var self = this;\n    self.autorun(function () {\n      setTimeout(self.selectionLogic, 500);\n    });\n  }\n\n  return _messagePopupSlashCommandPreviewRendered;\n}());\nTemplate.messagePopupSlashCommandPreview.onDestroyed(function () {\n  $(this.inputBox).off('keyup', this.onInputKeyup);\n  $(this.inputBox).off('keydown', this.onInputKeydown);\n  $(this.inputBox).off('focus', this.onFocus);\n  $(this.inputBox).off('blur', this.onBlur);\n});\nTemplate.messagePopupSlashCommandPreview.events({\n  'mouseenter .popup-item, mousedown .popup-item, touchstart .popup-item': function (e) {\n    if (e.currentTarget.className.includes('selected')) {\n      return;\n    }\n\n    var template = Template.instance();\n    var current = template.find('.popup-item.selected');\n\n    if (current) {\n      current.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n    }\n\n    e.currentTarget.className += ' selected sidebar-item__popup-active';\n  },\n  'mousedown .popup-item, touchstart .popup-item': function () {\n    var template = Template.instance();\n    template.clickingItem = true;\n  },\n  'mouseup .popup-item, touchend .popup-item': function () {\n    var template = Template.instance();\n\n    if (template.dragging) {\n      template.dragging = false;\n      return;\n    }\n\n    template.clickingItem = false;\n    template.enterKeyAction();\n  },\n  'touchmove .popup-item': function (e) {\n    e.stopPropagation();\n    var template = Template.instance();\n    template.dragging = true;\n  }\n});\nTemplate.messagePopupSlashCommandPreview.helpers({\n  isOpen: function () {\n    return Template.instance().open.get(); // && ((Template.instance().hasData.get() || (Template.instance().data.emptyTemplate != null)) || !Template.instance().parentTemplate(1).subscriptionsReady());\n  },\n  getArgs: function () {\n    return Template.instance().commandArgs.get();\n  },\n  isLoading: function () {\n    return Template.instance().isLoading.get();\n  },\n  isType: function (actual, expected) {\n    return actual === expected;\n  },\n  preview: function () {\n    return Template.instance().preview.get();\n  }\n});","map":{"version":3,"sources":["app/ui-message/client/popup/messagePopupSlashCommandPreview.js"],"names":["_","module","link","v","Meteor","ReactiveVar","Template","slashCommands","hasAtLeastOnePermission","keys","TAB","ENTER","ESC","ARROW_LEFT","ARROW_UP","ARROW_RIGHT","ARROW_DOWN","getCursorPosition","input","selectionStart","document","selection","focus","sel","createRange","selLen","text","length","moveStart","value","messagePopupSlashCommandPreview","onCreated","open","isLoading","preview","selectedItem","commandName","commandArgs","matchSelectorRegex","selectorRegex","replaceRegex","dragging","template","fetchPreviews","debounce","_previewFetcher","cmd","args","command","params","data","rid","tmid","call","msg","err","Array","isArray","items","set","i18nTitle","defer","verifySelection","enterKeyAction","current","find","selectedId","getAttribute","curValue","item","i","id","console","warn","inputBox","selectionLogic","inputValueAtCursor","substr","test","matches","match","replace","trim","toLowerCase","commands","providesPreview","permission","first","className","onInputKeyup","event","which","preventDefault","stopPropagation","onInputKeydown","up","down","previous","$","prev","next","classList","contains","onFocus","clickingItem","onBlur","onRendered","_messagePopupSlashCommandPreviewRendered","getInput","Error","on","bind","self","autorun","setTimeout","onDestroyed","off","events","e","currentTarget","includes","instance","helpers","isOpen","get","getArgs","isType","actual","expected"],"mappings":"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","sourcesContent":["import _ from 'underscore';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Template } from 'meteor/templating';\n\nimport { slashCommands } from '../../../utils';\nimport { hasAtLeastOnePermission } from '../../../authorization';\nimport './messagePopupSlashCommandPreview.html';\n\nconst keys = {\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tARROW_LEFT: 37,\n\tARROW_UP: 38,\n\tARROW_RIGHT: 39,\n\tARROW_DOWN: 40,\n};\n\nfunction getCursorPosition(input) {\n\tif (!input) {\n\t\treturn;\n\t}\n\n\tif (input.selectionStart) {\n\t\treturn input.selectionStart;\n\t}\n\tif (document.selection) {\n\t\tinput.focus();\n\t\tconst sel = document.selection.createRange();\n\t\tconst selLen = document.selection.createRange().text.length;\n\t\tsel.moveStart('character', -input.value.length);\n\t\treturn sel.text.length - selLen;\n\t}\n}\n\nTemplate.messagePopupSlashCommandPreview.onCreated(function () {\n\tthis.open = new ReactiveVar(false);\n\tthis.isLoading = new ReactiveVar(true);\n\tthis.preview = new ReactiveVar();\n\tthis.selectedItem = new ReactiveVar();\n\tthis.commandName = new ReactiveVar('');\n\tthis.commandArgs = new ReactiveVar('');\n\n\t// regex ensures a command is entered into the input\n\t// such as \"/testing \" before continuing\n\tthis.matchSelectorRegex = /(?:^)(\\/[\\w\\d\\S]+ )[^]*$/;\n\tthis.selectorRegex = /(\\/[\\w\\d\\S]+ )([^]*)$/;\n\tthis.replaceRegex = /(\\/[\\w\\d\\S]+ )[^]*$/; // WHAT'S THIS\n\n\tthis.dragging = false;\n\n\tconst template = this;\n\ttemplate.fetchPreviews = _.debounce(function _previewFetcher(cmd, args) {\n\t\tconst command = cmd;\n\t\tconst params = args;\n\t\tconst { rid, tmid } = template.data;\n\t\tMeteor.call('getSlashCommandPreviews', { cmd, params, msg: { rid, tmid } }, function (err, preview) {\n\t\t\tif (err) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!preview || !Array.isArray(preview.items)) {\n\t\t\t\ttemplate.preview.set({\n\t\t\t\t\ti18nTitle: 'No_results_found_for',\n\t\t\t\t\titems: [],\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\ttemplate.preview.set(preview);\n\t\t\t}\n\n\t\t\ttemplate.commandName.set(command);\n\t\t\ttemplate.commandArgs.set(params);\n\t\t\ttemplate.isLoading.set(false);\n\n\t\t\tMeteor.defer(function () {\n\t\t\t\ttemplate.verifySelection();\n\t\t\t});\n\t\t});\n\t}, 500);\n\n\ttemplate.enterKeyAction = () => {\n\t\tconst current = template.find('.popup-item.selected');\n\n\t\tif (!current) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedId = current.getAttribute('data-id');\n\n\t\tif (!selectedId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cmd = template.commandName.curValue;\n\t\tconst params = template.commandArgs.curValue;\n\n\t\tif (!cmd || !params) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = template.preview.curValue.items.find((i) => i.id === selectedId);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rid, tmid } = template.data;\n\t\tMeteor.call('executeSlashCommandPreview', { cmd, params, msg: { rid, tmid } }, item, function (err) {\n\t\t\tif (err) {\n\t\t\t\tconsole.warn(err);\n\t\t\t}\n\t\t});\n\n\t\ttemplate.open.set(false);\n\t\ttemplate.inputBox.value = '';\n\t\ttemplate.preview.set();\n\t\ttemplate.commandName.set('');\n\t\ttemplate.commandArgs.set('');\n\t};\n\n\ttemplate.selectionLogic = () => {\n\t\tconst inputValueAtCursor = template.inputBox.value.substr(0, getCursorPosition(template.inputBox));\n\n\t\tif (!template.matchSelectorRegex.test(inputValueAtCursor)) {\n\t\t\ttemplate.open.set(false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst matches = inputValueAtCursor.match(template.selectorRegex);\n\t\tconst cmd = matches[1].replace('/', '').trim().toLowerCase();\n\t\tconst command = slashCommands.commands[cmd];\n\n\t\t// Ensure the command they're typing actually exists\n\t\t// And it provides a command preview\n\t\t// And if it provides a permission to check, they have permission to run the command\n\t\tconst { rid } = template.data;\n\t\tif (!command || !command.providesPreview || (command.permission && !hasAtLeastOnePermission(command.permission, rid))) {\n\t\t\ttemplate.open.set(false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst args = matches[2];\n\n\t\t// Check to verify there are no additional arguments passed,\n\t\t// Because we we don't care about what it if there isn't\n\t\tif (!args) {\n\t\t\ttemplate.open.set(false);\n\t\t\treturn;\n\t\t}\n\n\t\t// If they haven't changed a thing, show what we already got\n\t\tif (template.commandName.curValue === cmd && template.commandArgs.curValue === args && template.preview.curValue) {\n\t\t\ttemplate.isLoading.set(false);\n\t\t\ttemplate.open.set(true);\n\t\t\treturn;\n\t\t}\n\n\t\ttemplate.isLoading.set(true);\n\t\ttemplate.open.set(true);\n\n\t\t// Fetch and display them\n\t\ttemplate.fetchPreviews(cmd, args);\n\t};\n\n\ttemplate.verifySelection = () => {\n\t\tconst current = template.find('.popup-item.selected');\n\n\t\tif (!current) {\n\t\t\tconst first = template.find('.popup-item');\n\n\t\t\tif (first) {\n\t\t\t\tfirst.className += ' selected sidebar-item__popup-active';\n\t\t\t}\n\t\t}\n\t};\n\n\t// Typing data\n\ttemplate.onInputKeyup = (event) => {\n\t\tif (template.open.curValue === true && event.which === keys.ESC) {\n\t\t\ttemplate.open.set(false);\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ARROW_UP || event.which === keys.ARROW_DOWN) {\n\t\t\t// Arrow up and down are for navigating the choices\n\t\t\treturn;\n\t\t}\n\n\t\ttemplate.selectionLogic();\n\t};\n\n\t// Using the keyboard to navigate the options\n\ttemplate.onInputKeydown = (event) => {\n\t\tif (!template.open.curValue || template.isLoading.curValue) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ENTER) {\n\t\t\t// || event.which === keys.TAB) { <-- does using tab to select make sense?\n\t\t\ttemplate.enterKeyAction();\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ARROW_UP) {\n\t\t\ttemplate.up();\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ARROW_DOWN) {\n\t\t\ttemplate.down();\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\ttemplate.up = () => {\n\t\tconst current = template.find('.popup-item.selected');\n\t\tconst previous = $(current).prev('.popup-item')[0] || template.find('.popup-item:last-child');\n\n\t\tif (previous != null) {\n\t\t\tcurrent.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n\t\t\tprevious.className += ' selected sidebar-item__popup-active';\n\t\t}\n\t};\n\n\ttemplate.down = () => {\n\t\tconst current = template.find('.popup-item.selected');\n\t\tconst next = $(current).next('.popup-item')[0] || template.find('.popup-item');\n\n\t\tif (next && next.classList.contains('popup-item')) {\n\t\t\tcurrent.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n\t\t\tnext.className += ' selected sidebar-item__popup-active';\n\t\t}\n\t};\n\n\ttemplate.onFocus = () => {\n\t\ttemplate.clickingItem = false;\n\t\tif (template.open.curValue) {\n\t\t\treturn;\n\t\t}\n\n\t\ttemplate.selectionLogic();\n\t};\n\n\ttemplate.onBlur = () => {\n\t\tif (template.clickingItem) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn template.open.set(false);\n\t};\n});\n\nTemplate.messagePopupSlashCommandPreview.onRendered(function _messagePopupSlashCommandPreviewRendered() {\n\tif (!this.data.getInput) {\n\t\tthrow Error('Somethign wrong happened.');\n\t}\n\n\tthis.inputBox = this.data.getInput();\n\t$(this.inputBox).on('keyup', this.onInputKeyup.bind(this));\n\t$(this.inputBox).on('keydown', this.onInputKeydown.bind(this));\n\t$(this.inputBox).on('focus', this.onFocus.bind(this));\n\t$(this.inputBox).on('blur', this.onBlur.bind(this));\n\n\tconst self = this;\n\tself.autorun(() => {\n\t\tsetTimeout(self.selectionLogic, 500);\n\t});\n});\n\nTemplate.messagePopupSlashCommandPreview.onDestroyed(function () {\n\t$(this.inputBox).off('keyup', this.onInputKeyup);\n\t$(this.inputBox).off('keydown', this.onInputKeydown);\n\t$(this.inputBox).off('focus', this.onFocus);\n\t$(this.inputBox).off('blur', this.onBlur);\n});\n\nTemplate.messagePopupSlashCommandPreview.events({\n\t'mouseenter .popup-item, mousedown .popup-item, touchstart .popup-item'(e) {\n\t\tif (e.currentTarget.className.includes('selected')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst template = Template.instance();\n\t\tconst current = template.find('.popup-item.selected');\n\t\tif (current) {\n\t\t\tcurrent.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n\t\t}\n\n\t\te.currentTarget.className += ' selected sidebar-item__popup-active';\n\t},\n\t'mousedown .popup-item, touchstart .popup-item'() {\n\t\tconst template = Template.instance();\n\t\ttemplate.clickingItem = true;\n\t},\n\t'mouseup .popup-item, touchend .popup-item'() {\n\t\tconst template = Template.instance();\n\t\tif (template.dragging) {\n\t\t\ttemplate.dragging = false;\n\t\t\treturn;\n\t\t}\n\n\t\ttemplate.clickingItem = false;\n\t\ttemplate.enterKeyAction();\n\t},\n\t'touchmove .popup-item'(e) {\n\t\te.stopPropagation();\n\t\tconst template = Template.instance();\n\t\ttemplate.dragging = true;\n\t},\n});\n\nTemplate.messagePopupSlashCommandPreview.helpers({\n\tisOpen() {\n\t\treturn Template.instance().open.get(); // && ((Template.instance().hasData.get() || (Template.instance().data.emptyTemplate != null)) || !Template.instance().parentTemplate(1).subscriptionsReady());\n\t},\n\tgetArgs() {\n\t\treturn Template.instance().commandArgs.get();\n\t},\n\tisLoading() {\n\t\treturn Template.instance().isLoading.get();\n\t},\n\tisType(actual, expected) {\n\t\treturn actual === expected;\n\t},\n\tpreview() {\n\t\treturn Template.instance().preview.get();\n\t},\n});\n"]},"sourceType":"module","hash":"1bc55a20fd2d71702650c36f9ce8e5ce5b88943a"}
