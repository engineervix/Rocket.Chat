{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/iframeCommands.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui/client/lib/iframeCommands.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/iframeCommands.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/iframeCommands.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/iframeCommands.js"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter(v) {\n    FlowRouter = v;\n  }\n\n}, 1);\nlet ServiceConfiguration;\nmodule.link(\"meteor/service-configuration\", {\n  ServiceConfiguration(v) {\n    ServiceConfiguration = v;\n  }\n\n}, 2);\nlet s;\nmodule.link(\"underscore.string\", {\n  default(v) {\n    s = v;\n  }\n\n}, 3);\nlet escapeRegExp;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeRegExp(v) {\n    escapeRegExp = v;\n  }\n\n}, 4);\nlet AccountBox;\nmodule.link(\"../../../ui-utils\", {\n  AccountBox(v) {\n    AccountBox = v;\n  }\n\n}, 5);\nlet settings;\nmodule.link(\"../../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 6);\nlet callbacks;\nmodule.link(\"../../../../lib/callbacks\", {\n  callbacks(v) {\n    callbacks = v;\n  }\n\n}, 7);\nlet add, remove;\nmodule.link(\"../../../../client/views/room/lib/Toolbox/IframeButtons\", {\n  add(v) {\n    add = v;\n  },\n\n  remove(v) {\n    remove = v;\n  }\n\n}, 8);\nlet baseURI;\nmodule.link(\"../../../../client/lib/baseURI\", {\n  baseURI(v) {\n    baseURI = v;\n  }\n\n}, 9);\nconst commands = {\n  'go'(data) {\n    if (typeof data.path !== 'string' || data.path.trim().length === 0) {\n      return console.error('`path` not defined');\n    }\n\n    const newUrl = new URL(\"\".concat(s.rtrim(baseURI, '/'), \"/\").concat(s.ltrim(data.path, '/')));\n    const newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, _ref) => {\n      let [key, value] = _ref;\n      ret[key] = value;\n      return ret;\n    }, {});\n    const newPath = newUrl.pathname.replace(new RegExp(\"^\".concat(escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX))), '');\n    FlowRouter.go(newPath, null, _objectSpread(_objectSpread({}, FlowRouter.current().queryParams), newParams));\n  },\n\n  'set-user-status'(data) {\n    AccountBox.setStatus(data.status);\n  },\n\n  'call-custom-oauth-login'(data, event) {\n    const customOAuthCallback = response => {\n      event.source.postMessage({\n        event: 'custom-oauth-callback',\n        response\n      }, event.origin);\n    };\n\n    const siteUrl = \"\".concat(Meteor.settings.Site_Url, \"/\");\n\n    if (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n      data.redirectUrl = null;\n    }\n\n    if (typeof data.service === 'string' && window.ServiceConfiguration) {\n      const customOauth = ServiceConfiguration.configurations.findOne({\n        service: data.service\n      });\n\n      if (customOauth) {\n        const customLoginWith = Meteor[\"loginWith\".concat(s.capitalize(customOauth.service, true))];\n        const customRedirectUri = data.redirectUrl || siteUrl;\n        customLoginWith.call(Meteor, {\n          redirectUrl: customRedirectUri\n        }, customOAuthCallback);\n      }\n    }\n  },\n\n  'login-with-token'(data) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    if (typeof data.token === 'string') {\n      Meteor.loginWithToken(data.token, function () {\n        console.log('Iframe command [login-with-token]: result', [data, ...args]);\n      });\n    }\n  },\n\n  'logout'() {\n    const user = Meteor.user();\n    Meteor.logout(() => {\n      callbacks.run('afterLogoutCleanUp', user);\n      Meteor.call('logoutCleanUp', user);\n      return FlowRouter.go('home');\n    });\n  },\n\n  'set-toolbar-button'(_ref2) {\n    let {\n      id,\n      icon,\n      label\n    } = _ref2;\n    add(id, {\n      id,\n      icon,\n      label\n    });\n  },\n\n  'remove-toolbar-button'(_ref3) {\n    let {\n      id\n    } = _ref3;\n    remove(id);\n  }\n\n};\nwindow.addEventListener('message', e => {\n  if (settings.get('Iframe_Integration_receive_enable') !== true) {\n    return;\n  }\n\n  if (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n    return;\n  }\n\n  const origins = settings.get('Iframe_Integration_receive_origin');\n\n  if (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n    return console.error('Origin not allowed', e.origin);\n  }\n\n  const command = commands[e.data.externalCommand];\n\n  if (command) {\n    command(e.data, e);\n  }\n});","map":{"version":3,"sources":["app/ui/client/lib/iframeCommands.js"],"names":["_objectSpread","module","link","default","v","Meteor","FlowRouter","ServiceConfiguration","s","escapeRegExp","AccountBox","settings","callbacks","add","remove","baseURI","commands","data","path","trim","length","console","error","newUrl","URL","rtrim","ltrim","newParams","Array","from","searchParams","entries","reduce","ret","key","value","newPath","pathname","replace","RegExp","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","go","current","queryParams","setStatus","status","event","customOAuthCallback","response","source","postMessage","origin","siteUrl","Site_Url","redirectUrl","startsWith","service","window","customOauth","configurations","findOne","customLoginWith","capitalize","customRedirectUri","call","args","token","loginWithToken","log","user","logout","run","id","icon","label","addEventListener","e","get","externalCommand","origins","split","indexOf","command"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { ServiceConfiguration } from 'meteor/service-configuration';\nimport s from 'underscore.string';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\n\nimport { AccountBox } from '../../../ui-utils';\nimport { settings } from '../../../settings';\nimport { callbacks } from '../../../../lib/callbacks';\nimport { add, remove } from '../../../../client/views/room/lib/Toolbox/IframeButtons';\nimport { baseURI } from '../../../../client/lib/baseURI';\n\nconst commands = {\n\t'go'(data) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tconst newUrl = new URL(`${s.rtrim(baseURI, '/')}/${s.ltrim(data.path, '/')}`);\n\n\t\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, [key, value]) => {\n\t\t\tret[key] = value;\n\t\t\treturn ret;\n\t\t}, {});\n\n\t\tconst newPath = newUrl.pathname.replace(new RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`), '');\n\t\tFlowRouter.go(newPath, null, { ...FlowRouter.current().queryParams, ...newParams });\n\t},\n\n\t'set-user-status'(data) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data, event) {\n\t\tconst customOAuthCallback = (response) => {\n\t\t\tevent.source.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\t\tresponse,\n\t\t\t\t},\n\t\t\t\tevent.origin,\n\t\t\t);\n\t\t};\n\n\t\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = ServiceConfiguration.configurations.findOne({ service: data.service });\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = Meteor[`loginWith${s.capitalize(customOauth.service, true)}`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data, ...args) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, function () {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', [data, ...args]);\n\t\t\t});\n\t\t}\n\t},\n\n\t'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tcallbacks.run('afterLogoutCleanUp', user);\n\t\t\tMeteor.call('logoutCleanUp', user);\n\t\t\treturn FlowRouter.go('home');\n\t\t});\n\t},\n\n\t'set-toolbar-button'({ id, icon, label }) {\n\t\tadd(id, { id, icon, label });\n\t},\n\t'remove-toolbar-button'({ id }) {\n\t\tremove(id);\n\t},\n};\n\nwindow.addEventListener('message', (e) => {\n\tif (settings.get('Iframe_Integration_receive_enable') !== true) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = settings.get('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\treturn console.error('Origin not allowed', e.origin);\n\t}\n\n\tconst command = commands[e.data.externalCommand];\n\tif (command) {\n\t\tcommand(e.data, e);\n\t}\n});\n"]},"sourceType":"module","hash":"c1daca71261b8a5f03e44150ebc16e61d60e042b"}
