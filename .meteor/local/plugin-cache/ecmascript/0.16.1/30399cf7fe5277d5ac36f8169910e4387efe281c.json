{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/helpers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/admin/apps/helpers.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/helpers.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/helpers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/apps/helpers.js"}},"code":"module.export({\n  appEnabledStatuses: function () {\n    return appEnabledStatuses;\n  },\n  apiCurlGetter: function () {\n    return apiCurlGetter;\n  },\n  handleInstallError: function () {\n    return handleInstallError;\n  },\n  handleAPIError: function () {\n    return handleAPIError;\n  },\n  warnStatusChange: function () {\n    return warnStatusChange;\n  },\n  appButtonProps: function () {\n    return appButtonProps;\n  },\n  appStatusSpanProps: function () {\n    return appStatusSpanProps;\n  },\n  formatPrice: function () {\n    return formatPrice;\n  },\n  formatPricingPlan: function () {\n    return formatPricingPlan;\n  }\n});\nvar AppStatus;\nmodule.link(\"@rocket.chat/apps-engine/definition/AppStatus\", {\n  AppStatus: function (v) {\n    AppStatus = v;\n  }\n}, 0);\nvar semver;\nmodule.link(\"semver\", {\n  \"default\": function (v) {\n    semver = v;\n  }\n}, 1);\nvar Utilities;\nmodule.link(\"../../../../app/apps/lib/misc/Utilities\", {\n  Utilities: function (v) {\n    Utilities = v;\n  }\n}, 2);\nvar t;\nmodule.link(\"../../../../app/utils/client\", {\n  t: function (v) {\n    t = v;\n  }\n}, 3);\nvar dispatchToastMessage;\nmodule.link(\"../../../lib/toast\", {\n  dispatchToastMessage: function (v) {\n    dispatchToastMessage = v;\n  }\n}, 4);\nvar appEnabledStatuses = [AppStatus.AUTO_ENABLED, AppStatus.MANUALLY_ENABLED];\nvar appErroredStatuses = [AppStatus.COMPILER_ERROR_DISABLED, AppStatus.ERROR_DISABLED, AppStatus.INVALID_SETTINGS_DISABLED, AppStatus.INVALID_LICENSE_DISABLED];\n\nvar apiCurlGetter = function (absoluteUrl) {\n  return function (method, api) {\n    var example = api.examples[method] || {};\n    return Utilities.curl({\n      url: absoluteUrl(api.computedPath),\n      method: method,\n      params: example.params,\n      query: example.query,\n      content: example.content,\n      headers: example.headers\n    }).split('\\n');\n  };\n};\n\nfunction handleInstallError(apiError) {\n  if (!apiError.xhr || !apiError.xhr.responseJSON) {\n    return;\n  }\n\n  var _apiError$xhr$respons = apiError.xhr.responseJSON,\n      status = _apiError$xhr$respons.status,\n      messages = _apiError$xhr$respons.messages,\n      error = _apiError$xhr$respons.error,\n      _apiError$xhr$respons2 = _apiError$xhr$respons.payload,\n      payload = _apiError$xhr$respons2 === void 0 ? null : _apiError$xhr$respons2;\n  var message;\n\n  switch (status) {\n    case 'storage_error':\n      message = messages.join('');\n      break;\n\n    case 'app_user_error':\n      message = messages.join('');\n\n      if (payload && payload.username) {\n        message = t('Apps_User_Already_Exists', {\n          username: payload.username\n        });\n      }\n\n      break;\n\n    default:\n      if (error) {\n        message = error;\n      } else {\n        message = 'There has been an error installing the app';\n      }\n\n  }\n\n  dispatchToastMessage({\n    type: 'error',\n    message: message\n  });\n}\n\nvar shouldHandleErrorAsWarning = function (message) {\n  var warnings = ['Could not reach the Marketplace'];\n  return warnings.includes(message);\n};\n\nvar handleAPIError = function (error) {\n  var message = error.xhr && error.xhr.responseJSON && error.xhr.responseJSON.error || error.message;\n\n  if (shouldHandleErrorAsWarning(message)) {\n    dispatchToastMessage({\n      type: 'warning',\n      message: message\n    });\n    return;\n  }\n\n  dispatchToastMessage({\n    type: 'error',\n    message: message\n  });\n};\n\nvar warnStatusChange = function (appName, status) {\n  if (appErroredStatuses.includes(status)) {\n    dispatchToastMessage({\n      type: 'error',\n      message: (t(\"App_status_\" + status), appName)\n    });\n    return;\n  }\n\n  dispatchToastMessage({\n    type: 'info',\n    message: (t(\"App_status_\" + status), appName)\n  });\n};\n\nvar appButtonProps = function (_ref) {\n  var installed = _ref.installed,\n      version = _ref.version,\n      marketplaceVersion = _ref.marketplaceVersion,\n      isPurchased = _ref.isPurchased,\n      price = _ref.price,\n      purchaseType = _ref.purchaseType,\n      subscriptionInfo = _ref.subscriptionInfo,\n      pricingPlans = _ref.pricingPlans,\n      isEnterpriseOnly = _ref.isEnterpriseOnly;\n  var canUpdate = installed && version && marketplaceVersion && semver.lt(version, marketplaceVersion);\n\n  if (canUpdate) {\n    return {\n      action: 'update',\n      icon: 'reload',\n      label: 'Update'\n    };\n  }\n\n  if (installed) {\n    return;\n  }\n\n  var canDownload = isPurchased;\n\n  if (canDownload) {\n    return {\n      action: 'install',\n      label: 'Install'\n    };\n  }\n\n  var canSubscribe = purchaseType === 'subscription' && !subscriptionInfo.status;\n\n  if (canSubscribe) {\n    var cannotTry = pricingPlans.every(function (currentPricingPlan) {\n      return currentPricingPlan.trialDays === 0;\n    });\n\n    if (cannotTry || isEnterpriseOnly) {\n      return {\n        action: 'purchase',\n        label: 'Subscribe'\n      };\n    }\n\n    return {\n      action: 'purchase',\n      label: 'Trial'\n    };\n  }\n\n  var canBuy = price > 0;\n\n  if (canBuy) {\n    return {\n      action: 'purchase',\n      label: 'Buy'\n    };\n  }\n\n  return {\n    action: 'purchase',\n    label: 'Install'\n  };\n};\n\nvar appStatusSpanProps = function (_ref2) {\n  var installed = _ref2.installed,\n      status = _ref2.status,\n      subscriptionInfo = _ref2.subscriptionInfo;\n\n  if (!installed) {\n    return;\n  }\n\n  var isFailed = appErroredStatuses.includes(status);\n\n  if (isFailed) {\n    return {\n      type: 'failed',\n      icon: 'warning',\n      label: status === AppStatus.INVALID_SETTINGS_DISABLED ? 'Config Needed' : 'Failed'\n    };\n  }\n\n  var isEnabled = appEnabledStatuses.includes(status);\n\n  if (!isEnabled) {\n    return {\n      type: 'warning',\n      icon: 'warning',\n      label: 'Disabled'\n    };\n  }\n\n  var isOnTrialPeriod = subscriptionInfo && subscriptionInfo.status === 'trialing';\n\n  if (isOnTrialPeriod) {\n    return {\n      icon: 'checkmark-circled',\n      label: 'Trial period'\n    };\n  }\n\n  return {\n    icon: 'checkmark-circled',\n    label: 'Enabled'\n  };\n};\n\nvar formatPrice = function (price) {\n  return \"$\" + Number.parseFloat(price).toFixed(2);\n};\n\nvar formatPricingPlan = function (_ref3) {\n  var strategy = _ref3.strategy,\n      price = _ref3.price,\n      _ref3$tiers = _ref3.tiers,\n      tiers = _ref3$tiers === void 0 ? [] : _ref3$tiers;\n\n  var _ref4 = Array.isArray(tiers) && tiers.find(function (tier) {\n    return tier.price === price;\n  }) || {},\n      _ref4$perUnit = _ref4.perUnit,\n      perUnit = _ref4$perUnit === void 0 ? false : _ref4$perUnit;\n\n  var pricingPlanTranslationString = ['Apps_Marketplace_pricingPlan', Array.isArray(tiers) && tiers.length > 0 && 'startingAt', strategy, perUnit && 'perUser'].filter(Boolean).join('_');\n  return t(pricingPlanTranslationString, {\n    price: formatPrice(price)\n  });\n};","map":{"version":3,"sources":["client/views/admin/apps/helpers.js"],"names":["module","export","appEnabledStatuses","apiCurlGetter","handleInstallError","handleAPIError","warnStatusChange","appButtonProps","appStatusSpanProps","formatPrice","formatPricingPlan","AppStatus","link","v","semver","Utilities","t","dispatchToastMessage","AUTO_ENABLED","MANUALLY_ENABLED","appErroredStatuses","COMPILER_ERROR_DISABLED","ERROR_DISABLED","INVALID_SETTINGS_DISABLED","INVALID_LICENSE_DISABLED","absoluteUrl","method","api","example","examples","curl","url","computedPath","params","query","content","headers","split","apiError","xhr","responseJSON","status","messages","error","payload","message","join","username","type","shouldHandleErrorAsWarning","warnings","includes","appName","installed","version","marketplaceVersion","isPurchased","price","purchaseType","subscriptionInfo","pricingPlans","isEnterpriseOnly","canUpdate","lt","action","icon","label","canDownload","canSubscribe","cannotTry","every","currentPricingPlan","trialDays","canBuy","isFailed","isEnabled","isOnTrialPeriod","Number","parseFloat","toFixed","strategy","tiers","Array","isArray","find","tier","perUnit","pricingPlanTranslationString","length","filter","Boolean"],"mappings":"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","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport semver from 'semver';\n\nimport { Utilities } from '../../../../app/apps/lib/misc/Utilities';\nimport { t } from '../../../../app/utils/client';\nimport { dispatchToastMessage } from '../../../lib/toast';\n\nexport const appEnabledStatuses = [AppStatus.AUTO_ENABLED, AppStatus.MANUALLY_ENABLED];\n\nconst appErroredStatuses = [\n\tAppStatus.COMPILER_ERROR_DISABLED,\n\tAppStatus.ERROR_DISABLED,\n\tAppStatus.INVALID_SETTINGS_DISABLED,\n\tAppStatus.INVALID_LICENSE_DISABLED,\n];\n\nexport const apiCurlGetter = (absoluteUrl) => (method, api) => {\n\tconst example = api.examples[method] || {};\n\treturn Utilities.curl({\n\t\turl: absoluteUrl(api.computedPath),\n\t\tmethod,\n\t\tparams: example.params,\n\t\tquery: example.query,\n\t\tcontent: example.content,\n\t\theaders: example.headers,\n\t}).split('\\n');\n};\n\nexport function handleInstallError(apiError) {\n\tif (!apiError.xhr || !apiError.xhr.responseJSON) {\n\t\treturn;\n\t}\n\n\tconst { status, messages, error, payload = null } = apiError.xhr.responseJSON;\n\n\tlet message;\n\n\tswitch (status) {\n\t\tcase 'storage_error':\n\t\t\tmessage = messages.join('');\n\t\t\tbreak;\n\t\tcase 'app_user_error':\n\t\t\tmessage = messages.join('');\n\t\t\tif (payload && payload.username) {\n\t\t\t\tmessage = t('Apps_User_Already_Exists', { username: payload.username });\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (error) {\n\t\t\t\tmessage = error;\n\t\t\t} else {\n\t\t\t\tmessage = 'There has been an error installing the app';\n\t\t\t}\n\t}\n\n\tdispatchToastMessage({ type: 'error', message });\n}\n\nconst shouldHandleErrorAsWarning = (message) => {\n\tconst warnings = ['Could not reach the Marketplace'];\n\n\treturn warnings.includes(message);\n};\n\nexport const handleAPIError = (error) => {\n\tconst message = (error.xhr && error.xhr.responseJSON && error.xhr.responseJSON.error) || error.message;\n\n\tif (shouldHandleErrorAsWarning(message)) {\n\t\tdispatchToastMessage({ type: 'warning', message });\n\t\treturn;\n\t}\n\n\tdispatchToastMessage({ type: 'error', message });\n};\n\nexport const warnStatusChange = (appName, status) => {\n\tif (appErroredStatuses.includes(status)) {\n\t\tdispatchToastMessage({ type: 'error', message: (t(`App_status_${status}`), appName) });\n\t\treturn;\n\t}\n\n\tdispatchToastMessage({ type: 'info', message: (t(`App_status_${status}`), appName) });\n};\n\nexport const appButtonProps = ({\n\tinstalled,\n\tversion,\n\tmarketplaceVersion,\n\tisPurchased,\n\tprice,\n\tpurchaseType,\n\tsubscriptionInfo,\n\tpricingPlans,\n\tisEnterpriseOnly,\n}) => {\n\tconst canUpdate = installed && version && marketplaceVersion && semver.lt(version, marketplaceVersion);\n\tif (canUpdate) {\n\t\treturn {\n\t\t\taction: 'update',\n\t\t\ticon: 'reload',\n\t\t\tlabel: 'Update',\n\t\t};\n\t}\n\n\tif (installed) {\n\t\treturn;\n\t}\n\n\tconst canDownload = isPurchased;\n\tif (canDownload) {\n\t\treturn {\n\t\t\taction: 'install',\n\t\t\tlabel: 'Install',\n\t\t};\n\t}\n\n\tconst canSubscribe = purchaseType === 'subscription' && !subscriptionInfo.status;\n\tif (canSubscribe) {\n\t\tconst cannotTry = pricingPlans.every((currentPricingPlan) => currentPricingPlan.trialDays === 0);\n\n\t\tif (cannotTry || isEnterpriseOnly) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Subscribe',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Trial',\n\t\t};\n\t}\n\n\tconst canBuy = price > 0;\n\tif (canBuy) {\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Buy',\n\t\t};\n\t}\n\n\treturn {\n\t\taction: 'purchase',\n\t\tlabel: 'Install',\n\t};\n};\n\nexport const appStatusSpanProps = ({ installed, status, subscriptionInfo }) => {\n\tif (!installed) {\n\t\treturn;\n\t}\n\n\tconst isFailed = appErroredStatuses.includes(status);\n\tif (isFailed) {\n\t\treturn {\n\t\t\ttype: 'failed',\n\t\t\ticon: 'warning',\n\t\t\tlabel: status === AppStatus.INVALID_SETTINGS_DISABLED ? 'Config Needed' : 'Failed',\n\t\t};\n\t}\n\n\tconst isEnabled = appEnabledStatuses.includes(status);\n\tif (!isEnabled) {\n\t\treturn {\n\t\t\ttype: 'warning',\n\t\t\ticon: 'warning',\n\t\t\tlabel: 'Disabled',\n\t\t};\n\t}\n\n\tconst isOnTrialPeriod = subscriptionInfo && subscriptionInfo.status === 'trialing';\n\tif (isOnTrialPeriod) {\n\t\treturn {\n\t\t\ticon: 'checkmark-circled',\n\t\t\tlabel: 'Trial period',\n\t\t};\n\t}\n\n\treturn {\n\t\ticon: 'checkmark-circled',\n\t\tlabel: 'Enabled',\n\t};\n};\n\nexport const formatPrice = (price) => `\\$${Number.parseFloat(price).toFixed(2)}`;\n\nexport const formatPricingPlan = ({ strategy, price, tiers = [] }) => {\n\tconst { perUnit = false } = (Array.isArray(tiers) && tiers.find((tier) => tier.price === price)) || {};\n\n\tconst pricingPlanTranslationString = [\n\t\t'Apps_Marketplace_pricingPlan',\n\t\tArray.isArray(tiers) && tiers.length > 0 && 'startingAt',\n\t\tstrategy,\n\t\tperUnit && 'perUser',\n\t]\n\t\t.filter(Boolean)\n\t\t.join('_');\n\n\treturn t(pricingPlanTranslationString, {\n\t\tprice: formatPrice(price),\n\t});\n};\n"]},"sourceType":"module","hash":"30399cf7fe5277d5ac36f8169910e4387efe281c"}
