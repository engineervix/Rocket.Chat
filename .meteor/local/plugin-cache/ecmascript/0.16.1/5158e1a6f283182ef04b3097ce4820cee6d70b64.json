{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-master/client/body.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-master/client/body.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-master/client/body.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-master/client/body.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-master/client/body.js"}},"code":"var Clipboard;\nmodule.link(\"clipboard\", {\n  \"default\": function (v) {\n    Clipboard = v;\n  }\n}, 0);\nvar s;\nmodule.link(\"underscore.string\", {\n  \"default\": function (v) {\n    s = v;\n  }\n}, 1);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar Match;\nmodule.link(\"meteor/check\", {\n  Match: function (v) {\n    Match = v;\n  }\n}, 3);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 4);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 5);\nvar t;\nmodule.link(\"../../utils/client\", {\n  t: function (v) {\n    t = v;\n  }\n}, 6);\nvar chatMessages;\nmodule.link(\"../../ui\", {\n  chatMessages: function (v) {\n    chatMessages = v;\n  }\n}, 7);\nvar popover, RoomManager;\nmodule.link(\"../../ui-utils\", {\n  popover: function (v) {\n    popover = v;\n  },\n  RoomManager: function (v) {\n    RoomManager = v;\n  }\n}, 8);\nvar settings;\nmodule.link(\"../../settings\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 9);\nvar ChatSubscription;\nmodule.link(\"../../models\", {\n  ChatSubscription: function (v) {\n    ChatSubscription = v;\n  }\n}, 10);\nmodule.link(\"./body.html\");\nvar imperativeModal;\nmodule.link(\"../../../client/lib/imperativeModal\", {\n  imperativeModal: function (v) {\n    imperativeModal = v;\n  }\n}, 11);\nvar GenericModal;\nmodule.link(\"../../../client/components/GenericModal\", {\n  \"default\": function (v) {\n    GenericModal = v;\n  }\n}, 12);\nvar fireGlobalEvent;\nmodule.link(\"../../../client/lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent: function (v) {\n    fireGlobalEvent = v;\n  }\n}, 13);\nvar isLayoutEmbedded;\nmodule.link(\"../../../client/lib/utils/isLayoutEmbedded\", {\n  isLayoutEmbedded: function (v) {\n    isLayoutEmbedded = v;\n  }\n}, 14);\nTemplate.body.onRendered(function () {\n  new Clipboard('.clipboard');\n  $(document.body).on('keydown', function (e) {\n    var unread = Session.get('unread');\n\n    if (e.keyCode === 27 && (e.shiftKey === true || e.ctrlKey === true) && unread != null && unread !== '') {\n      e.preventDefault();\n      e.stopPropagation();\n\n      var handleClearUnreadAllMessages = function () {\n        var subscriptions = ChatSubscription.find({\n          open: true\n        }, {\n          fields: {\n            unread: 1,\n            alert: 1,\n            rid: 1,\n            t: 1,\n            name: 1,\n            ls: 1\n          }\n        });\n        subscriptions.forEach(function (subscription) {\n          if (subscription.alert || subscription.unread > 0) {\n            Meteor.call('readMessages', subscription.rid);\n          }\n        });\n        imperativeModal.close();\n      };\n\n      imperativeModal.open({\n        component: GenericModal,\n        props: {\n          children: t('Are_you_sure_you_want_to_clear_all_unread_messages'),\n          variant: 'warning',\n          title: t('Clear_all_unreads_question'),\n          confirmText: t('Yes_clear_all'),\n          onClose: imperativeModal.close,\n          onCancel: imperativeModal.close,\n          onConfirm: handleClearUnreadAllMessages\n        }\n      });\n    }\n  });\n  $(document.body).on('keydown', function (e) {\n    var target = e.target;\n\n    if (e.ctrlKey === true || e.metaKey === true) {\n      popover.close();\n      return;\n    }\n\n    if (!(e.keyCode > 45 && e.keyCode < 91 || e.keyCode === 8)) {\n      return;\n    }\n\n    if (/input|textarea|select/i.test(target.tagName)) {\n      return;\n    }\n\n    if (target.id === 'pswp') {\n      return;\n    }\n\n    popover.close();\n\n    if (document.querySelector('.rc-modal-wrapper dialog[open]')) {\n      return;\n    }\n\n    var inputMessage = chatMessages[RoomManager.openedRoom] && chatMessages[RoomManager.openedRoom].input;\n\n    if (!inputMessage) {\n      return;\n    }\n\n    inputMessage.focus();\n  });\n\n  var handleMessageLinkClick = function (event) {\n    var link = event.currentTarget;\n\n    if (link.origin === s.rtrim(Meteor.absoluteUrl(), '/') && /msg=([a-zA-Z0-9]+)/.test(link.search)) {\n      fireGlobalEvent('click-message-link', {\n        link: link.pathname + link.search\n      });\n    }\n  };\n\n  this.autorun(function () {\n    if (isLayoutEmbedded()) {\n      $(document.body).on('click', 'a', handleMessageLinkClick);\n    } else {\n      $(document.body).off('click', 'a', handleMessageLinkClick);\n    }\n  });\n  this.autorun(function (c) {\n    var w = window;\n    var d = document;\n    var script = 'script';\n    var l = 'dataLayer';\n    var i = settings.get('GoogleTagManager_id');\n\n    if (Match.test(i, String) && i.trim() !== '') {\n      c.stop();\n      return function (w, d, s, l, i) {\n        w[l] = w[l] || [];\n        w[l].push({\n          'gtm.start': new Date().getTime(),\n          'event': 'gtm.js'\n        });\n        var f = d.getElementsByTagName(s)[0];\n        var j = d.createElement(s);\n        var dl = l !== 'dataLayer' ? \"&l=\" + l : '';\n        j.async = true;\n        j.src = \"//www.googletagmanager.com/gtm.js?id=\" + i + dl;\n        return f.parentNode.insertBefore(j, f);\n      }(w, d, script, l, i);\n    }\n  });\n});","map":{"version":3,"sources":["app/ui-master/client/body.js"],"names":["Clipboard","module","link","v","s","Meteor","Match","Session","Template","t","chatMessages","popover","RoomManager","settings","ChatSubscription","imperativeModal","GenericModal","fireGlobalEvent","isLayoutEmbedded","body","onRendered","$","document","on","e","unread","get","keyCode","shiftKey","ctrlKey","preventDefault","stopPropagation","handleClearUnreadAllMessages","subscriptions","find","open","fields","alert","rid","name","ls","forEach","subscription","call","close","component","props","children","variant","title","confirmText","onClose","onCancel","onConfirm","target","metaKey","test","tagName","id","querySelector","inputMessage","openedRoom","input","focus","handleMessageLinkClick","event","currentTarget","origin","rtrim","absoluteUrl","search","pathname","autorun","off","c","w","window","d","script","l","i","String","trim","stop","push","Date","getTime","f","getElementsByTagName","j","createElement","dl","async","src","parentNode","insertBefore"],"mappings":"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","sourcesContent":["import Clipboard from 'clipboard';\nimport s from 'underscore.string';\nimport { Meteor } from 'meteor/meteor';\nimport { Match } from 'meteor/check';\nimport { Session } from 'meteor/session';\nimport { Template } from 'meteor/templating';\n\nimport { t } from '../../utils/client';\nimport { chatMessages } from '../../ui';\nimport { popover, RoomManager } from '../../ui-utils';\nimport { settings } from '../../settings';\nimport { ChatSubscription } from '../../models';\nimport './body.html';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport GenericModal from '../../../client/components/GenericModal';\nimport { fireGlobalEvent } from '../../../client/lib/utils/fireGlobalEvent';\nimport { isLayoutEmbedded } from '../../../client/lib/utils/isLayoutEmbedded';\n\nTemplate.body.onRendered(function () {\n\tnew Clipboard('.clipboard');\n\n\t$(document.body).on('keydown', function (e) {\n\t\tconst unread = Session.get('unread');\n\t\tif (e.keyCode === 27 && (e.shiftKey === true || e.ctrlKey === true) && unread != null && unread !== '') {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\n\t\t\tconst handleClearUnreadAllMessages = () => {\n\t\t\t\tconst subscriptions = ChatSubscription.find(\n\t\t\t\t\t{\n\t\t\t\t\t\topen: true,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tunread: 1,\n\t\t\t\t\t\t\talert: 1,\n\t\t\t\t\t\t\trid: 1,\n\t\t\t\t\t\t\tt: 1,\n\t\t\t\t\t\t\tname: 1,\n\t\t\t\t\t\t\tls: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tsubscriptions.forEach((subscription) => {\n\t\t\t\t\tif (subscription.alert || subscription.unread > 0) {\n\t\t\t\t\t\tMeteor.call('readMessages', subscription.rid);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\timperativeModal.close();\n\t\t\t};\n\n\t\t\timperativeModal.open({\n\t\t\t\tcomponent: GenericModal,\n\t\t\t\tprops: {\n\t\t\t\t\tchildren: t('Are_you_sure_you_want_to_clear_all_unread_messages'),\n\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\ttitle: t('Clear_all_unreads_question'),\n\t\t\t\t\tconfirmText: t('Yes_clear_all'),\n\t\t\t\t\tonClose: imperativeModal.close,\n\t\t\t\t\tonCancel: imperativeModal.close,\n\t\t\t\t\tonConfirm: handleClearUnreadAllMessages,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t});\n\n\t$(document.body).on('keydown', function (e) {\n\t\tconst { target } = e;\n\t\tif (e.ctrlKey === true || e.metaKey === true) {\n\t\t\tpopover.close();\n\t\t\treturn;\n\t\t}\n\t\tif (!((e.keyCode > 45 && e.keyCode < 91) || e.keyCode === 8)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (/input|textarea|select/i.test(target.tagName)) {\n\t\t\treturn;\n\t\t}\n\t\tif (target.id === 'pswp') {\n\t\t\treturn;\n\t\t}\n\n\t\tpopover.close();\n\n\t\tif (document.querySelector('.rc-modal-wrapper dialog[open]')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst inputMessage = chatMessages[RoomManager.openedRoom] && chatMessages[RoomManager.openedRoom].input;\n\t\tif (!inputMessage) {\n\t\t\treturn;\n\t\t}\n\t\tinputMessage.focus();\n\t});\n\n\tconst handleMessageLinkClick = (event) => {\n\t\tconst link = event.currentTarget;\n\t\tif (link.origin === s.rtrim(Meteor.absoluteUrl(), '/') && /msg=([a-zA-Z0-9]+)/.test(link.search)) {\n\t\t\tfireGlobalEvent('click-message-link', { link: link.pathname + link.search });\n\t\t}\n\t};\n\n\tthis.autorun(() => {\n\t\tif (isLayoutEmbedded()) {\n\t\t\t$(document.body).on('click', 'a', handleMessageLinkClick);\n\t\t} else {\n\t\t\t$(document.body).off('click', 'a', handleMessageLinkClick);\n\t\t}\n\t});\n\n\tthis.autorun(function (c) {\n\t\tconst w = window;\n\t\tconst d = document;\n\t\tconst script = 'script';\n\t\tconst l = 'dataLayer';\n\t\tconst i = settings.get('GoogleTagManager_id');\n\t\tif (Match.test(i, String) && i.trim() !== '') {\n\t\t\tc.stop();\n\t\t\treturn (function (w, d, s, l, i) {\n\t\t\t\tw[l] = w[l] || [];\n\t\t\t\tw[l].push({\n\t\t\t\t\t'gtm.start': new Date().getTime(),\n\t\t\t\t\t'event': 'gtm.js',\n\t\t\t\t});\n\t\t\t\tconst f = d.getElementsByTagName(s)[0];\n\t\t\t\tconst j = d.createElement(s);\n\t\t\t\tconst dl = l !== 'dataLayer' ? `&l=${l}` : '';\n\t\t\t\tj.async = true;\n\t\t\t\tj.src = `//www.googletagmanager.com/gtm.js?id=${i}${dl}`;\n\t\t\t\treturn f.parentNode.insertBefore(j, f);\n\t\t\t})(w, d, script, l, i);\n\t\t}\n\t});\n});\n"]},"sourceType":"module","hash":"5158e1a6f283182ef04b3097ce4820cee6d70b64"}
