{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/OTR/OTRWithData.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/room/contextualBar/OTR/OTRWithData.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/OTR/OTRWithData.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/OTR/OTRWithData.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/contextualBar/OTR/OTRWithData.js"}},"code":"var _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 0);\nvar React, useEffect, useMemo, useCallback;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  }\n}, 1);\nvar ORTInstance;\nmodule.link(\"../../../../../app/otr/client/rocketchat.otr\", {\n  OTR: function (v) {\n    ORTInstance = v;\n  }\n}, 2);\nvar useSetModal;\nmodule.link(\"../../../../contexts/ModalContext\", {\n  useSetModal: function (v) {\n    useSetModal = v;\n  }\n}, 3);\nvar usePresence;\nmodule.link(\"../../../../hooks/usePresence\", {\n  usePresence: function (v) {\n    usePresence = v;\n  }\n}, 4);\nvar useReactiveValue;\nmodule.link(\"../../../../hooks/useReactiveValue\", {\n  useReactiveValue: function (v) {\n    useReactiveValue = v;\n  }\n}, 5);\nvar OTR;\nmodule.link(\"./OTR\", {\n  \"default\": function (v) {\n    OTR = v;\n  }\n}, 6);\nvar OTRModal;\nmodule.link(\"./OTRModal\", {\n  \"default\": function (v) {\n    OTRModal = v;\n  }\n}, 7);\n\nvar OTRWithData = function (_ref) {\n  var _usePresence;\n\n  var rid = _ref.rid,\n      tabBar = _ref.tabBar;\n  var onClickClose = useMutableCallback(function () {\n    return tabBar && tabBar.close();\n  });\n  var setModal = useSetModal();\n  var closeModal = useMutableCallback(function () {\n    return setModal();\n  });\n  var otr = useMemo(function () {\n    return ORTInstance.getInstanceByRoomId(rid);\n  }, [rid]);\n\n  var _useReactiveValue = useReactiveValue(useCallback(function () {\n    return otr ? [otr.established.get(), otr.establishing.get()] : [false, false];\n  }, [otr])),\n      _useReactiveValue2 = _slicedToArray(_useReactiveValue, 2),\n      isEstablished = _useReactiveValue2[0],\n      isEstablishing = _useReactiveValue2[1];\n\n  var userStatus = (_usePresence = usePresence(otr.peerId)) === null || _usePresence === void 0 ? void 0 : _usePresence.status;\n  var isOnline = !['offline', 'loading'].includes(userStatus);\n\n  var handleStart = function () {\n    otr.handshake();\n  };\n\n  var handleEnd = function () {\n    return otr === null || otr === void 0 ? void 0 : otr.end();\n  };\n\n  var handleReset = function () {\n    otr.reset();\n    otr.handshake(true);\n  };\n\n  useEffect(function () {\n    if (isEstablished) {\n      return closeModal();\n    }\n\n    if (!isEstablishing) {\n      return;\n    }\n\n    var timeout = setTimeout(function () {\n      otr.establishing.set(false);\n      setModal( /*#__PURE__*/React.createElement(OTRModal, {\n        onConfirm: closeModal,\n        onCancel: closeModal\n      }));\n    }, 10000);\n    return function () {\n      return clearTimeout(timeout);\n    };\n  }, [closeModal, isEstablished, isEstablishing, setModal, otr]);\n  return /*#__PURE__*/React.createElement(OTR, {\n    isOnline: isOnline,\n    isEstablishing: isEstablishing,\n    isEstablished: isEstablished,\n    onClickClose: onClickClose,\n    onClickStart: handleStart,\n    onClickEnd: handleEnd,\n    onClickRefresh: handleReset\n  });\n};\n\nmodule.exportDefault(OTRWithData);","map":{"version":3,"sources":["client/views/room/contextualBar/OTR/OTRWithData.js"],"names":["_slicedToArray","module","link","default","v","useMutableCallback","React","useEffect","useMemo","useCallback","ORTInstance","OTR","useSetModal","usePresence","useReactiveValue","OTRModal","OTRWithData","rid","tabBar","onClickClose","close","setModal","closeModal","otr","getInstanceByRoomId","established","get","establishing","isEstablished","isEstablishing","userStatus","peerId","status","isOnline","includes","handleStart","handshake","handleEnd","end","handleReset","reset","timeout","setTimeout","set","clearTimeout","exportDefault"],"mappings":"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","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useCallback } from 'react';\n\nimport { OTR as ORTInstance } from '../../../../../app/otr/client/rocketchat.otr';\nimport { useSetModal } from '../../../../contexts/ModalContext';\nimport { usePresence } from '../../../../hooks/usePresence';\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\nimport OTR from './OTR';\nimport OTRModal from './OTRModal';\n\nconst OTRWithData = ({ rid, tabBar }) => {\n\tconst onClickClose = useMutableCallback(() => tabBar && tabBar.close());\n\n\tconst setModal = useSetModal();\n\tconst closeModal = useMutableCallback(() => setModal());\n\tconst otr = useMemo(() => ORTInstance.getInstanceByRoomId(rid), [rid]);\n\n\tconst [isEstablished, isEstablishing] = useReactiveValue(\n\t\tuseCallback(() => (otr ? [otr.established.get(), otr.establishing.get()] : [false, false]), [otr]),\n\t);\n\n\tconst userStatus = usePresence(otr.peerId)?.status;\n\n\tconst isOnline = !['offline', 'loading'].includes(userStatus);\n\n\tconst handleStart = () => {\n\t\totr.handshake();\n\t};\n\n\tconst handleEnd = () => otr?.end();\n\n\tconst handleReset = () => {\n\t\totr.reset();\n\t\totr.handshake(true);\n\t};\n\n\tuseEffect(() => {\n\t\tif (isEstablished) {\n\t\t\treturn closeModal();\n\t\t}\n\n\t\tif (!isEstablishing) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\totr.establishing.set(false);\n\t\t\tsetModal(<OTRModal onConfirm={closeModal} onCancel={closeModal} />);\n\t\t}, 10000);\n\n\t\treturn () => clearTimeout(timeout);\n\t}, [closeModal, isEstablished, isEstablishing, setModal, otr]);\n\n\treturn (\n\t\t<OTR\n\t\t\tisOnline={isOnline}\n\t\t\tisEstablishing={isEstablishing}\n\t\t\tisEstablished={isEstablished}\n\t\t\tonClickClose={onClickClose}\n\t\t\tonClickStart={handleStart}\n\t\t\tonClickEnd={handleEnd}\n\t\t\tonClickRefresh={handleReset}\n\t\t/>\n\t);\n};\n\nexport default OTRWithData;\n"]},"sourceType":"module","hash":"ce0316a6c580d78391f83fb35974e44784895bf8"}
