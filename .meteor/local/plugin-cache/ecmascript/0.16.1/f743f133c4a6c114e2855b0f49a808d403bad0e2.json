{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ConnectedModalBlock.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/blocks/ConnectedModalBlock.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ConnectedModalBlock.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ConnectedModalBlock.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/blocks/ConnectedModalBlock.js"}},"code":"const _excluded = [\"type\"];\n\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 1);\nlet UIKitIncomingInteractionContainerType;\nmodule.link(\"@rocket.chat/apps-engine/definition/uikit/UIKitIncomingInteractionContainer\", {\n  UIKitIncomingInteractionContainerType(v) {\n    UIKitIncomingInteractionContainerType = v;\n  }\n\n}, 0);\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n\n}, 1);\nlet kitContext;\nmodule.link(\"@rocket.chat/fuselage-ui-kit\", {\n  kitContext(v) {\n    kitContext = v;\n  }\n\n}, 2);\nlet React, useEffect, useReducer, useState;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useReducer(v) {\n    useReducer = v;\n  },\n\n  useState(v) {\n    useState = v;\n  }\n\n}, 3);\nlet ActionManager;\nmodule.link(\"../../../app/ui-message/client/ActionManager\", {\n  \"*\"(v) {\n    ActionManager = v;\n  }\n\n}, 4);\nlet ModalBlock;\nmodule.link(\"./ModalBlock\", {\n  default(v) {\n    ModalBlock = v;\n  }\n\n}, 5);\nmodule.link(\"./textParsers\");\n\nconst useActionManagerState = initialState => {\n  const [state, setState] = useState(initialState);\n  const {\n    viewId\n  } = state;\n  useEffect(() => {\n    const handleUpdate = _ref => {\n      let {\n        type\n      } = _ref,\n          data = _objectWithoutProperties(_ref, _excluded);\n\n      if (type === 'errors') {\n        const {\n          errors\n        } = data;\n        setState(state => _objectSpread(_objectSpread({}, state), {}, {\n          errors\n        }));\n        return;\n      }\n\n      setState(data);\n    };\n\n    ActionManager.on(viewId, handleUpdate);\n    return () => {\n      ActionManager.off(viewId, handleUpdate);\n    };\n  }, [viewId]);\n  return state;\n};\n\nconst useValues = view => {\n  const reducer = useMutableCallback((values, _ref2) => {\n    let {\n      actionId,\n      payload\n    } = _ref2;\n    return _objectSpread(_objectSpread({}, values), {}, {\n      [actionId]: payload\n    });\n  });\n  const initializer = useMutableCallback(() => {\n    const filterInputFields = _ref3 => {\n      let {\n        element,\n        elements = []\n      } = _ref3;\n\n      if (element && element.initialValue) {\n        return true;\n      }\n\n      if (elements.length && elements.map(element => ({\n        element\n      })).filter(filterInputFields).length) {\n        return true;\n      }\n    };\n\n    const mapElementToState = _ref4 => {\n      let {\n        element,\n        blockId,\n        elements = []\n      } = _ref4;\n\n      if (elements.length) {\n        return elements.map(element => ({\n          element,\n          blockId\n        })).filter(filterInputFields).map(mapElementToState);\n      }\n\n      return [element.actionId, {\n        value: element.initialValue,\n        blockId\n      }];\n    };\n\n    return view.blocks.filter(filterInputFields).map(mapElementToState).reduce((obj, el) => {\n      if (Array.isArray(el[0])) {\n        return _objectSpread(_objectSpread({}, obj), Object.fromEntries(el));\n      }\n\n      const [key, value] = el;\n      return _objectSpread(_objectSpread({}, obj), {}, {\n        [key]: value\n      });\n    }, {});\n  });\n  return useReducer(reducer, null, initializer);\n};\n\nfunction ConnectedModalBlock(props) {\n  const state = useActionManagerState(props);\n  const {\n    appId,\n    viewId,\n    mid: _mid,\n    errors,\n    view\n  } = state;\n  const [values, updateValues] = useValues(view);\n\n  const groupStateByBlockId = obj => Object.entries(obj).reduce((obj, _ref5) => {\n    let [key, {\n      blockId,\n      value\n    }] = _ref5;\n    obj[blockId] = obj[blockId] || {};\n    obj[blockId][key] = value;\n    return obj;\n  }, {});\n\n  const prevent = e => {\n    if (e) {\n      (e.nativeEvent || e).stopImmediatePropagation();\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  };\n\n  const context = _objectSpread(_objectSpread({\n    action: _ref6 => {\n      let {\n        actionId,\n        appId,\n        value,\n        blockId,\n        mid = _mid\n      } = _ref6;\n      return ActionManager.triggerBlockAction({\n        container: {\n          type: UIKitIncomingInteractionContainerType.VIEW,\n          id: viewId\n        },\n        actionId,\n        appId,\n        value,\n        blockId,\n        mid\n      });\n    },\n    state: _ref7 => {\n      let {\n        actionId,\n        value,\n\n        /* ,appId, */\n        blockId = 'default'\n      } = _ref7;\n      updateValues({\n        actionId,\n        payload: {\n          blockId,\n          value\n        }\n      });\n    }\n  }, state), {}, {\n    values\n  });\n\n  const handleSubmit = useMutableCallback(e => {\n    prevent(e);\n    ActionManager.triggerSubmitView({\n      viewId,\n      appId,\n      payload: {\n        view: _objectSpread(_objectSpread({}, view), {}, {\n          id: viewId,\n          state: groupStateByBlockId(values)\n        })\n      }\n    });\n  });\n  const handleCancel = useMutableCallback(e => {\n    prevent(e);\n    return ActionManager.triggerCancel({\n      appId,\n      viewId,\n      view: _objectSpread(_objectSpread({}, view), {}, {\n        id: viewId,\n        state: groupStateByBlockId(values)\n      })\n    });\n  });\n  const handleClose = useMutableCallback(e => {\n    prevent(e);\n    return ActionManager.triggerCancel({\n      appId,\n      viewId,\n      view: _objectSpread(_objectSpread({}, view), {}, {\n        id: viewId,\n        state: groupStateByBlockId(values)\n      }),\n      isCleared: true\n    });\n  });\n  return /*#__PURE__*/React.createElement(kitContext.Provider, {\n    value: context\n  }, /*#__PURE__*/React.createElement(ModalBlock, {\n    view: view,\n    errors: errors,\n    appId: appId,\n    onSubmit: handleSubmit,\n    onCancel: handleCancel,\n    onClose: handleClose\n  }));\n}\n\nmodule.exportDefault(ConnectedModalBlock);","map":{"version":3,"sources":["client/views/blocks/ConnectedModalBlock.js"],"names":["_objectSpread","module","link","default","v","_objectWithoutProperties","UIKitIncomingInteractionContainerType","useMutableCallback","kitContext","React","useEffect","useReducer","useState","ActionManager","ModalBlock","useActionManagerState","initialState","state","setState","viewId","handleUpdate","type","data","errors","on","off","useValues","view","reducer","values","actionId","payload","initializer","filterInputFields","element","elements","initialValue","length","map","filter","mapElementToState","blockId","value","blocks","reduce","obj","el","Array","isArray","Object","fromEntries","key","ConnectedModalBlock","props","appId","mid","_mid","updateValues","groupStateByBlockId","entries","prevent","e","nativeEvent","stopImmediatePropagation","stopPropagation","preventDefault","context","action","triggerBlockAction","container","VIEW","id","handleSubmit","triggerSubmitView","handleCancel","triggerCancel","handleClose","isCleared","exportDefault"],"mappings":"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","sourcesContent":["import { UIKitIncomingInteractionContainerType } from '@rocket.chat/apps-engine/definition/uikit/UIKitIncomingInteractionContainer';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { kitContext } from '@rocket.chat/fuselage-ui-kit';\nimport React, { useEffect, useReducer, useState } from 'react';\n\nimport * as ActionManager from '../../../app/ui-message/client/ActionManager';\nimport ModalBlock from './ModalBlock';\nimport './textParsers';\n\nconst useActionManagerState = (initialState) => {\n\tconst [state, setState] = useState(initialState);\n\n\tconst { viewId } = state;\n\n\tuseEffect(() => {\n\t\tconst handleUpdate = ({ type, ...data }) => {\n\t\t\tif (type === 'errors') {\n\t\t\t\tconst { errors } = data;\n\t\t\t\tsetState((state) => ({ ...state, errors }));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetState(data);\n\t\t};\n\n\t\tActionManager.on(viewId, handleUpdate);\n\n\t\treturn () => {\n\t\t\tActionManager.off(viewId, handleUpdate);\n\t\t};\n\t}, [viewId]);\n\n\treturn state;\n};\n\nconst useValues = (view) => {\n\tconst reducer = useMutableCallback((values, { actionId, payload }) => ({\n\t\t...values,\n\t\t[actionId]: payload,\n\t}));\n\n\tconst initializer = useMutableCallback(() => {\n\t\tconst filterInputFields = ({ element, elements = [] }) => {\n\t\t\tif (element && element.initialValue) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (elements.length && elements.map((element) => ({ element })).filter(filterInputFields).length) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t};\n\n\t\tconst mapElementToState = ({ element, blockId, elements = [] }) => {\n\t\t\tif (elements.length) {\n\t\t\t\treturn elements\n\t\t\t\t\t.map((element) => ({ element, blockId }))\n\t\t\t\t\t.filter(filterInputFields)\n\t\t\t\t\t.map(mapElementToState);\n\t\t\t}\n\t\t\treturn [element.actionId, { value: element.initialValue, blockId }];\n\t\t};\n\n\t\treturn view.blocks\n\t\t\t.filter(filterInputFields)\n\t\t\t.map(mapElementToState)\n\t\t\t.reduce((obj, el) => {\n\t\t\t\tif (Array.isArray(el[0])) {\n\t\t\t\t\treturn { ...obj, ...Object.fromEntries(el) };\n\t\t\t\t}\n\n\t\t\t\tconst [key, value] = el;\n\t\t\t\treturn { ...obj, [key]: value };\n\t\t\t}, {});\n\t});\n\n\treturn useReducer(reducer, null, initializer);\n};\n\nfunction ConnectedModalBlock(props) {\n\tconst state = useActionManagerState(props);\n\n\tconst { appId, viewId, mid: _mid, errors, view } = state;\n\n\tconst [values, updateValues] = useValues(view);\n\n\tconst groupStateByBlockId = (obj) =>\n\t\tObject.entries(obj).reduce((obj, [key, { blockId, value }]) => {\n\t\t\tobj[blockId] = obj[blockId] || {};\n\t\t\tobj[blockId][key] = value;\n\t\t\treturn obj;\n\t\t}, {});\n\n\tconst prevent = (e) => {\n\t\tif (e) {\n\t\t\t(e.nativeEvent || e).stopImmediatePropagation();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\tconst context = {\n\t\taction: ({ actionId, appId, value, blockId, mid = _mid }) =>\n\t\t\tActionManager.triggerBlockAction({\n\t\t\t\tcontainer: {\n\t\t\t\t\ttype: UIKitIncomingInteractionContainerType.VIEW,\n\t\t\t\t\tid: viewId,\n\t\t\t\t},\n\t\t\t\tactionId,\n\t\t\t\tappId,\n\t\t\t\tvalue,\n\t\t\t\tblockId,\n\t\t\t\tmid,\n\t\t\t}),\n\t\tstate: ({ actionId, value, /* ,appId, */ blockId = 'default' }) => {\n\t\t\tupdateValues({\n\t\t\t\tactionId,\n\t\t\t\tpayload: {\n\t\t\t\t\tblockId,\n\t\t\t\t\tvalue,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t...state,\n\t\tvalues,\n\t};\n\n\tconst handleSubmit = useMutableCallback((e) => {\n\t\tprevent(e);\n\t\tActionManager.triggerSubmitView({\n\t\t\tviewId,\n\t\t\tappId,\n\t\t\tpayload: {\n\t\t\t\tview: {\n\t\t\t\t\t...view,\n\t\t\t\t\tid: viewId,\n\t\t\t\t\tstate: groupStateByBlockId(values),\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t});\n\n\tconst handleCancel = useMutableCallback((e) => {\n\t\tprevent(e);\n\t\treturn ActionManager.triggerCancel({\n\t\t\tappId,\n\t\t\tviewId,\n\t\t\tview: {\n\t\t\t\t...view,\n\t\t\t\tid: viewId,\n\t\t\t\tstate: groupStateByBlockId(values),\n\t\t\t},\n\t\t});\n\t});\n\n\tconst handleClose = useMutableCallback((e) => {\n\t\tprevent(e);\n\t\treturn ActionManager.triggerCancel({\n\t\t\tappId,\n\t\t\tviewId,\n\t\t\tview: {\n\t\t\t\t...view,\n\t\t\t\tid: viewId,\n\t\t\t\tstate: groupStateByBlockId(values),\n\t\t\t},\n\t\t\tisCleared: true,\n\t\t});\n\t});\n\n\treturn (\n\t\t<kitContext.Provider value={context}>\n\t\t\t<ModalBlock view={view} errors={errors} appId={appId} onSubmit={handleSubmit} onCancel={handleCancel} onClose={handleClose} />\n\t\t</kitContext.Provider>\n\t);\n}\n\nexport default ConnectedModalBlock;\n"]},"sourceType":"module","hash":"f743f133c4a6c114e2855b0f49a808d403bad0e2"}
