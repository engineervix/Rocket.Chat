{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/directory/chats/contextualBar/RoomEdit.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/omnichannel/directory/chats/contextualBar/RoomEdit.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/directory/chats/contextualBar/RoomEdit.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/directory/chats/contextualBar/RoomEdit.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/omnichannel/directory/chats/contextualBar/RoomEdit.js"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet Field, TextInput, ButtonGroup, Button;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Field(v) {\n    Field = v;\n  },\n\n  TextInput(v) {\n    TextInput = v;\n  },\n\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  },\n\n  Button(v) {\n    Button = v;\n  }\n\n}, 0);\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n\n}, 1);\nlet React, useState, useMemo;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useState(v) {\n    useState = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  }\n\n}, 2);\nlet useSubscription;\nmodule.link(\"use-subscription\", {\n  useSubscription(v) {\n    useSubscription = v;\n  }\n\n}, 3);\nlet hasAtLeastOnePermission;\nmodule.link(\"../../../../../../app/authorization/client\", {\n  hasAtLeastOnePermission(v) {\n    hasAtLeastOnePermission = v;\n  }\n\n}, 4);\nlet CustomFieldsForm;\nmodule.link(\"../../../../../components/CustomFieldsForm\", {\n  default(v) {\n    CustomFieldsForm = v;\n  }\n\n}, 5);\nlet Tags;\nmodule.link(\"../../../../../components/Omnichannel/Tags\", {\n  default(v) {\n    Tags = v;\n  }\n\n}, 6);\nlet VerticalBar;\nmodule.link(\"../../../../../components/VerticalBar\", {\n  default(v) {\n    VerticalBar = v;\n  }\n\n}, 7);\nlet useMethod;\nmodule.link(\"../../../../../contexts/ServerContext\", {\n  useMethod(v) {\n    useMethod = v;\n  }\n\n}, 8);\nlet useToastMessageDispatch;\nmodule.link(\"../../../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n\n}, 9);\nlet useTranslation;\nmodule.link(\"../../../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 10);\nlet AsyncStatePhase;\nmodule.link(\"../../../../../hooks/useAsyncState\", {\n  AsyncStatePhase(v) {\n    AsyncStatePhase = v;\n  }\n\n}, 11);\nlet useEndpointData;\nmodule.link(\"../../../../../hooks/useEndpointData\", {\n  useEndpointData(v) {\n    useEndpointData = v;\n  }\n\n}, 12);\nlet useForm;\nmodule.link(\"../../../../../hooks/useForm\", {\n  useForm(v) {\n    useForm = v;\n  }\n\n}, 13);\nlet formsSubscription;\nmodule.link(\"../../../additionalForms\", {\n  formsSubscription(v) {\n    formsSubscription = v;\n  }\n\n}, 14);\nlet FormSkeleton;\nmodule.link(\"../../Skeleton\", {\n  FormSkeleton(v) {\n    FormSkeleton = v;\n  }\n\n}, 15);\nconst initialValuesRoom = {\n  topic: '',\n  tags: [],\n  livechatData: {},\n  priorityId: ''\n};\n\nconst getInitialValuesRoom = room => {\n  if (!room) {\n    return initialValuesRoom;\n  }\n\n  const {\n    topic,\n    tags,\n    livechatData,\n    priorityId\n  } = room;\n  return {\n    topic: topic !== null && topic !== void 0 ? topic : '',\n    tags: tags !== null && tags !== void 0 ? tags : [],\n    livechatData: livechatData !== null && livechatData !== void 0 ? livechatData : {},\n    priorityId: priorityId !== null && priorityId !== void 0 ? priorityId : ''\n  };\n};\n\nfunction RoomEdit(_ref) {\n  let {\n    room,\n    visitor,\n    reload,\n    reloadInfo,\n    close\n  } = _ref;\n  const t = useTranslation();\n  const {\n    values: valuesRoom,\n    handlers: handlersRoom,\n    hasUnsavedChanges: hasUnsavedChangesRoom\n  } = useForm(getInitialValuesRoom(room));\n\n  const canViewCustomFields = () => hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields']);\n\n  const {\n    handleTopic,\n    handleTags,\n    handlePriorityId\n  } = handlersRoom;\n  const {\n    topic,\n    tags,\n    priorityId\n  } = valuesRoom;\n  const forms = useSubscription(formsSubscription);\n  const {\n    usePrioritiesSelect = () => {}\n  } = forms;\n  const PrioritiesSelect = usePrioritiesSelect();\n  const {\n    values: valueCustom,\n    handlers: handleValueCustom,\n    hasUnsavedChanges: hasUnsavedChangesCustomFields\n  } = useForm({\n    livechatData: valuesRoom.livechatData\n  });\n  const {\n    handleLivechatData\n  } = handleValueCustom;\n  const {\n    livechatData\n  } = valueCustom;\n  const [customFieldsError, setCustomFieldsError] = useState([]);\n  const {\n    value: allCustomFields,\n    phase: stateCustomFields\n  } = useEndpointData('livechat/custom-fields');\n  const {\n    value: prioritiesResult = {},\n    phase: statePriorities\n  } = useEndpointData('livechat/priorities.list');\n\n  const jsonConverterToValidFormat = customFields => {\n    const jsonObj = {};\n    customFields.forEach(_ref2 => {\n      let {\n        _id,\n        label,\n        visibility,\n        options,\n        scope,\n        defaultValue,\n        required\n      } = _ref2;\n      visibility === 'visible' & scope === 'room' && (jsonObj[_id] = {\n        label,\n        type: options ? 'select' : 'text',\n        required,\n        defaultValue,\n        options: options && options.split(',').map(item => item.trim())\n      });\n    });\n    return jsonObj;\n  };\n\n  const jsonCustomField = useMemo(() => allCustomFields && allCustomFields.customFields ? jsonConverterToValidFormat(allCustomFields.customFields) : {}, [allCustomFields]);\n  const dispatchToastMessage = useToastMessageDispatch();\n  const saveRoom = useMethod('livechat:saveInfo');\n  const handleSave = useMutableCallback(async e => {\n    e.preventDefault();\n    const userData = {\n      _id: visitor._id\n    };\n\n    const roomData = _objectSpread({\n      _id: room._id,\n      topic,\n      tags: tags.sort(),\n      livechatData\n    }, priorityId && {\n      priorityId\n    });\n\n    try {\n      saveRoom(userData, roomData);\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Saved')\n      });\n      reload && reload();\n      reloadInfo && reloadInfo();\n      close();\n    } catch (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    }\n  });\n  const formIsValid = (hasUnsavedChangesRoom || hasUnsavedChangesCustomFields) && customFieldsError.length === 0;\n\n  if ([stateCustomFields, statePriorities].includes(AsyncStatePhase.LOADING)) {\n    return /*#__PURE__*/React.createElement(FormSkeleton, null);\n  }\n\n  const {\n    priorities\n  } = prioritiesResult;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(VerticalBar.ScrollableContent, {\n    is: \"form\"\n  }, canViewCustomFields() && allCustomFields && /*#__PURE__*/React.createElement(CustomFieldsForm, {\n    jsonCustomFields: jsonCustomField,\n    customFieldsData: livechatData,\n    setCustomFieldsData: handleLivechatData,\n    setCustomFieldsError: setCustomFieldsError\n  }), /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Label, null, t('Topic')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextInput, {\n    flexGrow: 1,\n    value: topic,\n    onChange: handleTopic\n  }))), Tags && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Tags, {\n    tags: tags,\n    handler: handleTags\n  })), PrioritiesSelect && priorities && priorities.length > 0 && /*#__PURE__*/React.createElement(PrioritiesSelect, {\n    value: priorityId,\n    label: t('Priority'),\n    options: priorities,\n    handler: handlePriorityId\n  })), /*#__PURE__*/React.createElement(VerticalBar.Footer, null, /*#__PURE__*/React.createElement(ButtonGroup, {\n    stretch: true\n  }, /*#__PURE__*/React.createElement(Button, {\n    flexGrow: 1,\n    onClick: close\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    mie: \"none\",\n    flexGrow: 1,\n    onClick: handleSave,\n    disabled: !formIsValid,\n    primary: true\n  }, t('Save')))));\n}\n\nmodule.exportDefault(RoomEdit);","map":{"version":3,"sources":["client/views/omnichannel/directory/chats/contextualBar/RoomEdit.js"],"names":["_objectSpread","module","link","default","v","Field","TextInput","ButtonGroup","Button","useMutableCallback","React","useState","useMemo","useSubscription","hasAtLeastOnePermission","CustomFieldsForm","Tags","VerticalBar","useMethod","useToastMessageDispatch","useTranslation","AsyncStatePhase","useEndpointData","useForm","formsSubscription","FormSkeleton","initialValuesRoom","topic","tags","livechatData","priorityId","getInitialValuesRoom","room","RoomEdit","visitor","reload","reloadInfo","close","t","values","valuesRoom","handlers","handlersRoom","hasUnsavedChanges","hasUnsavedChangesRoom","canViewCustomFields","handleTopic","handleTags","handlePriorityId","forms","usePrioritiesSelect","PrioritiesSelect","valueCustom","handleValueCustom","hasUnsavedChangesCustomFields","handleLivechatData","customFieldsError","setCustomFieldsError","value","allCustomFields","phase","stateCustomFields","prioritiesResult","statePriorities","jsonConverterToValidFormat","customFields","jsonObj","forEach","_id","label","visibility","options","scope","defaultValue","required","type","split","map","item","trim","jsonCustomField","dispatchToastMessage","saveRoom","handleSave","e","preventDefault","userData","roomData","sort","message","error","formIsValid","length","includes","LOADING","priorities","exportDefault"],"mappings":"AAAA,IAAIA,aAAJ;;AAAkBC,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACJ,IAAAA,aAAa,GAACI,CAAd;AAAgB;;AAA5B,CAAnD,EAAiF,CAAjF;AAAlB,IAAIC,KAAJ,EAAUC,SAAV,EAAoBC,WAApB,EAAgCC,MAAhC;AAAuCP,MAAM,CAACC,IAAP,CAAY,uBAAZ,EAAoC;AAACG,EAAAA,KAAK,CAACD,CAAD,EAAG;AAACC,IAAAA,KAAK,GAACD,CAAN;AAAQ,GAAlB;;AAAmBE,EAAAA,SAAS,CAACF,CAAD,EAAG;AAACE,IAAAA,SAAS,GAACF,CAAV;AAAY,GAA5C;;AAA6CG,EAAAA,WAAW,CAACH,CAAD,EAAG;AAACG,IAAAA,WAAW,GAACH,CAAZ;AAAc,GAA1E;;AAA2EI,EAAAA,MAAM,CAACJ,CAAD,EAAG;AAACI,IAAAA,MAAM,GAACJ,CAAP;AAAS;;AAA9F,CAApC,EAAoI,CAApI;AAAuI,IAAIK,kBAAJ;AAAuBR,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACO,EAAAA,kBAAkB,CAACL,CAAD,EAAG;AAACK,IAAAA,kBAAkB,GAACL,CAAnB;AAAqB;;AAA5C,CAA1C,EAAwF,CAAxF;AAA2F,IAAIM,KAAJ,EAAUC,QAAV,EAAmBC,OAAnB;AAA2BX,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACM,IAAAA,KAAK,GAACN,CAAN;AAAQ,GAApB;;AAAqBO,EAAAA,QAAQ,CAACP,CAAD,EAAG;AAACO,IAAAA,QAAQ,GAACP,CAAT;AAAW,GAA5C;;AAA6CQ,EAAAA,OAAO,CAACR,CAAD,EAAG;AAACQ,IAAAA,OAAO,GAACR,CAAR;AAAU;;AAAlE,CAApB,EAAwF,CAAxF;AAA2F,IAAIS,eAAJ;AAAoBZ,MAAM,CAACC,IAAP,CAAY,kBAAZ,EAA+B;AAACW,EAAAA,eAAe,CAACT,CAAD,EAAG;AAACS,IAAAA,eAAe,GAACT,CAAhB;AAAkB;;AAAtC,CAA/B,EAAuE,CAAvE;AAA0E,IAAIU,uBAAJ;AAA4Bb,MAAM,CAACC,IAAP,CAAY,4CAAZ,EAAyD;AAACY,EAAAA,uBAAuB,CAACV,CAAD,EAAG;AAACU,IAAAA,uBAAuB,GAACV,CAAxB;AAA0B;;AAAtD,CAAzD,EAAiH,CAAjH;AAAoH,IAAIW,gBAAJ;AAAqBd,MAAM,CAACC,IAAP,CAAY,4CAAZ,EAAyD;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACW,IAAAA,gBAAgB,GAACX,CAAjB;AAAmB;;AAA/B,CAAzD,EAA0F,CAA1F;AAA6F,IAAIY,IAAJ;AAASf,MAAM,CAACC,IAAP,CAAY,4CAAZ,EAAyD;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACY,IAAAA,IAAI,GAACZ,CAAL;AAAO;;AAAnB,CAAzD,EAA8E,CAA9E;AAAiF,IAAIa,WAAJ;AAAgBhB,MAAM,CAACC,IAAP,CAAY,uCAAZ,EAAoD;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACa,IAAAA,WAAW,GAACb,CAAZ;AAAc;;AAA1B,CAApD,EAAgF,CAAhF;AAAmF,IAAIc,SAAJ;AAAcjB,MAAM,CAACC,IAAP,CAAY,uCAAZ,EAAoD;AAACgB,EAAAA,SAAS,CAACd,CAAD,EAAG;AAACc,IAAAA,SAAS,GAACd,CAAV;AAAY;;AAA1B,CAApD,EAAgF,CAAhF;AAAmF,IAAIe,uBAAJ;AAA4BlB,MAAM,CAACC,IAAP,CAAY,8CAAZ,EAA2D;AAACiB,EAAAA,uBAAuB,CAACf,CAAD,EAAG;AAACe,IAAAA,uBAAuB,GAACf,CAAxB;AAA0B;;AAAtD,CAA3D,EAAmH,CAAnH;AAAsH,IAAIgB,cAAJ;AAAmBnB,MAAM,CAACC,IAAP,CAAY,4CAAZ,EAAyD;AAACkB,EAAAA,cAAc,CAAChB,CAAD,EAAG;AAACgB,IAAAA,cAAc,GAAChB,CAAf;AAAiB;;AAApC,CAAzD,EAA+F,EAA/F;AAAmG,IAAIiB,eAAJ;AAAoBpB,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACmB,EAAAA,eAAe,CAACjB,CAAD,EAAG;AAACiB,IAAAA,eAAe,GAACjB,CAAhB;AAAkB;;AAAtC,CAAjD,EAAyF,EAAzF;AAA6F,IAAIkB,eAAJ;AAAoBrB,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACoB,EAAAA,eAAe,CAAClB,CAAD,EAAG;AAACkB,IAAAA,eAAe,GAAClB,CAAhB;AAAkB;;AAAtC,CAAnD,EAA2F,EAA3F;AAA+F,IAAImB,OAAJ;AAAYtB,MAAM,CAACC,IAAP,CAAY,8BAAZ,EAA2C;AAACqB,EAAAA,OAAO,CAACnB,CAAD,EAAG;AAACmB,IAAAA,OAAO,GAACnB,CAAR;AAAU;;AAAtB,CAA3C,EAAmE,EAAnE;AAAuE,IAAIoB,iBAAJ;AAAsBvB,MAAM,CAACC,IAAP,CAAY,0BAAZ,EAAuC;AAACsB,EAAAA,iBAAiB,CAACpB,CAAD,EAAG;AAACoB,IAAAA,iBAAiB,GAACpB,CAAlB;AAAoB;;AAA1C,CAAvC,EAAmF,EAAnF;AAAuF,IAAIqB,YAAJ;AAAiBxB,MAAM,CAACC,IAAP,CAAY,gBAAZ,EAA6B;AAACuB,EAAAA,YAAY,CAACrB,CAAD,EAAG;AAACqB,IAAAA,YAAY,GAACrB,CAAb;AAAe;;AAAhC,CAA7B,EAA+D,EAA/D;AAkBjtD,MAAMsB,iBAAiB,GAAG;AACzBC,EAAAA,KAAK,EAAE,EADkB;AAEzBC,EAAAA,IAAI,EAAE,EAFmB;AAGzBC,EAAAA,YAAY,EAAE,EAHW;AAIzBC,EAAAA,UAAU,EAAE;AAJa,CAA1B;;AAOA,MAAMC,oBAAoB,GAAIC,IAAD,IAAU;AACtC,MAAI,CAACA,IAAL,EAAW;AACV,WAAON,iBAAP;AACA;;AAED,QAAM;AAAEC,IAAAA,KAAF;AAASC,IAAAA,IAAT;AAAeC,IAAAA,YAAf;AAA6BC,IAAAA;AAA7B,MAA4CE,IAAlD;AAEA,SAAO;AACNL,IAAAA,KAAK,EAAEA,KAAF,aAAEA,KAAF,cAAEA,KAAF,GAAW,EADV;AAENC,IAAAA,IAAI,EAAEA,IAAF,aAAEA,IAAF,cAAEA,IAAF,GAAU,EAFR;AAGNC,IAAAA,YAAY,EAAEA,YAAF,aAAEA,YAAF,cAAEA,YAAF,GAAkB,EAHxB;AAINC,IAAAA,UAAU,EAAEA,UAAF,aAAEA,UAAF,cAAEA,UAAF,GAAgB;AAJpB,GAAP;AAMA,CAbD;;AAeA,SAASG,QAAT,OAAgE;AAAA,MAA9C;AAAED,IAAAA,IAAF;AAAQE,IAAAA,OAAR;AAAiBC,IAAAA,MAAjB;AAAyBC,IAAAA,UAAzB;AAAqCC,IAAAA;AAArC,GAA8C;AAC/D,QAAMC,CAAC,GAAGlB,cAAc,EAAxB;AAEA,QAAM;AAAEmB,IAAAA,MAAM,EAAEC,UAAV;AAAsBC,IAAAA,QAAQ,EAAEC,YAAhC;AAA8CC,IAAAA,iBAAiB,EAAEC;AAAjE,MAA2FrB,OAAO,CAACQ,oBAAoB,CAACC,IAAD,CAArB,CAAxG;;AACA,QAAMa,mBAAmB,GAAG,MAAM/B,uBAAuB,CAAC,CAAC,iCAAD,EAAoC,iCAApC,CAAD,CAAzD;;AAEA,QAAM;AAAEgC,IAAAA,WAAF;AAAeC,IAAAA,UAAf;AAA2BC,IAAAA;AAA3B,MAAgDN,YAAtD;AACA,QAAM;AAAEf,IAAAA,KAAF;AAASC,IAAAA,IAAT;AAAeE,IAAAA;AAAf,MAA8BU,UAApC;AAEA,QAAMS,KAAK,GAAGpC,eAAe,CAACW,iBAAD,CAA7B;AAEA,QAAM;AAAE0B,IAAAA,mBAAmB,GAAG,MAAM,CAAE;AAAhC,MAAqCD,KAA3C;AAEA,QAAME,gBAAgB,GAAGD,mBAAmB,EAA5C;AAEA,QAAM;AACLX,IAAAA,MAAM,EAAEa,WADH;AAELX,IAAAA,QAAQ,EAAEY,iBAFL;AAGLV,IAAAA,iBAAiB,EAAEW;AAHd,MAIF/B,OAAO,CAAC;AACXM,IAAAA,YAAY,EAAEW,UAAU,CAACX;AADd,GAAD,CAJX;AAQA,QAAM;AAAE0B,IAAAA;AAAF,MAAyBF,iBAA/B;AACA,QAAM;AAAExB,IAAAA;AAAF,MAAmBuB,WAAzB;AAEA,QAAM,CAACI,iBAAD,EAAoBC,oBAApB,IAA4C9C,QAAQ,CAAC,EAAD,CAA1D;AAEA,QAAM;AAAE+C,IAAAA,KAAK,EAAEC,eAAT;AAA0BC,IAAAA,KAAK,EAAEC;AAAjC,MAAuDvC,eAAe,CAAC,wBAAD,CAA5E;AACA,QAAM;AAAEoC,IAAAA,KAAK,EAAEI,gBAAgB,GAAG,EAA5B;AAAgCF,IAAAA,KAAK,EAAEG;AAAvC,MAA2DzC,eAAe,CAAC,0BAAD,CAAhF;;AAEA,QAAM0C,0BAA0B,GAAIC,YAAD,IAAkB;AACpD,UAAMC,OAAO,GAAG,EAAhB;AACAD,IAAAA,YAAY,CAACE,OAAb,CAAqB,SAAwE;AAAA,UAAvE;AAAEC,QAAAA,GAAF;AAAOC,QAAAA,KAAP;AAAcC,QAAAA,UAAd;AAA0BC,QAAAA,OAA1B;AAAmCC,QAAAA,KAAnC;AAA0CC,QAAAA,YAA1C;AAAwDC,QAAAA;AAAxD,OAAuE;AAC3FJ,MAAAA,UAAU,KAAK,SAAhB,GAA8BE,KAAK,KAAK,MAAxC,KACEN,OAAO,CAACE,GAAD,CAAP,GAAe;AACfC,QAAAA,KADe;AAEfM,QAAAA,IAAI,EAAEJ,OAAO,GAAG,QAAH,GAAc,MAFZ;AAGfG,QAAAA,QAHe;AAIfD,QAAAA,YAJe;AAKfF,QAAAA,OAAO,EAAEA,OAAO,IAAIA,OAAO,CAACK,KAAR,CAAc,GAAd,EAAmBC,GAAnB,CAAwBC,IAAD,IAAUA,IAAI,CAACC,IAAL,EAAjC;AALL,OADjB;AAQA,KATD;AAUA,WAAOb,OAAP;AACA,GAbD;;AAeA,QAAMc,eAAe,GAAGpE,OAAO,CAC9B,MAAO+C,eAAe,IAAIA,eAAe,CAACM,YAAnC,GAAkDD,0BAA0B,CAACL,eAAe,CAACM,YAAjB,CAA5E,GAA6G,EADtF,EAE9B,CAACN,eAAD,CAF8B,CAA/B;AAKA,QAAMsB,oBAAoB,GAAG9D,uBAAuB,EAApD;AAEA,QAAM+D,QAAQ,GAAGhE,SAAS,CAAC,mBAAD,CAA1B;AAEA,QAAMiE,UAAU,GAAG1E,kBAAkB,CAAC,MAAO2E,CAAP,IAAa;AAClDA,IAAAA,CAAC,CAACC,cAAF;AACA,UAAMC,QAAQ,GAAG;AAChBlB,MAAAA,GAAG,EAAElC,OAAO,CAACkC;AADG,KAAjB;;AAIA,UAAMmB,QAAQ;AACbnB,MAAAA,GAAG,EAAEpC,IAAI,CAACoC,GADG;AAEbzC,MAAAA,KAFa;AAGbC,MAAAA,IAAI,EAAEA,IAAI,CAAC4D,IAAL,EAHO;AAIb3D,MAAAA;AAJa,OAKTC,UAAU,IAAI;AAAEA,MAAAA;AAAF,KALL,CAAd;;AAQA,QAAI;AACHoD,MAAAA,QAAQ,CAACI,QAAD,EAAWC,QAAX,CAAR;AACAN,MAAAA,oBAAoB,CAAC;AAAEN,QAAAA,IAAI,EAAE,SAAR;AAAmBc,QAAAA,OAAO,EAAEnD,CAAC,CAAC,OAAD;AAA7B,OAAD,CAApB;AACAH,MAAAA,MAAM,IAAIA,MAAM,EAAhB;AACAC,MAAAA,UAAU,IAAIA,UAAU,EAAxB;AACAC,MAAAA,KAAK;AACL,KAND,CAME,OAAOqD,KAAP,EAAc;AACfT,MAAAA,oBAAoB,CAAC;AAAEN,QAAAA,IAAI,EAAE,OAAR;AAAiBc,QAAAA,OAAO,EAAEC;AAA1B,OAAD,CAApB;AACA;AACD,GAvBoC,CAArC;AAyBA,QAAMC,WAAW,GAAG,CAAC/C,qBAAqB,IAAIU,6BAA1B,KAA4DE,iBAAiB,CAACoC,MAAlB,KAA6B,CAA7G;;AAEA,MAAI,CAAC/B,iBAAD,EAAoBE,eAApB,EAAqC8B,QAArC,CAA8CxE,eAAe,CAACyE,OAA9D,CAAJ,EAA4E;AAC3E,wBAAO,oBAAC,YAAD,OAAP;AACA;;AAED,QAAM;AAAEC,IAAAA;AAAF,MAAiBjC,gBAAvB;AAEA,sBACC,uDACC,oBAAC,WAAD,CAAa,iBAAb;AAA+B,IAAA,EAAE,EAAC;AAAlC,KACEjB,mBAAmB,MAAMc,eAAzB,iBACA,oBAAC,gBAAD;AACC,IAAA,gBAAgB,EAAEqB,eADnB;AAEC,IAAA,gBAAgB,EAAEnD,YAFnB;AAGC,IAAA,mBAAmB,EAAE0B,kBAHtB;AAIC,IAAA,oBAAoB,EAAEE;AAJvB,IAFF,eASC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,KAAP,QAAcnB,CAAC,CAAC,OAAD,CAAf,CADD,eAEC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,SAAD;AAAW,IAAA,QAAQ,EAAE,CAArB;AAAwB,IAAA,KAAK,EAAEX,KAA/B;AAAsC,IAAA,QAAQ,EAAEmB;AAAhD,IADD,CAFD,CATD,EAeE9B,IAAI,iBACJ,oBAAC,KAAD,qBACC,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAEY,IAAZ;AAAkB,IAAA,OAAO,EAAEmB;AAA3B,IADD,CAhBF,EAoBEI,gBAAgB,IAAI4C,UAApB,IAAkCA,UAAU,CAACH,MAAX,GAAoB,CAAtD,iBACA,oBAAC,gBAAD;AAAkB,IAAA,KAAK,EAAE9D,UAAzB;AAAqC,IAAA,KAAK,EAAEQ,CAAC,CAAC,UAAD,CAA7C;AAA2D,IAAA,OAAO,EAAEyD,UAApE;AAAgF,IAAA,OAAO,EAAE/C;AAAzF,IArBF,CADD,eAyBC,oBAAC,WAAD,CAAa,MAAb,qBACC,oBAAC,WAAD;AAAa,IAAA,OAAO;AAApB,kBACC,oBAAC,MAAD;AAAQ,IAAA,QAAQ,EAAE,CAAlB;AAAqB,IAAA,OAAO,EAAEX;AAA9B,KACEC,CAAC,CAAC,QAAD,CADH,CADD,eAIC,oBAAC,MAAD;AAAQ,IAAA,GAAG,EAAC,MAAZ;AAAmB,IAAA,QAAQ,EAAE,CAA7B;AAAgC,IAAA,OAAO,EAAE6C,UAAzC;AAAqD,IAAA,QAAQ,EAAE,CAACQ,WAAhE;AAA6E,IAAA,OAAO;AAApF,KACErD,CAAC,CAAC,MAAD,CADH,CAJD,CADD,CAzBD,CADD;AAsCA;;AAtKDrC,MAAM,CAAC+F,aAAP,CAwKe/D,QAxKf","sourcesContent":["import { Field, TextInput, ButtonGroup, Button } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useState, useMemo } from 'react';\nimport { useSubscription } from 'use-subscription';\n\nimport { hasAtLeastOnePermission } from '../../../../../../app/authorization/client';\nimport CustomFieldsForm from '../../../../../components/CustomFieldsForm';\nimport Tags from '../../../../../components/Omnichannel/Tags';\nimport VerticalBar from '../../../../../components/VerticalBar';\nimport { useMethod } from '../../../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../../../contexts/TranslationContext';\nimport { AsyncStatePhase } from '../../../../../hooks/useAsyncState';\nimport { useEndpointData } from '../../../../../hooks/useEndpointData';\nimport { useForm } from '../../../../../hooks/useForm';\nimport { formsSubscription } from '../../../additionalForms';\nimport { FormSkeleton } from '../../Skeleton';\n\nconst initialValuesRoom = {\n\ttopic: '',\n\ttags: [],\n\tlivechatData: {},\n\tpriorityId: '',\n};\n\nconst getInitialValuesRoom = (room) => {\n\tif (!room) {\n\t\treturn initialValuesRoom;\n\t}\n\n\tconst { topic, tags, livechatData, priorityId } = room;\n\n\treturn {\n\t\ttopic: topic ?? '',\n\t\ttags: tags ?? [],\n\t\tlivechatData: livechatData ?? {},\n\t\tpriorityId: priorityId ?? '',\n\t};\n};\n\nfunction RoomEdit({ room, visitor, reload, reloadInfo, close }) {\n\tconst t = useTranslation();\n\n\tconst { values: valuesRoom, handlers: handlersRoom, hasUnsavedChanges: hasUnsavedChangesRoom } = useForm(getInitialValuesRoom(room));\n\tconst canViewCustomFields = () => hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields']);\n\n\tconst { handleTopic, handleTags, handlePriorityId } = handlersRoom;\n\tconst { topic, tags, priorityId } = valuesRoom;\n\n\tconst forms = useSubscription(formsSubscription);\n\n\tconst { usePrioritiesSelect = () => {} } = forms;\n\n\tconst PrioritiesSelect = usePrioritiesSelect();\n\n\tconst {\n\t\tvalues: valueCustom,\n\t\thandlers: handleValueCustom,\n\t\thasUnsavedChanges: hasUnsavedChangesCustomFields,\n\t} = useForm({\n\t\tlivechatData: valuesRoom.livechatData,\n\t});\n\n\tconst { handleLivechatData } = handleValueCustom;\n\tconst { livechatData } = valueCustom;\n\n\tconst [customFieldsError, setCustomFieldsError] = useState([]);\n\n\tconst { value: allCustomFields, phase: stateCustomFields } = useEndpointData('livechat/custom-fields');\n\tconst { value: prioritiesResult = {}, phase: statePriorities } = useEndpointData('livechat/priorities.list');\n\n\tconst jsonConverterToValidFormat = (customFields) => {\n\t\tconst jsonObj = {};\n\t\tcustomFields.forEach(({ _id, label, visibility, options, scope, defaultValue, required }) => {\n\t\t\t(visibility === 'visible') & (scope === 'room') &&\n\t\t\t\t(jsonObj[_id] = {\n\t\t\t\t\tlabel,\n\t\t\t\t\ttype: options ? 'select' : 'text',\n\t\t\t\t\trequired,\n\t\t\t\t\tdefaultValue,\n\t\t\t\t\toptions: options && options.split(',').map((item) => item.trim()),\n\t\t\t\t});\n\t\t});\n\t\treturn jsonObj;\n\t};\n\n\tconst jsonCustomField = useMemo(\n\t\t() => (allCustomFields && allCustomFields.customFields ? jsonConverterToValidFormat(allCustomFields.customFields) : {}),\n\t\t[allCustomFields],\n\t);\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst saveRoom = useMethod('livechat:saveInfo');\n\n\tconst handleSave = useMutableCallback(async (e) => {\n\t\te.preventDefault();\n\t\tconst userData = {\n\t\t\t_id: visitor._id,\n\t\t};\n\n\t\tconst roomData = {\n\t\t\t_id: room._id,\n\t\t\ttopic,\n\t\t\ttags: tags.sort(),\n\t\t\tlivechatData,\n\t\t\t...(priorityId && { priorityId }),\n\t\t};\n\n\t\ttry {\n\t\t\tsaveRoom(userData, roomData);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\treload && reload();\n\t\t\treloadInfo && reloadInfo();\n\t\t\tclose();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst formIsValid = (hasUnsavedChangesRoom || hasUnsavedChangesCustomFields) && customFieldsError.length === 0;\n\n\tif ([stateCustomFields, statePriorities].includes(AsyncStatePhase.LOADING)) {\n\t\treturn <FormSkeleton />;\n\t}\n\n\tconst { priorities } = prioritiesResult;\n\n\treturn (\n\t\t<>\n\t\t\t<VerticalBar.ScrollableContent is='form'>\n\t\t\t\t{canViewCustomFields() && allCustomFields && (\n\t\t\t\t\t<CustomFieldsForm\n\t\t\t\t\t\tjsonCustomFields={jsonCustomField}\n\t\t\t\t\t\tcustomFieldsData={livechatData}\n\t\t\t\t\t\tsetCustomFieldsData={handleLivechatData}\n\t\t\t\t\t\tsetCustomFieldsError={setCustomFieldsError}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t<Field>\n\t\t\t\t\t<Field.Label>{t('Topic')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<TextInput flexGrow={1} value={topic} onChange={handleTopic} />\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t\t{Tags && (\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<Tags tags={tags} handler={handleTags} />\n\t\t\t\t\t</Field>\n\t\t\t\t)}\n\t\t\t\t{PrioritiesSelect && priorities && priorities.length > 0 && (\n\t\t\t\t\t<PrioritiesSelect value={priorityId} label={t('Priority')} options={priorities} handler={handlePriorityId} />\n\t\t\t\t)}\n\t\t\t</VerticalBar.ScrollableContent>\n\t\t\t<VerticalBar.Footer>\n\t\t\t\t<ButtonGroup stretch>\n\t\t\t\t\t<Button flexGrow={1} onClick={close}>\n\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button mie='none' flexGrow={1} onClick={handleSave} disabled={!formIsValid} primary>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</VerticalBar.Footer>\n\t\t</>\n\t);\n}\n\nexport default RoomEdit;\n"]},"sourceType":"module","hash":"e70d273980b628dca60678c8d78df6ef524ad3e8"}
