{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/OTR/OTRWithData.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/contextualBar/OTR/OTRWithData.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/OTR/OTRWithData.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/OTR/OTRWithData.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/contextualBar/OTR/OTRWithData.js"}},"code":"let useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n\n}, 0);\nlet React, useEffect, useMemo, useCallback;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  },\n\n  useCallback(v) {\n    useCallback = v;\n  }\n\n}, 1);\nlet ORTInstance;\nmodule.link(\"../../../../../app/otr/client/rocketchat.otr\", {\n  OTR(v) {\n    ORTInstance = v;\n  }\n\n}, 2);\nlet useSetModal;\nmodule.link(\"../../../../contexts/ModalContext\", {\n  useSetModal(v) {\n    useSetModal = v;\n  }\n\n}, 3);\nlet usePresence;\nmodule.link(\"../../../../hooks/usePresence\", {\n  usePresence(v) {\n    usePresence = v;\n  }\n\n}, 4);\nlet useReactiveValue;\nmodule.link(\"../../../../hooks/useReactiveValue\", {\n  useReactiveValue(v) {\n    useReactiveValue = v;\n  }\n\n}, 5);\nlet OTR;\nmodule.link(\"./OTR\", {\n  default(v) {\n    OTR = v;\n  }\n\n}, 6);\nlet OTRModal;\nmodule.link(\"./OTRModal\", {\n  default(v) {\n    OTRModal = v;\n  }\n\n}, 7);\n\nconst OTRWithData = _ref => {\n  var _usePresence;\n\n  let {\n    rid,\n    tabBar\n  } = _ref;\n  const onClickClose = useMutableCallback(() => tabBar && tabBar.close());\n  const setModal = useSetModal();\n  const closeModal = useMutableCallback(() => setModal());\n  const otr = useMemo(() => ORTInstance.getInstanceByRoomId(rid), [rid]);\n  const [isEstablished, isEstablishing] = useReactiveValue(useCallback(() => otr ? [otr.established.get(), otr.establishing.get()] : [false, false], [otr]));\n  const userStatus = (_usePresence = usePresence(otr.peerId)) === null || _usePresence === void 0 ? void 0 : _usePresence.status;\n  const isOnline = !['offline', 'loading'].includes(userStatus);\n\n  const handleStart = () => {\n    otr.handshake();\n  };\n\n  const handleEnd = () => otr === null || otr === void 0 ? void 0 : otr.end();\n\n  const handleReset = () => {\n    otr.reset();\n    otr.handshake(true);\n  };\n\n  useEffect(() => {\n    if (isEstablished) {\n      return closeModal();\n    }\n\n    if (!isEstablishing) {\n      return;\n    }\n\n    const timeout = setTimeout(() => {\n      otr.establishing.set(false);\n      setModal( /*#__PURE__*/React.createElement(OTRModal, {\n        onConfirm: closeModal,\n        onCancel: closeModal\n      }));\n    }, 10000);\n    return () => clearTimeout(timeout);\n  }, [closeModal, isEstablished, isEstablishing, setModal, otr]);\n  return /*#__PURE__*/React.createElement(OTR, {\n    isOnline: isOnline,\n    isEstablishing: isEstablishing,\n    isEstablished: isEstablished,\n    onClickClose: onClickClose,\n    onClickStart: handleStart,\n    onClickEnd: handleEnd,\n    onClickRefresh: handleReset\n  });\n};\n\nmodule.exportDefault(OTRWithData);","map":{"version":3,"sources":["client/views/room/contextualBar/OTR/OTRWithData.js"],"names":["useMutableCallback","module","link","v","React","useEffect","useMemo","useCallback","default","ORTInstance","OTR","useSetModal","usePresence","useReactiveValue","OTRModal","OTRWithData","rid","tabBar","onClickClose","close","setModal","closeModal","otr","getInstanceByRoomId","isEstablished","isEstablishing","established","get","establishing","userStatus","peerId","status","isOnline","includes","handleStart","handshake","handleEnd","end","handleReset","reset","timeout","setTimeout","set","clearTimeout","exportDefault"],"mappings":"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","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useCallback } from 'react';\n\nimport { OTR as ORTInstance } from '../../../../../app/otr/client/rocketchat.otr';\nimport { useSetModal } from '../../../../contexts/ModalContext';\nimport { usePresence } from '../../../../hooks/usePresence';\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\nimport OTR from './OTR';\nimport OTRModal from './OTRModal';\n\nconst OTRWithData = ({ rid, tabBar }) => {\n\tconst onClickClose = useMutableCallback(() => tabBar && tabBar.close());\n\n\tconst setModal = useSetModal();\n\tconst closeModal = useMutableCallback(() => setModal());\n\tconst otr = useMemo(() => ORTInstance.getInstanceByRoomId(rid), [rid]);\n\n\tconst [isEstablished, isEstablishing] = useReactiveValue(\n\t\tuseCallback(() => (otr ? [otr.established.get(), otr.establishing.get()] : [false, false]), [otr]),\n\t);\n\n\tconst userStatus = usePresence(otr.peerId)?.status;\n\n\tconst isOnline = !['offline', 'loading'].includes(userStatus);\n\n\tconst handleStart = () => {\n\t\totr.handshake();\n\t};\n\n\tconst handleEnd = () => otr?.end();\n\n\tconst handleReset = () => {\n\t\totr.reset();\n\t\totr.handshake(true);\n\t};\n\n\tuseEffect(() => {\n\t\tif (isEstablished) {\n\t\t\treturn closeModal();\n\t\t}\n\n\t\tif (!isEstablishing) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\totr.establishing.set(false);\n\t\t\tsetModal(<OTRModal onConfirm={closeModal} onCancel={closeModal} />);\n\t\t}, 10000);\n\n\t\treturn () => clearTimeout(timeout);\n\t}, [closeModal, isEstablished, isEstablishing, setModal, otr]);\n\n\treturn (\n\t\t<OTR\n\t\t\tisOnline={isOnline}\n\t\t\tisEstablishing={isEstablishing}\n\t\t\tisEstablished={isEstablished}\n\t\t\tonClickClose={onClickClose}\n\t\t\tonClickStart={handleStart}\n\t\t\tonClickEnd={handleEnd}\n\t\t\tonClickRefresh={handleReset}\n\t\t/>\n\t);\n};\n\nexport default OTRWithData;\n"]},"sourceType":"module","hash":"962bfa867f4fb28db847c90fb3cf7962fcf7f0b1"}
