{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/externalFrame/externalFrameContainer.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/livechat/client/externalFrame/externalFrameContainer.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/externalFrame/externalFrameContainer.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/externalFrame/externalFrameContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/client/externalFrame/externalFrameContainer.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 1);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 2);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 3);\nvar APIClient;\nmodule.link(\"../../../utils/client\", {\n  APIClient: function (v) {\n    APIClient = v;\n  }\n}, 4);\nvar settings;\nmodule.link(\"../../../settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 5);\nvar encrypt, getKeyFromString;\nmodule.link(\"./crypto\", {\n  encrypt: function (v) {\n    encrypt = v;\n  },\n  getKeyFromString: function (v) {\n    getKeyFromString = v;\n  }\n}, 6);\nmodule.link(\"./externalFrameContainer.html\");\nTemplate.ExternalFrameContainer.helpers({\n  externalFrameUrl: function () {\n    var authToken = Template.instance().authToken.get();\n\n    if (!authToken) {\n      return '';\n    }\n\n    var frameURLSetting = settings.get('Omnichannel_External_Frame_URL');\n\n    try {\n      var frameURL = new URL(frameURLSetting);\n      frameURL.searchParams.append('uid', Meteor.userId());\n      frameURL.searchParams.append('rid', Session.get('openedRoom'));\n      frameURL.searchParams.append('t', authToken);\n      return frameURL.toString();\n    } catch (_unused) {\n      console.error('Invalid URL provided to external frame');\n      return '';\n    }\n  }\n});\nTemplate.ExternalFrameContainer.onCreated(function () {\n  function _callee() {\n    var _APIClient$getCredent, authToken, keyStr;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              this.authToken = new ReactiveVar();\n              _APIClient$getCredent = APIClient.getCredentials(), authToken = _APIClient$getCredent['X-Auth-Token'];\n              keyStr = settings.get('Omnichannel_External_Frame_Encryption_JWK');\n\n              if (!keyStr) {\n                _context.next = 16;\n                break;\n              }\n\n              _context.t0 = this.authToken;\n              _context.t1 = _regeneratorRuntime;\n              _context.t2 = encrypt;\n              _context.t3 = authToken;\n              _context.next = 10;\n              return _regeneratorRuntime.awrap(getKeyFromString(keyStr));\n\n            case 10:\n              _context.t4 = _context.sent;\n              _context.t5 = (0, _context.t2)(_context.t3, _context.t4);\n              _context.next = 14;\n              return _context.t1.awrap.call(_context.t1, _context.t5);\n\n            case 14:\n              _context.t6 = _context.sent;\n              return _context.abrupt(\"return\", _context.t0.set.call(_context.t0, _context.t6));\n\n            case 16:\n              this.authToken.set(authToken);\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }\n\n      return _callee$;\n    }(), null, this, null, Promise);\n  }\n\n  return _callee;\n}());","map":{"version":3,"sources":["app/livechat/client/externalFrame/externalFrameContainer.js"],"names":["_regeneratorRuntime","module","link","default","v","Meteor","Template","Session","ReactiveVar","APIClient","settings","encrypt","getKeyFromString","ExternalFrameContainer","helpers","externalFrameUrl","authToken","instance","get","frameURLSetting","frameURL","URL","searchParams","append","userId","toString","console","error","onCreated","getCredentials","keyStr","set"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\nimport { Session } from 'meteor/session';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { APIClient } from '../../../utils/client';\nimport { settings } from '../../../settings/client';\nimport { encrypt, getKeyFromString } from './crypto';\n\nimport './externalFrameContainer.html';\n\nTemplate.ExternalFrameContainer.helpers({\n\texternalFrameUrl() {\n\t\tconst authToken = Template.instance().authToken.get();\n\n\t\tif (!authToken) {\n\t\t\treturn '';\n\t\t}\n\n\t\tconst frameURLSetting = settings.get('Omnichannel_External_Frame_URL');\n\n\t\ttry {\n\t\t\tconst frameURL = new URL(frameURLSetting);\n\n\t\t\tframeURL.searchParams.append('uid', Meteor.userId());\n\t\t\tframeURL.searchParams.append('rid', Session.get('openedRoom'));\n\t\t\tframeURL.searchParams.append('t', authToken);\n\n\t\t\treturn frameURL.toString();\n\t\t} catch {\n\t\t\tconsole.error('Invalid URL provided to external frame');\n\n\t\t\treturn '';\n\t\t}\n\t},\n});\n\nTemplate.ExternalFrameContainer.onCreated(async function () {\n\tthis.authToken = new ReactiveVar();\n\n\tconst { 'X-Auth-Token': authToken } = APIClient.getCredentials();\n\tconst keyStr = settings.get('Omnichannel_External_Frame_Encryption_JWK');\n\n\tif (keyStr) {\n\t\treturn this.authToken.set(await encrypt(authToken, await getKeyFromString(keyStr)));\n\t}\n\n\tthis.authToken.set(authToken);\n});\n"]},"sourceType":"module","hash":"b7fa8f198fb9c1feb309de66e30e24f9f6b3d0e4"}
