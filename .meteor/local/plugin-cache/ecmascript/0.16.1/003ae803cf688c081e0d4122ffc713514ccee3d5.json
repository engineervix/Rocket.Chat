{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/ee/app/canned-responses/client/views/tabbar/cannedResponses.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"ee/app/canned-responses/client/views/tabbar/cannedResponses.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/ee/app/canned-responses/client/views/tabbar/cannedResponses.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/ee/app/canned-responses/client/views/tabbar/cannedResponses.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"ee/app/canned-responses/client/views/tabbar/cannedResponses.js"}},"code":"let ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 2);\nlet CannedResponse;\nmodule.link(\"../../collections/CannedResponse\", {\n  CannedResponse(v) {\n    CannedResponse = v;\n  }\n\n}, 3);\nlet t;\nmodule.link(\"../../../../../../app/utils\", {\n  t(v) {\n    t = v;\n  }\n\n}, 4);\nlet chatMessages;\nmodule.link(\"../../../../../../app/ui/client\", {\n  chatMessages(v) {\n    chatMessages = v;\n  }\n\n}, 5);\nlet handleError;\nmodule.link(\"../../../../../../client/lib/utils/handleError\", {\n  handleError(v) {\n    handleError = v;\n  }\n\n}, 6);\nlet dispatchToastMessage;\nmodule.link(\"../../../../../../client/lib/toast\", {\n  dispatchToastMessage(v) {\n    dispatchToastMessage = v;\n  }\n\n}, 7);\nmodule.link(\"./cannedResponses.html\");\nTemplate.cannedResponses.helpers({\n  cannedResponses() {\n    const searchText = Template.instance().searchText.get().toLocaleLowerCase();\n    let query = {};\n\n    if (Template.instance().context.get() === 'department') {\n      query = {\n        scope: 'department',\n        departmentId: Template.instance().departmentId\n      };\n    }\n\n    if (searchText) {\n      const regex = new RegExp(searchText, 'i');\n      query.$or = [{\n        shortcut: {\n          $regex: regex\n        }\n      }, {\n        text: {\n          $regex: regex\n        }\n      }];\n    }\n\n    return CannedResponse.find(query);\n  },\n\n  hasNoCannedResponses() {\n    return CannedResponse.find().count() === 0;\n  },\n\n  isDetailScreen() {\n    return ['edit', 'new', 'view'].includes(Template.instance().action.get());\n  },\n\n  isNewResponse() {\n    return Template.instance().action.get() === 'new';\n  },\n\n  isExistingResponse() {\n    return ['edit', 'view'].includes(Template.instance().action.get());\n  },\n\n  isUserContext() {\n    return Template.instance().context.get() === 'user';\n  },\n\n  searchText() {\n    return Template.instance().searchText.get();\n  },\n\n  isDepartmentContext() {\n    return Template.instance().context.get() === 'department';\n  },\n\n  cannedResponse() {\n    return Template.instance().cannedResponse.get();\n  },\n\n  canDeleteResponse() {\n    const action = Template.instance().action.get();\n\n    if (action !== 'edit') {\n      return false;\n    }\n\n    const response = Template.instance().cannedResponse.get();\n    const context = Template.instance().context.get();\n    return response.scope === context;\n  },\n\n  canModifyResponse() {\n    const action = Template.instance().action.get();\n\n    if (action === 'new') {\n      return true;\n    }\n\n    const response = Template.instance().cannedResponse.get();\n    const context = Template.instance().context.get();\n    return response.scope === context;\n  },\n\n  createdByString() {\n    const username = this.createdBy;\n    const me = Meteor.users.findOne(Meteor.userId());\n\n    if (me.username === username) {\n      return t('Me');\n    }\n\n    return username;\n  },\n\n  isPreviewMode() {\n    return Template.instance().action.get() === 'view';\n  }\n\n});\nTemplate.cannedResponses.events({\n  'click .new-canned-response-btn'(e, instance) {\n    e.preventDefault();\n    e.stopPropagation();\n    instance.cannedResponse.set({\n      shortcut: '',\n      text: ''\n    });\n    instance.action.set('new');\n  },\n\n  'click .canned-response'(e, instance) {\n    e.preventDefault();\n    e.stopPropagation();\n    const {\n      _id\n    } = this;\n    const cannedResponse = CannedResponse.findOne({\n      _id\n    });\n\n    if (!cannedResponse) {\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Invalid Canned Response')\n      });\n    }\n\n    instance.cannedResponse.set(cannedResponse);\n    const canEdit = instance.context.get() === cannedResponse.scope;\n    instance.action.set(canEdit ? 'edit' : 'view');\n  },\n\n  'click .delete-canned-response'(e, instance) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const _id = instance.$('input[name=id]').val();\n\n    Meteor.call('removeCannedResponse', _id, error => {\n      if (error) {\n        return handleError(error);\n      }\n\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Canned_Response_Removed')\n      });\n      instance.action.set(null);\n    });\n  },\n\n  'click .cancel-canned-response-btn'(e, instance) {\n    e.preventDefault();\n    e.stopPropagation();\n    instance.action.set(null);\n  },\n\n  'click .use-canned-response-btn'(e, instance) {\n    e.preventDefault();\n    e.stopPropagation();\n    const {\n      rid\n    } = Template.currentData();\n\n    if (!rid) {\n      return;\n    }\n\n    const object = instance.cannedResponse.get();\n    const {\n      input\n    } = chatMessages[rid];\n    const {\n      text\n    } = object;\n\n    if (document.selection) {\n      input.focus();\n      const sel = document.selection.createRange();\n      sel.text = text;\n      return;\n    }\n\n    if (input.selectionStart || input.selectionStart === 0) {\n      const startPos = input.selectionStart;\n      const endPos = input.selectionEnd;\n      const prefix = input.value.substring(0, startPos);\n      const suffix = input.value.substring(endPos, input.value.length);\n      input.value = \"\".concat(prefix).concat(text).concat(suffix);\n      input.selectionStart = startPos + text.length;\n      input.selectionEnd = startPos + text.length;\n      input.focus();\n      instance.action.set(null);\n      return;\n    }\n\n    input.value += text;\n  },\n\n  'click .save-canned-response-btn'(e, instance) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const _id = instance.$('input[name=id]').val();\n\n    const shortcut = instance.$('input[name=shortcut]').val();\n    const text = instance.$('textarea[name=text]').val();\n    const responseData = {\n      shortcut,\n      text\n    };\n    const context = instance.context.get();\n\n    if (context === 'department') {\n      if (!instance.departmentId) {\n        dispatchToastMessage({\n          type: 'error',\n          message: t('Invalid_Department')\n        });\n        return;\n      }\n\n      responseData.scope = 'department';\n      responseData.departmentId = instance.departmentId;\n    } else {\n      responseData.scope = 'user';\n    }\n\n    Meteor.call('saveCannedResponse', _id, responseData, function (error\n    /* , result*/\n    ) {\n      if (error) {\n        return handleError(error);\n      }\n\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Saved')\n      });\n      instance.action.set(null);\n    });\n  },\n\n  'keyup .js-search'(event, instance) {\n    instance.searchText.set(event.currentTarget.value || '');\n  }\n\n});\nTemplate.cannedResponses.onCreated(function () {\n  this.action = new ReactiveVar();\n  this.context = new ReactiveVar();\n  this.cannedResponse = new ReactiveVar();\n  this.searchText = new ReactiveVar('');\n  this.departmentId = null;\n\n  if (this.data && this.data.context) {\n    this.context.set(this.data.context);\n\n    if (this.data.context === 'department') {\n      this.departmentId = this.data.departmentId;\n    }\n  } else {\n    this.context.set('user');\n  }\n});","map":{"version":3,"sources":["ee/app/canned-responses/client/views/tabbar/cannedResponses.js"],"names":["ReactiveVar","module","link","v","Meteor","Template","CannedResponse","t","chatMessages","handleError","dispatchToastMessage","cannedResponses","helpers","searchText","instance","get","toLocaleLowerCase","query","context","scope","departmentId","regex","RegExp","$or","shortcut","$regex","text","find","hasNoCannedResponses","count","isDetailScreen","includes","action","isNewResponse","isExistingResponse","isUserContext","isDepartmentContext","cannedResponse","canDeleteResponse","response","canModifyResponse","createdByString","username","createdBy","me","users","findOne","userId","isPreviewMode","events","e","preventDefault","stopPropagation","set","_id","type","message","canEdit","$","val","call","error","rid","currentData","object","input","document","selection","focus","sel","createRange","selectionStart","startPos","endPos","selectionEnd","prefix","value","substring","suffix","length","responseData","event","currentTarget","onCreated","data"],"mappings":"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","sourcesContent":["import { ReactiveVar } from 'meteor/reactive-var';\nimport { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\n\nimport { CannedResponse } from '../../collections/CannedResponse';\nimport { t } from '../../../../../../app/utils';\nimport { chatMessages } from '../../../../../../app/ui/client';\nimport { handleError } from '../../../../../../client/lib/utils/handleError';\nimport { dispatchToastMessage } from '../../../../../../client/lib/toast';\n\nimport './cannedResponses.html';\n\nTemplate.cannedResponses.helpers({\n\tcannedResponses() {\n\t\tconst searchText = Template.instance().searchText.get().toLocaleLowerCase();\n\n\t\tlet query = {};\n\n\t\tif (Template.instance().context.get() === 'department') {\n\t\t\tquery = {\n\t\t\t\tscope: 'department',\n\t\t\t\tdepartmentId: Template.instance().departmentId,\n\t\t\t};\n\t\t}\n\n\t\tif (searchText) {\n\t\t\tconst regex = new RegExp(searchText, 'i');\n\t\t\tquery.$or = [\n\t\t\t\t{\n\t\t\t\t\tshortcut: {\n\t\t\t\t\t\t$regex: regex,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: {\n\t\t\t\t\t\t$regex: regex,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\t\treturn CannedResponse.find(query);\n\t},\n\n\thasNoCannedResponses() {\n\t\treturn CannedResponse.find().count() === 0;\n\t},\n\n\tisDetailScreen() {\n\t\treturn ['edit', 'new', 'view'].includes(Template.instance().action.get());\n\t},\n\n\tisNewResponse() {\n\t\treturn Template.instance().action.get() === 'new';\n\t},\n\n\tisExistingResponse() {\n\t\treturn ['edit', 'view'].includes(Template.instance().action.get());\n\t},\n\n\tisUserContext() {\n\t\treturn Template.instance().context.get() === 'user';\n\t},\n\n\tsearchText() {\n\t\treturn Template.instance().searchText.get();\n\t},\n\n\tisDepartmentContext() {\n\t\treturn Template.instance().context.get() === 'department';\n\t},\n\n\tcannedResponse() {\n\t\treturn Template.instance().cannedResponse.get();\n\t},\n\n\tcanDeleteResponse() {\n\t\tconst action = Template.instance().action.get();\n\n\t\tif (action !== 'edit') {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst response = Template.instance().cannedResponse.get();\n\t\tconst context = Template.instance().context.get();\n\n\t\treturn response.scope === context;\n\t},\n\n\tcanModifyResponse() {\n\t\tconst action = Template.instance().action.get();\n\n\t\tif (action === 'new') {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst response = Template.instance().cannedResponse.get();\n\t\tconst context = Template.instance().context.get();\n\n\t\treturn response.scope === context;\n\t},\n\n\tcreatedByString() {\n\t\tconst username = this.createdBy;\n\n\t\tconst me = Meteor.users.findOne(Meteor.userId());\n\n\t\tif (me.username === username) {\n\t\t\treturn t('Me');\n\t\t}\n\n\t\treturn username;\n\t},\n\n\tisPreviewMode() {\n\t\treturn Template.instance().action.get() === 'view';\n\t},\n});\n\nTemplate.cannedResponses.events({\n\t'click .new-canned-response-btn'(e, instance) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tinstance.cannedResponse.set({\n\t\t\tshortcut: '',\n\t\t\ttext: '',\n\t\t});\n\t\tinstance.action.set('new');\n\t},\n\n\t'click .canned-response'(e, instance) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst { _id } = this;\n\n\t\tconst cannedResponse = CannedResponse.findOne({ _id });\n\t\tif (!cannedResponse) {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Invalid Canned Response') });\n\t\t}\n\n\t\tinstance.cannedResponse.set(cannedResponse);\n\t\tconst canEdit = instance.context.get() === cannedResponse.scope;\n\n\t\tinstance.action.set(canEdit ? 'edit' : 'view');\n\t},\n\n\t'click .delete-canned-response'(e, instance) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst _id = instance.$('input[name=id]').val();\n\n\t\tMeteor.call('removeCannedResponse', _id, (error) => {\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Canned_Response_Removed') });\n\t\t\tinstance.action.set(null);\n\t\t});\n\t},\n\n\t'click .cancel-canned-response-btn'(e, instance) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tinstance.action.set(null);\n\t},\n\n\t'click .use-canned-response-btn'(e, instance) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst { rid } = Template.currentData();\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst object = instance.cannedResponse.get();\n\t\tconst { input } = chatMessages[rid];\n\t\tconst { text } = object;\n\n\t\tif (document.selection) {\n\t\t\tinput.focus();\n\t\t\tconst sel = document.selection.createRange();\n\t\t\tsel.text = text;\n\t\t\treturn;\n\t\t}\n\n\t\tif (input.selectionStart || input.selectionStart === 0) {\n\t\t\tconst startPos = input.selectionStart;\n\t\t\tconst endPos = input.selectionEnd;\n\n\t\t\tconst prefix = input.value.substring(0, startPos);\n\t\t\tconst suffix = input.value.substring(endPos, input.value.length);\n\n\t\t\tinput.value = `${prefix}${text}${suffix}`;\n\t\t\tinput.selectionStart = startPos + text.length;\n\t\t\tinput.selectionEnd = startPos + text.length;\n\n\t\t\tinput.focus();\n\t\t\tinstance.action.set(null);\n\t\t\treturn;\n\t\t}\n\n\t\tinput.value += text;\n\t},\n\n\t'click .save-canned-response-btn'(e, instance) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst _id = instance.$('input[name=id]').val();\n\t\tconst shortcut = instance.$('input[name=shortcut]').val();\n\t\tconst text = instance.$('textarea[name=text]').val();\n\n\t\tconst responseData = {\n\t\t\tshortcut,\n\t\t\ttext,\n\t\t};\n\n\t\tconst context = instance.context.get();\n\t\tif (context === 'department') {\n\t\t\tif (!instance.departmentId) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Invalid_Department') });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresponseData.scope = 'department';\n\t\t\tresponseData.departmentId = instance.departmentId;\n\t\t} else {\n\t\t\tresponseData.scope = 'user';\n\t\t}\n\n\t\tMeteor.call('saveCannedResponse', _id, responseData, function (error /* , result*/) {\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\tinstance.action.set(null);\n\t\t});\n\t},\n\n\t'keyup .js-search'(event, instance) {\n\t\tinstance.searchText.set(event.currentTarget.value || '');\n\t},\n});\n\nTemplate.cannedResponses.onCreated(function () {\n\tthis.action = new ReactiveVar();\n\tthis.context = new ReactiveVar();\n\tthis.cannedResponse = new ReactiveVar();\n\tthis.searchText = new ReactiveVar('');\n\tthis.departmentId = null;\n\n\tif (this.data && this.data.context) {\n\t\tthis.context.set(this.data.context);\n\n\t\tif (this.data.context === 'department') {\n\t\t\tthis.departmentId = this.data.departmentId;\n\t\t}\n\t} else {\n\t\tthis.context.set('user');\n\t}\n});\n"]},"sourceType":"module","hash":"003ae803cf688c081e0d4122ffc713514ccee3d5"}
