{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/messageBox/messageBoxActions.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-message/client/messageBox/messageBoxActions.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/messageBox/messageBoxActions.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/messageBox/messageBoxActions.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/messageBox/messageBoxActions.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _toConsumableArray;\n\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 1);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Random;\nmodule.link(\"meteor/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar VRecDialog;\nmodule.link(\"../../../ui-vrecord/client\", {\n  VRecDialog: function (v) {\n    VRecDialog = v;\n  }\n}, 4);\nvar messageBox, modal;\nmodule.link(\"../../../ui-utils\", {\n  messageBox: function (v) {\n    messageBox = v;\n  },\n  modal: function (v) {\n    modal = v;\n  }\n}, 5);\nvar fileUpload;\nmodule.link(\"../../../ui\", {\n  fileUpload: function (v) {\n    fileUpload = v;\n  }\n}, 6);\nvar settings;\nmodule.link(\"../../../settings\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 7);\nvar t;\nmodule.link(\"../../../utils\", {\n  t: function (v) {\n    t = v;\n  }\n}, 8);\nmessageBox.actions.add('Create_new', 'Video_message', {\n  id: 'video-message',\n  icon: 'video',\n  condition: function () {\n    return (navigator.mediaDevices || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia) && window.MediaRecorder && settings.get('FileUpload_Enabled') && settings.get('Message_VideoRecorderEnabled') && (!settings.get('FileUpload_MediaTypeBlackList') || !settings.get('FileUpload_MediaTypeBlackList').match(/video\\/webm|video\\/\\*/i)) && (!settings.get('FileUpload_MediaTypeWhiteList') || settings.get('FileUpload_MediaTypeWhiteList').match(/video\\/webm|video\\/\\*/i));\n  },\n  action: function (_ref) {\n    var rid = _ref.rid,\n        tmid = _ref.tmid,\n        messageBox = _ref.messageBox;\n    return VRecDialog.opened ? VRecDialog.close() : VRecDialog.open(messageBox, {\n      rid: rid,\n      tmid: tmid\n    });\n  }\n});\nmessageBox.actions.add('Add_files_from', 'Computer', {\n  id: 'file-upload',\n  icon: 'computer',\n  condition: function () {\n    return settings.get('FileUpload_Enabled');\n  },\n  action: function (_ref2) {\n    var rid = _ref2.rid,\n        tmid = _ref2.tmid,\n        event = _ref2.event,\n        messageBox = _ref2.messageBox;\n    event.preventDefault();\n    var $input = $(document.createElement('input'));\n    $input.css('display', 'none');\n    $input.attr({\n      id: 'fileupload-input',\n      type: 'file',\n      multiple: 'multiple'\n    });\n    $(document.body).append($input);\n    $input.one('change', function () {\n      function _callee(e) {\n        var _await$module$dynamic, mime, filesToUpload;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return _regeneratorRuntime.awrap(module.dynamicImport('../../../utils/lib/mimeTypes'));\n\n                case 2:\n                  _await$module$dynamic = _context.sent;\n                  mime = _await$module$dynamic.mime;\n                  filesToUpload = _toConsumableArray(e.target.files).map(function (file) {\n                    Object.defineProperty(file, 'type', {\n                      value: mime.lookup(file.name)\n                    });\n                    return {\n                      file: file,\n                      name: file.name\n                    };\n                  });\n                  fileUpload(filesToUpload, $('.js-input-message', messageBox).get(0), {\n                    rid: rid,\n                    tmid: tmid\n                  });\n                  $input.remove();\n\n                case 7:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }\n\n          return _callee$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee;\n    }());\n    $input.click(); // Simple hack for iOS aka codegueira\n\n    if (navigator.userAgent.match(/(iPad|iPhone|iPod)/g)) {\n      $input.click();\n    }\n  }\n});\nvar canGetGeolocation = new ReactiveVar(false);\n\nvar getGeolocationPermission = function () {\n  return new Promise(function (resolve) {\n    if (!navigator.permissions) {\n      resolve(true);\n    }\n\n    navigator.permissions.query({\n      name: 'geolocation'\n    }).then(function (_ref3) {\n      var state = _ref3.state;\n      resolve(state);\n    });\n  });\n};\n\nvar getGeolocationPosition = function () {\n  return new Promise(function (resolvePos) {\n    navigator.geolocation.getCurrentPosition(resolvePos, function () {\n      resolvePos(false);\n    }, {\n      enableHighAccuracy: true,\n      maximumAge: 0,\n      timeout: 10000\n    });\n  });\n};\n\nvar getCoordinates = function () {\n  function _callee3() {\n    var status, resolveModal, modalAnswer, _position, position;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(getGeolocationPermission());\n\n            case 2:\n              status = _context3.sent;\n\n              if (!(status === 'prompt')) {\n                _context3.next = 10;\n                break;\n              }\n\n              modalAnswer = new Promise(function (resolve) {\n                resolveModal = resolve;\n              });\n              modal.open({\n                title: t('You_will_be_asked_for_permissions'),\n                confirmButtonText: t('Continue'),\n                showCancelButton: true,\n                closeOnConfirm: true,\n                closeOnCancel: true\n              }, function () {\n                function _callee2(isConfirm) {\n                  var position, newStatus;\n                  return _regeneratorRuntime.async(function () {\n                    function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            if (!isConfirm) {\n                              resolveModal(false);\n                            }\n\n                            _context2.next = 3;\n                            return _regeneratorRuntime.awrap(getGeolocationPosition());\n\n                          case 3:\n                            position = _context2.sent;\n\n                            if (!position) {\n                              newStatus = getGeolocationPermission();\n                              resolveModal(newStatus);\n                            }\n\n                            resolveModal(position);\n\n                          case 6:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }\n\n                    return _callee2$;\n                  }(), null, null, null, Promise);\n                }\n\n                return _callee2;\n              }());\n              _context3.next = 8;\n              return _regeneratorRuntime.awrap(modalAnswer);\n\n            case 8:\n              _position = _context3.sent;\n              return _context3.abrupt(\"return\", _position);\n\n            case 10:\n              if (!(status === 'denied')) {\n                _context3.next = 12;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", status);\n\n            case 12:\n              _context3.next = 14;\n              return _regeneratorRuntime.awrap(getGeolocationPosition());\n\n            case 14:\n              position = _context3.sent;\n              return _context3.abrupt(\"return\", position);\n\n            case 16:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }\n\n      return _callee3$;\n    }(), null, null, null, Promise);\n  }\n\n  return _callee3;\n}();\n\nmessageBox.actions.add('Share', 'My_location', {\n  id: 'share-location',\n  icon: 'map-pin',\n  condition: function () {\n    return canGetGeolocation.get();\n  },\n  action: function () {\n    function _callee4(_ref4) {\n      var rid, tmid, position, _position$coords, latitude, longitude, text;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                rid = _ref4.rid, tmid = _ref4.tmid;\n                _context4.next = 3;\n                return _regeneratorRuntime.awrap(getCoordinates());\n\n              case 3:\n                position = _context4.sent;\n\n                if (position) {\n                  _context4.next = 6;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\");\n\n              case 6:\n                if (!(position === 'denied')) {\n                  _context4.next = 9;\n                  break;\n                }\n\n                modal.open({\n                  title: t('Cannot_share_your_location'),\n                  text: t('The_necessary_browser_permissions_for_location_sharing_are_not_granted'),\n                  confirmButtonText: t('Ok'),\n                  closeOnConfirm: true\n                });\n                return _context4.abrupt(\"return\");\n\n              case 9:\n                _position$coords = position.coords, latitude = _position$coords.latitude, longitude = _position$coords.longitude;\n                text = \"<div class=\\\"upload-preview\\\"><div class=\\\"upload-preview-file\\\" style=\\\"background-size: cover; box-shadow: 0 0 0px 1px #dfdfdf; border-radius: 2px; height: 250px; width:100%; max-width: 500px; background-image:url(https://maps.googleapis.com/maps/api/staticmap?zoom=14&size=500x250&markers=color:gray%7Clabel:%7C\" + latitude + \",\" + longitude + \"&key=\" + settings.get('MapView_GMapsAPIKey') + \")\\\" ></div></div>\";\n                modal.open({\n                  title: t('Share_Location_Title'),\n                  text: text,\n                  showCancelButton: true,\n                  closeOnConfirm: true,\n                  closeOnCancel: true,\n                  html: true\n                }, function (isConfirm) {\n                  if (isConfirm !== true) {\n                    return;\n                  }\n\n                  Meteor.call('sendMessage', {\n                    _id: Random.id(),\n                    rid: rid,\n                    tmid: tmid,\n                    msg: '',\n                    location: {\n                      type: 'Point',\n                      coordinates: [longitude, latitude]\n                    }\n                  });\n                });\n\n              case 12:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }\n\n        return _callee4$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee4;\n  }()\n});\nMeteor.startup(function () {\n  Tracker.autorun(function () {\n    var isMapViewEnabled = settings.get('MapView_Enabled') === true;\n    var isGeolocationCurrentPositionSupported = navigator.geolocation && navigator.geolocation.getCurrentPosition;\n    var googleMapsApiKey = settings.get('MapView_GMapsAPIKey');\n    canGetGeolocation.set(isMapViewEnabled && isGeolocationCurrentPositionSupported && googleMapsApiKey && googleMapsApiKey.length);\n  });\n});","map":{"version":3,"sources":["app/ui-message/client/messageBox/messageBoxActions.js"],"names":["_regeneratorRuntime","module","link","default","v","_toConsumableArray","Meteor","Random","ReactiveVar","Tracker","VRecDialog","messageBox","modal","fileUpload","settings","t","actions","add","id","icon","condition","navigator","mediaDevices","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","window","MediaRecorder","get","match","action","rid","tmid","opened","close","open","event","preventDefault","$input","$","document","createElement","css","attr","type","multiple","body","append","one","e","mime","filesToUpload","target","files","map","file","Object","defineProperty","value","lookup","name","remove","click","userAgent","canGetGeolocation","getGeolocationPermission","Promise","resolve","permissions","query","then","state","getGeolocationPosition","resolvePos","geolocation","getCurrentPosition","enableHighAccuracy","maximumAge","timeout","getCoordinates","status","modalAnswer","resolveModal","title","confirmButtonText","showCancelButton","closeOnConfirm","closeOnCancel","isConfirm","position","newStatus","text","coords","latitude","longitude","html","call","_id","msg","location","coordinates","startup","autorun","isMapViewEnabled","isGeolocationCurrentPositionSupported","googleMapsApiKey","set","length"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport { VRecDialog } from '../../../ui-vrecord/client';\nimport { messageBox, modal } from '../../../ui-utils';\nimport { fileUpload } from '../../../ui';\nimport { settings } from '../../../settings';\nimport { t } from '../../../utils';\n\nmessageBox.actions.add('Create_new', 'Video_message', {\n\tid: 'video-message',\n\ticon: 'video',\n\tcondition: () =>\n\t\t(navigator.mediaDevices ||\n\t\t\tnavigator.getUserMedia ||\n\t\t\tnavigator.webkitGetUserMedia ||\n\t\t\tnavigator.mozGetUserMedia ||\n\t\t\tnavigator.msGetUserMedia) &&\n\t\twindow.MediaRecorder &&\n\t\tsettings.get('FileUpload_Enabled') &&\n\t\tsettings.get('Message_VideoRecorderEnabled') &&\n\t\t(!settings.get('FileUpload_MediaTypeBlackList') || !settings.get('FileUpload_MediaTypeBlackList').match(/video\\/webm|video\\/\\*/i)) &&\n\t\t(!settings.get('FileUpload_MediaTypeWhiteList') || settings.get('FileUpload_MediaTypeWhiteList').match(/video\\/webm|video\\/\\*/i)),\n\taction: ({ rid, tmid, messageBox }) => (VRecDialog.opened ? VRecDialog.close() : VRecDialog.open(messageBox, { rid, tmid })),\n});\n\nmessageBox.actions.add('Add_files_from', 'Computer', {\n\tid: 'file-upload',\n\ticon: 'computer',\n\tcondition: () => settings.get('FileUpload_Enabled'),\n\taction({ rid, tmid, event, messageBox }) {\n\t\tevent.preventDefault();\n\t\tconst $input = $(document.createElement('input'));\n\t\t$input.css('display', 'none');\n\t\t$input.attr({\n\t\t\tid: 'fileupload-input',\n\t\t\ttype: 'file',\n\t\t\tmultiple: 'multiple',\n\t\t});\n\n\t\t$(document.body).append($input);\n\n\t\t$input.one('change', async function (e) {\n\t\t\tconst { mime } = await import('../../../utils/lib/mimeTypes');\n\t\t\tconst filesToUpload = [...e.target.files].map((file) => {\n\t\t\t\tObject.defineProperty(file, 'type', {\n\t\t\t\t\tvalue: mime.lookup(file.name),\n\t\t\t\t});\n\t\t\t\treturn {\n\t\t\t\t\tfile,\n\t\t\t\t\tname: file.name,\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tfileUpload(filesToUpload, $('.js-input-message', messageBox).get(0), { rid, tmid });\n\t\t\t$input.remove();\n\t\t});\n\n\t\t$input.click();\n\n\t\t// Simple hack for iOS aka codegueira\n\t\tif (navigator.userAgent.match(/(iPad|iPhone|iPod)/g)) {\n\t\t\t$input.click();\n\t\t}\n\t},\n});\n\nconst canGetGeolocation = new ReactiveVar(false);\n\nconst getGeolocationPermission = () =>\n\tnew Promise((resolve) => {\n\t\tif (!navigator.permissions) {\n\t\t\tresolve(true);\n\t\t}\n\t\tnavigator.permissions.query({ name: 'geolocation' }).then(({ state }) => {\n\t\t\tresolve(state);\n\t\t});\n\t});\n\nconst getGeolocationPosition = () =>\n\tnew Promise((resolvePos) => {\n\t\tnavigator.geolocation.getCurrentPosition(\n\t\t\tresolvePos,\n\t\t\t() => {\n\t\t\t\tresolvePos(false);\n\t\t\t},\n\t\t\t{\n\t\t\t\tenableHighAccuracy: true,\n\t\t\t\tmaximumAge: 0,\n\t\t\t\ttimeout: 10000,\n\t\t\t},\n\t\t);\n\t});\n\nconst getCoordinates = async () => {\n\tconst status = await getGeolocationPermission();\n\tif (status === 'prompt') {\n\t\tlet resolveModal;\n\t\tconst modalAnswer = new Promise((resolve) => {\n\t\t\tresolveModal = resolve;\n\t\t});\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('You_will_be_asked_for_permissions'),\n\t\t\t\tconfirmButtonText: t('Continue'),\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tcloseOnConfirm: true,\n\t\t\t\tcloseOnCancel: true,\n\t\t\t},\n\t\t\tasync (isConfirm) => {\n\t\t\t\tif (!isConfirm) {\n\t\t\t\t\tresolveModal(false);\n\t\t\t\t}\n\t\t\t\tconst position = await getGeolocationPosition();\n\t\t\t\tif (!position) {\n\t\t\t\t\tconst newStatus = getGeolocationPermission();\n\t\t\t\t\tresolveModal(newStatus);\n\t\t\t\t}\n\t\t\t\tresolveModal(position);\n\t\t\t},\n\t\t);\n\t\tconst position = await modalAnswer;\n\t\treturn position;\n\t}\n\n\tif (status === 'denied') {\n\t\treturn status;\n\t}\n\n\tconst position = await getGeolocationPosition();\n\treturn position;\n};\n\nmessageBox.actions.add('Share', 'My_location', {\n\tid: 'share-location',\n\ticon: 'map-pin',\n\tcondition: () => canGetGeolocation.get(),\n\tasync action({ rid, tmid }) {\n\t\tconst position = await getCoordinates();\n\n\t\tif (!position) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (position === 'denied') {\n\t\t\tmodal.open({\n\t\t\t\ttitle: t('Cannot_share_your_location'),\n\t\t\t\ttext: t('The_necessary_browser_permissions_for_location_sharing_are_not_granted'),\n\t\t\t\tconfirmButtonText: t('Ok'),\n\t\t\t\tcloseOnConfirm: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tcoords: { latitude, longitude },\n\t\t} = position;\n\t\tconst text = `<div class=\"upload-preview\"><div class=\"upload-preview-file\" style=\"background-size: cover; box-shadow: 0 0 0px 1px #dfdfdf; border-radius: 2px; height: 250px; width:100%; max-width: 500px; background-image:url(https://maps.googleapis.com/maps/api/staticmap?zoom=14&size=500x250&markers=color:gray%7Clabel:%7C${latitude},${longitude}&key=${settings.get(\n\t\t\t'MapView_GMapsAPIKey',\n\t\t)})\" ></div></div>`;\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Share_Location_Title'),\n\t\t\t\ttext,\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tcloseOnConfirm: true,\n\t\t\t\tcloseOnCancel: true,\n\t\t\t\thtml: true,\n\t\t\t},\n\t\t\tfunction (isConfirm) {\n\t\t\t\tif (isConfirm !== true) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tMeteor.call('sendMessage', {\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\trid,\n\t\t\t\t\ttmid,\n\t\t\t\t\tmsg: '',\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: [longitude, latitude],\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t},\n});\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst isMapViewEnabled = settings.get('MapView_Enabled') === true;\n\t\tconst isGeolocationCurrentPositionSupported = navigator.geolocation && navigator.geolocation.getCurrentPosition;\n\t\tconst googleMapsApiKey = settings.get('MapView_GMapsAPIKey');\n\t\tcanGetGeolocation.set(isMapViewEnabled && isGeolocationCurrentPositionSupported && googleMapsApiKey && googleMapsApiKey.length);\n\t});\n});\n"]},"sourceType":"module","hash":"0a4e9d3db2d5a97cf7be71a261c282f4c8cee679"}
