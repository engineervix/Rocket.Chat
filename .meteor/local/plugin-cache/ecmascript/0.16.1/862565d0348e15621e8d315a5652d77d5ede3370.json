{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/sidebar/search/SearchList.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/sidebar/search/SearchList.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/sidebar/search/SearchList.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/sidebar/search/SearchList.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/sidebar/search/SearchList.js"}},"code":"var _templateObject;\n\nvar _excluded = [\"setValue\"];\n\nvar _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default: function (v) {\n    _extends = v;\n  }\n}, 0);\n\nvar _taggedTemplateLiteralLoose;\n\nmodule.link(\"@babel/runtime/helpers/taggedTemplateLiteralLoose\", {\n  default: function (v) {\n    _taggedTemplateLiteralLoose = v;\n  }\n}, 1);\n\nvar _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default: function (v) {\n    _objectWithoutProperties = v;\n  }\n}, 2);\n\nvar _toConsumableArray;\n\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 3);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 4);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 5);\nvar css;\nmodule.link(\"@rocket.chat/css-in-js\", {\n  css: function (v) {\n    css = v;\n  }\n}, 0);\nvar Sidebar, TextInput, Box, Icon;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Sidebar: function (v) {\n    Sidebar = v;\n  },\n  TextInput: function (v) {\n    TextInput = v;\n  },\n  Box: function (v) {\n    Box = v;\n  },\n  Icon: function (v) {\n    Icon = v;\n  }\n}, 1);\nvar useMutableCallback, useDebouncedValue, useStableArray, useAutoFocus, useUniqueId;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  },\n  useDebouncedValue: function (v) {\n    useDebouncedValue = v;\n  },\n  useStableArray: function (v) {\n    useStableArray = v;\n  },\n  useAutoFocus: function (v) {\n    useAutoFocus = v;\n  },\n  useUniqueId: function (v) {\n    useUniqueId = v;\n  }\n}, 2);\nvar escapeRegExp;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeRegExp: function (v) {\n    escapeRegExp = v;\n  }\n}, 3);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 4);\nvar React, forwardRef, useState, useMemo, useEffect, useRef;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  forwardRef: function (v) {\n    forwardRef = v;\n  },\n  useState: function (v) {\n    useState = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useRef: function (v) {\n    useRef = v;\n  }\n}, 5);\nvar Virtuoso;\nmodule.link(\"react-virtuoso\", {\n  Virtuoso: function (v) {\n    Virtuoso = v;\n  }\n}, 6);\nvar tinykeys;\nmodule.link(\"tinykeys\", {\n  \"default\": function (v) {\n    tinykeys = v;\n  }\n}, 7);\nvar useSetting;\nmodule.link(\"../../contexts/SettingsContext\", {\n  useSetting: function (v) {\n    useSetting = v;\n  }\n}, 8);\nvar useTranslation;\nmodule.link(\"../../contexts/TranslationContext\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 9);\nvar useUserPreference, useUserSubscriptions;\nmodule.link(\"../../contexts/UserContext\", {\n  useUserPreference: function (v) {\n    useUserPreference = v;\n  },\n  useUserSubscriptions: function (v) {\n    useUserSubscriptions = v;\n  }\n}, 10);\nvar AsyncStatePhase;\nmodule.link(\"../../hooks/useAsyncState\", {\n  AsyncStatePhase: function (v) {\n    AsyncStatePhase = v;\n  }\n}, 11);\nvar useMethodData;\nmodule.link(\"../../hooks/useMethodData\", {\n  useMethodData: function (v) {\n    useMethodData = v;\n  }\n}, 12);\nvar useAvatarTemplate;\nmodule.link(\"../hooks/useAvatarTemplate\", {\n  useAvatarTemplate: function (v) {\n    useAvatarTemplate = v;\n  }\n}, 13);\nvar useTemplateByViewMode;\nmodule.link(\"../hooks/useTemplateByViewMode\", {\n  useTemplateByViewMode: function (v) {\n    useTemplateByViewMode = v;\n  }\n}, 14);\nvar Row;\nmodule.link(\"./Row\", {\n  \"default\": function (v) {\n    Row = v;\n  }\n}, 15);\nvar ScrollerWithCustomProps;\nmodule.link(\"./ScrollerWithCustomProps\", {\n  \"default\": function (v) {\n    ScrollerWithCustomProps = v;\n  }\n}, 16);\n\nvar shortcut = function () {\n  if (!Meteor.Device.isDesktop()) {\n    return '';\n  }\n\n  if (window.navigator.platform.toLowerCase().includes('mac')) {\n    return \"(\\u2318+K)\";\n  }\n\n  return \"(\\u2303+K)\";\n}();\n\nvar useSpotlight = function () {\n  var filterText = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var usernames = arguments.length > 1 ? arguments[1] : undefined;\n  var expression = /(@|#)?(.*)/i;\n\n  var _filterText$match = filterText.match(expression),\n      _filterText$match2 = _slicedToArray(_filterText$match, 3),\n      mention = _filterText$match2[1],\n      name = _filterText$match2[2];\n\n  var searchForChannels = mention === '#';\n  var searchForDMs = mention === '@';\n  var type = useMemo(function () {\n    if (searchForChannels) {\n      return {\n        users: false,\n        rooms: true\n      };\n    }\n\n    if (searchForDMs) {\n      return {\n        users: true,\n        rooms: false\n      };\n    }\n\n    return {\n      users: true,\n      rooms: true\n    };\n  }, [searchForChannels, searchForDMs]);\n  var args = useMemo(function () {\n    return [name, usernames, type];\n  }, [type, name, usernames]);\n\n  var _useMethodData = useMethodData('spotlight', args),\n      _useMethodData$value = _useMethodData.value,\n      data = _useMethodData$value === void 0 ? {\n    users: [],\n    rooms: []\n  } : _useMethodData$value,\n      status = _useMethodData.phase;\n\n  return useMemo(function () {\n    if (!data) {\n      return {\n        data: {\n          users: [],\n          rooms: []\n        },\n        status: 'loading'\n      };\n    }\n\n    return {\n      data: data,\n      status: status\n    };\n  }, [data, status]);\n};\n\nvar options = {\n  sort: {\n    lm: -1,\n    name: 1\n  }\n};\n\nvar useSearchItems = function (filterText) {\n  var expression = /(@|#)?(.*)/i;\n  var teste = filterText.match(expression);\n\n  var _teste = _slicedToArray(teste, 3),\n      type = _teste[1],\n      name = _teste[2];\n\n  var query = useMemo(function () {\n    var filterRegex = new RegExp(escapeRegExp(name), 'i');\n    return _objectSpread({\n      $or: [{\n        name: filterRegex\n      }, {\n        fname: filterRegex\n      }]\n    }, type && {\n      t: type === '@' ? 'd' : {\n        $ne: 'd'\n      }\n    });\n  }, [name, type]);\n  var localRooms = useUserSubscriptions(query, options);\n  var usernamesFromClient = useStableArray(_toConsumableArray(localRooms === null || localRooms === void 0 ? void 0 : localRooms.map(function (_ref) {\n    var t = _ref.t,\n        name = _ref.name;\n    return t === 'd' ? name : null;\n  })).filter(Boolean));\n\n  var _useSpotlight = useSpotlight(filterText, usernamesFromClient),\n      spotlight = _useSpotlight.data,\n      status = _useSpotlight.status;\n\n  return useMemo(function () {\n    var resultsFromServer = [];\n\n    var filterUsersUnique = function (_ref2, index, arr) {\n      var _id = _ref2._id;\n      return index === arr.findIndex(function (user) {\n        return _id === user._id;\n      });\n    };\n\n    var roomFilter = function (room) {\n      return !localRooms.find(function (item) {\n        var _room$uids;\n\n        return room.t === 'd' && ((_room$uids = room.uids) === null || _room$uids === void 0 ? void 0 : _room$uids.length) > 1 && room.uids.includes(item._id) || [item.rid, item._id].includes(room._id);\n      });\n    };\n\n    var usersfilter = function (user) {\n      return !localRooms.find(function (room) {\n        var _room$uids2;\n\n        return room.t === 'd' && ((_room$uids2 = room.uids) === null || _room$uids2 === void 0 ? void 0 : _room$uids2.length) === 2 && room.uids.includes(user._id);\n      });\n    };\n\n    var userMap = function (user) {\n      return {\n        _id: user._id,\n        t: 'd',\n        name: user.username,\n        fname: user.name,\n        avatarETag: user.avatarETag\n      };\n    };\n\n    var exact = resultsFromServer.filter(function (item) {\n      return [item.usernamame, item.name, item.fname].includes(name);\n    });\n    resultsFromServer.push.apply(resultsFromServer, _toConsumableArray(spotlight.users.filter(filterUsersUnique).filter(usersfilter).map(userMap)));\n    resultsFromServer.push.apply(resultsFromServer, _toConsumableArray(spotlight.rooms.filter(roomFilter)));\n    return {\n      data: Array.from(new Set([].concat(_toConsumableArray(exact), _toConsumableArray(localRooms), resultsFromServer))),\n      status: status\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [localRooms, name, spotlight]);\n};\n\nvar useInput = function (initial) {\n  var _useState = useState(initial),\n      _useState2 = _slicedToArray(_useState, 2),\n      value = _useState2[0],\n      setValue = _useState2[1];\n\n  var onChange = useMutableCallback(function (e) {\n    setValue(e.currentTarget.value);\n  });\n  return {\n    value: value,\n    onChange: onChange,\n    setValue: setValue\n  };\n};\n\nvar toggleSelectionState = function (next, current, input) {\n  input.setAttribute('aria-activedescendant', next.id);\n  next.setAttribute('aria-selected', true);\n  next.classList.add('rcx-sidebar-item--selected');\n\n  if (current) {\n    current.setAttribute('aria-selected', false);\n    current.classList.remove('rcx-sidebar-item--selected');\n  }\n};\n/**\n * @type import('react').ForwardRefExoticComponent<{ onClose: unknown } & import('react').RefAttributes<HTMLElement>>\n */\n\n\nvar SearchList = /*#__PURE__*/forwardRef(function () {\n  function SearchList(_ref3, ref) {\n    var onClose = _ref3.onClose;\n    var listId = useUniqueId();\n    var t = useTranslation();\n\n    var _useInput = useInput(''),\n        setFilterValue = _useInput.setValue,\n        filter = _objectWithoutProperties(_useInput, _excluded);\n\n    var autofocus = useAutoFocus();\n    var listRef = useRef();\n    var boxRef = useRef();\n    var selectedElement = useRef();\n    var itemIndexRef = useRef(0);\n    var sidebarViewMode = useUserPreference('sidebarViewMode');\n    var showRealName = useSetting('UI_Use_Real_Name');\n    var sideBarItemTemplate = useTemplateByViewMode();\n    var avatarTemplate = useAvatarTemplate();\n    var extended = sidebarViewMode === 'extended';\n    var filterText = useDebouncedValue(filter.value, 100);\n    var placeholder = [t('Search'), shortcut].filter(Boolean).join(' ');\n\n    var _useSearchItems = useSearchItems(filterText),\n        items = _useSearchItems.data,\n        status = _useSearchItems.status;\n\n    var itemData = useMemo(function () {\n      return {\n        items: items,\n        t: t,\n        SideBarItemTemplate: sideBarItemTemplate,\n        avatarTemplate: avatarTemplate,\n        showRealName: showRealName,\n        extended: extended,\n        sidebarViewMode: sidebarViewMode\n      };\n    }, [avatarTemplate, extended, items, showRealName, sideBarItemTemplate, sidebarViewMode, t]);\n    var changeSelection = useMutableCallback(function (dir) {\n      var nextSelectedElement = null;\n\n      if (dir === 'up') {\n        nextSelectedElement = selectedElement.current.parentElement.previousSibling.querySelector('a');\n      } else {\n        nextSelectedElement = selectedElement.current.parentElement.nextSibling.querySelector('a');\n      }\n\n      if (nextSelectedElement) {\n        toggleSelectionState(nextSelectedElement, selectedElement.current, autofocus.current);\n        return nextSelectedElement;\n      }\n\n      return selectedElement.current;\n    });\n    var resetCursor = useMutableCallback(function () {\n      var _boxRef$current;\n\n      itemIndexRef.current = 0;\n      listRef.current.scrollToIndex({\n        index: itemIndexRef.current\n      });\n      selectedElement.current = (_boxRef$current = boxRef.current) === null || _boxRef$current === void 0 ? void 0 : _boxRef$current.querySelector('a.rcx-sidebar-item');\n\n      if (selectedElement.current) {\n        toggleSelectionState(selectedElement.current, undefined, autofocus.current);\n      }\n    });\n    useEffect(function () {\n      resetCursor();\n    });\n    useEffect(function () {\n      resetCursor();\n    }, [filterText, resetCursor]);\n    useEffect(function () {\n      if (!autofocus.current) {\n        return;\n      }\n\n      var unsubscribe = tinykeys(autofocus.current, {\n        Escape: function (event) {\n          event.preventDefault();\n          setFilterValue(function (value) {\n            if (!value) {\n              onClose();\n            }\n\n            resetCursor();\n            return '';\n          });\n        },\n        Tab: onClose,\n        ArrowUp: function () {\n          var currentElement = changeSelection('up');\n          itemIndexRef.current = Math.max(itemIndexRef.current - 1, 0);\n          listRef.current.scrollToIndex({\n            index: itemIndexRef.current\n          });\n          selectedElement.current = currentElement;\n        },\n        ArrowDown: function () {\n          var currentElement = changeSelection('down');\n          itemIndexRef.current = Math.min(itemIndexRef.current + 1, (items === null || items === void 0 ? void 0 : items.length) + 1);\n          listRef.current.scrollToIndex({\n            index: itemIndexRef.current\n          });\n          selectedElement.current = currentElement;\n        },\n        Enter: function () {\n          if (selectedElement.current) {\n            selectedElement.current.click();\n          }\n        }\n      });\n      return function () {\n        unsubscribe();\n      };\n    }, [autofocus, changeSelection, items.length, onClose, resetCursor, setFilterValue]);\n    return /*#__PURE__*/React.createElement(Box, {\n      position: \"absolute\",\n      \"rcx-sidebar\": true,\n      h: \"full\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      zIndex: 99,\n      w: \"full\",\n      className: css(_templateObject || (_templateObject = _taggedTemplateLiteralLoose([\"\\n\\t\\t\\t\\tleft: 0;\\n\\t\\t\\t\\ttop: 0;\\n\\t\\t\\t\"]))),\n      ref: ref\n    }, /*#__PURE__*/React.createElement(Sidebar.TopBar.Section, {\n      role: \"search\",\n      is: \"form\"\n    }, /*#__PURE__*/React.createElement(TextInput, _extends({\n      \"aria-owns\": listId,\n      \"data-qa\": \"sidebar-search-input\",\n      ref: autofocus\n    }, filter, {\n      placeholder: placeholder,\n      addon: /*#__PURE__*/React.createElement(Icon, {\n        name: \"cross\",\n        size: \"x20\",\n        onClick: onClose\n      })\n    }))), /*#__PURE__*/React.createElement(Box, {\n      ref: boxRef,\n      \"aria-expanded\": \"true\",\n      role: \"listbox\",\n      id: listId,\n      tabIndex: -1,\n      flexShrink: 1,\n      h: \"full\",\n      w: \"full\",\n      \"data-qa\": \"sidebar-search-result\",\n      onClick: onClose,\n      \"aria-busy\": status !== AsyncStatePhase.RESOLVED\n    }, /*#__PURE__*/React.createElement(Virtuoso, {\n      style: {\n        height: '100%',\n        width: '100%'\n      },\n      totalCount: items === null || items === void 0 ? void 0 : items.length,\n      data: items,\n      components: {\n        Scroller: ScrollerWithCustomProps\n      },\n      itemContent: function (index, data) {\n        return /*#__PURE__*/React.createElement(Row, {\n          data: itemData,\n          item: data\n        });\n      },\n      ref: listRef\n    })));\n  }\n\n  return SearchList;\n}());\nmodule.exportDefault(SearchList);","map":{"version":3,"sources":["client/sidebar/search/SearchList.js"],"names":["_extends","module","link","default","v","_taggedTemplateLiteralLoose","_objectWithoutProperties","_toConsumableArray","_objectSpread","_slicedToArray","css","Sidebar","TextInput","Box","Icon","useMutableCallback","useDebouncedValue","useStableArray","useAutoFocus","useUniqueId","escapeRegExp","Meteor","React","forwardRef","useState","useMemo","useEffect","useRef","Virtuoso","tinykeys","useSetting","useTranslation","useUserPreference","useUserSubscriptions","AsyncStatePhase","useMethodData","useAvatarTemplate","useTemplateByViewMode","Row","ScrollerWithCustomProps","shortcut","Device","isDesktop","window","navigator","platform","toLowerCase","includes","useSpotlight","filterText","usernames","expression","match","mention","name","searchForChannels","searchForDMs","type","users","rooms","args","value","data","status","phase","options","sort","lm","useSearchItems","teste","query","filterRegex","RegExp","$or","fname","t","$ne","localRooms","usernamesFromClient","map","filter","Boolean","spotlight","resultsFromServer","filterUsersUnique","index","arr","_id","findIndex","user","roomFilter","room","find","item","uids","length","rid","usersfilter","userMap","username","avatarETag","exact","usernamame","push","Array","from","Set","useInput","initial","setValue","onChange","e","currentTarget","toggleSelectionState","next","current","input","setAttribute","id","classList","add","remove","SearchList","ref","onClose","listId","setFilterValue","autofocus","listRef","boxRef","selectedElement","itemIndexRef","sidebarViewMode","showRealName","sideBarItemTemplate","avatarTemplate","extended","placeholder","join","items","itemData","SideBarItemTemplate","changeSelection","dir","nextSelectedElement","parentElement","previousSibling","querySelector","nextSibling","resetCursor","scrollToIndex","undefined","unsubscribe","Escape","event","preventDefault","Tab","ArrowUp","currentElement","Math","max","ArrowDown","min","Enter","click","RESOLVED","height","width","Scroller","exportDefault"],"mappings":"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","sourcesContent":["import { css } from '@rocket.chat/css-in-js';\nimport { Sidebar, TextInput, Box, Icon } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useDebouncedValue, useStableArray, useAutoFocus, useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\nimport React, { forwardRef, useState, useMemo, useEffect, useRef } from 'react';\nimport { Virtuoso } from 'react-virtuoso';\nimport tinykeys from 'tinykeys';\n\nimport { useSetting } from '../../contexts/SettingsContext';\nimport { useTranslation } from '../../contexts/TranslationContext';\nimport { useUserPreference, useUserSubscriptions } from '../../contexts/UserContext';\nimport { AsyncStatePhase } from '../../hooks/useAsyncState';\nimport { useMethodData } from '../../hooks/useMethodData';\nimport { useAvatarTemplate } from '../hooks/useAvatarTemplate';\nimport { useTemplateByViewMode } from '../hooks/useTemplateByViewMode';\nimport Row from './Row';\nimport ScrollerWithCustomProps from './ScrollerWithCustomProps';\n\nconst shortcut = (() => {\n\tif (!Meteor.Device.isDesktop()) {\n\t\treturn '';\n\t}\n\tif (window.navigator.platform.toLowerCase().includes('mac')) {\n\t\treturn '(\\u2318+K)';\n\t}\n\treturn '(\\u2303+K)';\n})();\n\nconst useSpotlight = (filterText = '', usernames) => {\n\tconst expression = /(@|#)?(.*)/i;\n\tconst [, mention, name] = filterText.match(expression);\n\n\tconst searchForChannels = mention === '#';\n\tconst searchForDMs = mention === '@';\n\n\tconst type = useMemo(() => {\n\t\tif (searchForChannels) {\n\t\t\treturn { users: false, rooms: true };\n\t\t}\n\t\tif (searchForDMs) {\n\t\t\treturn { users: true, rooms: false };\n\t\t}\n\t\treturn { users: true, rooms: true };\n\t}, [searchForChannels, searchForDMs]);\n\tconst args = useMemo(() => [name, usernames, type], [type, name, usernames]);\n\n\tconst { value: data = { users: [], rooms: [] }, phase: status } = useMethodData('spotlight', args);\n\n\treturn useMemo(() => {\n\t\tif (!data) {\n\t\t\treturn { data: { users: [], rooms: [] }, status: 'loading' };\n\t\t}\n\t\treturn { data, status };\n\t}, [data, status]);\n};\n\nconst options = {\n\tsort: {\n\t\tlm: -1,\n\t\tname: 1,\n\t},\n};\n\nconst useSearchItems = (filterText) => {\n\tconst expression = /(@|#)?(.*)/i;\n\tconst teste = filterText.match(expression);\n\n\tconst [, type, name] = teste;\n\tconst query = useMemo(() => {\n\t\tconst filterRegex = new RegExp(escapeRegExp(name), 'i');\n\n\t\treturn {\n\t\t\t$or: [{ name: filterRegex }, { fname: filterRegex }],\n\t\t\t...(type && {\n\t\t\t\tt: type === '@' ? 'd' : { $ne: 'd' },\n\t\t\t}),\n\t\t};\n\t}, [name, type]);\n\n\tconst localRooms = useUserSubscriptions(query, options);\n\n\tconst usernamesFromClient = useStableArray([...localRooms?.map(({ t, name }) => (t === 'd' ? name : null))].filter(Boolean));\n\n\tconst { data: spotlight, status } = useSpotlight(filterText, usernamesFromClient);\n\n\treturn useMemo(() => {\n\t\tconst resultsFromServer = [];\n\n\t\tconst filterUsersUnique = ({ _id }, index, arr) => index === arr.findIndex((user) => _id === user._id);\n\t\tconst roomFilter = (room) =>\n\t\t\t!localRooms.find(\n\t\t\t\t(item) => (room.t === 'd' && room.uids?.length > 1 && room.uids.includes(item._id)) || [item.rid, item._id].includes(room._id),\n\t\t\t);\n\t\tconst usersfilter = (user) => !localRooms.find((room) => room.t === 'd' && room.uids?.length === 2 && room.uids.includes(user._id));\n\n\t\tconst userMap = (user) => ({\n\t\t\t_id: user._id,\n\t\t\tt: 'd',\n\t\t\tname: user.username,\n\t\t\tfname: user.name,\n\t\t\tavatarETag: user.avatarETag,\n\t\t});\n\n\t\tconst exact = resultsFromServer.filter((item) => [item.usernamame, item.name, item.fname].includes(name));\n\n\t\tresultsFromServer.push(...spotlight.users.filter(filterUsersUnique).filter(usersfilter).map(userMap));\n\t\tresultsFromServer.push(...spotlight.rooms.filter(roomFilter));\n\n\t\treturn { data: Array.from(new Set([...exact, ...localRooms, ...resultsFromServer])), status };\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [localRooms, name, spotlight]);\n};\n\nconst useInput = (initial) => {\n\tconst [value, setValue] = useState(initial);\n\tconst onChange = useMutableCallback((e) => {\n\t\tsetValue(e.currentTarget.value);\n\t});\n\treturn { value, onChange, setValue };\n};\n\nconst toggleSelectionState = (next, current, input) => {\n\tinput.setAttribute('aria-activedescendant', next.id);\n\tnext.setAttribute('aria-selected', true);\n\tnext.classList.add('rcx-sidebar-item--selected');\n\tif (current) {\n\t\tcurrent.setAttribute('aria-selected', false);\n\t\tcurrent.classList.remove('rcx-sidebar-item--selected');\n\t}\n};\n\n/**\n * @type import('react').ForwardRefExoticComponent<{ onClose: unknown } & import('react').RefAttributes<HTMLElement>>\n */\nconst SearchList = forwardRef(function SearchList({ onClose }, ref) {\n\tconst listId = useUniqueId();\n\tconst t = useTranslation();\n\tconst { setValue: setFilterValue, ...filter } = useInput('');\n\n\tconst autofocus = useAutoFocus();\n\n\tconst listRef = useRef();\n\tconst boxRef = useRef();\n\n\tconst selectedElement = useRef();\n\tconst itemIndexRef = useRef(0);\n\n\tconst sidebarViewMode = useUserPreference('sidebarViewMode');\n\tconst showRealName = useSetting('UI_Use_Real_Name');\n\n\tconst sideBarItemTemplate = useTemplateByViewMode();\n\tconst avatarTemplate = useAvatarTemplate();\n\n\tconst extended = sidebarViewMode === 'extended';\n\n\tconst filterText = useDebouncedValue(filter.value, 100);\n\n\tconst placeholder = [t('Search'), shortcut].filter(Boolean).join(' ');\n\n\tconst { data: items, status } = useSearchItems(filterText);\n\n\tconst itemData = useMemo(\n\t\t() => ({\n\t\t\titems,\n\t\t\tt,\n\t\t\tSideBarItemTemplate: sideBarItemTemplate,\n\t\t\tavatarTemplate,\n\t\t\tshowRealName,\n\t\t\textended,\n\t\t\tsidebarViewMode,\n\t\t}),\n\t\t[avatarTemplate, extended, items, showRealName, sideBarItemTemplate, sidebarViewMode, t],\n\t);\n\n\tconst changeSelection = useMutableCallback((dir) => {\n\t\tlet nextSelectedElement = null;\n\n\t\tif (dir === 'up') {\n\t\t\tnextSelectedElement = selectedElement.current.parentElement.previousSibling.querySelector('a');\n\t\t} else {\n\t\t\tnextSelectedElement = selectedElement.current.parentElement.nextSibling.querySelector('a');\n\t\t}\n\n\t\tif (nextSelectedElement) {\n\t\t\ttoggleSelectionState(nextSelectedElement, selectedElement.current, autofocus.current);\n\t\t\treturn nextSelectedElement;\n\t\t}\n\t\treturn selectedElement.current;\n\t});\n\n\tconst resetCursor = useMutableCallback(() => {\n\t\titemIndexRef.current = 0;\n\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\n\t\tselectedElement.current = boxRef.current?.querySelector('a.rcx-sidebar-item');\n\n\t\tif (selectedElement.current) {\n\t\t\ttoggleSelectionState(selectedElement.current, undefined, autofocus.current);\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tresetCursor();\n\t});\n\n\tuseEffect(() => {\n\t\tresetCursor();\n\t}, [filterText, resetCursor]);\n\n\tuseEffect(() => {\n\t\tif (!autofocus.current) {\n\t\t\treturn;\n\t\t}\n\t\tconst unsubscribe = tinykeys(autofocus.current, {\n\t\t\tEscape: (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tsetFilterValue((value) => {\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\tonClose();\n\t\t\t\t\t}\n\t\t\t\t\tresetCursor();\n\t\t\t\t\treturn '';\n\t\t\t\t});\n\t\t\t},\n\t\t\tTab: onClose,\n\t\t\tArrowUp: () => {\n\t\t\t\tconst currentElement = changeSelection('up');\n\t\t\t\titemIndexRef.current = Math.max(itemIndexRef.current - 1, 0);\n\t\t\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\t\t\t\tselectedElement.current = currentElement;\n\t\t\t},\n\t\t\tArrowDown: () => {\n\t\t\t\tconst currentElement = changeSelection('down');\n\t\t\t\titemIndexRef.current = Math.min(itemIndexRef.current + 1, items?.length + 1);\n\t\t\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\t\t\t\tselectedElement.current = currentElement;\n\t\t\t},\n\t\t\tEnter: () => {\n\t\t\t\tif (selectedElement.current) {\n\t\t\t\t\tselectedElement.current.click();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\treturn () => {\n\t\t\tunsubscribe();\n\t\t};\n\t}, [autofocus, changeSelection, items.length, onClose, resetCursor, setFilterValue]);\n\n\treturn (\n\t\t<Box\n\t\t\tposition='absolute'\n\t\t\trcx-sidebar\n\t\t\th='full'\n\t\t\tdisplay='flex'\n\t\t\tflexDirection='column'\n\t\t\tzIndex={99}\n\t\t\tw='full'\n\t\t\tclassName={css`\n\t\t\t\tleft: 0;\n\t\t\t\ttop: 0;\n\t\t\t`}\n\t\t\tref={ref}\n\t\t>\n\t\t\t<Sidebar.TopBar.Section role='search' is='form'>\n\t\t\t\t<TextInput\n\t\t\t\t\taria-owns={listId}\n\t\t\t\t\tdata-qa='sidebar-search-input'\n\t\t\t\t\tref={autofocus}\n\t\t\t\t\t{...filter}\n\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\taddon={<Icon name='cross' size='x20' onClick={onClose} />}\n\t\t\t\t/>\n\t\t\t</Sidebar.TopBar.Section>\n\t\t\t<Box\n\t\t\t\tref={boxRef}\n\t\t\t\taria-expanded='true'\n\t\t\t\trole='listbox'\n\t\t\t\tid={listId}\n\t\t\t\ttabIndex={-1}\n\t\t\t\tflexShrink={1}\n\t\t\t\th='full'\n\t\t\t\tw='full'\n\t\t\t\tdata-qa='sidebar-search-result'\n\t\t\t\tonClick={onClose}\n\t\t\t\taria-busy={status !== AsyncStatePhase.RESOLVED}\n\t\t\t>\n\t\t\t\t<Virtuoso\n\t\t\t\t\tstyle={{ height: '100%', width: '100%' }}\n\t\t\t\t\ttotalCount={items?.length}\n\t\t\t\t\tdata={items}\n\t\t\t\t\tcomponents={{ Scroller: ScrollerWithCustomProps }}\n\t\t\t\t\titemContent={(index, data) => <Row data={itemData} item={data} />}\n\t\t\t\t\tref={listRef}\n\t\t\t\t/>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n});\n\nexport default SearchList;\n"]},"sourceType":"module","hash":"862565d0348e15621e8d315a5652d77d5ede3370"}
