{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/messageBox/messageBoxAutogrow.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-message/client/messageBox/messageBoxAutogrow.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/messageBox/messageBoxAutogrow.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/messageBox/messageBoxAutogrow.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/messageBox/messageBoxAutogrow.js"}},"code":"module.export({\n  setupAutogrow: () => setupAutogrow\n});\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 0);\n\nconst replaceWhitespaces = whitespaces => \"\".concat('&nbsp;'.repeat(whitespaces.length - 1), \" \");\n\nconst setupAutogrow = (textarea, shadow, callback) => {\n  const width = textarea.clientWidth;\n  const height = textarea.clientHeight;\n  const {\n    font,\n    lineHeight,\n    maxHeight: maxHeightPx\n  } = window.getComputedStyle(textarea);\n  shadow.style.position = 'fixed';\n  shadow.style.top = '-10000px';\n  shadow.style.left = '-10000px';\n  shadow.style.width = \"\".concat(width, \"px\");\n  shadow.style.font = font;\n  shadow.style.lineHeight = lineHeight;\n  shadow.style.resize = 'none';\n  shadow.style.wordWrap = 'break-word';\n  const minHeight = height;\n  const maxHeight = parseInt(maxHeightPx, 10);\n  let lastWidth = width;\n  let lastHeight = minHeight;\n  let textLenght = 0;\n\n  const update = () => {\n    const {\n      clientWidth: width,\n      value: text\n    } = textarea;\n    const isMaximumHeightReached = lastHeight >= maxHeight;\n    const isTextLengthOutdated = textLenght && textLenght < text.length;\n    const wasWidthChanged = width !== lastWidth;\n\n    if (isMaximumHeightReached && isTextLengthOutdated && !wasWidthChanged) {\n      return true;\n    }\n\n    const shadowText = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\n$/, '<br/>&nbsp;').replace(/\\n/g, '<br/>').replace(/ {2,}/g, replaceWhitespaces);\n\n    if (wasWidthChanged) {\n      shadow.style.width = \"\".concat(width, \"px\");\n      lastWidth = width;\n    }\n\n    shadow.innerHTML = shadowText;\n    const shadowHeight = Math.max(shadow.clientHeight + 1, minHeight) + 1;\n    const height = Math.min(shadowHeight, maxHeight);\n\n    if (height === lastHeight) {\n      return true;\n    }\n\n    lastHeight = height;\n    const overflow = height < maxHeight ? 'hidden' : '';\n\n    if (height < maxHeight) {\n      textLenght = text.length;\n    }\n\n    textarea.style.overflow = overflow;\n    textarea.style.height = \"\".concat(height, \"px\");\n    callback && callback();\n  };\n\n  const updateThrottled = _.throttle(update, 300);\n\n  const $textarea = $(textarea);\n  $textarea.on('focus', update);\n  $textarea.on('change input', updateThrottled);\n  window.addEventListener('resize', updateThrottled, false);\n\n  const destroy = () => {\n    $textarea.off('focus', update);\n    $textarea.off('change input', updateThrottled);\n    window.removeEventListener('resize', updateThrottled);\n  };\n\n  update();\n  return {\n    update,\n    destroy\n  };\n};","map":{"version":3,"sources":["app/ui-message/client/messageBox/messageBoxAutogrow.js"],"names":["module","export","setupAutogrow","_","link","default","v","replaceWhitespaces","whitespaces","repeat","length","textarea","shadow","callback","width","clientWidth","height","clientHeight","font","lineHeight","maxHeight","maxHeightPx","window","getComputedStyle","style","position","top","left","resize","wordWrap","minHeight","parseInt","lastWidth","lastHeight","textLenght","update","value","text","isMaximumHeightReached","isTextLengthOutdated","wasWidthChanged","shadowText","replace","innerHTML","shadowHeight","Math","max","min","overflow","updateThrottled","throttle","$textarea","$","on","addEventListener","destroy","off","removeEventListener"],"mappings":"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","sourcesContent":["import _ from 'underscore';\n\nconst replaceWhitespaces = (whitespaces) => `${'&nbsp;'.repeat(whitespaces.length - 1)} `;\n\nexport const setupAutogrow = (textarea, shadow, callback) => {\n\tconst width = textarea.clientWidth;\n\tconst height = textarea.clientHeight;\n\tconst { font, lineHeight, maxHeight: maxHeightPx } = window.getComputedStyle(textarea);\n\n\tshadow.style.position = 'fixed';\n\tshadow.style.top = '-10000px';\n\tshadow.style.left = '-10000px';\n\tshadow.style.width = `${width}px`;\n\tshadow.style.font = font;\n\tshadow.style.lineHeight = lineHeight;\n\tshadow.style.resize = 'none';\n\tshadow.style.wordWrap = 'break-word';\n\n\tconst minHeight = height;\n\tconst maxHeight = parseInt(maxHeightPx, 10);\n\n\tlet lastWidth = width;\n\tlet lastHeight = minHeight;\n\tlet textLenght = 0;\n\n\tconst update = () => {\n\t\tconst { clientWidth: width, value: text } = textarea;\n\n\t\tconst isMaximumHeightReached = lastHeight >= maxHeight;\n\t\tconst isTextLengthOutdated = textLenght && textLenght < text.length;\n\t\tconst wasWidthChanged = width !== lastWidth;\n\n\t\tif (isMaximumHeightReached && isTextLengthOutdated && !wasWidthChanged) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst shadowText = text\n\t\t\t.replace(/&/g, '&amp;')\n\t\t\t.replace(/</g, '&lt;')\n\t\t\t.replace(/>/g, '&gt;')\n\t\t\t.replace(/\\n$/, '<br/>&nbsp;')\n\t\t\t.replace(/\\n/g, '<br/>')\n\t\t\t.replace(/ {2,}/g, replaceWhitespaces);\n\t\tif (wasWidthChanged) {\n\t\t\tshadow.style.width = `${width}px`;\n\t\t\tlastWidth = width;\n\t\t}\n\n\t\tshadow.innerHTML = shadowText;\n\n\t\tconst shadowHeight = Math.max(shadow.clientHeight + 1, minHeight) + 1;\n\t\tconst height = Math.min(shadowHeight, maxHeight);\n\n\t\tif (height === lastHeight) {\n\t\t\treturn true;\n\t\t}\n\n\t\tlastHeight = height;\n\n\t\tconst overflow = height < maxHeight ? 'hidden' : '';\n\n\t\tif (height < maxHeight) {\n\t\t\ttextLenght = text.length;\n\t\t}\n\n\t\ttextarea.style.overflow = overflow;\n\t\ttextarea.style.height = `${height}px`;\n\n\t\tcallback && callback();\n\t};\n\n\tconst updateThrottled = _.throttle(update, 300);\n\n\tconst $textarea = $(textarea);\n\t$textarea.on('focus', update);\n\t$textarea.on('change input', updateThrottled);\n\twindow.addEventListener('resize', updateThrottled, false);\n\n\tconst destroy = () => {\n\t\t$textarea.off('focus', update);\n\t\t$textarea.off('change input', updateThrottled);\n\t\twindow.removeEventListener('resize', updateThrottled);\n\t};\n\n\tupdate();\n\n\treturn {\n\t\tupdate,\n\t\tdestroy,\n\t};\n};\n"]},"sourceType":"module","hash":"c6c7f4f9ca8f92875e6a04827119f0cd8d318c33"}
