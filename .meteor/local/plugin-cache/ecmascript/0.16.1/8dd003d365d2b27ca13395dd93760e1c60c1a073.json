{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppMenu.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/admin/apps/AppMenu.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppMenu.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/AppMenu.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/apps/AppMenu.js"}},"code":"const _excluded = [\"app\"];\n\nlet _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default(v) {\n    _extends = v;\n  }\n\n}, 0);\n\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 1);\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 2);\nlet Box, Icon, Menu;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box(v) {\n    Box = v;\n  },\n\n  Icon(v) {\n    Icon = v;\n  },\n\n  Menu(v) {\n    Menu = v;\n  }\n\n}, 0);\nlet React, useMemo, useCallback;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  },\n\n  useCallback(v) {\n    useCallback = v;\n  }\n\n}, 1);\nlet useSetModal;\nmodule.link(\"../../../contexts/ModalContext\", {\n  useSetModal(v) {\n    useSetModal = v;\n  }\n\n}, 2);\nlet useRoute;\nmodule.link(\"../../../contexts/RouterContext\", {\n  useRoute(v) {\n    useRoute = v;\n  }\n\n}, 3);\nlet useMethod, useEndpoint;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useMethod(v) {\n    useMethod = v;\n  },\n\n  useEndpoint(v) {\n    useEndpoint = v;\n  }\n\n}, 4);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 5);\nlet CloudLoginModal;\nmodule.link(\"./CloudLoginModal\", {\n  default(v) {\n    CloudLoginModal = v;\n  }\n\n}, 6);\nlet IframeModal;\nmodule.link(\"./IframeModal\", {\n  default(v) {\n    IframeModal = v;\n  }\n\n}, 7);\nlet WarningModal;\nmodule.link(\"./WarningModal\", {\n  default(v) {\n    WarningModal = v;\n  }\n\n}, 8);\nlet appEnabledStatuses, warnStatusChange, handleAPIError;\nmodule.link(\"./helpers\", {\n  appEnabledStatuses(v) {\n    appEnabledStatuses = v;\n  },\n\n  warnStatusChange(v) {\n    warnStatusChange = v;\n  },\n\n  handleAPIError(v) {\n    handleAPIError = v;\n  }\n\n}, 9);\n\nfunction AppMenu(_ref) {\n  let {\n    app\n  } = _ref,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  const t = useTranslation();\n  const setModal = useSetModal();\n  const appsRoute = useRoute('admin-apps');\n  const checkUserLoggedIn = useMethod('cloud:checkUserLoggedIn');\n  const setAppStatus = useEndpoint('POST', \"/apps/\".concat(app.id, \"/status\"));\n  const buildExternalUrl = useEndpoint('GET', '/apps');\n  const syncApp = useEndpoint('POST', \"/apps/\".concat(app.id, \"/sync\"));\n  const uninstallApp = useEndpoint('DELETE', \"/apps/\".concat(app.id));\n  const canAppBeSubscribed = app.purchaseType === 'subscription';\n  const isSubscribed = app.subscriptionInfo && ['active', 'trialing'].includes(app.subscriptionInfo.status);\n  const isAppEnabled = appEnabledStatuses.includes(app.status);\n  const closeModal = useCallback(() => {\n    setModal(null);\n  }, [setModal]);\n  const handleEnable = useCallback(async () => {\n    try {\n      const {\n        status\n      } = await setAppStatus({\n        status: 'manually_enabled'\n      });\n      warnStatusChange(app.name, status);\n    } catch (error) {\n      handleAPIError(error);\n    }\n  }, [app.name, setAppStatus]);\n  const handleViewLogs = useCallback(() => {\n    appsRoute.push({\n      context: 'logs',\n      id: app.id\n    });\n  }, [app.id, appsRoute]);\n  const handleSubscription = useCallback(async () => {\n    if (!(await checkUserLoggedIn())) {\n      setModal( /*#__PURE__*/React.createElement(CloudLoginModal, null));\n      return;\n    }\n\n    let data;\n\n    try {\n      data = await buildExternalUrl({\n        buildExternalUrl: 'true',\n        appId: app.id,\n        purchaseType: app.purchaseType,\n        details: true\n      });\n    } catch (error) {\n      handleAPIError(error);\n      return;\n    }\n\n    const confirm = async () => {\n      try {\n        await syncApp();\n      } catch (error) {\n        handleAPIError(error);\n      }\n    };\n\n    setModal( /*#__PURE__*/React.createElement(IframeModal, {\n      url: data.url,\n      confirm: confirm,\n      cancel: closeModal\n    }));\n  }, [checkUserLoggedIn, setModal, closeModal, buildExternalUrl, app.id, app.purchaseType, syncApp]);\n  const handleDisable = useCallback(() => {\n    const confirm = async () => {\n      closeModal();\n\n      try {\n        const {\n          status\n        } = await setAppStatus({\n          status: 'manually_disabled'\n        });\n        warnStatusChange(app.name, status);\n      } catch (error) {\n        handleAPIError(error);\n      }\n    };\n\n    setModal( /*#__PURE__*/React.createElement(WarningModal, {\n      close: closeModal,\n      confirm: confirm,\n      text: t('Apps_Marketplace_Deactivate_App_Prompt'),\n      confirmText: t('Yes')\n    }));\n  }, [app.name, closeModal, setAppStatus, setModal, t]);\n  const handleUninstall = useCallback(() => {\n    const uninstall = async () => {\n      closeModal();\n\n      try {\n        await uninstallApp();\n      } catch (error) {\n        handleAPIError(error);\n      }\n    };\n\n    if (isSubscribed) {\n      const confirm = async () => {\n        await handleSubscription();\n      };\n\n      setModal( /*#__PURE__*/React.createElement(WarningModal, {\n        close: closeModal,\n        cancel: uninstall,\n        confirm: confirm,\n        text: t('Apps_Marketplace_Uninstall_Subscribed_App_Prompt'),\n        confirmText: t('Apps_Marketplace_Modify_App_Subscription'),\n        cancelText: t('Apps_Marketplace_Uninstall_Subscribed_App_Anyway')\n      }));\n    }\n\n    setModal( /*#__PURE__*/React.createElement(WarningModal, {\n      close: closeModal,\n      confirm: uninstall,\n      text: t('Apps_Marketplace_Uninstall_App_Prompt'),\n      confirmText: t('Yes')\n    }));\n  }, [closeModal, handleSubscription, isSubscribed, setModal, t, uninstallApp]);\n  const menuOptions = useMemo(() => _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, canAppBeSubscribed && {\n    subscribe: {\n      label: /*#__PURE__*/React.createElement(Box, null, /*#__PURE__*/React.createElement(Icon, {\n        name: \"card\",\n        size: \"x16\",\n        marginInlineEnd: \"x4\"\n      }), t('Subscription')),\n      action: handleSubscription\n    }\n  }), {}, {\n    viewLogs: {\n      label: /*#__PURE__*/React.createElement(Box, null, /*#__PURE__*/React.createElement(Icon, {\n        name: \"list-alt\",\n        size: \"x16\",\n        marginInlineEnd: \"x4\"\n      }), t('View_Logs')),\n      action: handleViewLogs\n    }\n  }, isAppEnabled && {\n    disable: {\n      label: /*#__PURE__*/React.createElement(Box, {\n        color: \"warning\"\n      }, /*#__PURE__*/React.createElement(Icon, {\n        name: \"ban\",\n        size: \"x16\",\n        marginInlineEnd: \"x4\"\n      }), t('Disable')),\n      action: handleDisable\n    }\n  }), !isAppEnabled && {\n    enable: {\n      label: /*#__PURE__*/React.createElement(Box, null, /*#__PURE__*/React.createElement(Icon, {\n        name: \"check\",\n        size: \"x16\",\n        marginInlineEnd: \"x4\"\n      }), t('Enable')),\n      action: handleEnable\n    }\n  }), {}, {\n    uninstall: {\n      label: /*#__PURE__*/React.createElement(Box, {\n        color: \"danger\"\n      }, /*#__PURE__*/React.createElement(Icon, {\n        name: \"trash\",\n        size: \"x16\",\n        marginInlineEnd: \"x4\"\n      }), t('Uninstall')),\n      action: handleUninstall\n    }\n  }), [canAppBeSubscribed, t, handleSubscription, handleViewLogs, isAppEnabled, handleDisable, handleEnable, handleUninstall]);\n  return /*#__PURE__*/React.createElement(Menu, _extends({\n    options: menuOptions,\n    placement: \"bottom-start\"\n  }, props));\n}\n\nmodule.exportDefault(AppMenu);","map":{"version":3,"sources":["client/views/admin/apps/AppMenu.js"],"names":["_extends","module","link","default","v","_objectSpread","_objectWithoutProperties","Box","Icon","Menu","React","useMemo","useCallback","useSetModal","useRoute","useMethod","useEndpoint","useTranslation","CloudLoginModal","IframeModal","WarningModal","appEnabledStatuses","warnStatusChange","handleAPIError","AppMenu","app","props","t","setModal","appsRoute","checkUserLoggedIn","setAppStatus","id","buildExternalUrl","syncApp","uninstallApp","canAppBeSubscribed","purchaseType","isSubscribed","subscriptionInfo","includes","status","isAppEnabled","closeModal","handleEnable","name","error","handleViewLogs","push","context","handleSubscription","data","appId","details","confirm","url","handleDisable","handleUninstall","uninstall","menuOptions","subscribe","label","action","viewLogs","disable","enable","exportDefault"],"mappings":"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","sourcesContent":["import { Box, Icon, Menu } from '@rocket.chat/fuselage';\nimport React, { useMemo, useCallback } from 'react';\n\nimport { useSetModal } from '../../../contexts/ModalContext';\nimport { useRoute } from '../../../contexts/RouterContext';\nimport { useMethod, useEndpoint } from '../../../contexts/ServerContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport CloudLoginModal from './CloudLoginModal';\nimport IframeModal from './IframeModal';\nimport WarningModal from './WarningModal';\nimport { appEnabledStatuses, warnStatusChange, handleAPIError } from './helpers';\n\nfunction AppMenu({ app, ...props }) {\n\tconst t = useTranslation();\n\tconst setModal = useSetModal();\n\tconst appsRoute = useRoute('admin-apps');\n\tconst checkUserLoggedIn = useMethod('cloud:checkUserLoggedIn');\n\n\tconst setAppStatus = useEndpoint('POST', `/apps/${app.id}/status`);\n\tconst buildExternalUrl = useEndpoint('GET', '/apps');\n\tconst syncApp = useEndpoint('POST', `/apps/${app.id}/sync`);\n\tconst uninstallApp = useEndpoint('DELETE', `/apps/${app.id}`);\n\n\tconst canAppBeSubscribed = app.purchaseType === 'subscription';\n\tconst isSubscribed = app.subscriptionInfo && ['active', 'trialing'].includes(app.subscriptionInfo.status);\n\tconst isAppEnabled = appEnabledStatuses.includes(app.status);\n\n\tconst closeModal = useCallback(() => {\n\t\tsetModal(null);\n\t}, [setModal]);\n\n\tconst handleEnable = useCallback(async () => {\n\t\ttry {\n\t\t\tconst { status } = await setAppStatus({ status: 'manually_enabled' });\n\t\t\twarnStatusChange(app.name, status);\n\t\t} catch (error) {\n\t\t\thandleAPIError(error);\n\t\t}\n\t}, [app.name, setAppStatus]);\n\n\tconst handleViewLogs = useCallback(() => {\n\t\tappsRoute.push({ context: 'logs', id: app.id });\n\t}, [app.id, appsRoute]);\n\n\tconst handleSubscription = useCallback(async () => {\n\t\tif (!(await checkUserLoggedIn())) {\n\t\t\tsetModal(<CloudLoginModal />);\n\t\t\treturn;\n\t\t}\n\n\t\tlet data;\n\t\ttry {\n\t\t\tdata = await buildExternalUrl({\n\t\t\t\tbuildExternalUrl: 'true',\n\t\t\t\tappId: app.id,\n\t\t\t\tpurchaseType: app.purchaseType,\n\t\t\t\tdetails: true,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\thandleAPIError(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst confirm = async () => {\n\t\t\ttry {\n\t\t\t\tawait syncApp();\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t};\n\n\t\tsetModal(<IframeModal url={data.url} confirm={confirm} cancel={closeModal} />);\n\t}, [checkUserLoggedIn, setModal, closeModal, buildExternalUrl, app.id, app.purchaseType, syncApp]);\n\n\tconst handleDisable = useCallback(() => {\n\t\tconst confirm = async () => {\n\t\t\tcloseModal();\n\t\t\ttry {\n\t\t\t\tconst { status } = await setAppStatus({ status: 'manually_disabled' });\n\t\t\t\twarnStatusChange(app.name, status);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t};\n\t\tsetModal(\n\t\t\t<WarningModal close={closeModal} confirm={confirm} text={t('Apps_Marketplace_Deactivate_App_Prompt')} confirmText={t('Yes')} />,\n\t\t);\n\t}, [app.name, closeModal, setAppStatus, setModal, t]);\n\n\tconst handleUninstall = useCallback(() => {\n\t\tconst uninstall = async () => {\n\t\t\tcloseModal();\n\t\t\ttry {\n\t\t\t\tawait uninstallApp();\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t};\n\n\t\tif (isSubscribed) {\n\t\t\tconst confirm = async () => {\n\t\t\t\tawait handleSubscription();\n\t\t\t};\n\n\t\t\tsetModal(\n\t\t\t\t<WarningModal\n\t\t\t\t\tclose={closeModal}\n\t\t\t\t\tcancel={uninstall}\n\t\t\t\t\tconfirm={confirm}\n\t\t\t\t\ttext={t('Apps_Marketplace_Uninstall_Subscribed_App_Prompt')}\n\t\t\t\t\tconfirmText={t('Apps_Marketplace_Modify_App_Subscription')}\n\t\t\t\t\tcancelText={t('Apps_Marketplace_Uninstall_Subscribed_App_Anyway')}\n\t\t\t\t/>,\n\t\t\t);\n\t\t}\n\n\t\tsetModal(\n\t\t\t<WarningModal close={closeModal} confirm={uninstall} text={t('Apps_Marketplace_Uninstall_App_Prompt')} confirmText={t('Yes')} />,\n\t\t);\n\t}, [closeModal, handleSubscription, isSubscribed, setModal, t, uninstallApp]);\n\n\tconst menuOptions = useMemo(\n\t\t() => ({\n\t\t\t...(canAppBeSubscribed && {\n\t\t\t\tsubscribe: {\n\t\t\t\t\tlabel: (\n\t\t\t\t\t\t<Box>\n\t\t\t\t\t\t\t<Icon name='card' size='x16' marginInlineEnd='x4' />\n\t\t\t\t\t\t\t{t('Subscription')}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t),\n\t\t\t\t\taction: handleSubscription,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tviewLogs: {\n\t\t\t\tlabel: (\n\t\t\t\t\t<Box>\n\t\t\t\t\t\t<Icon name='list-alt' size='x16' marginInlineEnd='x4' />\n\t\t\t\t\t\t{t('View_Logs')}\n\t\t\t\t\t</Box>\n\t\t\t\t),\n\t\t\t\taction: handleViewLogs,\n\t\t\t},\n\t\t\t...(isAppEnabled && {\n\t\t\t\tdisable: {\n\t\t\t\t\tlabel: (\n\t\t\t\t\t\t<Box color='warning'>\n\t\t\t\t\t\t\t<Icon name='ban' size='x16' marginInlineEnd='x4' />\n\t\t\t\t\t\t\t{t('Disable')}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t),\n\t\t\t\t\taction: handleDisable,\n\t\t\t\t},\n\t\t\t}),\n\t\t\t...(!isAppEnabled && {\n\t\t\t\tenable: {\n\t\t\t\t\tlabel: (\n\t\t\t\t\t\t<Box>\n\t\t\t\t\t\t\t<Icon name='check' size='x16' marginInlineEnd='x4' />\n\t\t\t\t\t\t\t{t('Enable')}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t),\n\t\t\t\t\taction: handleEnable,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tuninstall: {\n\t\t\t\tlabel: (\n\t\t\t\t\t<Box color='danger'>\n\t\t\t\t\t\t<Icon name='trash' size='x16' marginInlineEnd='x4' />\n\t\t\t\t\t\t{t('Uninstall')}\n\t\t\t\t\t</Box>\n\t\t\t\t),\n\t\t\t\taction: handleUninstall,\n\t\t\t},\n\t\t}),\n\t\t[canAppBeSubscribed, t, handleSubscription, handleViewLogs, isAppEnabled, handleDisable, handleEnable, handleUninstall],\n\t);\n\n\treturn <Menu options={menuOptions} placement='bottom-start' {...props} />;\n}\n\nexport default AppMenu;\n"]},"sourceType":"module","hash":"8dd003d365d2b27ca13395dd93760e1c60c1a073"}
