{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/ExportMessages/MailExportForm.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/contextualBar/ExportMessages/MailExportForm.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/ExportMessages/MailExportForm.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/room/contextualBar/ExportMessages/MailExportForm.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/contextualBar/ExportMessages/MailExportForm.js"}},"code":"var _templateObject;\n\nlet _taggedTemplateLiteral;\n\nmodule.link(\"@babel/runtime/helpers/taggedTemplateLiteral\", {\n  default(v) {\n    _taggedTemplateLiteral = v;\n  }\n\n}, 0);\nlet css;\nmodule.link(\"@rocket.chat/css-in-js\", {\n  css(v) {\n    css = v;\n  }\n\n}, 0);\nlet Field, TextInput, ButtonGroup, Button, Box, Icon, Callout, FieldGroup;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Field(v) {\n    Field = v;\n  },\n\n  TextInput(v) {\n    TextInput = v;\n  },\n\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  },\n\n  Button(v) {\n    Button = v;\n  },\n\n  Box(v) {\n    Box = v;\n  },\n\n  Icon(v) {\n    Icon = v;\n  },\n\n  Callout(v) {\n    Callout = v;\n  },\n\n  FieldGroup(v) {\n    FieldGroup = v;\n  }\n\n}, 1);\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n\n}, 2);\nlet $;\nmodule.link(\"jquery\", {\n  default(v) {\n    $ = v;\n  }\n\n}, 3);\nlet React, useState, useEffect;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useState(v) {\n    useState = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  }\n\n}, 4);\nlet validateEmail;\nmodule.link(\"../../../../../lib/emailValidator\", {\n  validateEmail(v) {\n    validateEmail = v;\n  }\n\n}, 5);\nlet UserAutoCompleteMultiple;\nmodule.link(\"../../../../components/UserAutoCompleteMultiple\", {\n  default(v) {\n    UserAutoCompleteMultiple = v;\n  }\n\n}, 6);\nlet useEndpoint;\nmodule.link(\"../../../../contexts/ServerContext\", {\n  useEndpoint(v) {\n    useEndpoint = v;\n  }\n\n}, 7);\nlet useToastMessageDispatch;\nmodule.link(\"../../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n\n}, 8);\nlet useTranslation;\nmodule.link(\"../../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 9);\nlet useForm;\nmodule.link(\"../../../../hooks/useForm\", {\n  useForm(v) {\n    useForm = v;\n  }\n\n}, 10);\nlet roomCoordinator;\nmodule.link(\"../../../../lib/rooms/roomCoordinator\", {\n  roomCoordinator(v) {\n    roomCoordinator = v;\n  }\n\n}, 11);\nlet useUserRoom;\nmodule.link(\"../../hooks/useUserRoom\", {\n  useUserRoom(v) {\n    useUserRoom = v;\n  }\n\n}, 12);\nconst clickable = css(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n\\tcursor: pointer;\\n\"])));\n\nconst MailExportForm = _ref => {\n  let {\n    onCancel,\n    rid\n  } = _ref;\n  const t = useTranslation();\n  const room = useUserRoom(rid);\n  const roomName = room && room.t && roomCoordinator.getRoomName(room.t, room);\n  const [selectedMessages, setSelected] = useState([]);\n  const [errorMessage, setErrorMessage] = useState();\n  const {\n    values,\n    handlers\n  } = useForm({\n    dateFrom: '',\n    dateTo: '',\n    toUsers: [],\n    additionalEmails: '',\n    subject: t('Mail_Messages_Subject', roomName)\n  });\n  const dispatchToastMessage = useToastMessageDispatch();\n  const {\n    toUsers,\n    additionalEmails,\n    subject\n  } = values;\n  const reset = useMutableCallback(() => {\n    setSelected([]);\n    $('.messages-box .message', $(\"#chat-window-\".concat(rid))).removeClass('selected');\n  });\n  useEffect(() => {\n    const $root = $(\"#chat-window-\".concat(rid));\n    $('.messages-box', $root).addClass('selectable');\n\n    const handler = function () {\n      const {\n        id\n      } = this;\n\n      if (this.classList.contains('selected')) {\n        this.classList.remove('selected');\n        setSelected(selectedMessages => selectedMessages.filter(message => message !== id));\n      } else {\n        this.classList.add('selected');\n        setSelected(selectedMessages => selectedMessages.concat(id));\n      }\n    };\n\n    $('.messages-box .message', $root).on('click', handler);\n    return () => {\n      $('.messages-box', $root).removeClass('selectable');\n      $('.messages-box .message', $root).off('click', handler).filter('.selected').removeClass('selected');\n    };\n  }, [rid]);\n  const {\n    handleToUsers,\n    handleAdditionalEmails,\n    handleSubject\n  } = handlers;\n  const onChangeUsers = useMutableCallback((value, action) => {\n    if (!action) {\n      if (toUsers.includes(value)) {\n        return;\n      }\n\n      return handleToUsers([...toUsers, value]);\n    }\n\n    handleToUsers(toUsers.filter(current => current !== value));\n  });\n  const roomsExport = useEndpoint('POST', 'rooms.export');\n\n  const handleSubmit = async () => {\n    if (toUsers.length === 0 && additionalEmails === '') {\n      setErrorMessage(t('Mail_Message_Missing_to'));\n      return;\n    }\n\n    if (additionalEmails !== '' && !validateEmail(additionalEmails)) {\n      setErrorMessage(t('Mail_Message_Invalid_emails', additionalEmails));\n      return;\n    }\n\n    if (selectedMessages.length === 0) {\n      setErrorMessage(t('Mail_Message_No_messages_selected_select_all'));\n      return;\n    }\n\n    setErrorMessage(null);\n\n    try {\n      await roomsExport({\n        rid,\n        type: 'email',\n        toUsers,\n        toEmails: additionalEmails.split(','),\n        subject,\n        messages: selectedMessages\n      });\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Your_email_has_been_queued_for_sending')\n      });\n    } catch (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(FieldGroup, null, /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Callout, {\n    onClick: reset,\n    title: t('Messages selected'),\n    type: selectedMessages.length > 0 ? 'success' : 'info'\n  }, /*#__PURE__*/React.createElement(\"p\", null, \"\".concat(selectedMessages.length, \" Messages selected\")), selectedMessages.length > 0 && /*#__PURE__*/React.createElement(Box, {\n    is: \"p\",\n    className: clickable\n  }, t('Click here to clear the selection')), selectedMessages.length === 0 && /*#__PURE__*/React.createElement(Box, {\n    is: \"p\"\n  }, t('Click_the_messages_you_would_like_to_send_by_email')))), /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Label, null, t('To_users')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(UserAutoCompleteMultiple, {\n    value: toUsers,\n    onChange: onChangeUsers\n  }))), /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Label, null, t('To_additional_emails')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextInput, {\n    placeholder: t('Email_Placeholder_any'),\n    value: additionalEmails,\n    onChange: handleAdditionalEmails,\n    addon: /*#__PURE__*/React.createElement(Icon, {\n      name: \"mail\",\n      size: \"x20\"\n    })\n  }))), /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Label, null, t('Subject')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextInput, {\n    value: subject,\n    onChange: handleSubject,\n    addon: /*#__PURE__*/React.createElement(Icon, {\n      name: \"edit\",\n      size: \"x20\"\n    })\n  }))), errorMessage && /*#__PURE__*/React.createElement(Callout, {\n    type: 'danger',\n    title: errorMessage\n  }), /*#__PURE__*/React.createElement(ButtonGroup, {\n    stretch: true,\n    mb: \"x12\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onCancel\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    onClick: () => handleSubmit()\n  }, t('Send'))));\n};\n\nmodule.exportDefault(MailExportForm);","map":{"version":3,"sources":["client/views/room/contextualBar/ExportMessages/MailExportForm.js"],"names":["_taggedTemplateLiteral","module","link","default","v","css","Field","TextInput","ButtonGroup","Button","Box","Icon","Callout","FieldGroup","useMutableCallback","$","React","useState","useEffect","validateEmail","UserAutoCompleteMultiple","useEndpoint","useToastMessageDispatch","useTranslation","useForm","roomCoordinator","useUserRoom","clickable","MailExportForm","onCancel","rid","t","room","roomName","getRoomName","selectedMessages","setSelected","errorMessage","setErrorMessage","values","handlers","dateFrom","dateTo","toUsers","additionalEmails","subject","dispatchToastMessage","reset","removeClass","$root","addClass","handler","id","classList","contains","remove","filter","message","add","concat","on","off","handleToUsers","handleAdditionalEmails","handleSubject","onChangeUsers","value","action","includes","current","roomsExport","handleSubmit","length","type","toEmails","split","messages","error","exportDefault"],"mappings":"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","sourcesContent":["import { css } from '@rocket.chat/css-in-js';\nimport { Field, TextInput, ButtonGroup, Button, Box, Icon, Callout, FieldGroup } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport $ from 'jquery';\nimport React, { useState, useEffect } from 'react';\n\nimport { validateEmail } from '../../../../../lib/emailValidator';\nimport UserAutoCompleteMultiple from '../../../../components/UserAutoCompleteMultiple';\nimport { useEndpoint } from '../../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../../contexts/TranslationContext';\nimport { useForm } from '../../../../hooks/useForm';\nimport { roomCoordinator } from '../../../../lib/rooms/roomCoordinator';\nimport { useUserRoom } from '../../hooks/useUserRoom';\n\nconst clickable = css`\n\tcursor: pointer;\n`;\n\nconst MailExportForm = ({ onCancel, rid }) => {\n\tconst t = useTranslation();\n\n\tconst room = useUserRoom(rid);\n\tconst roomName = room && room.t && roomCoordinator.getRoomName(room.t, room);\n\n\tconst [selectedMessages, setSelected] = useState([]);\n\n\tconst [errorMessage, setErrorMessage] = useState();\n\n\tconst { values, handlers } = useForm({\n\t\tdateFrom: '',\n\t\tdateTo: '',\n\t\ttoUsers: [],\n\t\tadditionalEmails: '',\n\t\tsubject: t('Mail_Messages_Subject', roomName),\n\t});\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst { toUsers, additionalEmails, subject } = values;\n\n\tconst reset = useMutableCallback(() => {\n\t\tsetSelected([]);\n\t\t$('.messages-box .message', $(`#chat-window-${rid}`)).removeClass('selected');\n\t});\n\n\tuseEffect(() => {\n\t\tconst $root = $(`#chat-window-${rid}`);\n\t\t$('.messages-box', $root).addClass('selectable');\n\n\t\tconst handler = function () {\n\t\t\tconst { id } = this;\n\n\t\t\tif (this.classList.contains('selected')) {\n\t\t\t\tthis.classList.remove('selected');\n\t\t\t\tsetSelected((selectedMessages) => selectedMessages.filter((message) => message !== id));\n\t\t\t} else {\n\t\t\t\tthis.classList.add('selected');\n\t\t\t\tsetSelected((selectedMessages) => selectedMessages.concat(id));\n\t\t\t}\n\t\t};\n\t\t$('.messages-box .message', $root).on('click', handler);\n\n\t\treturn () => {\n\t\t\t$('.messages-box', $root).removeClass('selectable');\n\t\t\t$('.messages-box .message', $root).off('click', handler).filter('.selected').removeClass('selected');\n\t\t};\n\t}, [rid]);\n\n\tconst { handleToUsers, handleAdditionalEmails, handleSubject } = handlers;\n\n\tconst onChangeUsers = useMutableCallback((value, action) => {\n\t\tif (!action) {\n\t\t\tif (toUsers.includes(value)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleToUsers([...toUsers, value]);\n\t\t}\n\t\thandleToUsers(toUsers.filter((current) => current !== value));\n\t});\n\n\tconst roomsExport = useEndpoint('POST', 'rooms.export');\n\n\tconst handleSubmit = async () => {\n\t\tif (toUsers.length === 0 && additionalEmails === '') {\n\t\t\tsetErrorMessage(t('Mail_Message_Missing_to'));\n\t\t\treturn;\n\t\t}\n\t\tif (additionalEmails !== '' && !validateEmail(additionalEmails)) {\n\t\t\tsetErrorMessage(t('Mail_Message_Invalid_emails', additionalEmails));\n\t\t\treturn;\n\t\t}\n\t\tif (selectedMessages.length === 0) {\n\t\t\tsetErrorMessage(t('Mail_Message_No_messages_selected_select_all'));\n\t\t\treturn;\n\t\t}\n\t\tsetErrorMessage(null);\n\n\t\ttry {\n\t\t\tawait roomsExport({\n\t\t\t\trid,\n\t\t\t\ttype: 'email',\n\t\t\t\ttoUsers,\n\t\t\t\ttoEmails: additionalEmails.split(','),\n\t\t\t\tsubject,\n\t\t\t\tmessages: selectedMessages,\n\t\t\t});\n\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'success',\n\t\t\t\tmessage: t('Your_email_has_been_queued_for_sending'),\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'error',\n\t\t\t\tmessage: error,\n\t\t\t});\n\t\t}\n\t};\n\n\treturn (\n\t\t<FieldGroup>\n\t\t\t<Field>\n\t\t\t\t<Callout onClick={reset} title={t('Messages selected')} type={selectedMessages.length > 0 ? 'success' : 'info'}>\n\t\t\t\t\t<p>{`${selectedMessages.length} Messages selected`}</p>\n\t\t\t\t\t{selectedMessages.length > 0 && (\n\t\t\t\t\t\t<Box is='p' className={clickable}>\n\t\t\t\t\t\t\t{t('Click here to clear the selection')}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t)}\n\t\t\t\t\t{selectedMessages.length === 0 && <Box is='p'>{t('Click_the_messages_you_would_like_to_send_by_email')}</Box>}\n\t\t\t\t</Callout>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Label>{t('To_users')}</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<UserAutoCompleteMultiple value={toUsers} onChange={onChangeUsers} />\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Label>{t('To_additional_emails')}</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tplaceholder={t('Email_Placeholder_any')}\n\t\t\t\t\t\tvalue={additionalEmails}\n\t\t\t\t\t\tonChange={handleAdditionalEmails}\n\t\t\t\t\t\taddon={<Icon name='mail' size='x20' />}\n\t\t\t\t\t/>\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Label>{t('Subject')}</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<TextInput value={subject} onChange={handleSubject} addon={<Icon name='edit' size='x20' />} />\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\n\t\t\t{errorMessage && <Callout type={'danger'} title={errorMessage} />}\n\n\t\t\t<ButtonGroup stretch mb='x12'>\n\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t<Button primary onClick={() => handleSubmit()}>\n\t\t\t\t\t{t('Send')}\n\t\t\t\t</Button>\n\t\t\t</ButtonGroup>\n\t\t</FieldGroup>\n\t);\n};\n\nexport default MailExportForm;\n"]},"sourceType":"module","hash":"57006170027e6f29761ec85dd1a52a5286136e31"}
