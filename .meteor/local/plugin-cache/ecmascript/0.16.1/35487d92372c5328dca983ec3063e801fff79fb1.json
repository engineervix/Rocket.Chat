{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-master/client/body.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-master/client/body.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-master/client/body.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-master/client/body.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-master/client/body.js"}},"code":"let Clipboard;\nmodule.link(\"clipboard\", {\n  default(v) {\n    Clipboard = v;\n  }\n\n}, 0);\nlet s;\nmodule.link(\"underscore.string\", {\n  default(v) {\n    s = v;\n  }\n\n}, 1);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 2);\nlet Match;\nmodule.link(\"meteor/check\", {\n  Match(v) {\n    Match = v;\n  }\n\n}, 3);\nlet Session;\nmodule.link(\"meteor/session\", {\n  Session(v) {\n    Session = v;\n  }\n\n}, 4);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 5);\nlet t;\nmodule.link(\"../../utils/client\", {\n  t(v) {\n    t = v;\n  }\n\n}, 6);\nlet chatMessages;\nmodule.link(\"../../ui\", {\n  chatMessages(v) {\n    chatMessages = v;\n  }\n\n}, 7);\nlet popover, RoomManager;\nmodule.link(\"../../ui-utils\", {\n  popover(v) {\n    popover = v;\n  },\n\n  RoomManager(v) {\n    RoomManager = v;\n  }\n\n}, 8);\nlet settings;\nmodule.link(\"../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 9);\nlet ChatSubscription;\nmodule.link(\"../../models\", {\n  ChatSubscription(v) {\n    ChatSubscription = v;\n  }\n\n}, 10);\nmodule.link(\"./body.html\");\nlet imperativeModal;\nmodule.link(\"../../../client/lib/imperativeModal\", {\n  imperativeModal(v) {\n    imperativeModal = v;\n  }\n\n}, 11);\nlet GenericModal;\nmodule.link(\"../../../client/components/GenericModal\", {\n  default(v) {\n    GenericModal = v;\n  }\n\n}, 12);\nlet fireGlobalEvent;\nmodule.link(\"../../../client/lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent(v) {\n    fireGlobalEvent = v;\n  }\n\n}, 13);\nlet isLayoutEmbedded;\nmodule.link(\"../../../client/lib/utils/isLayoutEmbedded\", {\n  isLayoutEmbedded(v) {\n    isLayoutEmbedded = v;\n  }\n\n}, 14);\nTemplate.body.onRendered(function () {\n  new Clipboard('.clipboard');\n  $(document.body).on('keydown', function (e) {\n    const unread = Session.get('unread');\n\n    if (e.keyCode === 27 && (e.shiftKey === true || e.ctrlKey === true) && unread != null && unread !== '') {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const handleClearUnreadAllMessages = () => {\n        const subscriptions = ChatSubscription.find({\n          open: true\n        }, {\n          fields: {\n            unread: 1,\n            alert: 1,\n            rid: 1,\n            t: 1,\n            name: 1,\n            ls: 1\n          }\n        });\n        subscriptions.forEach(subscription => {\n          if (subscription.alert || subscription.unread > 0) {\n            Meteor.call('readMessages', subscription.rid);\n          }\n        });\n        imperativeModal.close();\n      };\n\n      imperativeModal.open({\n        component: GenericModal,\n        props: {\n          children: t('Are_you_sure_you_want_to_clear_all_unread_messages'),\n          variant: 'warning',\n          title: t('Clear_all_unreads_question'),\n          confirmText: t('Yes_clear_all'),\n          onClose: imperativeModal.close,\n          onCancel: imperativeModal.close,\n          onConfirm: handleClearUnreadAllMessages\n        }\n      });\n    }\n  });\n  $(document.body).on('keydown', function (e) {\n    const {\n      target\n    } = e;\n\n    if (e.ctrlKey === true || e.metaKey === true) {\n      popover.close();\n      return;\n    }\n\n    if (!(e.keyCode > 45 && e.keyCode < 91 || e.keyCode === 8)) {\n      return;\n    }\n\n    if (/input|textarea|select/i.test(target.tagName)) {\n      return;\n    }\n\n    if (target.id === 'pswp') {\n      return;\n    }\n\n    popover.close();\n\n    if (document.querySelector('.rc-modal-wrapper dialog[open]')) {\n      return;\n    }\n\n    const inputMessage = chatMessages[RoomManager.openedRoom] && chatMessages[RoomManager.openedRoom].input;\n\n    if (!inputMessage) {\n      return;\n    }\n\n    inputMessage.focus();\n  });\n\n  const handleMessageLinkClick = event => {\n    const link = event.currentTarget;\n\n    if (link.origin === s.rtrim(Meteor.absoluteUrl(), '/') && /msg=([a-zA-Z0-9]+)/.test(link.search)) {\n      fireGlobalEvent('click-message-link', {\n        link: link.pathname + link.search\n      });\n    }\n  };\n\n  this.autorun(() => {\n    if (isLayoutEmbedded()) {\n      $(document.body).on('click', 'a', handleMessageLinkClick);\n    } else {\n      $(document.body).off('click', 'a', handleMessageLinkClick);\n    }\n  });\n  this.autorun(function (c) {\n    const w = window;\n    const d = document;\n    const script = 'script';\n    const l = 'dataLayer';\n    const i = settings.get('GoogleTagManager_id');\n\n    if (Match.test(i, String) && i.trim() !== '') {\n      c.stop();\n      return function (w, d, s, l, i) {\n        w[l] = w[l] || [];\n        w[l].push({\n          'gtm.start': new Date().getTime(),\n          'event': 'gtm.js'\n        });\n        const f = d.getElementsByTagName(s)[0];\n        const j = d.createElement(s);\n        const dl = l !== 'dataLayer' ? \"&l=\".concat(l) : '';\n        j.async = true;\n        j.src = \"//www.googletagmanager.com/gtm.js?id=\".concat(i).concat(dl);\n        return f.parentNode.insertBefore(j, f);\n      }(w, d, script, l, i);\n    }\n  });\n});","map":{"version":3,"sources":["app/ui-master/client/body.js"],"names":["Clipboard","module","link","default","v","s","Meteor","Match","Session","Template","t","chatMessages","popover","RoomManager","settings","ChatSubscription","imperativeModal","GenericModal","fireGlobalEvent","isLayoutEmbedded","body","onRendered","$","document","on","e","unread","get","keyCode","shiftKey","ctrlKey","preventDefault","stopPropagation","handleClearUnreadAllMessages","subscriptions","find","open","fields","alert","rid","name","ls","forEach","subscription","call","close","component","props","children","variant","title","confirmText","onClose","onCancel","onConfirm","target","metaKey","test","tagName","id","querySelector","inputMessage","openedRoom","input","focus","handleMessageLinkClick","event","currentTarget","origin","rtrim","absoluteUrl","search","pathname","autorun","off","c","w","window","d","script","l","i","String","trim","stop","push","Date","getTime","f","getElementsByTagName","j","createElement","dl","async","src","parentNode","insertBefore"],"mappings":"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","sourcesContent":["import Clipboard from 'clipboard';\nimport s from 'underscore.string';\nimport { Meteor } from 'meteor/meteor';\nimport { Match } from 'meteor/check';\nimport { Session } from 'meteor/session';\nimport { Template } from 'meteor/templating';\n\nimport { t } from '../../utils/client';\nimport { chatMessages } from '../../ui';\nimport { popover, RoomManager } from '../../ui-utils';\nimport { settings } from '../../settings';\nimport { ChatSubscription } from '../../models';\nimport './body.html';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport GenericModal from '../../../client/components/GenericModal';\nimport { fireGlobalEvent } from '../../../client/lib/utils/fireGlobalEvent';\nimport { isLayoutEmbedded } from '../../../client/lib/utils/isLayoutEmbedded';\n\nTemplate.body.onRendered(function () {\n\tnew Clipboard('.clipboard');\n\n\t$(document.body).on('keydown', function (e) {\n\t\tconst unread = Session.get('unread');\n\t\tif (e.keyCode === 27 && (e.shiftKey === true || e.ctrlKey === true) && unread != null && unread !== '') {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\n\t\t\tconst handleClearUnreadAllMessages = () => {\n\t\t\t\tconst subscriptions = ChatSubscription.find(\n\t\t\t\t\t{\n\t\t\t\t\t\topen: true,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tunread: 1,\n\t\t\t\t\t\t\talert: 1,\n\t\t\t\t\t\t\trid: 1,\n\t\t\t\t\t\t\tt: 1,\n\t\t\t\t\t\t\tname: 1,\n\t\t\t\t\t\t\tls: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tsubscriptions.forEach((subscription) => {\n\t\t\t\t\tif (subscription.alert || subscription.unread > 0) {\n\t\t\t\t\t\tMeteor.call('readMessages', subscription.rid);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\timperativeModal.close();\n\t\t\t};\n\n\t\t\timperativeModal.open({\n\t\t\t\tcomponent: GenericModal,\n\t\t\t\tprops: {\n\t\t\t\t\tchildren: t('Are_you_sure_you_want_to_clear_all_unread_messages'),\n\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\ttitle: t('Clear_all_unreads_question'),\n\t\t\t\t\tconfirmText: t('Yes_clear_all'),\n\t\t\t\t\tonClose: imperativeModal.close,\n\t\t\t\t\tonCancel: imperativeModal.close,\n\t\t\t\t\tonConfirm: handleClearUnreadAllMessages,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t});\n\n\t$(document.body).on('keydown', function (e) {\n\t\tconst { target } = e;\n\t\tif (e.ctrlKey === true || e.metaKey === true) {\n\t\t\tpopover.close();\n\t\t\treturn;\n\t\t}\n\t\tif (!((e.keyCode > 45 && e.keyCode < 91) || e.keyCode === 8)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (/input|textarea|select/i.test(target.tagName)) {\n\t\t\treturn;\n\t\t}\n\t\tif (target.id === 'pswp') {\n\t\t\treturn;\n\t\t}\n\n\t\tpopover.close();\n\n\t\tif (document.querySelector('.rc-modal-wrapper dialog[open]')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst inputMessage = chatMessages[RoomManager.openedRoom] && chatMessages[RoomManager.openedRoom].input;\n\t\tif (!inputMessage) {\n\t\t\treturn;\n\t\t}\n\t\tinputMessage.focus();\n\t});\n\n\tconst handleMessageLinkClick = (event) => {\n\t\tconst link = event.currentTarget;\n\t\tif (link.origin === s.rtrim(Meteor.absoluteUrl(), '/') && /msg=([a-zA-Z0-9]+)/.test(link.search)) {\n\t\t\tfireGlobalEvent('click-message-link', { link: link.pathname + link.search });\n\t\t}\n\t};\n\n\tthis.autorun(() => {\n\t\tif (isLayoutEmbedded()) {\n\t\t\t$(document.body).on('click', 'a', handleMessageLinkClick);\n\t\t} else {\n\t\t\t$(document.body).off('click', 'a', handleMessageLinkClick);\n\t\t}\n\t});\n\n\tthis.autorun(function (c) {\n\t\tconst w = window;\n\t\tconst d = document;\n\t\tconst script = 'script';\n\t\tconst l = 'dataLayer';\n\t\tconst i = settings.get('GoogleTagManager_id');\n\t\tif (Match.test(i, String) && i.trim() !== '') {\n\t\t\tc.stop();\n\t\t\treturn (function (w, d, s, l, i) {\n\t\t\t\tw[l] = w[l] || [];\n\t\t\t\tw[l].push({\n\t\t\t\t\t'gtm.start': new Date().getTime(),\n\t\t\t\t\t'event': 'gtm.js',\n\t\t\t\t});\n\t\t\t\tconst f = d.getElementsByTagName(s)[0];\n\t\t\t\tconst j = d.createElement(s);\n\t\t\t\tconst dl = l !== 'dataLayer' ? `&l=${l}` : '';\n\t\t\t\tj.async = true;\n\t\t\t\tj.src = `//www.googletagmanager.com/gtm.js?id=${i}${dl}`;\n\t\t\t\treturn f.parentNode.insertBefore(j, f);\n\t\t\t})(w, d, script, l, i);\n\t\t}\n\t});\n});\n"]},"sourceType":"module","hash":"35487d92372c5328dca983ec3063e801fff79fb1"}
