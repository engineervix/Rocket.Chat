{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/CustomFieldsForm.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/components/CustomFieldsForm.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/CustomFieldsForm.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/CustomFieldsForm.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/CustomFieldsForm.js"}},"code":"const _excluded = [\"formValues\", \"formHandlers\", \"customFields\"],\n      _excluded2 = [\"jsonCustomFields\", \"customFieldsData\", \"setCustomFieldsData\", \"onLoadFields\"];\n\nlet _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default(v) {\n    _extends = v;\n  }\n\n}, 0);\n\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 1);\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 2);\nmodule.export({\n  default: () => CustomFieldsForm\n});\nlet TextInput, Select, Field;\nmodule.link(\"@rocket.chat/fuselage\", {\n  TextInput(v) {\n    TextInput = v;\n  },\n\n  Select(v) {\n    Select = v;\n  },\n\n  Field(v) {\n    Field = v;\n  }\n\n}, 0);\nlet capitalize;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  capitalize(v) {\n    capitalize = v;\n  }\n\n}, 1);\nlet React, useMemo, useEffect, useState;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useState(v) {\n    useState = v;\n  }\n\n}, 2);\nlet useSetting;\nmodule.link(\"../contexts/SettingsContext\", {\n  useSetting(v) {\n    useSetting = v;\n  }\n\n}, 3);\nlet useTranslation;\nmodule.link(\"../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 4);\nlet useComponentDidUpdate;\nmodule.link(\"../hooks/useComponentDidUpdate\", {\n  useComponentDidUpdate(v) {\n    useComponentDidUpdate = v;\n  }\n\n}, 5);\nlet useForm;\nmodule.link(\"../hooks/useForm\", {\n  useForm(v) {\n    useForm = v;\n  }\n\n}, 6);\n\nconst CustomTextInput = _ref => {\n  let {\n    label,\n    name,\n    required,\n    minLength,\n    maxLength,\n    setState,\n    state,\n    className,\n    setCustomFieldsError = () => []\n  } = _ref;\n  const t = useTranslation();\n  const [inputError, setInputError] = useState('');\n  const verify = useMemo(() => {\n    const errors = [];\n\n    if (!state && required) {\n      errors.push(t('The_field_is_required', label || name));\n    }\n\n    if (state.length < minLength && state.length > 0) {\n      errors.push(t('Min_length_is', minLength));\n    }\n\n    return errors.join(', ');\n  }, [state, required, minLength, t, label, name]);\n  useEffect(() => {\n    setCustomFieldsError(oldErrors => verify ? [...oldErrors, {\n      name\n    }] : oldErrors.filter(item => item.name !== name));\n  }, [name, setCustomFieldsError, verify]);\n  useComponentDidUpdate(() => {\n    setInputError(verify);\n  }, [verify]);\n  return useMemo(() => /*#__PURE__*/React.createElement(Field, {\n    className: className\n  }, /*#__PURE__*/React.createElement(Field.Label, null, label || t(name), required && '*'), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextInput, {\n    name: name,\n    error: inputError,\n    maxLength: maxLength,\n    flexGrow: 1,\n    value: state,\n    onChange: e => setState(e.currentTarget.value)\n  })), /*#__PURE__*/React.createElement(Field.Error, null, inputError)), [className, label, t, name, required, inputError, maxLength, state, setState]);\n};\n\nconst CustomSelect = _ref2 => {\n  let {\n    label,\n    name,\n    required,\n    options = {},\n    setState,\n    state,\n    className,\n    setCustomFieldsError = () => []\n  } = _ref2;\n  const t = useTranslation();\n  const [selectError, setSelectError] = useState('');\n  const mappedOptions = useMemo(() => Object.values(options).map(value => [value, value]), [options]);\n  const verify = useMemo(() => !state.length && required ? t('The_field_is_required', label || name) : '', [name, label, required, state.length, t]);\n  useEffect(() => {\n    setCustomFieldsError(oldErrors => verify ? [...oldErrors, {\n      name\n    }] : oldErrors.filter(item => item.name !== name));\n  }, [name, setCustomFieldsError, verify]);\n  useComponentDidUpdate(() => {\n    setSelectError(verify);\n  }, [verify]);\n  return useMemo(() => /*#__PURE__*/React.createElement(Field, {\n    className: className\n  }, /*#__PURE__*/React.createElement(Field.Label, null, label || t(name), required && '*'), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(Select, {\n    name: name,\n    error: selectError,\n    flexGrow: 1,\n    value: state,\n    options: mappedOptions,\n    onChange: val => setState(val)\n  })), /*#__PURE__*/React.createElement(Field.Error, null, selectError)), [className, label, t, name, required, selectError, state, mappedOptions, setState]);\n};\n\nconst CustomFieldsAssembler = _ref3 => {\n  let {\n    formValues,\n    formHandlers,\n    customFields\n  } = _ref3,\n      props = _objectWithoutProperties(_ref3, _excluded);\n\n  return Object.entries(customFields).map(_ref4 => {\n    let [key, value] = _ref4;\n\n    const extraProps = _objectSpread({\n      key,\n      name: key,\n      setState: formHandlers[\"handle\".concat(capitalize(key))],\n      state: formValues[key]\n    }, value);\n\n    if (value.type === 'select') {\n      return /*#__PURE__*/React.createElement(CustomSelect, _extends({}, extraProps, props));\n    }\n\n    if (value.type === 'text') {\n      return /*#__PURE__*/React.createElement(CustomTextInput, _extends({}, extraProps, props));\n    }\n\n    return null;\n  });\n};\n\nfunction CustomFieldsForm(_ref5) {\n  let {\n    jsonCustomFields,\n    customFieldsData,\n    setCustomFieldsData,\n    onLoadFields = () => {}\n  } = _ref5,\n      props = _objectWithoutProperties(_ref5, _excluded2);\n\n  const accountsCustomFieldsJson = useSetting('Accounts_CustomFields');\n  const [customFields] = useState(() => {\n    try {\n      return jsonCustomFields || JSON.parse(accountsCustomFieldsJson || '{}');\n    } catch (_unused) {\n      return {};\n    }\n  });\n  const hasCustomFields = Boolean(Object.values(customFields).length);\n  const defaultFields = useMemo(() => Object.entries(customFields).reduce((data, _ref6) => {\n    var _value$defaultValue;\n\n    let [key, value] = _ref6;\n    data[key] = (_value$defaultValue = value.defaultValue) !== null && _value$defaultValue !== void 0 ? _value$defaultValue : '';\n    return data;\n  }, {}), [customFields]);\n  const {\n    values,\n    handlers\n  } = useForm(_objectSpread(_objectSpread({}, defaultFields), customFieldsData));\n  useEffect(() => {\n    onLoadFields(hasCustomFields);\n\n    if (hasCustomFields) {\n      setCustomFieldsData(values);\n    }\n  }, [hasCustomFields, onLoadFields, setCustomFieldsData, values]);\n\n  if (!hasCustomFields) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(CustomFieldsAssembler, _extends({\n    formValues: values,\n    formHandlers: handlers,\n    customFields: customFields\n  }, props));\n}","map":{"version":3,"sources":["client/components/CustomFieldsForm.js"],"names":["_extends","module","link","default","v","_objectSpread","_objectWithoutProperties","export","CustomFieldsForm","TextInput","Select","Field","capitalize","React","useMemo","useEffect","useState","useSetting","useTranslation","useComponentDidUpdate","useForm","CustomTextInput","label","name","required","minLength","maxLength","setState","state","className","setCustomFieldsError","t","inputError","setInputError","verify","errors","push","length","join","oldErrors","filter","item","e","currentTarget","value","CustomSelect","options","selectError","setSelectError","mappedOptions","Object","values","map","val","CustomFieldsAssembler","formValues","formHandlers","customFields","props","entries","key","extraProps","type","jsonCustomFields","customFieldsData","setCustomFieldsData","onLoadFields","accountsCustomFieldsJson","JSON","parse","hasCustomFields","Boolean","defaultFields","reduce","data","defaultValue","handlers"],"mappings":"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","sourcesContent":["import { TextInput, Select, Field } from '@rocket.chat/fuselage';\nimport { capitalize } from '@rocket.chat/string-helpers';\nimport React, { useMemo, useEffect, useState } from 'react';\n\nimport { useSetting } from '../contexts/SettingsContext';\nimport { useTranslation } from '../contexts/TranslationContext';\nimport { useComponentDidUpdate } from '../hooks/useComponentDidUpdate';\nimport { useForm } from '../hooks/useForm';\n\nconst CustomTextInput = ({ label, name, required, minLength, maxLength, setState, state, className, setCustomFieldsError = () => [] }) => {\n\tconst t = useTranslation();\n\n\tconst [inputError, setInputError] = useState('');\n\n\tconst verify = useMemo(() => {\n\t\tconst errors = [];\n\t\tif (!state && required) {\n\t\t\terrors.push(t('The_field_is_required', label || name));\n\t\t}\n\n\t\tif (state.length < minLength && state.length > 0) {\n\t\t\terrors.push(t('Min_length_is', minLength));\n\t\t}\n\n\t\treturn errors.join(', ');\n\t}, [state, required, minLength, t, label, name]);\n\n\tuseEffect(() => {\n\t\tsetCustomFieldsError((oldErrors) => (verify ? [...oldErrors, { name }] : oldErrors.filter((item) => item.name !== name)));\n\t}, [name, setCustomFieldsError, verify]);\n\n\tuseComponentDidUpdate(() => {\n\t\tsetInputError(verify);\n\t}, [verify]);\n\n\treturn useMemo(\n\t\t() => (\n\t\t\t<Field className={className}>\n\t\t\t\t<Field.Label>\n\t\t\t\t\t{label || t(name)}\n\t\t\t\t\t{required && '*'}\n\t\t\t\t</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tname={name}\n\t\t\t\t\t\terror={inputError}\n\t\t\t\t\t\tmaxLength={maxLength}\n\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\tvalue={state}\n\t\t\t\t\t\tonChange={(e) => setState(e.currentTarget.value)}\n\t\t\t\t\t/>\n\t\t\t\t</Field.Row>\n\t\t\t\t<Field.Error>{inputError}</Field.Error>\n\t\t\t</Field>\n\t\t),\n\t\t[className, label, t, name, required, inputError, maxLength, state, setState],\n\t);\n};\n\nconst CustomSelect = ({ label, name, required, options = {}, setState, state, className, setCustomFieldsError = () => [] }) => {\n\tconst t = useTranslation();\n\tconst [selectError, setSelectError] = useState('');\n\n\tconst mappedOptions = useMemo(() => Object.values(options).map((value) => [value, value]), [options]);\n\tconst verify = useMemo(\n\t\t() => (!state.length && required ? t('The_field_is_required', label || name) : ''),\n\t\t[name, label, required, state.length, t],\n\t);\n\n\tuseEffect(() => {\n\t\tsetCustomFieldsError((oldErrors) => (verify ? [...oldErrors, { name }] : oldErrors.filter((item) => item.name !== name)));\n\t}, [name, setCustomFieldsError, verify]);\n\n\tuseComponentDidUpdate(() => {\n\t\tsetSelectError(verify);\n\t}, [verify]);\n\n\treturn useMemo(\n\t\t() => (\n\t\t\t<Field className={className}>\n\t\t\t\t<Field.Label>\n\t\t\t\t\t{label || t(name)}\n\t\t\t\t\t{required && '*'}\n\t\t\t\t</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<Select name={name} error={selectError} flexGrow={1} value={state} options={mappedOptions} onChange={(val) => setState(val)} />\n\t\t\t\t</Field.Row>\n\t\t\t\t<Field.Error>{selectError}</Field.Error>\n\t\t\t</Field>\n\t\t),\n\t\t[className, label, t, name, required, selectError, state, mappedOptions, setState],\n\t);\n};\n\nconst CustomFieldsAssembler = ({ formValues, formHandlers, customFields, ...props }) =>\n\tObject.entries(customFields).map(([key, value]) => {\n\t\tconst extraProps = {\n\t\t\tkey,\n\t\t\tname: key,\n\t\t\tsetState: formHandlers[`handle${capitalize(key)}`],\n\t\t\tstate: formValues[key],\n\t\t\t...value,\n\t\t};\n\n\t\tif (value.type === 'select') {\n\t\t\treturn <CustomSelect {...extraProps} {...props} />;\n\t\t}\n\n\t\tif (value.type === 'text') {\n\t\t\treturn <CustomTextInput {...extraProps} {...props} />;\n\t\t}\n\n\t\treturn null;\n\t});\n\nexport default function CustomFieldsForm({ jsonCustomFields, customFieldsData, setCustomFieldsData, onLoadFields = () => {}, ...props }) {\n\tconst accountsCustomFieldsJson = useSetting('Accounts_CustomFields');\n\n\tconst [customFields] = useState(() => {\n\t\ttry {\n\t\t\treturn jsonCustomFields || JSON.parse(accountsCustomFieldsJson || '{}');\n\t\t} catch {\n\t\t\treturn {};\n\t\t}\n\t});\n\n\tconst hasCustomFields = Boolean(Object.values(customFields).length);\n\tconst defaultFields = useMemo(\n\t\t() =>\n\t\t\tObject.entries(customFields).reduce((data, [key, value]) => {\n\t\t\t\tdata[key] = value.defaultValue ?? '';\n\t\t\t\treturn data;\n\t\t\t}, {}),\n\t\t[customFields],\n\t);\n\n\tconst { values, handlers } = useForm({ ...defaultFields, ...customFieldsData });\n\n\tuseEffect(() => {\n\t\tonLoadFields(hasCustomFields);\n\t\tif (hasCustomFields) {\n\t\t\tsetCustomFieldsData(values);\n\t\t}\n\t}, [hasCustomFields, onLoadFields, setCustomFieldsData, values]);\n\n\tif (!hasCustomFields) {\n\t\treturn null;\n\t}\n\n\treturn <CustomFieldsAssembler formValues={values} formHandlers={handlers} customFields={customFields} {...props} />;\n}\n"]},"sourceType":"module","hash":"250b5618d40617978d351ac652b26277623e090b"}
