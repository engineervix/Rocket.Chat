{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-login/client/username/username.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-login/client/username/username.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-login/client/username/username.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-login/client/username/username.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-login/client/username/username.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 1);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 2);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 3);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 4);\nlet settings;\nmodule.link(\"../../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 5);\nlet Button;\nmodule.link(\"../../../ui\", {\n  Button(v) {\n    Button = v;\n  }\n\n}, 6);\nlet t;\nmodule.link(\"../../../utils\", {\n  t(v) {\n    t = v;\n  }\n\n}, 7);\nlet callbacks;\nmodule.link(\"../../../../lib/callbacks\", {\n  callbacks(v) {\n    callbacks = v;\n  }\n\n}, 8);\nlet dispatchToastMessage;\nmodule.link(\"../../../../client/lib/toast\", {\n  dispatchToastMessage(v) {\n    dispatchToastMessage = v;\n  }\n\n}, 9);\nTemplate.username.onCreated(function () {\n  const self = this;\n  self.customFields = new ReactiveVar();\n  self.username = new ReactiveVar();\n  Tracker.autorun(() => {\n    const Accounts_CustomFields = settings.get('Accounts_CustomFields');\n\n    if (typeof Accounts_CustomFields === 'string' && Accounts_CustomFields.trim() !== '') {\n      try {\n        return this.customFields.set(JSON.parse(settings.get('Accounts_CustomFields')));\n      } catch (error1) {\n        return console.error('Invalid JSON for Accounts_CustomFields');\n      }\n    } else {\n      return this.customFields.set(null);\n    }\n  });\n\n  const validateCustomFields = function (formObj, validationObj) {\n    const customFields = self.customFields.get();\n\n    if (!customFields) {\n      return;\n    }\n\n    for (const field in formObj) {\n      if (formObj.hasOwnProperty(field)) {\n        const value = formObj[field];\n\n        if (customFields[field] == null) {\n          continue;\n        }\n\n        const customField = customFields[field];\n\n        if (customField.required === true && !value) {\n          validationObj[field] = t('Field_required');\n          return validationObj[field];\n        }\n\n        if (customField.maxLength != null && value.length > customField.maxLength) {\n          validationObj[field] = t('Max_length_is', customField.maxLength);\n          return validationObj[field];\n        }\n\n        if (customField.minLength != null && value.length < customField.minLength) {\n          validationObj[field] = t('Min_length_is', customField.minLength);\n          return validationObj[field];\n        }\n      }\n    }\n  };\n\n  this.validate = function () {\n    const formData = $('#login-card').serializeArray();\n    const formObj = {};\n    const validationObj = {};\n    formData.forEach(field => {\n      formObj[field.name] = field.value;\n    });\n    $('#login-card h2').removeClass('error');\n    $('#login-card input.error, #login-card select.error').removeClass('error');\n    $('#login-card .input-error').text('');\n    validateCustomFields(formObj, validationObj);\n\n    if (!_.isEmpty(validationObj)) {\n      $('#login-card h2').addClass('error');\n      Object.keys(validationObj).forEach(key => {\n        const value = validationObj[key];\n        $(\"#login-card input[name=\".concat(key, \"], #login-card select[name=\").concat(key, \"]\")).addClass('error');\n        $(\"#login-card input[name=\".concat(key, \"]~.input-error, #login-card select[name=\").concat(key, \"]~.input-error\")).text(value);\n      });\n      return false;\n    }\n\n    return formObj;\n  };\n\n  return Meteor.call('getUsernameSuggestion', function (error, username) {\n    self.username.set({\n      ready: true,\n      username\n    });\n    return Meteor.defer(() => self.find('input').focus());\n  });\n});\nTemplate.username.helpers({\n  username() {\n    return Template.instance().username.get();\n  },\n\n  backgroundUrl() {\n    const asset = settings.get('Assets_background');\n    const prefix = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '';\n\n    if (asset && (asset.url || asset.defaultUrl)) {\n      return \"\".concat(prefix, \"/\").concat(asset.url || asset.defaultUrl);\n    }\n  }\n\n});\nTemplate.username.events({\n  'focus .input-text input'(event) {\n    return $(event.currentTarget).parents('.input-text').addClass('focus');\n  },\n\n  'blur .input-text input'(event) {\n    if (event.currentTarget.value === '') {\n      return $(event.currentTarget).parents('.input-text').removeClass('focus');\n    }\n  },\n\n  'reset #login-card'() {\n    Meteor.logout();\n  },\n\n  'submit #login-card'(event, instance) {\n    event.preventDefault();\n    const formData = instance.validate();\n    const username = instance.username.get();\n    username.empty = false;\n    username.error = false;\n    username.invalid = false;\n    instance.username.set(username);\n    const button = $(event.target).find('button.login');\n    Button.loading(button);\n\n    if (!formData) {\n      Button.reset(button);\n      return;\n    }\n\n    const usernameValue = $('#username').val().trim();\n\n    if (usernameValue === '') {\n      username.empty = true;\n      instance.username.set(username);\n      Button.reset(button);\n      return;\n    }\n\n    Meteor.call('saveCustomFields', formData, function (err) {\n      if (err != null) {\n        dispatchToastMessage({\n          type: 'error',\n          message: err.error\n        });\n      }\n    });\n    Meteor.call('setUsername', usernameValue, function (err) {\n      if (err != null) {\n        if (err.error === 'username-invalid') {\n          username.invalid = true;\n        } else if (err.error === 'error-blocked-username') {\n          username.blocked = true;\n        } else {\n          username.unavailable = true;\n        }\n\n        username.username = usernameValue;\n        username.escaped = _.escape(usernameValue);\n      }\n\n      Button.reset(button);\n      instance.username.set(username);\n      return callbacks.run('usernameSet');\n    });\n  }\n\n});","map":{"version":3,"sources":["app/ui-login/client/username/username.js"],"names":["Meteor","module","link","v","ReactiveVar","Template","Tracker","_","default","settings","Button","t","callbacks","dispatchToastMessage","username","onCreated","self","customFields","autorun","Accounts_CustomFields","get","trim","set","JSON","parse","error1","console","error","validateCustomFields","formObj","validationObj","field","hasOwnProperty","value","customField","required","maxLength","length","minLength","validate","formData","$","serializeArray","forEach","name","removeClass","text","isEmpty","addClass","Object","keys","key","call","ready","defer","find","focus","helpers","instance","backgroundUrl","asset","prefix","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","url","defaultUrl","events","event","currentTarget","parents","logout","preventDefault","empty","invalid","button","target","loading","reset","usernameValue","val","err","type","message","blocked","unavailable","escaped","escape","run"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Template } from 'meteor/templating';\nimport { Tracker } from 'meteor/tracker';\nimport _ from 'underscore';\n\nimport { settings } from '../../../settings';\nimport { Button } from '../../../ui';\nimport { t } from '../../../utils';\nimport { callbacks } from '../../../../lib/callbacks';\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\n\nTemplate.username.onCreated(function () {\n\tconst self = this;\n\tself.customFields = new ReactiveVar();\n\tself.username = new ReactiveVar();\n\n\tTracker.autorun(() => {\n\t\tconst Accounts_CustomFields = settings.get('Accounts_CustomFields');\n\t\tif (typeof Accounts_CustomFields === 'string' && Accounts_CustomFields.trim() !== '') {\n\t\t\ttry {\n\t\t\t\treturn this.customFields.set(JSON.parse(settings.get('Accounts_CustomFields')));\n\t\t\t} catch (error1) {\n\t\t\t\treturn console.error('Invalid JSON for Accounts_CustomFields');\n\t\t\t}\n\t\t} else {\n\t\t\treturn this.customFields.set(null);\n\t\t}\n\t});\n\n\tconst validateCustomFields = function (formObj, validationObj) {\n\t\tconst customFields = self.customFields.get();\n\t\tif (!customFields) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const field in formObj) {\n\t\t\tif (formObj.hasOwnProperty(field)) {\n\t\t\t\tconst value = formObj[field];\n\t\t\t\tif (customFields[field] == null) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst customField = customFields[field];\n\t\t\t\tif (customField.required === true && !value) {\n\t\t\t\t\tvalidationObj[field] = t('Field_required');\n\t\t\t\t\treturn validationObj[field];\n\t\t\t\t}\n\t\t\t\tif (customField.maxLength != null && value.length > customField.maxLength) {\n\t\t\t\t\tvalidationObj[field] = t('Max_length_is', customField.maxLength);\n\t\t\t\t\treturn validationObj[field];\n\t\t\t\t}\n\t\t\t\tif (customField.minLength != null && value.length < customField.minLength) {\n\t\t\t\t\tvalidationObj[field] = t('Min_length_is', customField.minLength);\n\t\t\t\t\treturn validationObj[field];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.validate = function () {\n\t\tconst formData = $('#login-card').serializeArray();\n\t\tconst formObj = {};\n\t\tconst validationObj = {};\n\t\tformData.forEach((field) => {\n\t\t\tformObj[field.name] = field.value;\n\t\t});\n\n\t\t$('#login-card h2').removeClass('error');\n\t\t$('#login-card input.error, #login-card select.error').removeClass('error');\n\t\t$('#login-card .input-error').text('');\n\t\tvalidateCustomFields(formObj, validationObj);\n\t\tif (!_.isEmpty(validationObj)) {\n\t\t\t$('#login-card h2').addClass('error');\n\n\t\t\tObject.keys(validationObj).forEach((key) => {\n\t\t\t\tconst value = validationObj[key];\n\t\t\t\t$(`#login-card input[name=${key}], #login-card select[name=${key}]`).addClass('error');\n\t\t\t\t$(`#login-card input[name=${key}]~.input-error, #login-card select[name=${key}]~.input-error`).text(value);\n\t\t\t});\n\n\t\t\treturn false;\n\t\t}\n\t\treturn formObj;\n\t};\n\n\treturn Meteor.call('getUsernameSuggestion', function (error, username) {\n\t\tself.username.set({\n\t\t\tready: true,\n\t\t\tusername,\n\t\t});\n\t\treturn Meteor.defer(() => self.find('input').focus());\n\t});\n});\n\nTemplate.username.helpers({\n\tusername() {\n\t\treturn Template.instance().username.get();\n\t},\n\n\tbackgroundUrl() {\n\t\tconst asset = settings.get('Assets_background');\n\t\tconst prefix = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '';\n\t\tif (asset && (asset.url || asset.defaultUrl)) {\n\t\t\treturn `${prefix}/${asset.url || asset.defaultUrl}`;\n\t\t}\n\t},\n});\n\nTemplate.username.events({\n\t'focus .input-text input'(event) {\n\t\treturn $(event.currentTarget).parents('.input-text').addClass('focus');\n\t},\n\n\t'blur .input-text input'(event) {\n\t\tif (event.currentTarget.value === '') {\n\t\t\treturn $(event.currentTarget).parents('.input-text').removeClass('focus');\n\t\t}\n\t},\n\t'reset #login-card'() {\n\t\tMeteor.logout();\n\t},\n\t'submit #login-card'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tconst formData = instance.validate();\n\n\t\tconst username = instance.username.get();\n\t\tusername.empty = false;\n\t\tusername.error = false;\n\t\tusername.invalid = false;\n\t\tinstance.username.set(username);\n\n\t\tconst button = $(event.target).find('button.login');\n\t\tButton.loading(button);\n\n\t\tif (!formData) {\n\t\t\tButton.reset(button);\n\t\t\treturn;\n\t\t}\n\n\t\tconst usernameValue = $('#username').val().trim();\n\t\tif (usernameValue === '') {\n\t\t\tusername.empty = true;\n\t\t\tinstance.username.set(username);\n\t\t\tButton.reset(button);\n\t\t\treturn;\n\t\t}\n\n\t\tMeteor.call('saveCustomFields', formData, function (err) {\n\t\t\tif (err != null) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: err.error });\n\t\t\t}\n\t\t});\n\n\t\tMeteor.call('setUsername', usernameValue, function (err) {\n\t\t\tif (err != null) {\n\t\t\t\tif (err.error === 'username-invalid') {\n\t\t\t\t\tusername.invalid = true;\n\t\t\t\t} else if (err.error === 'error-blocked-username') {\n\t\t\t\t\tusername.blocked = true;\n\t\t\t\t} else {\n\t\t\t\t\tusername.unavailable = true;\n\t\t\t\t}\n\t\t\t\tusername.username = usernameValue;\n\t\t\t\tusername.escaped = _.escape(usernameValue);\n\t\t\t}\n\n\t\t\tButton.reset(button);\n\t\t\tinstance.username.set(username);\n\t\t\treturn callbacks.run('usernameSet');\n\t\t});\n\t},\n});\n"]},"sourceType":"module","hash":"8f8516d8bfe67f5b3abbc5d246cdd24875b60d6e"}
