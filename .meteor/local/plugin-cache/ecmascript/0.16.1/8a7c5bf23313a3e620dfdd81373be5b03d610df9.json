{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ModalBlock.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/blocks/ModalBlock.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ModalBlock.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ModalBlock.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/blocks/ModalBlock.js"}},"code":"var _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nmodule.export({\n  modalParser: function () {\n    return modalParser;\n  }\n});\nvar Modal, AnimatedVisibility, ButtonGroup, Button, Box;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Modal: function (v) {\n    Modal = v;\n  },\n  AnimatedVisibility: function (v) {\n    AnimatedVisibility = v;\n  },\n  ButtonGroup: function (v) {\n    ButtonGroup = v;\n  },\n  Button: function (v) {\n    Button = v;\n  },\n  Box: function (v) {\n    Box = v;\n  }\n}, 0);\nvar useUniqueId;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useUniqueId: function (v) {\n    useUniqueId = v;\n  }\n}, 1);\nvar UiKitComponent, UiKitModal, modalParser;\nmodule.link(\"@rocket.chat/fuselage-ui-kit\", {\n  UiKitComponent: function (v) {\n    UiKitComponent = v;\n  },\n  UiKitModal: function (v) {\n    UiKitModal = v;\n  },\n  modalParser: function (v) {\n    modalParser = v;\n  }\n}, 2);\nvar React, useCallback, useEffect, useMemo, useRef;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  },\n  useRef: function (v) {\n    useRef = v;\n  }\n}, 3);\nvar getURL;\nmodule.link(\"../../../app/utils/lib/getURL\", {\n  getURL: function (v) {\n    getURL = v;\n  }\n}, 4);\nmodule.link(\"./textParsers\");\nvar focusableElementsString = \"\\n\\ta[href]:not([tabindex=\\\"-1\\\"]),\\n\\tarea[href]:not([tabindex=\\\"-1\\\"]),\\n\\tinput:not([disabled]):not([tabindex=\\\"-1\\\"]),\\n\\tselect:not([disabled]):not([tabindex=\\\"-1\\\"]),\\n\\ttextarea:not([disabled]):not([tabindex=\\\"-1\\\"]),\\n\\tbutton:not([disabled]):not([tabindex=\\\"-1\\\"]),\\n\\tiframe,\\n\\tobject,\\n\\tembed,\\n\\t[tabindex]:not([tabindex=\\\"-1\\\"]),\\n\\t[contenteditable]\";\nvar focusableElementsStringInvalid = \"\\n\\ta[href]:not([tabindex=\\\"-1\\\"]):invalid,\\n\\tarea[href]:not([tabindex=\\\"-1\\\"]):invalid,\\n\\tinput:not([disabled]):not([tabindex=\\\"-1\\\"]):invalid,\\n\\tselect:not([disabled]):not([tabindex=\\\"-1\\\"]):invalid,\\n\\ttextarea:not([disabled]):not([tabindex=\\\"-1\\\"]):invalid,\\n\\tbutton:not([disabled]):not([tabindex=\\\"-1\\\"]):invalid,\\n\\tiframe:invalid,\\n\\tobject:invalid,\\n\\tembed:invalid,\\n\\t[tabindex]:not([tabindex=\\\"-1\\\"]):invalid,\\n\\t[contenteditable]:invalid\";\n\nfunction ModalBlock(_ref) {\n  var view = _ref.view,\n      errors = _ref.errors,\n      appId = _ref.appId,\n      onSubmit = _ref.onSubmit,\n      onClose = _ref.onClose,\n      onCancel = _ref.onCancel;\n  var id = \"modal_id_\" + useUniqueId();\n  var ref = useRef(); // Auto focus\n\n  useEffect(function () {\n    if (!ref.current) {\n      return;\n    }\n\n    if (errors && Object.keys(errors).length) {\n      var element = ref.current.querySelector(focusableElementsStringInvalid);\n      element && element.focus();\n    } else {\n      var _element = ref.current.querySelector(focusableElementsString);\n\n      _element && _element.focus();\n    }\n  }, [errors]); // save focus to restore after close\n\n  var previousFocus = useMemo(function () {\n    return document.activeElement;\n  }, []); // restore the focus after the component unmount\n\n  useEffect(function () {\n    return function () {\n      return previousFocus && previousFocus.focus();\n    };\n  }, [previousFocus]); // Handle Tab, Shift + Tab, Enter and Escape\n\n  var handleKeyDown = useCallback(function (event) {\n    if (event.keyCode === 13) {\n      var _event$target;\n\n      // ENTER\n      if ((event === null || event === void 0 ? void 0 : (_event$target = event.target) === null || _event$target === void 0 ? void 0 : _event$target.nodeName) !== 'TEXTAREA') {\n        return onSubmit(event);\n      }\n    }\n\n    if (event.keyCode === 27) {\n      // ESC\n      event.stopPropagation();\n      event.preventDefault();\n      onClose();\n      return false;\n    }\n\n    if (event.keyCode === 9) {\n      // TAB\n      var elements = Array.from(ref.current.querySelectorAll(focusableElementsString));\n\n      var _elements = _slicedToArray(elements, 1),\n          first = _elements[0];\n\n      var last = elements.pop();\n\n      if (!ref.current.contains(document.activeElement)) {\n        return first.focus();\n      }\n\n      if (event.shiftKey) {\n        if (!first || first === document.activeElement) {\n          last.focus();\n          event.stopPropagation();\n          event.preventDefault();\n        }\n\n        return;\n      }\n\n      if (!last || last === document.activeElement) {\n        first.focus();\n        event.stopPropagation();\n        event.preventDefault();\n      }\n    }\n  }, [onClose, onSubmit]); // Clean the events\n\n  useEffect(function () {\n    var element = document.querySelector('.rc-modal-wrapper');\n    var container = element.querySelector('.rcx-modal__content');\n\n    var close = function (e) {\n      if (e.target !== element) {\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n      onClose();\n      return false;\n    };\n\n    var ignoreIfnotContains = function (e) {\n      if (!container.contains(e.target)) {\n        return;\n      }\n\n      return handleKeyDown(e);\n    };\n\n    document.addEventListener('keydown', ignoreIfnotContains);\n    element.addEventListener('click', close);\n    return function () {\n      document.removeEventListener('keydown', ignoreIfnotContains);\n      element.removeEventListener('click', close);\n    };\n  }, [handleKeyDown, onClose]);\n  return /*#__PURE__*/React.createElement(AnimatedVisibility, {\n    visibility: AnimatedVisibility.UNHIDING\n  }, /*#__PURE__*/React.createElement(Modal, {\n    open: true,\n    id: id,\n    ref: ref\n  }, /*#__PURE__*/React.createElement(Modal.Header, null, view.showIcon ? /*#__PURE__*/React.createElement(Modal.Thumb, {\n    url: getURL(\"/api/apps/\" + appId + \"/icon\")\n  }) : null, /*#__PURE__*/React.createElement(Modal.Title, null, modalParser.text(view.title)), /*#__PURE__*/React.createElement(Modal.Close, {\n    tabIndex: -1,\n    onClick: onClose\n  })), /*#__PURE__*/React.createElement(Modal.Content, null, /*#__PURE__*/React.createElement(Box, {\n    is: \"form\",\n    method: \"post\",\n    action: \"#\",\n    onSubmit: onSubmit\n  }, /*#__PURE__*/React.createElement(UiKitComponent, {\n    render: UiKitModal,\n    blocks: view.blocks\n  }))), /*#__PURE__*/React.createElement(Modal.Footer, null, /*#__PURE__*/React.createElement(ButtonGroup, {\n    align: \"end\"\n  }, view.close && /*#__PURE__*/React.createElement(Button, {\n    onClick: onCancel\n  }, modalParser.text(view.close.text)), view.submit && /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    onClick: onSubmit\n  }, modalParser.text(view.submit.text))))));\n}\n\nmodule.exportDefault(ModalBlock);","map":{"version":3,"sources":["client/views/blocks/ModalBlock.js"],"names":["_slicedToArray","module","link","default","v","export","modalParser","Modal","AnimatedVisibility","ButtonGroup","Button","Box","useUniqueId","UiKitComponent","UiKitModal","React","useCallback","useEffect","useMemo","useRef","getURL","focusableElementsString","focusableElementsStringInvalid","ModalBlock","view","errors","appId","onSubmit","onClose","onCancel","id","ref","current","Object","keys","length","element","querySelector","focus","previousFocus","document","activeElement","handleKeyDown","event","keyCode","target","nodeName","stopPropagation","preventDefault","elements","Array","from","querySelectorAll","first","last","pop","contains","shiftKey","container","close","e","ignoreIfnotContains","addEventListener","removeEventListener","UNHIDING","showIcon","text","title","blocks","submit","exportDefault"],"mappings":"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","sourcesContent":["import { Modal, AnimatedVisibility, ButtonGroup, Button, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UiKitComponent, UiKitModal, modalParser } from '@rocket.chat/fuselage-ui-kit';\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\n\nimport { getURL } from '../../../app/utils/lib/getURL';\nimport './textParsers';\n\nconst focusableElementsString = `\n\ta[href]:not([tabindex=\"-1\"]),\n\tarea[href]:not([tabindex=\"-1\"]),\n\tinput:not([disabled]):not([tabindex=\"-1\"]),\n\tselect:not([disabled]):not([tabindex=\"-1\"]),\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]),\n\tbutton:not([disabled]):not([tabindex=\"-1\"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex=\"-1\"]),\n\t[contenteditable]`;\n\nconst focusableElementsStringInvalid = `\n\ta[href]:not([tabindex=\"-1\"]):invalid,\n\tarea[href]:not([tabindex=\"-1\"]):invalid,\n\tinput:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tselect:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tbutton:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex=\"-1\"]):invalid,\n\t[contenteditable]:invalid`;\n\nfunction ModalBlock({ view, errors, appId, onSubmit, onClose, onCancel }) {\n\tconst id = `modal_id_${useUniqueId()}`;\n\tconst ref = useRef();\n\n\t// Auto focus\n\tuseEffect(() => {\n\t\tif (!ref.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (errors && Object.keys(errors).length) {\n\t\t\tconst element = ref.current.querySelector(focusableElementsStringInvalid);\n\t\t\telement && element.focus();\n\t\t} else {\n\t\t\tconst element = ref.current.querySelector(focusableElementsString);\n\t\t\telement && element.focus();\n\t\t}\n\t}, [errors]);\n\t// save focus to restore after close\n\tconst previousFocus = useMemo(() => document.activeElement, []);\n\t// restore the focus after the component unmount\n\tuseEffect(() => () => previousFocus && previousFocus.focus(), [previousFocus]);\n\t// Handle Tab, Shift + Tab, Enter and Escape\n\tconst handleKeyDown = useCallback(\n\t\t(event) => {\n\t\t\tif (event.keyCode === 13) {\n\t\t\t\t// ENTER\n\t\t\t\tif (event?.target?.nodeName !== 'TEXTAREA') {\n\t\t\t\t\treturn onSubmit(event);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (event.keyCode === 27) {\n\t\t\t\t// ESC\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tonClose();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (event.keyCode === 9) {\n\t\t\t\t// TAB\n\t\t\t\tconst elements = Array.from(ref.current.querySelectorAll(focusableElementsString));\n\t\t\t\tconst [first] = elements;\n\t\t\t\tconst last = elements.pop();\n\n\t\t\t\tif (!ref.current.contains(document.activeElement)) {\n\t\t\t\t\treturn first.focus();\n\t\t\t\t}\n\n\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\tif (!first || first === document.activeElement) {\n\t\t\t\t\t\tlast.focus();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!last || last === document.activeElement) {\n\t\t\t\t\tfirst.focus();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[onClose, onSubmit],\n\t);\n\t// Clean the events\n\tuseEffect(() => {\n\t\tconst element = document.querySelector('.rc-modal-wrapper');\n\t\tconst container = element.querySelector('.rcx-modal__content');\n\t\tconst close = (e) => {\n\t\t\tif (e.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tonClose();\n\t\t\treturn false;\n\t\t};\n\n\t\tconst ignoreIfnotContains = (e) => {\n\t\t\tif (!container.contains(e.target)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleKeyDown(e);\n\t\t};\n\n\t\tdocument.addEventListener('keydown', ignoreIfnotContains);\n\t\telement.addEventListener('click', close);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('keydown', ignoreIfnotContains);\n\t\t\telement.removeEventListener('click', close);\n\t\t};\n\t}, [handleKeyDown, onClose]);\n\n\treturn (\n\t\t<AnimatedVisibility visibility={AnimatedVisibility.UNHIDING}>\n\t\t\t<Modal open id={id} ref={ref}>\n\t\t\t\t<Modal.Header>\n\t\t\t\t\t{view.showIcon ? <Modal.Thumb url={getURL(`/api/apps/${appId}/icon`)} /> : null}\n\t\t\t\t\t<Modal.Title>{modalParser.text(view.title)}</Modal.Title>\n\t\t\t\t\t<Modal.Close tabIndex={-1} onClick={onClose} />\n\t\t\t\t</Modal.Header>\n\t\t\t\t<Modal.Content>\n\t\t\t\t\t<Box is='form' method='post' action='#' onSubmit={onSubmit}>\n\t\t\t\t\t\t<UiKitComponent render={UiKitModal} blocks={view.blocks} />\n\t\t\t\t\t</Box>\n\t\t\t\t</Modal.Content>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t\t{view.close && <Button onClick={onCancel}>{modalParser.text(view.close.text)}</Button>}\n\t\t\t\t\t\t{view.submit && (\n\t\t\t\t\t\t\t<Button primary onClick={onSubmit}>\n\t\t\t\t\t\t\t\t{modalParser.text(view.submit.text)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t</AnimatedVisibility>\n\t);\n}\n\nexport default ModalBlock;\nexport { modalParser };\n"]},"sourceType":"module","hash":"8a7c5bf23313a3e620dfdd81373be5b03d610df9"}
