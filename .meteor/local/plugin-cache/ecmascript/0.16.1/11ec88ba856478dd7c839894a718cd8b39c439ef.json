{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/account/security/EndToEnd.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/account/security/EndToEnd.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/account/security/EndToEnd.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/account/security/EndToEnd.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/account/security/EndToEnd.js"}},"code":"var _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default: function (v) {\n    _extends = v;\n  }\n}, 0);\n\nvar _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 1);\nvar Box, Margins, PasswordInput, Field, FieldGroup, Button;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box: function (v) {\n    Box = v;\n  },\n  Margins: function (v) {\n    Margins = v;\n  },\n  PasswordInput: function (v) {\n    PasswordInput = v;\n  },\n  Field: function (v) {\n    Field = v;\n  },\n  FieldGroup: function (v) {\n    FieldGroup = v;\n  },\n  Button: function (v) {\n    Button = v;\n  }\n}, 0);\nvar useLocalStorage, useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useLocalStorage: function (v) {\n    useLocalStorage = v;\n  },\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 1);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar React, useCallback, useEffect;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  }\n}, 3);\nvar e2e;\nmodule.link(\"../../../../app/e2e/client/rocketchat.e2e\", {\n  e2e: function (v) {\n    e2e = v;\n  }\n}, 4);\nvar callbacks;\nmodule.link(\"../../../../lib/callbacks\", {\n  callbacks: function (v) {\n    callbacks = v;\n  }\n}, 5);\nvar useRoute;\nmodule.link(\"../../../contexts/RouterContext\", {\n  useRoute: function (v) {\n    useRoute = v;\n  }\n}, 6);\nvar useMethod;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useMethod: function (v) {\n    useMethod = v;\n  }\n}, 7);\nvar useToastMessageDispatch;\nmodule.link(\"../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch: function (v) {\n    useToastMessageDispatch = v;\n  }\n}, 8);\nvar useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 9);\nvar useUser;\nmodule.link(\"../../../contexts/UserContext\", {\n  useUser: function (v) {\n    useUser = v;\n  }\n}, 10);\nvar useForm;\nmodule.link(\"../../../hooks/useForm\", {\n  useForm: function (v) {\n    useForm = v;\n  }\n}, 11);\n\nvar EndToEnd = function (props) {\n  var t = useTranslation();\n  var dispatchToastMessage = useToastMessageDispatch();\n  var homeRoute = useRoute('home');\n  var user = useUser();\n  var publicKey = useLocalStorage('public_key');\n  var privateKey = useLocalStorage('private_key');\n  var resetE2eKey = useMethod('e2e.resetOwnE2EKey');\n\n  var _useForm = useForm({\n    password: '',\n    passwordConfirm: ''\n  }),\n      values = _useForm.values,\n      handlers = _useForm.handlers,\n      reset = _useForm.reset;\n\n  var password = values.password,\n      passwordConfirm = values.passwordConfirm;\n  var handlePassword = handlers.handlePassword,\n      handlePasswordConfirm = handlers.handlePasswordConfirm;\n  var keysExist = publicKey && privateKey;\n  var hasTypedPassword = password.trim().length > 0;\n  var passwordError = password !== passwordConfirm && passwordConfirm.length > 0 ? t('Passwords_do_not_match') : undefined;\n  var canSave = keysExist && !passwordError && passwordConfirm.length > 0;\n  var handleLogout = useMutableCallback(function () {\n    Meteor.logout(function () {\n      callbacks.run('afterLogoutCleanUp', user);\n      Meteor.call('logoutCleanUp', user);\n      homeRoute.push({});\n    });\n  });\n  var saveNewPassword = useCallback(function () {\n    function _callee() {\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return _regeneratorRuntime.awrap(e2e.changePassword(password));\n\n              case 3:\n                reset();\n                dispatchToastMessage({\n                  type: 'success',\n                  message: t('Encryption_key_saved_successfully')\n                });\n                _context.next = 10;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                dispatchToastMessage({\n                  type: 'error',\n                  message: _context.t0\n                });\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return _callee$;\n      }(), null, null, [[0, 7]], Promise);\n    }\n\n    return _callee;\n  }(), [dispatchToastMessage, password, reset, t]);\n  var handleResetE2eKey = useCallback(function () {\n    function _callee2() {\n      var result;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(resetE2eKey());\n\n              case 3:\n                result = _context2.sent;\n\n                if (result) {\n                  dispatchToastMessage({\n                    type: 'success',\n                    message: t('User_e2e_key_was_reset')\n                  });\n                  handleLogout();\n                }\n\n                _context2.next = 10;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2[\"catch\"](0);\n                dispatchToastMessage({\n                  type: 'error',\n                  message: _context2.t0\n                });\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }\n\n        return _callee2$;\n      }(), null, null, [[0, 7]], Promise);\n    }\n\n    return _callee2;\n  }(), [dispatchToastMessage, resetE2eKey, handleLogout, t]);\n  useEffect(function () {\n    if (password.trim() === '') {\n      handlePasswordConfirm('');\n    }\n  }, [handlePasswordConfirm, password]);\n  return /*#__PURE__*/React.createElement(Box, _extends({\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"flex-start\",\n    mbs: \"x16\"\n  }, props), /*#__PURE__*/React.createElement(Margins, {\n    blockEnd: \"x8\"\n  }, /*#__PURE__*/React.createElement(Box, {\n    fontScale: \"h4\"\n  }, t('E2E_Encryption_Password_Change')), /*#__PURE__*/React.createElement(Box, {\n    dangerouslySetInnerHTML: {\n      __html: t('E2E_Encryption_Password_Explanation')\n    }\n  }), /*#__PURE__*/React.createElement(FieldGroup, {\n    w: \"full\"\n  }, /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Label, null, t('New_encryption_password')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(PasswordInput, {\n    value: password,\n    onChange: handlePassword,\n    placeholder: t('New_Password_Placeholder'),\n    disabled: !keysExist\n  })), !keysExist && /*#__PURE__*/React.createElement(Field.Hint, null, t('EncryptionKey_Change_Disabled'))), hasTypedPassword && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Label, null, t('Confirm_new_encryption_password')), /*#__PURE__*/React.createElement(PasswordInput, {\n    error: passwordError,\n    value: passwordConfirm,\n    onChange: handlePasswordConfirm,\n    placeholder: t('Confirm_New_Password_Placeholder')\n  }), /*#__PURE__*/React.createElement(Field.Error, null, passwordError))), /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    disabled: !canSave,\n    onClick: saveNewPassword\n  }, t('Save_changes')), /*#__PURE__*/React.createElement(Box, {\n    fontScale: \"h4\",\n    mbs: \"x16\"\n  }, t('Reset_E2E_Key')), /*#__PURE__*/React.createElement(Box, {\n    dangerouslySetInnerHTML: {\n      __html: t('E2E_Reset_Key_Explanation')\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    onClick: handleResetE2eKey\n  }, t('Reset_E2E_Key'))));\n};\n\nmodule.exportDefault(EndToEnd);","map":{"version":3,"sources":["client/views/account/security/EndToEnd.js"],"names":["_extends","module","link","default","v","_regeneratorRuntime","Box","Margins","PasswordInput","Field","FieldGroup","Button","useLocalStorage","useMutableCallback","Meteor","React","useCallback","useEffect","e2e","callbacks","useRoute","useMethod","useToastMessageDispatch","useTranslation","useUser","useForm","EndToEnd","props","t","dispatchToastMessage","homeRoute","user","publicKey","privateKey","resetE2eKey","password","passwordConfirm","values","handlers","reset","handlePassword","handlePasswordConfirm","keysExist","hasTypedPassword","trim","length","passwordError","undefined","canSave","handleLogout","logout","run","call","push","saveNewPassword","changePassword","type","message","handleResetE2eKey","result","__html","exportDefault"],"mappings":"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","sourcesContent":["import { Box, Margins, PasswordInput, Field, FieldGroup, Button } from '@rocket.chat/fuselage';\nimport { useLocalStorage, useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { Meteor } from 'meteor/meteor';\nimport React, { useCallback, useEffect } from 'react';\n\nimport { e2e } from '../../../../app/e2e/client/rocketchat.e2e';\nimport { callbacks } from '../../../../lib/callbacks';\nimport { useRoute } from '../../../contexts/RouterContext';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useUser } from '../../../contexts/UserContext';\nimport { useForm } from '../../../hooks/useForm';\n\nconst EndToEnd = (props) => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst homeRoute = useRoute('home');\n\tconst user = useUser();\n\n\tconst publicKey = useLocalStorage('public_key');\n\tconst privateKey = useLocalStorage('private_key');\n\n\tconst resetE2eKey = useMethod('e2e.resetOwnE2EKey');\n\n\tconst { values, handlers, reset } = useForm({ password: '', passwordConfirm: '' });\n\tconst { password, passwordConfirm } = values;\n\tconst { handlePassword, handlePasswordConfirm } = handlers;\n\n\tconst keysExist = publicKey && privateKey;\n\n\tconst hasTypedPassword = password.trim().length > 0;\n\tconst passwordError = password !== passwordConfirm && passwordConfirm.length > 0 ? t('Passwords_do_not_match') : undefined;\n\tconst canSave = keysExist && !passwordError && passwordConfirm.length > 0;\n\n\tconst handleLogout = useMutableCallback(() => {\n\t\tMeteor.logout(() => {\n\t\t\tcallbacks.run('afterLogoutCleanUp', user);\n\t\t\tMeteor.call('logoutCleanUp', user);\n\t\t\thomeRoute.push({});\n\t\t});\n\t});\n\n\tconst saveNewPassword = useCallback(async () => {\n\t\ttry {\n\t\t\tawait e2e.changePassword(password);\n\t\t\treset();\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Encryption_key_saved_successfully') });\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, password, reset, t]);\n\n\tconst handleResetE2eKey = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await resetE2eKey();\n\t\t\tif (result) {\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('User_e2e_key_was_reset') });\n\t\t\t\thandleLogout();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, resetE2eKey, handleLogout, t]);\n\n\tuseEffect(() => {\n\t\tif (password.trim() === '') {\n\t\t\thandlePasswordConfirm('');\n\t\t}\n\t}, [handlePasswordConfirm, password]);\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' alignItems='flex-start' mbs='x16' {...props}>\n\t\t\t<Margins blockEnd='x8'>\n\t\t\t\t<Box fontScale='h4'>{t('E2E_Encryption_Password_Change')}</Box>\n\t\t\t\t<Box dangerouslySetInnerHTML={{ __html: t('E2E_Encryption_Password_Explanation') }} />\n\t\t\t\t<FieldGroup w='full'>\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<Field.Label>{t('New_encryption_password')}</Field.Label>\n\t\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t\t<PasswordInput value={password} onChange={handlePassword} placeholder={t('New_Password_Placeholder')} disabled={!keysExist} />\n\t\t\t\t\t\t</Field.Row>\n\t\t\t\t\t\t{!keysExist && <Field.Hint>{t('EncryptionKey_Change_Disabled')}</Field.Hint>}\n\t\t\t\t\t</Field>\n\t\t\t\t\t{hasTypedPassword && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Field.Label>{t('Confirm_new_encryption_password')}</Field.Label>\n\t\t\t\t\t\t\t<PasswordInput\n\t\t\t\t\t\t\t\terror={passwordError}\n\t\t\t\t\t\t\t\tvalue={passwordConfirm}\n\t\t\t\t\t\t\t\tonChange={handlePasswordConfirm}\n\t\t\t\t\t\t\t\tplaceholder={t('Confirm_New_Password_Placeholder')}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Field.Error>{passwordError}</Field.Error>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t</FieldGroup>\n\t\t\t\t<Button primary disabled={!canSave} onClick={saveNewPassword}>\n\t\t\t\t\t{t('Save_changes')}\n\t\t\t\t</Button>\n\t\t\t\t<Box fontScale='h4' mbs='x16'>\n\t\t\t\t\t{t('Reset_E2E_Key')}\n\t\t\t\t</Box>\n\t\t\t\t<Box dangerouslySetInnerHTML={{ __html: t('E2E_Reset_Key_Explanation') }} />\n\t\t\t\t<Button onClick={handleResetE2eKey}>{t('Reset_E2E_Key')}</Button>\n\t\t\t</Margins>\n\t\t</Box>\n\t);\n};\n\nexport default EndToEnd;\n"]},"sourceType":"module","hash":"11ec88ba856478dd7c839894a718cd8b39c439ef"}
