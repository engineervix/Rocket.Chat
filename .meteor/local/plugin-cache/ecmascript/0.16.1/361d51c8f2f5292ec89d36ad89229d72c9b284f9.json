{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/popover.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-utils/client/lib/popover.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/popover.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/popover.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-utils/client/lib/popover.js"}},"code":"var _excluded = [\"currentTarget\"];\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\n\nvar _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default: function (v) {\n    _objectWithoutProperties = v;\n  }\n}, 1);\nmodule.export({\n  popover: function () {\n    return popover;\n  }\n});\nmodule.link(\"./popover.html\");\nvar Blaze;\nmodule.link(\"meteor/blaze\", {\n  Blaze: function (v) {\n    Blaze = v;\n  }\n}, 0);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 1);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 2);\nvar messageBox;\nmodule.link(\"./messageBox\", {\n  messageBox: function (v) {\n    messageBox = v;\n  }\n}, 3);\nvar MessageAction;\nmodule.link(\"./MessageAction\", {\n  MessageAction: function (v) {\n    MessageAction = v;\n  }\n}, 4);\nvar isRtl;\nmodule.link(\"../../../utils/client\", {\n  isRtl: function (v) {\n    isRtl = v;\n  }\n}, 5);\nvar popover = {\n  renderedPopover: null,\n  open: function (_ref) {\n    var currentTarget = _ref.currentTarget,\n        config = _objectWithoutProperties(_ref, _excluded);\n\n    // Popover position must be computed as soon as possible, avoiding DOM changes over currentTarget\n    var data = _objectSpread({\n      targetRect: currentTarget === null || currentTarget === void 0 ? void 0 : currentTarget.getBoundingClientRect()\n    }, config);\n\n    this.renderedPopover = Blaze.renderWithData(Template.popover, data, document.body);\n  },\n  close: function () {\n    if (!this.renderedPopover) {\n      return false;\n    }\n\n    Blaze.remove(this.renderedPopover);\n    var activeElement = this.renderedPopover.dataVar.curValue.activeElement;\n\n    if (activeElement) {\n      $(activeElement).removeClass('active');\n    }\n  }\n};\nTemplate.popover.helpers({\n  hasAction: function () {\n    return !!this.action;\n  }\n});\nTemplate.popover.onRendered(function () {\n  var _this = this;\n\n  if (this.data.onRendered) {\n    this.data.onRendered();\n  }\n\n  $('.rc-popover').click(function (e) {\n    if (e.currentTarget === e.target) {\n      popover.close();\n    }\n  });\n  var _this$data = this.data,\n      _this$data$offsetVert = _this$data.offsetVertical,\n      offsetVertical = _this$data$offsetVert === void 0 ? 0 : _this$data$offsetVert,\n      _this$data$offsetHori = _this$data.offsetHorizontal,\n      offsetHorizontal = _this$data$offsetHori === void 0 ? 0 : _this$data$offsetHori;\n  var activeElement = this.data.activeElement;\n  var originalWidth = window.innerWidth;\n  var popoverContent = this.firstNode.children[0];\n\n  var position = _.throttle(function () {\n    var direction = typeof _this.data.direction === 'function' ? _this.data.direction() : _this.data.direction;\n    var verticalDirection = /top/.test(direction) ? 'top' : 'bottom';\n    var rtlDirection = isRtl() ^ /inverted/.test(direction) ? 'left' : 'right';\n    var rightDirection = /right/.test(direction) ? 'right' : rtlDirection;\n    var horizontalDirection = /left/.test(direction) ? 'left' : rightDirection;\n    var position = typeof _this.data.position === 'function' ? _this.data.position() : _this.data.position;\n    var customCSSProperties = typeof _this.data.customCSSProperties === 'function' ? _this.data.customCSSProperties() : _this.data.customCSSProperties;\n    var mousePosition = typeof _this.data.mousePosition === 'function' ? _this.data.mousePosition() : _this.data.mousePosition || {\n      x: _this.data.targetRect[horizontalDirection === 'left' ? 'right' : 'left'],\n      y: _this.data.targetRect[verticalDirection]\n    };\n    var offsetWidth = offsetHorizontal * (horizontalDirection === 'left' ? 1 : -1);\n    var offsetHeight = offsetVertical * (verticalDirection === 'bottom' ? 1 : -1);\n    var leftDiff = window.innerWidth - originalWidth;\n\n    if (position) {\n      popoverContent.style.top = position.top + \"px\";\n      popoverContent.style.left = position.left + leftDiff + \"px\";\n    } else {\n      var clientHeight = _this.data.targetRect.height;\n      var popoverWidth = popoverContent.offsetWidth;\n      var popoverHeight = popoverContent.offsetHeight;\n      var windowWidth = window.innerWidth;\n      var windowHeight = window.innerHeight;\n      var top = mousePosition.y - clientHeight + offsetHeight;\n\n      if (verticalDirection === 'top') {\n        top = mousePosition.y - popoverHeight + offsetHeight;\n\n        if (top < 0) {\n          top = 10 + offsetHeight;\n        }\n      }\n\n      if (top + popoverHeight > windowHeight) {\n        top = windowHeight - 10 - popoverHeight - offsetHeight;\n      }\n\n      var left = mousePosition.x - popoverWidth + offsetWidth;\n\n      if (horizontalDirection === 'right') {\n        left = mousePosition.x + offsetWidth;\n      }\n\n      if (left + popoverWidth >= windowWidth) {\n        left = mousePosition.x - popoverWidth + offsetWidth;\n      }\n\n      if (left <= 0) {\n        left = mousePosition.x + offsetWidth;\n      }\n\n      popoverContent.style.top = top + \"px\";\n      popoverContent.style.left = left + leftDiff + \"px\";\n    }\n\n    if (customCSSProperties) {\n      Object.keys(customCSSProperties).forEach(function (property) {\n        popoverContent.style[property] = customCSSProperties[property];\n      });\n    }\n\n    var realTop = Number(popoverContent.style.top.replace('px', ''));\n\n    if (realTop + popoverContent.offsetHeight > window.innerHeight) {\n      popoverContent.style.overflow = 'scroll';\n      popoverContent.style.bottom = 0;\n      popoverContent.className = 'rc-popover__content rc-popover__content-scroll';\n    }\n\n    if (activeElement) {\n      $(activeElement).addClass('active');\n    }\n\n    popoverContent.style.opacity = 1;\n  }, 50);\n\n  var observer = new MutationObserver(position);\n  observer.observe(popoverContent, {\n    childList: true,\n    subtree: true\n  });\n  $(window).on('resize', position);\n  position();\n  this.position = position;\n  this.observer = observer;\n  this.firstNode.style.visibility = 'visible';\n});\nTemplate.popover.onDestroyed(function () {\n  var _this$observer;\n\n  if (this.data.onDestroyed) {\n    this.data.onDestroyed();\n  }\n\n  $(window).off('resize', this.position);\n  (_this$observer = this.observer) === null || _this$observer === void 0 ? void 0 : _this$observer.disconnect();\n});\nTemplate.popover.events({\n  'click .js-action': function (e, instance) {\n    !this.action || this.action.call(this, e, instance.data.data);\n    popover.close();\n  },\n  'click .js-close': function () {\n    popover.close();\n  },\n  'click [data-type=\"messagebox-action\"]': function (event, t) {\n    var id = event.currentTarget.dataset.id;\n    var actions = messageBox.actions.getById(id);\n    actions.filter(function (_ref2) {\n      var action = _ref2.action;\n      return !!action;\n    }).forEach(function (_ref3) {\n      var action = _ref3.action;\n      action.call(null, _objectSpread(_objectSpread({}, t.data.data), {}, {\n        event: event\n      }));\n    });\n    popover.close();\n  },\n  'click [data-type=\"message-action\"]': function (e, t) {\n    var button = MessageAction.getButtonById(e.currentTarget.dataset.id);\n\n    if ((button != null ? button.action : undefined) != null) {\n      e.stopPropagation();\n      e.preventDefault();\n      var _t$data$instance = t.data.instance,\n          tabBar = _t$data$instance.tabBar,\n          rid = _t$data$instance.rid;\n      button.action.call(t.data.data, e, {\n        tabBar: tabBar,\n        rid: rid\n      });\n      popover.close();\n      return false;\n    }\n  }\n});\nTemplate.popover.helpers({\n  isSafariIos: /iP(ad|hone|od).+Version\\/[\\d\\.]+.*Safari/i.test(navigator.userAgent)\n});","map":{"version":3,"sources":["app/ui-utils/client/lib/popover.js"],"names":["_objectSpread","module","link","default","v","_objectWithoutProperties","export","popover","Blaze","Template","_","messageBox","MessageAction","isRtl","renderedPopover","open","currentTarget","config","data","targetRect","getBoundingClientRect","renderWithData","document","body","close","remove","activeElement","dataVar","curValue","$","removeClass","helpers","hasAction","action","onRendered","click","e","target","offsetVertical","offsetHorizontal","originalWidth","window","innerWidth","popoverContent","firstNode","children","position","throttle","direction","verticalDirection","test","rtlDirection","rightDirection","horizontalDirection","customCSSProperties","mousePosition","x","y","offsetWidth","offsetHeight","leftDiff","style","top","left","clientHeight","height","popoverWidth","popoverHeight","windowWidth","windowHeight","innerHeight","Object","keys","forEach","property","realTop","Number","replace","overflow","bottom","className","addClass","opacity","observer","MutationObserver","observe","childList","subtree","on","visibility","onDestroyed","off","disconnect","events","instance","call","event","t","id","dataset","actions","getById","filter","button","getButtonById","undefined","stopPropagation","preventDefault","tabBar","rid","isSafariIos","navigator","userAgent"],"mappings":"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","sourcesContent":["import './popover.html';\nimport { Blaze } from 'meteor/blaze';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\n\nimport { messageBox } from './messageBox';\nimport { MessageAction } from './MessageAction';\nimport { isRtl } from '../../../utils/client';\n\nexport const popover = {\n\trenderedPopover: null,\n\topen({ currentTarget, ...config }) {\n\t\t// Popover position must be computed as soon as possible, avoiding DOM changes over currentTarget\n\t\tconst data = {\n\t\t\ttargetRect: currentTarget?.getBoundingClientRect(),\n\t\t\t...config,\n\t\t};\n\t\tthis.renderedPopover = Blaze.renderWithData(Template.popover, data, document.body);\n\t},\n\tclose() {\n\t\tif (!this.renderedPopover) {\n\t\t\treturn false;\n\t\t}\n\n\t\tBlaze.remove(this.renderedPopover);\n\n\t\tconst { activeElement } = this.renderedPopover.dataVar.curValue;\n\t\tif (activeElement) {\n\t\t\t$(activeElement).removeClass('active');\n\t\t}\n\t},\n};\n\nTemplate.popover.helpers({\n\thasAction() {\n\t\treturn !!this.action;\n\t},\n});\n\nTemplate.popover.onRendered(function () {\n\tif (this.data.onRendered) {\n\t\tthis.data.onRendered();\n\t}\n\n\t$('.rc-popover').click(function (e) {\n\t\tif (e.currentTarget === e.target) {\n\t\t\tpopover.close();\n\t\t}\n\t});\n\tconst { offsetVertical = 0, offsetHorizontal = 0 } = this.data;\n\tconst { activeElement } = this.data;\n\tconst originalWidth = window.innerWidth;\n\tconst popoverContent = this.firstNode.children[0];\n\tconst position = _.throttle(() => {\n\t\tconst direction = typeof this.data.direction === 'function' ? this.data.direction() : this.data.direction;\n\n\t\tconst verticalDirection = /top/.test(direction) ? 'top' : 'bottom';\n\t\tconst rtlDirection = isRtl() ^ /inverted/.test(direction) ? 'left' : 'right';\n\t\tconst rightDirection = /right/.test(direction) ? 'right' : rtlDirection;\n\t\tconst horizontalDirection = /left/.test(direction) ? 'left' : rightDirection;\n\n\t\tconst position = typeof this.data.position === 'function' ? this.data.position() : this.data.position;\n\t\tconst customCSSProperties =\n\t\t\ttypeof this.data.customCSSProperties === 'function' ? this.data.customCSSProperties() : this.data.customCSSProperties;\n\n\t\tconst mousePosition =\n\t\t\ttypeof this.data.mousePosition === 'function'\n\t\t\t\t? this.data.mousePosition()\n\t\t\t\t: this.data.mousePosition || {\n\t\t\t\t\t\tx: this.data.targetRect[horizontalDirection === 'left' ? 'right' : 'left'],\n\t\t\t\t\t\ty: this.data.targetRect[verticalDirection],\n\t\t\t\t  };\n\t\tconst offsetWidth = offsetHorizontal * (horizontalDirection === 'left' ? 1 : -1);\n\t\tconst offsetHeight = offsetVertical * (verticalDirection === 'bottom' ? 1 : -1);\n\n\t\tconst leftDiff = window.innerWidth - originalWidth;\n\n\t\tif (position) {\n\t\t\tpopoverContent.style.top = `${position.top}px`;\n\t\t\tpopoverContent.style.left = `${position.left + leftDiff}px`;\n\t\t} else {\n\t\t\tconst clientHeight = this.data.targetRect.height;\n\t\t\tconst popoverWidth = popoverContent.offsetWidth;\n\t\t\tconst popoverHeight = popoverContent.offsetHeight;\n\t\t\tconst windowWidth = window.innerWidth;\n\t\t\tconst windowHeight = window.innerHeight;\n\n\t\t\tlet top = mousePosition.y - clientHeight + offsetHeight;\n\n\t\t\tif (verticalDirection === 'top') {\n\t\t\t\ttop = mousePosition.y - popoverHeight + offsetHeight;\n\n\t\t\t\tif (top < 0) {\n\t\t\t\t\ttop = 10 + offsetHeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (top + popoverHeight > windowHeight) {\n\t\t\t\ttop = windowHeight - 10 - popoverHeight - offsetHeight;\n\t\t\t}\n\n\t\t\tlet left = mousePosition.x - popoverWidth + offsetWidth;\n\n\t\t\tif (horizontalDirection === 'right') {\n\t\t\t\tleft = mousePosition.x + offsetWidth;\n\t\t\t}\n\n\t\t\tif (left + popoverWidth >= windowWidth) {\n\t\t\t\tleft = mousePosition.x - popoverWidth + offsetWidth;\n\t\t\t}\n\n\t\t\tif (left <= 0) {\n\t\t\t\tleft = mousePosition.x + offsetWidth;\n\t\t\t}\n\n\t\t\tpopoverContent.style.top = `${top}px`;\n\t\t\tpopoverContent.style.left = `${left + leftDiff}px`;\n\t\t}\n\n\t\tif (customCSSProperties) {\n\t\t\tObject.keys(customCSSProperties).forEach(function (property) {\n\t\t\t\tpopoverContent.style[property] = customCSSProperties[property];\n\t\t\t});\n\t\t}\n\n\t\tconst realTop = Number(popoverContent.style.top.replace('px', ''));\n\t\tif (realTop + popoverContent.offsetHeight > window.innerHeight) {\n\t\t\tpopoverContent.style.overflow = 'scroll';\n\t\t\tpopoverContent.style.bottom = 0;\n\t\t\tpopoverContent.className = 'rc-popover__content rc-popover__content-scroll';\n\t\t}\n\n\t\tif (activeElement) {\n\t\t\t$(activeElement).addClass('active');\n\t\t}\n\t\tpopoverContent.style.opacity = 1;\n\t}, 50);\n\n\tconst observer = new MutationObserver(position);\n\tobserver.observe(popoverContent, { childList: true, subtree: true });\n\n\t$(window).on('resize', position);\n\tposition();\n\tthis.position = position;\n\tthis.observer = observer;\n\n\tthis.firstNode.style.visibility = 'visible';\n});\n\nTemplate.popover.onDestroyed(function () {\n\tif (this.data.onDestroyed) {\n\t\tthis.data.onDestroyed();\n\t}\n\t$(window).off('resize', this.position);\n\tthis.observer?.disconnect();\n});\n\nTemplate.popover.events({\n\t'click .js-action'(e, instance) {\n\t\t!this.action || this.action.call(this, e, instance.data.data);\n\t\tpopover.close();\n\t},\n\t'click .js-close'() {\n\t\tpopover.close();\n\t},\n\t'click [data-type=\"messagebox-action\"]'(event, t) {\n\t\tconst { id } = event.currentTarget.dataset;\n\t\tconst actions = messageBox.actions.getById(id);\n\t\tactions\n\t\t\t.filter(({ action }) => !!action)\n\t\t\t.forEach(({ action }) => {\n\t\t\t\taction.call(null, {\n\t\t\t\t\t...t.data.data,\n\t\t\t\t\tevent,\n\t\t\t\t});\n\t\t\t});\n\t\tpopover.close();\n\t},\n\t'click [data-type=\"message-action\"]'(e, t) {\n\t\tconst button = MessageAction.getButtonById(e.currentTarget.dataset.id);\n\t\tif ((button != null ? button.action : undefined) != null) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconst { tabBar, rid } = t.data.instance;\n\t\t\tbutton.action.call(t.data.data, e, { tabBar, rid });\n\t\t\tpopover.close();\n\t\t\treturn false;\n\t\t}\n\t},\n});\n\nTemplate.popover.helpers({\n\tisSafariIos: /iP(ad|hone|od).+Version\\/[\\d\\.]+.*Safari/i.test(navigator.userAgent),\n});\n"]},"sourceType":"module","hash":"361d51c8f2f5292ec89d36ad89229d72c9b284f9"}
