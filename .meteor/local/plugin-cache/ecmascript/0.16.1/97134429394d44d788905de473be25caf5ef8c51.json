{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/account/security/TwoFactorTOTP.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/account/security/TwoFactorTOTP.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/account/security/TwoFactorTOTP.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/account/security/TwoFactorTOTP.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/account/security/TwoFactorTOTP.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default: function (v) {\n    _extends = v;\n  }\n}, 1);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 2);\nvar Box, Button, TextInput, Margins;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box: function (v) {\n    Box = v;\n  },\n  Button: function (v) {\n    Button = v;\n  },\n  TextInput: function (v) {\n    TextInput = v;\n  },\n  Margins: function (v) {\n    Margins = v;\n  }\n}, 0);\nvar useSafely;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useSafely: function (v) {\n    useSafely = v;\n  }\n}, 1);\nvar React, useState, useCallback, useEffect;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useState: function (v) {\n    useState = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  }\n}, 2);\nvar qrcode;\nmodule.link(\"yaqrcode\", {\n  \"default\": function (v) {\n    qrcode = v;\n  }\n}, 3);\nvar TextCopy;\nmodule.link(\"../../../components/TextCopy\", {\n  \"default\": function (v) {\n    TextCopy = v;\n  }\n}, 4);\nvar TwoFactorTotpModal;\nmodule.link(\"../../../components/TwoFactorModal/TwoFactorTotpModal\", {\n  \"default\": function (v) {\n    TwoFactorTotpModal = v;\n  }\n}, 5);\nvar useSetModal;\nmodule.link(\"../../../contexts/ModalContext\", {\n  useSetModal: function (v) {\n    useSetModal = v;\n  }\n}, 6);\nvar useMethod;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useMethod: function (v) {\n    useMethod = v;\n  }\n}, 7);\nvar useToastMessageDispatch;\nmodule.link(\"../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch: function (v) {\n    useToastMessageDispatch = v;\n  }\n}, 8);\nvar useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 9);\nvar useUser;\nmodule.link(\"../../../contexts/UserContext\", {\n  useUser: function (v) {\n    useUser = v;\n  }\n}, 10);\nvar useForm;\nmodule.link(\"../../../hooks/useForm\", {\n  useForm: function (v) {\n    useForm = v;\n  }\n}, 11);\nvar BackupCodesModal;\nmodule.link(\"./BackupCodesModal\", {\n  \"default\": function (v) {\n    BackupCodesModal = v;\n  }\n}, 12);\n\nvar TwoFactorTOTP = function (props) {\n  var t = useTranslation();\n  var dispatchToastMessage = useToastMessageDispatch();\n  var user = useUser();\n  var setModal = useSetModal();\n  var enableTotpFn = useMethod('2fa:enable');\n  var disableTotpFn = useMethod('2fa:disable');\n  var verifyCodeFn = useMethod('2fa:validateTempToken');\n  var checkCodesRemainingFn = useMethod('2fa:checkCodesRemaining');\n  var regenerateCodesFn = useMethod('2fa:regenerateCodes');\n\n  var _useSafely = useSafely(useState(false)),\n      _useSafely2 = _slicedToArray(_useSafely, 2),\n      registeringTotp = _useSafely2[0],\n      setRegisteringTotp = _useSafely2[1];\n\n  var _useSafely3 = useSafely(useState()),\n      _useSafely4 = _slicedToArray(_useSafely3, 2),\n      qrCode = _useSafely4[0],\n      setQrCode = _useSafely4[1];\n\n  var _useSafely5 = useSafely(useState()),\n      _useSafely6 = _slicedToArray(_useSafely5, 2),\n      totpSecret = _useSafely6[0],\n      setTotpSecret = _useSafely6[1];\n\n  var _useSafely7 = useSafely(useState()),\n      _useSafely8 = _slicedToArray(_useSafely7, 2),\n      codesRemaining = _useSafely8[0],\n      setCodesRemaining = _useSafely8[1];\n\n  var _useForm = useForm({\n    authCode: ''\n  }),\n      values = _useForm.values,\n      handlers = _useForm.handlers;\n\n  var authCode = values.authCode;\n  var handleAuthCode = handlers.handleAuthCode;\n  var totpEnabled = user && user.services && user.services.totp && user.services.totp.enabled;\n  var closeModal = useCallback(function () {\n    return setModal(null);\n  }, [setModal]);\n  useEffect(function () {\n    var updateCodesRemaining = function () {\n      function _callee() {\n        var result;\n        return _regeneratorRuntime.async(function () {\n          function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (totpEnabled) {\n                    _context.next = 2;\n                    break;\n                  }\n\n                  return _context.abrupt(\"return\", false);\n\n                case 2:\n                  _context.next = 4;\n                  return _regeneratorRuntime.awrap(checkCodesRemainingFn());\n\n                case 4:\n                  result = _context.sent;\n                  setCodesRemaining(result.remaining);\n\n                case 6:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }\n\n          return _callee$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee;\n    }();\n\n    updateCodesRemaining();\n  }, [checkCodesRemainingFn, setCodesRemaining, totpEnabled]);\n  var handleEnableTotp = useCallback(function () {\n    function _callee2() {\n      var result;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(enableTotpFn());\n\n              case 3:\n                result = _context2.sent;\n                setTotpSecret(result.secret);\n                setQrCode(qrcode(result.url, {\n                  size: 200\n                }));\n                setRegisteringTotp(true);\n                _context2.next = 12;\n                break;\n\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](0);\n                dispatchToastMessage({\n                  type: 'error',\n                  message: _context2.t0\n                });\n\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }\n\n        return _callee2$;\n      }(), null, null, [[0, 9]], Promise);\n    }\n\n    return _callee2;\n  }(), [dispatchToastMessage, enableTotpFn, setQrCode, setRegisteringTotp, setTotpSecret]);\n  var handleDisableTotp = useCallback(function () {\n    function _callee4() {\n      var onDisable;\n      return _regeneratorRuntime.async(function () {\n        function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                onDisable = function () {\n                  function _callee3(authCode) {\n                    var result;\n                    return _regeneratorRuntime.async(function () {\n                      function _callee3$(_context3) {\n                        while (1) {\n                          switch (_context3.prev = _context3.next) {\n                            case 0:\n                              _context3.prev = 0;\n                              _context3.next = 3;\n                              return _regeneratorRuntime.awrap(disableTotpFn(authCode));\n\n                            case 3:\n                              result = _context3.sent;\n\n                              if (result) {\n                                _context3.next = 6;\n                                break;\n                              }\n\n                              return _context3.abrupt(\"return\", dispatchToastMessage({\n                                type: 'error',\n                                message: t('Invalid_two_factor_code')\n                              }));\n\n                            case 6:\n                              dispatchToastMessage({\n                                type: 'success',\n                                message: t('Two-factor_authentication_disabled')\n                              });\n                              _context3.next = 12;\n                              break;\n\n                            case 9:\n                              _context3.prev = 9;\n                              _context3.t0 = _context3[\"catch\"](0);\n                              dispatchToastMessage({\n                                type: 'error',\n                                message: _context3.t0\n                              });\n\n                            case 12:\n                              closeModal();\n\n                            case 13:\n                            case \"end\":\n                              return _context3.stop();\n                          }\n                        }\n                      }\n\n                      return _callee3$;\n                    }(), null, null, [[0, 9]], Promise);\n                  }\n\n                  return _callee3;\n                }();\n\n                setModal( /*#__PURE__*/React.createElement(TwoFactorTotpModal, {\n                  onConfirm: onDisable,\n                  onClose: closeModal\n                }));\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }\n\n        return _callee4$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee4;\n  }(), [closeModal, disableTotpFn, dispatchToastMessage, setModal, t]);\n  var handleVerifyCode = useCallback(function () {\n    function _callee5() {\n      var result;\n      return _regeneratorRuntime.async(function () {\n        function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.prev = 0;\n                _context5.next = 3;\n                return _regeneratorRuntime.awrap(verifyCodeFn(authCode));\n\n              case 3:\n                result = _context5.sent;\n\n                if (result) {\n                  _context5.next = 6;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", dispatchToastMessage({\n                  type: 'error',\n                  message: t('Invalid_two_factor_code')\n                }));\n\n              case 6:\n                setModal( /*#__PURE__*/React.createElement(BackupCodesModal, {\n                  codes: result.codes,\n                  onClose: closeModal\n                }));\n                _context5.next = 12;\n                break;\n\n              case 9:\n                _context5.prev = 9;\n                _context5.t0 = _context5[\"catch\"](0);\n                dispatchToastMessage({\n                  type: 'error',\n                  message: _context5.t0\n                });\n\n              case 12:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }\n\n        return _callee5$;\n      }(), null, null, [[0, 9]], Promise);\n    }\n\n    return _callee5;\n  }(), [authCode, closeModal, dispatchToastMessage, setModal, t, verifyCodeFn]);\n  var handleRegenerateCodes = useCallback(function () {\n    var onRegenerate = function () {\n      function _callee6(authCode) {\n        var result;\n        return _regeneratorRuntime.async(function () {\n          function _callee6$(_context6) {\n            while (1) {\n              switch (_context6.prev = _context6.next) {\n                case 0:\n                  _context6.prev = 0;\n                  _context6.next = 3;\n                  return _regeneratorRuntime.awrap(regenerateCodesFn(authCode));\n\n                case 3:\n                  result = _context6.sent;\n\n                  if (result) {\n                    _context6.next = 6;\n                    break;\n                  }\n\n                  return _context6.abrupt(\"return\", dispatchToastMessage({\n                    type: 'error',\n                    message: t('Invalid_two_factor_code')\n                  }));\n\n                case 6:\n                  setModal( /*#__PURE__*/React.createElement(BackupCodesModal, {\n                    codes: result.codes,\n                    onClose: closeModal\n                  }));\n                  _context6.next = 12;\n                  break;\n\n                case 9:\n                  _context6.prev = 9;\n                  _context6.t0 = _context6[\"catch\"](0);\n                  dispatchToastMessage({\n                    type: 'error',\n                    message: _context6.t0\n                  });\n\n                case 12:\n                case \"end\":\n                  return _context6.stop();\n              }\n            }\n          }\n\n          return _callee6$;\n        }(), null, null, [[0, 9]], Promise);\n      }\n\n      return _callee6;\n    }();\n\n    setModal( /*#__PURE__*/React.createElement(TwoFactorTotpModal, {\n      onConfirm: onRegenerate,\n      onClose: closeModal\n    }));\n  }, [closeModal, dispatchToastMessage, regenerateCodesFn, setModal, t]);\n  return /*#__PURE__*/React.createElement(Box, _extends({\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"flex-start\"\n  }, props), /*#__PURE__*/React.createElement(Margins, {\n    blockEnd: \"x8\"\n  }, /*#__PURE__*/React.createElement(Box, {\n    fontScale: \"h4\"\n  }, t('Two-factor_authentication')), !totpEnabled && !registeringTotp && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Box, null, t('Two-factor_authentication_is_currently_disabled')), /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    onClick: handleEnableTotp\n  }, t('Enable_two-factor_authentication'))), !totpEnabled && registeringTotp && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Box, null, t('Scan_QR_code')), /*#__PURE__*/React.createElement(Box, null, t('Scan_QR_code_alternative_s')), /*#__PURE__*/React.createElement(TextCopy, {\n    text: totpSecret\n  }), /*#__PURE__*/React.createElement(Box, {\n    is: \"img\",\n    size: \"x200\",\n    src: qrCode,\n    \"aria-hidden\": \"true\"\n  }), /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"row\",\n    w: \"full\"\n  }, /*#__PURE__*/React.createElement(TextInput, {\n    placeholder: t('Enter_authentication_code'),\n    value: authCode,\n    onChange: handleAuthCode\n  }), /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    onClick: handleVerifyCode\n  }, t('Verify')))), totpEnabled && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    danger: true,\n    onClick: handleDisableTotp\n  }, t('Disable_two-factor_authentication')), /*#__PURE__*/React.createElement(Box, {\n    fontScale: \"p2m\",\n    mbs: \"x8\"\n  }, t('Backup_codes')), /*#__PURE__*/React.createElement(Box, null, t('You_have_n_codes_remaining', {\n    number: codesRemaining\n  })), /*#__PURE__*/React.createElement(Button, {\n    onClick: handleRegenerateCodes\n  }, t('Regenerate_codes')))));\n};\n\nmodule.exportDefault(TwoFactorTOTP);","map":{"version":3,"sources":["client/views/account/security/TwoFactorTOTP.js"],"names":["_regeneratorRuntime","module","link","default","v","_extends","_slicedToArray","Box","Button","TextInput","Margins","useSafely","React","useState","useCallback","useEffect","qrcode","TextCopy","TwoFactorTotpModal","useSetModal","useMethod","useToastMessageDispatch","useTranslation","useUser","useForm","BackupCodesModal","TwoFactorTOTP","props","t","dispatchToastMessage","user","setModal","enableTotpFn","disableTotpFn","verifyCodeFn","checkCodesRemainingFn","regenerateCodesFn","registeringTotp","setRegisteringTotp","qrCode","setQrCode","totpSecret","setTotpSecret","codesRemaining","setCodesRemaining","authCode","values","handlers","handleAuthCode","totpEnabled","services","totp","enabled","closeModal","updateCodesRemaining","result","remaining","handleEnableTotp","secret","url","size","type","message","handleDisableTotp","onDisable","handleVerifyCode","codes","handleRegenerateCodes","onRegenerate","number","exportDefault"],"mappings":"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","sourcesContent":["import { Box, Button, TextInput, Margins } from '@rocket.chat/fuselage';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport React, { useState, useCallback, useEffect } from 'react';\nimport qrcode from 'yaqrcode';\n\nimport TextCopy from '../../../components/TextCopy';\nimport TwoFactorTotpModal from '../../../components/TwoFactorModal/TwoFactorTotpModal';\nimport { useSetModal } from '../../../contexts/ModalContext';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useUser } from '../../../contexts/UserContext';\nimport { useForm } from '../../../hooks/useForm';\nimport BackupCodesModal from './BackupCodesModal';\n\nconst TwoFactorTOTP = (props) => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst user = useUser();\n\tconst setModal = useSetModal();\n\n\tconst enableTotpFn = useMethod('2fa:enable');\n\tconst disableTotpFn = useMethod('2fa:disable');\n\tconst verifyCodeFn = useMethod('2fa:validateTempToken');\n\tconst checkCodesRemainingFn = useMethod('2fa:checkCodesRemaining');\n\tconst regenerateCodesFn = useMethod('2fa:regenerateCodes');\n\n\tconst [registeringTotp, setRegisteringTotp] = useSafely(useState(false));\n\tconst [qrCode, setQrCode] = useSafely(useState());\n\tconst [totpSecret, setTotpSecret] = useSafely(useState());\n\tconst [codesRemaining, setCodesRemaining] = useSafely(useState());\n\n\tconst { values, handlers } = useForm({ authCode: '' });\n\n\tconst { authCode } = values;\n\tconst { handleAuthCode } = handlers;\n\n\tconst totpEnabled = user && user.services && user.services.totp && user.services.totp.enabled;\n\n\tconst closeModal = useCallback(() => setModal(null), [setModal]);\n\n\tuseEffect(() => {\n\t\tconst updateCodesRemaining = async () => {\n\t\t\tif (!totpEnabled) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst result = await checkCodesRemainingFn();\n\t\t\tsetCodesRemaining(result.remaining);\n\t\t};\n\t\tupdateCodesRemaining();\n\t}, [checkCodesRemainingFn, setCodesRemaining, totpEnabled]);\n\n\tconst handleEnableTotp = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await enableTotpFn();\n\n\t\t\tsetTotpSecret(result.secret);\n\t\t\tsetQrCode(qrcode(result.url, { size: 200 }));\n\n\t\t\tsetRegisteringTotp(true);\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, enableTotpFn, setQrCode, setRegisteringTotp, setTotpSecret]);\n\n\tconst handleDisableTotp = useCallback(async () => {\n\t\tconst onDisable = async (authCode) => {\n\t\t\ttry {\n\t\t\t\tconst result = await disableTotpFn(authCode);\n\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Invalid_two_factor_code') });\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Two-factor_authentication_disabled') });\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t\tcloseModal();\n\t\t};\n\n\t\tsetModal(<TwoFactorTotpModal onConfirm={onDisable} onClose={closeModal} />);\n\t}, [closeModal, disableTotpFn, dispatchToastMessage, setModal, t]);\n\n\tconst handleVerifyCode = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await verifyCodeFn(authCode);\n\n\t\t\tif (!result) {\n\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Invalid_two_factor_code') });\n\t\t\t}\n\t\t\tsetModal(<BackupCodesModal codes={result.codes} onClose={closeModal} />);\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [authCode, closeModal, dispatchToastMessage, setModal, t, verifyCodeFn]);\n\n\tconst handleRegenerateCodes = useCallback(() => {\n\t\tconst onRegenerate = async (authCode) => {\n\t\t\ttry {\n\t\t\t\tconst result = await regenerateCodesFn(authCode);\n\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Invalid_two_factor_code') });\n\t\t\t\t}\n\t\t\t\tsetModal(<BackupCodesModal codes={result.codes} onClose={closeModal} />);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t};\n\n\t\tsetModal(<TwoFactorTotpModal onConfirm={onRegenerate} onClose={closeModal} />);\n\t}, [closeModal, dispatchToastMessage, regenerateCodesFn, setModal, t]);\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' alignItems='flex-start' {...props}>\n\t\t\t<Margins blockEnd='x8'>\n\t\t\t\t<Box fontScale='h4'>{t('Two-factor_authentication')}</Box>\n\t\t\t\t{!totpEnabled && !registeringTotp && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Box>{t('Two-factor_authentication_is_currently_disabled')}</Box>\n\t\t\t\t\t\t<Button primary onClick={handleEnableTotp}>\n\t\t\t\t\t\t\t{t('Enable_two-factor_authentication')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t\t{!totpEnabled && registeringTotp && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Box>{t('Scan_QR_code')}</Box>\n\t\t\t\t\t\t<Box>{t('Scan_QR_code_alternative_s')}</Box>\n\t\t\t\t\t\t<TextCopy text={totpSecret} />\n\t\t\t\t\t\t<Box is='img' size='x200' src={qrCode} aria-hidden='true' />\n\t\t\t\t\t\t<Box display='flex' flexDirection='row' w='full'>\n\t\t\t\t\t\t\t<TextInput placeholder={t('Enter_authentication_code')} value={authCode} onChange={handleAuthCode} />\n\t\t\t\t\t\t\t<Button primary onClick={handleVerifyCode}>\n\t\t\t\t\t\t\t\t{t('Verify')}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t\t{totpEnabled && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Button primary danger onClick={handleDisableTotp}>\n\t\t\t\t\t\t\t{t('Disable_two-factor_authentication')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Box fontScale='p2m' mbs='x8'>\n\t\t\t\t\t\t\t{t('Backup_codes')}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t<Box>{t('You_have_n_codes_remaining', { number: codesRemaining })}</Box>\n\t\t\t\t\t\t<Button onClick={handleRegenerateCodes}>{t('Regenerate_codes')}</Button>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</Margins>\n\t\t</Box>\n\t);\n};\n\nexport default TwoFactorTOTP;\n"]},"sourceType":"module","hash":"97134429394d44d788905de473be25caf5ef8c51"}
