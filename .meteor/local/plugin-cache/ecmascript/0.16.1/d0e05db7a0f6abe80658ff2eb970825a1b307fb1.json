{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livestream/client/views/liveStreamTab.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/livestream/client/views/liveStreamTab.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livestream/client/views/liveStreamTab.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livestream/client/views/liveStreamTab.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livestream/client/views/liveStreamTab.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nmodule.export({\n  call: function () {\n    return call;\n  },\n  close: function () {\n    return close;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 1);\nvar Blaze;\nmodule.link(\"meteor/blaze\", {\n  Blaze: function (v) {\n    Blaze = v;\n  }\n}, 2);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 3);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 4);\nvar TAPi18n;\nmodule.link(\"meteor/rocketchat:tap-i18n\", {\n  TAPi18n: function (v) {\n    TAPi18n = v;\n  }\n}, 5);\nvar auth;\nmodule.link(\"../oauth.js\", {\n  auth: function (v) {\n    auth = v;\n  }\n}, 6);\nvar RocketChatAnnouncement;\nmodule.link(\"../../../lib\", {\n  RocketChatAnnouncement: function (v) {\n    RocketChatAnnouncement = v;\n  }\n}, 7);\nvar popout;\nmodule.link(\"../../../ui-utils\", {\n  popout: function (v) {\n    popout = v;\n  }\n}, 8);\nvar t;\nmodule.link(\"../../../utils\", {\n  t: function (v) {\n    t = v;\n  }\n}, 9);\nvar settings;\nmodule.link(\"../../../settings\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 10);\nvar callbacks;\nmodule.link(\"../../../../lib/callbacks\", {\n  callbacks: function (v) {\n    callbacks = v;\n  }\n}, 11);\nvar hasAllPermission;\nmodule.link(\"../../../authorization\", {\n  hasAllPermission: function (v) {\n    hasAllPermission = v;\n  }\n}, 12);\nvar Users, Rooms;\nmodule.link(\"../../../models\", {\n  Users: function (v) {\n    Users = v;\n  },\n  Rooms: function (v) {\n    Rooms = v;\n  }\n}, 13);\nvar handleError;\nmodule.link(\"../../../../client/lib/utils/handleError\", {\n  handleError: function (v) {\n    handleError = v;\n  }\n}, 14);\nvar dispatchToastMessage;\nmodule.link(\"../../../../client/lib/toast\", {\n  dispatchToastMessage: function (v) {\n    dispatchToastMessage = v;\n  }\n}, 15);\n\nvar call = function () {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return new Promise(function (resolve, reject) {\n    var _Meteor;\n\n    (_Meteor = Meteor).call.apply(_Meteor, args.concat([function (err, result) {\n      if (err) {\n        handleError(err);\n        reject(err);\n      }\n\n      resolve(result);\n    }]));\n  });\n};\n\nvar close = function (popup) {\n  return new Promise(function (resolve) {\n    var checkInterval = setInterval(function () {\n      if (popup.closed) {\n        clearInterval(checkInterval);\n        resolve();\n      }\n    }, 300);\n  });\n};\n\nfunction optionsFromUrl(url) {\n  var options = {};\n  var parsedUrl = url.match(/(http:|https:|)\\/\\/(www.)?(youtu(be\\.com|\\.be|be\\.googleapis\\.com))\\/(video\\/|embed\\/|watch\\?v=|v\\/|embed\\?clip=)?([A-Za-z0-9._%-]*)(\\&\\S+)?/);\n  options.url = url;\n\n  if (parsedUrl != null) {\n    options.id = parsedUrl[6];\n\n    if (parsedUrl[3].includes('youtu')) {\n      options.url = \"https://www.youtube.com/embed/\" + parsedUrl[6];\n      options.thumbnail = \"https://img.youtube.com/vi/\" + parsedUrl[6] + \"/0.jpg\";\n    } // @TODO add support for other urls\n\n  }\n\n  return options;\n}\n\nTemplate.liveStreamTab.helpers({\n  broadcastEnabled: function () {\n    return !!settings.get('Broadcasting_enabled');\n  },\n  streamingSource: function () {\n    return Template.instance().streamingOptions.get() ? Template.instance().streamingOptions.get().url : '';\n  },\n  streamingUnavailableMessage: function () {\n    return Template.instance().streamingOptions.get() && Template.instance().streamingOptions.get().message && Template.instance().streamingOptions.get().message !== '' ? Template.instance().streamingOptions.get().message : t('Livestream_not_found');\n  },\n  thumbnailUrl: function () {\n    return Template.instance().streamingOptions.get() ? Template.instance().streamingOptions.get().thumbnail : '';\n  },\n  hasThumbnail: function () {\n    return !!Template.instance().streamingOptions.get() && !!Template.instance().streamingOptions.get().thumbnail && Template.instance().streamingOptions.get().thumbnail !== '';\n  },\n  hasSource: function () {\n    return !!Template.instance().streamingOptions.get() && !!Template.instance().streamingOptions.get().url && Template.instance().streamingOptions.get().url !== '';\n  },\n  canEdit: function () {\n    return hasAllPermission('edit-room', this.rid);\n  },\n  editing: function () {\n    return Template.instance().editing.get() || Template.instance().streamingOptions.get() == null || Template.instance().streamingOptions.get() != null && (Template.instance().streamingOptions.get().url == null || Template.instance().streamingOptions.get().url === '');\n  },\n  canDock: function () {\n    var livestreamTabSource = Template.instance().streamingOptions.get().url;\n    var popoutSource = null;\n\n    try {\n      if (popout.context) {\n        popoutSource = Blaze.getData(popout.context).data && Blaze.getData(popout.context).data.streamingSource;\n      }\n\n      if (popoutSource != null && livestreamTabSource === popoutSource) {\n        return true;\n      }\n    } catch (e) {\n      return false;\n    }\n\n    return false;\n  },\n  isPopoutOpen: function () {\n    return Template.instance().popoutOpen.get();\n  },\n  isAudioOnly: function () {\n    return Template.instance().streamingOptions.get() ? Template.instance().streamingOptions.get().isAudioOnly : false;\n  }\n});\nTemplate.liveStreamTab.onCreated(function () {\n  var _this = this;\n\n  this.editing = new ReactiveVar(false);\n  this.streamingOptions = new ReactiveVar();\n  this.popoutOpen = new ReactiveVar(popout.context != null);\n  this.autorun(function () {\n    var room = Rooms.findOne(_this.data.rid, {\n      fields: {\n        streamingOptions: 1\n      }\n    });\n\n    _this.streamingOptions.set(room.streamingOptions);\n  });\n});\nTemplate.liveStreamTab.onDestroyed(function () {\n  if (popout.docked) {\n    popout.close();\n  }\n});\nTemplate.liveStreamTab.events({\n  'click .js-cancel': function (e, i) {\n    e.preventDefault();\n    i.editing.set(false);\n  },\n  'click .js-clear': function (e, i) {\n    e.preventDefault();\n    var clearedObject = {};\n    Meteor.call('saveRoomSettings', this.rid, 'streamingOptions', clearedObject, function (err) {\n      if (err) {\n        return handleError(err);\n      }\n\n      i.editing.set(false);\n      i.streamingOptions.set(clearedObject);\n      var roomAnnouncement = new RocketChatAnnouncement().getByRoom(i.data.rid);\n\n      if (roomAnnouncement.getMessage() !== '') {\n        roomAnnouncement.clear();\n      }\n\n      return dispatchToastMessage({\n        type: 'success',\n        message: TAPi18n.__('Livestream_source_changed_succesfully')\n      });\n    });\n  },\n  'click .js-save': function (e, i) {\n    e.preventDefault();\n\n    var streamingOptions = _objectSpread(_objectSpread({}, optionsFromUrl(i.find('[name=streaming-source]').value)), {}, {\n      isAudioOnly: i.find('[name=streaming-audio-only]').checked,\n      message: i.find('[name=streaming-message]').value,\n      type: 'livestream'\n    });\n\n    Meteor.call('saveRoomSettings', this.rid, 'streamingOptions', streamingOptions, function (err) {\n      if (err) {\n        return handleError(err);\n      }\n\n      i.editing.set(false);\n      i.streamingOptions.set(streamingOptions);\n\n      if (streamingOptions.url !== '') {\n        new RocketChatAnnouncement({\n          room: i.data.rid,\n          message: 'Broadcast is now live. Click here to watch!',\n          callback: 'openBroadcast'\n        }).save();\n      } else {\n        var roomAnnouncement = new RocketChatAnnouncement().getByRoom(i.data.rid);\n\n        if (roomAnnouncement.getMessage() !== '') {\n          roomAnnouncement.clear();\n        }\n      }\n\n      return dispatchToastMessage({\n        type: 'success',\n        message: TAPi18n.__('Livestream_source_changed_succesfully')\n      });\n    });\n  },\n  'click .streaming-source-settings': function (e, i) {\n    e.preventDefault();\n    i.editing.set(true);\n  },\n  'click .js-dock': function (e) {\n    e.stopPropagation();\n    popout.docked = true;\n  },\n  'click .js-close': function (e, i) {\n    e.stopPropagation();\n    var popoutSource = '';\n\n    if (popout.context) {\n      popoutSource = Blaze.getData(popout.context).data && Blaze.getData(popout.context).data.streamingSource;\n    }\n\n    popout.close();\n\n    if (popoutSource !== Template.instance().streamingOptions.get().url) {\n      popout.open({\n        content: 'liveStreamView',\n        data: {\n          streamingSource: i.streamingOptions.get().url,\n          isAudioOnly: i.streamingOptions.get().isAudioOnly,\n          showVideoControls: true,\n          streamingOptions: i.streamingOptions.get()\n        },\n        onCloseCallback: function () {\n          return i.popoutOpen.set(false);\n        }\n      });\n    }\n  },\n  'submit .liveStreamTab__form': function (e, i) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    var streamingOptions = _objectSpread(_objectSpread({}, optionsFromUrl(i.find('[name=streaming-source]').value)), {}, {\n      isAudioOnly: i.find('[name=streaming-audio-only]').checked,\n      message: i.find('[name=streaming-message]').value,\n      type: 'livestream'\n    });\n\n    Meteor.call('saveRoomSettings', this.rid, 'streamingOptions', streamingOptions, function (err) {\n      if (err) {\n        return handleError(err);\n      }\n\n      i.editing.set(false);\n      i.streamingOptions.set(streamingOptions);\n\n      if (streamingOptions.url !== '') {\n        new RocketChatAnnouncement({\n          room: i.data.rid,\n          message: 'Broadcast is now live. Click here to watch!',\n          callback: 'openBroadcast'\n        }).save();\n      } else {\n        var roomAnnouncement = new RocketChatAnnouncement().getByRoom(i.data.rid);\n\n        if (roomAnnouncement.getMessage() !== '') {\n          roomAnnouncement.clear();\n        }\n      }\n\n      return dispatchToastMessage({\n        type: 'success',\n        message: TAPi18n.__('Livestream_source_changed_succesfully')\n      });\n    });\n  },\n  'click .js-popout': function (e, i) {\n    e.preventDefault();\n    popout.open({\n      content: 'liveStreamView',\n      data: {\n        streamingSource: i.streamingOptions.get().url,\n        isAudioOnly: i.streamingOptions.get().isAudioOnly,\n        showVideoControls: true,\n        streamingOptions: i.streamingOptions.get()\n      },\n      onCloseCallback: function () {\n        return i.popoutOpen.set(false);\n      }\n    });\n    i.popoutOpen.set(true);\n  },\n  'click .js-broadcast': function () {\n    function _callee(e, i) {\n      var user, result;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n                e.currentTarget.classList.add('loading');\n                _context.prev = 2;\n                user = Users.findOne({\n                  _id: Meteor.userId()\n                }, {\n                  fields: {\n                    'settings.livestream': 1\n                  }\n                });\n\n                if (!(!user.settings || !user.settings.livestream)) {\n                  _context.next = 7;\n                  break;\n                }\n\n                _context.next = 7;\n                return _regeneratorRuntime.awrap(auth());\n\n              case 7:\n                _context.next = 9;\n                return _regeneratorRuntime.awrap(call('livestreamGet', {\n                  rid: i.data.rid\n                }));\n\n              case 9:\n                result = _context.sent;\n                popout.open({\n                  content: 'broadcastView',\n                  data: _objectSpread(_objectSpread({}, result), {}, {\n                    showVideoControls: false,\n                    showStreamControls: true\n                  }),\n                  onCloseCallback: function () {\n                    return i.popoutOpen.set(false);\n                  }\n                });\n                _context.next = 16;\n                break;\n\n              case 13:\n                _context.prev = 13;\n                _context.t0 = _context[\"catch\"](2);\n                console.log(_context.t0);\n\n              case 16:\n                _context.prev = 16;\n                e.currentTarget.classList.remove('loading');\n                return _context.finish(16);\n\n              case 19:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return _callee$;\n      }(), null, null, [[2, 13, 16, 19]], Promise);\n    }\n\n    return _callee;\n  }()\n});\ncallbacks.add('openBroadcast', function (rid) {\n  var roomData = Session.get(\"roomData\" + rid);\n\n  if (!roomData) {\n    return;\n  }\n\n  popout.open({\n    content: 'liveStreamView',\n    data: {\n      streamingSource: roomData.streamingOptions.url,\n      isAudioOnly: roomData.streamingOptions.isAudioOnly,\n      showVideoControls: true,\n      streamingOptions: roomData.streamingOptions\n    }\n  });\n});","map":{"version":3,"sources":["app/livestream/client/views/liveStreamTab.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","export","call","close","Meteor","ReactiveVar","Blaze","Session","Template","TAPi18n","auth","RocketChatAnnouncement","popout","t","settings","callbacks","hasAllPermission","Users","Rooms","handleError","dispatchToastMessage","args","Promise","resolve","reject","err","result","popup","checkInterval","setInterval","closed","clearInterval","optionsFromUrl","url","options","parsedUrl","match","id","includes","thumbnail","liveStreamTab","helpers","broadcastEnabled","get","streamingSource","instance","streamingOptions","streamingUnavailableMessage","message","thumbnailUrl","hasThumbnail","hasSource","canEdit","rid","editing","canDock","livestreamTabSource","popoutSource","context","getData","data","e","isPopoutOpen","popoutOpen","isAudioOnly","onCreated","autorun","room","findOne","fields","set","onDestroyed","docked","events","i","preventDefault","clearedObject","roomAnnouncement","getByRoom","getMessage","clear","type","__","find","value","checked","callback","save","stopPropagation","open","content","showVideoControls","onCloseCallback","currentTarget","classList","add","user","_id","userId","livestream","showStreamControls","console","log","remove","roomData"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Blaze } from 'meteor/blaze';\nimport { Session } from 'meteor/session';\nimport { Template } from 'meteor/templating';\nimport { TAPi18n } from 'meteor/rocketchat:tap-i18n';\n\nimport { auth } from '../oauth.js';\nimport { RocketChatAnnouncement } from '../../../lib';\nimport { popout } from '../../../ui-utils';\nimport { t } from '../../../utils';\nimport { settings } from '../../../settings';\nimport { callbacks } from '../../../../lib/callbacks';\nimport { hasAllPermission } from '../../../authorization';\nimport { Users, Rooms } from '../../../models';\nimport { handleError } from '../../../../client/lib/utils/handleError';\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\n\nexport const call = (...args) =>\n\tnew Promise(function (resolve, reject) {\n\t\tMeteor.call(...args, function (err, result) {\n\t\t\tif (err) {\n\t\t\t\thandleError(err);\n\t\t\t\treject(err);\n\t\t\t}\n\t\t\tresolve(result);\n\t\t});\n\t});\n\nexport const close = (popup) =>\n\tnew Promise(function (resolve) {\n\t\tconst checkInterval = setInterval(() => {\n\t\t\tif (popup.closed) {\n\t\t\t\tclearInterval(checkInterval);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 300);\n\t});\n\nfunction optionsFromUrl(url) {\n\tconst options = {};\n\tconst parsedUrl = url.match(\n\t\t/(http:|https:|)\\/\\/(www.)?(youtu(be\\.com|\\.be|be\\.googleapis\\.com))\\/(video\\/|embed\\/|watch\\?v=|v\\/|embed\\?clip=)?([A-Za-z0-9._%-]*)(\\&\\S+)?/,\n\t);\n\toptions.url = url;\n\tif (parsedUrl != null) {\n\t\toptions.id = parsedUrl[6];\n\t\tif (parsedUrl[3].includes('youtu')) {\n\t\t\toptions.url = `https://www.youtube.com/embed/${parsedUrl[6]}`;\n\t\t\toptions.thumbnail = `https://img.youtube.com/vi/${parsedUrl[6]}/0.jpg`;\n\t\t}\n\t\t// @TODO add support for other urls\n\t}\n\treturn options;\n}\n\nTemplate.liveStreamTab.helpers({\n\tbroadcastEnabled() {\n\t\treturn !!settings.get('Broadcasting_enabled');\n\t},\n\tstreamingSource() {\n\t\treturn Template.instance().streamingOptions.get() ? Template.instance().streamingOptions.get().url : '';\n\t},\n\tstreamingUnavailableMessage() {\n\t\treturn Template.instance().streamingOptions.get() &&\n\t\t\tTemplate.instance().streamingOptions.get().message &&\n\t\t\tTemplate.instance().streamingOptions.get().message !== ''\n\t\t\t? Template.instance().streamingOptions.get().message\n\t\t\t: t('Livestream_not_found');\n\t},\n\tthumbnailUrl() {\n\t\treturn Template.instance().streamingOptions.get() ? Template.instance().streamingOptions.get().thumbnail : '';\n\t},\n\thasThumbnail() {\n\t\treturn (\n\t\t\t!!Template.instance().streamingOptions.get() &&\n\t\t\t!!Template.instance().streamingOptions.get().thumbnail &&\n\t\t\tTemplate.instance().streamingOptions.get().thumbnail !== ''\n\t\t);\n\t},\n\thasSource() {\n\t\treturn (\n\t\t\t!!Template.instance().streamingOptions.get() &&\n\t\t\t!!Template.instance().streamingOptions.get().url &&\n\t\t\tTemplate.instance().streamingOptions.get().url !== ''\n\t\t);\n\t},\n\tcanEdit() {\n\t\treturn hasAllPermission('edit-room', this.rid);\n\t},\n\tediting() {\n\t\treturn (\n\t\t\tTemplate.instance().editing.get() ||\n\t\t\tTemplate.instance().streamingOptions.get() == null ||\n\t\t\t(Template.instance().streamingOptions.get() != null &&\n\t\t\t\t(Template.instance().streamingOptions.get().url == null || Template.instance().streamingOptions.get().url === ''))\n\t\t);\n\t},\n\tcanDock() {\n\t\tconst livestreamTabSource = Template.instance().streamingOptions.get().url;\n\t\tlet popoutSource = null;\n\t\ttry {\n\t\t\tif (popout.context) {\n\t\t\t\tpopoutSource = Blaze.getData(popout.context).data && Blaze.getData(popout.context).data.streamingSource;\n\t\t\t}\n\t\t\tif (popoutSource != null && livestreamTabSource === popoutSource) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t\treturn false;\n\t},\n\tisPopoutOpen() {\n\t\treturn Template.instance().popoutOpen.get();\n\t},\n\tisAudioOnly() {\n\t\treturn Template.instance().streamingOptions.get() ? Template.instance().streamingOptions.get().isAudioOnly : false;\n\t},\n});\n\nTemplate.liveStreamTab.onCreated(function () {\n\tthis.editing = new ReactiveVar(false);\n\tthis.streamingOptions = new ReactiveVar();\n\tthis.popoutOpen = new ReactiveVar(popout.context != null);\n\n\tthis.autorun(() => {\n\t\tconst room = Rooms.findOne(this.data.rid, { fields: { streamingOptions: 1 } });\n\t\tthis.streamingOptions.set(room.streamingOptions);\n\t});\n});\n\nTemplate.liveStreamTab.onDestroyed(function () {\n\tif (popout.docked) {\n\t\tpopout.close();\n\t}\n});\n\nTemplate.liveStreamTab.events({\n\t'click .js-cancel'(e, i) {\n\t\te.preventDefault();\n\t\ti.editing.set(false);\n\t},\n\t'click .js-clear'(e, i) {\n\t\te.preventDefault();\n\n\t\tconst clearedObject = {};\n\n\t\tMeteor.call('saveRoomSettings', this.rid, 'streamingOptions', clearedObject, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn handleError(err);\n\t\t\t}\n\t\t\ti.editing.set(false);\n\t\t\ti.streamingOptions.set(clearedObject);\n\t\t\tconst roomAnnouncement = new RocketChatAnnouncement().getByRoom(i.data.rid);\n\t\t\tif (roomAnnouncement.getMessage() !== '') {\n\t\t\t\troomAnnouncement.clear();\n\t\t\t}\n\t\t\treturn dispatchToastMessage({\n\t\t\t\ttype: 'success',\n\t\t\t\tmessage: TAPi18n.__('Livestream_source_changed_succesfully'),\n\t\t\t});\n\t\t});\n\t},\n\t'click .js-save'(e, i) {\n\t\te.preventDefault();\n\n\t\tconst streamingOptions = {\n\t\t\t...optionsFromUrl(i.find('[name=streaming-source]').value),\n\t\t\tisAudioOnly: i.find('[name=streaming-audio-only]').checked,\n\t\t\tmessage: i.find('[name=streaming-message]').value,\n\t\t\ttype: 'livestream',\n\t\t};\n\n\t\tMeteor.call('saveRoomSettings', this.rid, 'streamingOptions', streamingOptions, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn handleError(err);\n\t\t\t}\n\t\t\ti.editing.set(false);\n\t\t\ti.streamingOptions.set(streamingOptions);\n\t\t\tif (streamingOptions.url !== '') {\n\t\t\t\tnew RocketChatAnnouncement({\n\t\t\t\t\troom: i.data.rid,\n\t\t\t\t\tmessage: 'Broadcast is now live. Click here to watch!',\n\t\t\t\t\tcallback: 'openBroadcast',\n\t\t\t\t}).save();\n\t\t\t} else {\n\t\t\t\tconst roomAnnouncement = new RocketChatAnnouncement().getByRoom(i.data.rid);\n\t\t\t\tif (roomAnnouncement.getMessage() !== '') {\n\t\t\t\t\troomAnnouncement.clear();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn dispatchToastMessage({\n\t\t\t\ttype: 'success',\n\t\t\t\tmessage: TAPi18n.__('Livestream_source_changed_succesfully'),\n\t\t\t});\n\t\t});\n\t},\n\t'click .streaming-source-settings'(e, i) {\n\t\te.preventDefault();\n\t\ti.editing.set(true);\n\t},\n\t'click .js-dock'(e) {\n\t\te.stopPropagation();\n\t\tpopout.docked = true;\n\t},\n\t'click .js-close'(e, i) {\n\t\te.stopPropagation();\n\t\tlet popoutSource = '';\n\t\tif (popout.context) {\n\t\t\tpopoutSource = Blaze.getData(popout.context).data && Blaze.getData(popout.context).data.streamingSource;\n\t\t}\n\t\tpopout.close();\n\t\tif (popoutSource !== Template.instance().streamingOptions.get().url) {\n\t\t\tpopout.open({\n\t\t\t\tcontent: 'liveStreamView',\n\t\t\t\tdata: {\n\t\t\t\t\tstreamingSource: i.streamingOptions.get().url,\n\t\t\t\t\tisAudioOnly: i.streamingOptions.get().isAudioOnly,\n\t\t\t\t\tshowVideoControls: true,\n\t\t\t\t\tstreamingOptions: i.streamingOptions.get(),\n\t\t\t\t},\n\t\t\t\tonCloseCallback: () => i.popoutOpen.set(false),\n\t\t\t});\n\t\t}\n\t},\n\t'submit .liveStreamTab__form'(e, i) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst streamingOptions = {\n\t\t\t...optionsFromUrl(i.find('[name=streaming-source]').value),\n\t\t\tisAudioOnly: i.find('[name=streaming-audio-only]').checked,\n\t\t\tmessage: i.find('[name=streaming-message]').value,\n\t\t\ttype: 'livestream',\n\t\t};\n\n\t\tMeteor.call('saveRoomSettings', this.rid, 'streamingOptions', streamingOptions, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn handleError(err);\n\t\t\t}\n\t\t\ti.editing.set(false);\n\t\t\ti.streamingOptions.set(streamingOptions);\n\t\t\tif (streamingOptions.url !== '') {\n\t\t\t\tnew RocketChatAnnouncement({\n\t\t\t\t\troom: i.data.rid,\n\t\t\t\t\tmessage: 'Broadcast is now live. Click here to watch!',\n\t\t\t\t\tcallback: 'openBroadcast',\n\t\t\t\t}).save();\n\t\t\t} else {\n\t\t\t\tconst roomAnnouncement = new RocketChatAnnouncement().getByRoom(i.data.rid);\n\t\t\t\tif (roomAnnouncement.getMessage() !== '') {\n\t\t\t\t\troomAnnouncement.clear();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn dispatchToastMessage({\n\t\t\t\ttype: 'success',\n\t\t\t\tmessage: TAPi18n.__('Livestream_source_changed_succesfully'),\n\t\t\t});\n\t\t});\n\t},\n\t'click .js-popout'(e, i) {\n\t\te.preventDefault();\n\t\tpopout.open({\n\t\t\tcontent: 'liveStreamView',\n\t\t\tdata: {\n\t\t\t\tstreamingSource: i.streamingOptions.get().url,\n\t\t\t\tisAudioOnly: i.streamingOptions.get().isAudioOnly,\n\t\t\t\tshowVideoControls: true,\n\t\t\t\tstreamingOptions: i.streamingOptions.get(),\n\t\t\t},\n\t\t\tonCloseCallback: () => i.popoutOpen.set(false),\n\t\t});\n\t\ti.popoutOpen.set(true);\n\t},\n\tasync 'click .js-broadcast'(e, i) {\n\t\te.preventDefault();\n\t\te.currentTarget.classList.add('loading');\n\t\ttry {\n\t\t\tconst user = Users.findOne({ _id: Meteor.userId() }, { fields: { 'settings.livestream': 1 } });\n\t\t\tif (!user.settings || !user.settings.livestream) {\n\t\t\t\tawait auth();\n\t\t\t}\n\t\t\tconst result = await call('livestreamGet', { rid: i.data.rid });\n\t\t\tpopout.open({\n\t\t\t\tcontent: 'broadcastView',\n\t\t\t\tdata: {\n\t\t\t\t\t...result,\n\t\t\t\t\tshowVideoControls: false,\n\t\t\t\t\tshowStreamControls: true,\n\t\t\t\t},\n\t\t\t\tonCloseCallback: () => i.popoutOpen.set(false),\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.log(e);\n\t\t} finally {\n\t\t\te.currentTarget.classList.remove('loading');\n\t\t}\n\t},\n});\n\ncallbacks.add('openBroadcast', (rid) => {\n\tconst roomData = Session.get(`roomData${rid}`);\n\tif (!roomData) {\n\t\treturn;\n\t}\n\tpopout.open({\n\t\tcontent: 'liveStreamView',\n\t\tdata: {\n\t\t\tstreamingSource: roomData.streamingOptions.url,\n\t\t\tisAudioOnly: roomData.streamingOptions.isAudioOnly,\n\t\t\tshowVideoControls: true,\n\t\t\tstreamingOptions: roomData.streamingOptions,\n\t\t},\n\t});\n});\n"]},"sourceType":"module","hash":"d0e05db7a0f6abe80658ff2eb970825a1b307fb1"}
