{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/popup/messagePopup.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-message/client/popup/messagePopup.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/popup/messagePopup.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/popup/messagePopup.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/popup/messagePopup.js"}},"code":"var _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 3);\nmodule.link(\"./messagePopup.html\");\nvar keys = {\n  TAB: 9,\n  ENTER: 13,\n  ESC: 27,\n  ARROW_LEFT: 37,\n  ARROW_UP: 38,\n  ARROW_RIGHT: 39,\n  ARROW_DOWN: 40\n};\n\nfunction getCursorPosition(input) {\n  if (input == null) {\n    return;\n  }\n\n  if (input.selectionStart != null) {\n    return input.selectionStart;\n  }\n\n  if (document.selection != null) {\n    input.focus();\n    var sel = document.selection.createRange();\n    var selLen = document.selection.createRange().text.length;\n    sel.moveStart('character', -input.value.length);\n    return sel.text.length - selLen;\n  }\n}\n\nfunction setCursorPosition(input, caretPos) {\n  if (input == null) {\n    return;\n  }\n\n  if (input.selectionStart != null) {\n    input.focus();\n    return input.setSelectionRange(caretPos, caretPos);\n  }\n\n  if (document.selection != null) {\n    var range = input.createTextRange();\n    range.move('character', caretPos);\n    return range.select();\n  }\n}\n\nfunction val(v, d) {\n  if (v != null) {\n    return v;\n  }\n\n  return d;\n}\n\nTemplate.messagePopup.onCreated(function () {\n  var template = this;\n  template.textFilter = new ReactiveVar('');\n  template.textFilterDelay = val(template.data.textFilterDelay, 0);\n  template.open = val(template.data.open, new ReactiveVar(false));\n  template.hasData = new ReactiveVar(false);\n  template.value = new ReactiveVar();\n  template.trigger = val(template.data.trigger, '');\n  template.triggerAnywhere = val(template.data.triggerAnywhere, true);\n  template.closeOnEsc = val(template.data.closeOnEsc, true);\n  template.blurOnSelectItem = val(template.data.blurOnSelectItem, false);\n  template.prefix = val(template.data.prefix, template.trigger);\n  template.suffix = val(template.data.suffix, '');\n\n  if (template.triggerAnywhere === true) {\n    template.matchSelectorRegex = val(template.data.matchSelectorRegex, new RegExp(\"(?:^| |\\n)\" + template.trigger + \"[^\\\\s]*$\"));\n  } else {\n    template.matchSelectorRegex = val(template.data.matchSelectorRegex, new RegExp(\"(?:^)\" + template.trigger + \"[^\\\\s]*$\"));\n  }\n\n  template.selectorRegex = val(template.data.selectorRegex, new RegExp(template.trigger + \"([^\\\\s]*)$\"));\n  template.replaceRegex = val(template.data.replaceRegex, new RegExp(template.trigger + \"[^\\\\s]*$\"));\n  template.getValue = val(template.data.getValue, function (_id) {\n    return _id;\n  });\n\n  template.up = function () {\n    var current = template.find('.popup-item.selected');\n    var previous = $(current).prev('.popup-item')[0] || template.find('.popup-item:last-child');\n\n    if (previous != null) {\n      current.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n      previous.className += ' selected sidebar-item__popup-active';\n      previous.scrollIntoView(false);\n      return template.value.set(previous.getAttribute('data-id'));\n    }\n  };\n\n  template.down = function () {\n    var current = template.find('.popup-item.selected');\n    var next = $(current).next('.popup-item')[0] || template.find('.popup-item');\n\n    if (next && next.classList.contains('popup-item')) {\n      current.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n      next.className += ' selected sidebar-item__popup-active';\n      next.scrollIntoView(false);\n      return template.value.set(next.getAttribute('data-id'));\n    }\n  };\n\n  template.verifySelection = function () {\n    if (!template.open.curValue) {\n      return;\n    }\n\n    var current = template.find('.popup-item.selected');\n\n    if (current == null) {\n      var first = template.find('.popup-item');\n\n      if (first != null) {\n        first.className += ' selected sidebar-item__popup-active';\n        return template.value.set(first.getAttribute('data-id'));\n      }\n\n      return template.value.set(null);\n    }\n  };\n\n  template.onInputKeydown = function (event) {\n    if (template.open.curValue !== true || template.hasData.curValue !== true) {\n      return;\n    }\n\n    if (event.which === keys.ENTER || event.which === keys.TAB) {\n      if (template.blurOnSelectItem === true) {\n        template.input.blur();\n      } else {\n        template.open.set(false);\n      }\n\n      template.enterValue();\n\n      if (template.data.cleanOnEnter) {\n        template.input.value = '';\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    if (event.which === keys.ARROW_UP) {\n      template.up();\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    if (event.which === keys.ARROW_DOWN) {\n      template.down();\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  };\n\n  template.setTextFilter = _.debounce(function (value) {\n    return template.textFilter.set(value);\n  }, template.textFilterDelay);\n\n  template.onInputKeyup = function (event) {\n    if (template.closeOnEsc === true && template.open.curValue === true && event.which === keys.ESC) {\n      template.open.set(false);\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n\n    var value = template.input.value.substr(0, getCursorPosition(template.input));\n\n    if (template.matchSelectorRegex.test(value)) {\n      template.setTextFilter(value.match(template.selectorRegex)[1]);\n      template.open.set(true);\n    } else {\n      template.open.set(false);\n    }\n\n    if (template.open.curValue !== true) {\n      return;\n    }\n\n    if (event.which !== keys.ARROW_UP && event.which !== keys.ARROW_DOWN) {\n      return Meteor.defer(function () {\n        template.verifySelection();\n      });\n    }\n  };\n\n  template.onFocus = function () {\n    template.clickingItem = false;\n\n    if (template.open.curValue === true) {\n      return;\n    }\n\n    var value = template.input.value.substr(0, getCursorPosition(template.input));\n\n    if (template.matchSelectorRegex.test(value)) {\n      template.setTextFilter(value.match(template.selectorRegex)[1]);\n      template.open.set(true);\n      return Meteor.defer(function () {\n        return template.verifySelection();\n      });\n    }\n\n    return template.open.set(false);\n  };\n\n  template.onBlur = function () {\n    if (template.open.curValue === false) {\n      return;\n    }\n\n    if (template.clickingItem === true) {\n      return;\n    }\n\n    return template.open.set(false);\n  };\n\n  template.enterValue = function () {\n    if (template.value.curValue == null) {\n      return;\n    }\n\n    var value = template.input.value;\n    var caret = getCursorPosition(template.input);\n    var firstPartValue = value.substr(0, caret);\n    var lastPartValue = value.substr(caret);\n    var getValue = this.getValue(template.value.curValue, template.data.collection, template.records.get(), firstPartValue);\n\n    if (!getValue) {\n      return;\n    }\n\n    firstPartValue = firstPartValue.replace(template.selectorRegex, template.prefix + getValue + template.suffix);\n    template.input.value = firstPartValue + lastPartValue;\n    return setCursorPosition(template.input, firstPartValue.length);\n  };\n\n  template.records = new ReactiveVar([]);\n  template.autorun(function () {\n    var filter = template.textFilter.get();\n\n    if (filter != null) {\n      var filterCallback = function (result) {\n        template.hasData.set(result && result.length > 0);\n        template.records.set(result);\n        return Meteor.defer(function () {\n          return template.verifySelection();\n        });\n      };\n\n      var result = template.data.getFilter(template.data.collection, filter, filterCallback);\n\n      if (result != null) {\n        return filterCallback(result);\n      }\n    }\n  });\n});\nTemplate.messagePopup.onRendered(function () {\n  if (this.data.getInput != null) {\n    this.input = typeof this.data.getInput === 'function' && this.data.getInput();\n  } else if (this.data.input) {\n    this.input = this.parentTemplate().find(this.data.input);\n  }\n\n  if (this.input == null) {\n    console.error('Input not found for popup');\n  }\n\n  var self = this;\n  self.autorun(function () {\n    var open = self.open.get();\n\n    if ($('.reply-preview').length) {\n      if (open === true) {\n        $('.reply-preview').addClass('reply-preview-with-popup');\n        setTimeout(function () {\n          $('#popup').addClass('popup-with-reply-preview');\n        }, 50);\n      }\n    }\n\n    if (open === false) {\n      $('.reply-preview').removeClass('reply-preview-with-popup');\n      $('#popup').removeClass('popup-with-reply-preview');\n    }\n  });\n  $(this.input).on('keyup', this.onInputKeyup.bind(this));\n  $(this.input).on('keydown', this.onInputKeydown.bind(this));\n  $(this.input).on('focus', this.onFocus.bind(this));\n  $(this.input).on('blur', this.onBlur.bind(this));\n});\nTemplate.messagePopup.onDestroyed(function () {\n  $(this.input).off('keyup', this.onInputKeyup);\n  $(this.input).off('keydown', this.onInputKeydown);\n  $(this.input).off('focus', this.onFocus);\n  $(this.input).off('blur', this.onBlur);\n});\nTemplate.messagePopup.events({\n  'mouseenter .popup-item': function (e) {\n    if (e.currentTarget.className.indexOf('selected') > -1) {\n      return;\n    }\n\n    var template = Template.instance();\n    var current = template.find('.popup-item.selected');\n\n    if (current != null) {\n      current.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n    }\n\n    e.currentTarget.className += ' selected sidebar-item__popup-active';\n    return template.value.set(this._id);\n  },\n  'mousedown .popup-item, touchstart .popup-item': function () {\n    var template = Template.instance();\n    template.clickingItem = true;\n  },\n  'mouseup .popup-item, touchend .popup-item': function (e) {\n    e.stopPropagation();\n    var template = Template.instance();\n    var wasMenuIconClicked = e.target.classList.contains('sidebar-item__menu-icon');\n    template.clickingItem = false;\n\n    if (!wasMenuIconClicked) {\n      template.value.set(this._id);\n      template.enterValue();\n      template.open.set(false);\n    }\n  }\n});\nTemplate.messagePopup.helpers({\n  isOpen: function () {\n    return Template.instance().open.get() && (Template.instance().hasData.get() || Template.instance().data.emptyTemplate != null || !Template.instance().parentTemplate(1).subscriptionsReady());\n  },\n  data: function () {\n    var template = Template.instance();\n    return Object.assign(template.records.get(), {\n      toolbar: true\n    });\n  },\n  toolbarData: function () {\n    return _objectSpread(_objectSpread({}, Template.currentData()), {}, {\n      toolbar: true\n    });\n  },\n  sidebarHeaderHeight: function () {\n    return document.querySelector('.sidebar__header').offsetHeight + \"px\";\n  },\n  sidebarWidth: function () {\n    return document.querySelector('.sidebar').offsetWidth + \"px\";\n  }\n});","map":{"version":3,"sources":["app/ui-message/client/popup/messagePopup.js"],"names":["_objectSpread","module","link","default","v","_","Meteor","ReactiveVar","Template","keys","TAB","ENTER","ESC","ARROW_LEFT","ARROW_UP","ARROW_RIGHT","ARROW_DOWN","getCursorPosition","input","selectionStart","document","selection","focus","sel","createRange","selLen","text","length","moveStart","value","setCursorPosition","caretPos","setSelectionRange","range","createTextRange","move","select","val","d","messagePopup","onCreated","template","textFilter","textFilterDelay","data","open","hasData","trigger","triggerAnywhere","closeOnEsc","blurOnSelectItem","prefix","suffix","matchSelectorRegex","RegExp","selectorRegex","replaceRegex","getValue","_id","up","current","find","previous","$","prev","className","replace","scrollIntoView","set","getAttribute","down","next","classList","contains","verifySelection","curValue","first","onInputKeydown","event","which","blur","enterValue","cleanOnEnter","preventDefault","stopPropagation","setTextFilter","debounce","onInputKeyup","substr","test","match","defer","onFocus","clickingItem","onBlur","caret","firstPartValue","lastPartValue","collection","records","get","autorun","filter","filterCallback","result","getFilter","onRendered","getInput","parentTemplate","console","error","self","addClass","setTimeout","removeClass","on","bind","onDestroyed","off","events","e","currentTarget","indexOf","instance","wasMenuIconClicked","target","helpers","isOpen","emptyTemplate","subscriptionsReady","Object","assign","toolbar","toolbarData","currentData","sidebarHeaderHeight","querySelector","offsetHeight","sidebarWidth","offsetWidth"],"mappings":"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","sourcesContent":["// This is not supposed to be a complete list\n// it is just to improve readability in this file\n\nimport _ from 'underscore';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Template } from 'meteor/templating';\n\nimport './messagePopup.html';\n\nconst keys = {\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tARROW_LEFT: 37,\n\tARROW_UP: 38,\n\tARROW_RIGHT: 39,\n\tARROW_DOWN: 40,\n};\n\nfunction getCursorPosition(input) {\n\tif (input == null) {\n\t\treturn;\n\t}\n\tif (input.selectionStart != null) {\n\t\treturn input.selectionStart;\n\t}\n\tif (document.selection != null) {\n\t\tinput.focus();\n\t\tconst sel = document.selection.createRange();\n\t\tconst selLen = document.selection.createRange().text.length;\n\t\tsel.moveStart('character', -input.value.length);\n\t\treturn sel.text.length - selLen;\n\t}\n}\n\nfunction setCursorPosition(input, caretPos) {\n\tif (input == null) {\n\t\treturn;\n\t}\n\tif (input.selectionStart != null) {\n\t\tinput.focus();\n\t\treturn input.setSelectionRange(caretPos, caretPos);\n\t}\n\tif (document.selection != null) {\n\t\tconst range = input.createTextRange();\n\t\trange.move('character', caretPos);\n\t\treturn range.select();\n\t}\n}\n\nfunction val(v, d) {\n\tif (v != null) {\n\t\treturn v;\n\t}\n\treturn d;\n}\n\nTemplate.messagePopup.onCreated(function () {\n\tconst template = this;\n\ttemplate.textFilter = new ReactiveVar('');\n\ttemplate.textFilterDelay = val(template.data.textFilterDelay, 0);\n\ttemplate.open = val(template.data.open, new ReactiveVar(false));\n\ttemplate.hasData = new ReactiveVar(false);\n\ttemplate.value = new ReactiveVar();\n\ttemplate.trigger = val(template.data.trigger, '');\n\ttemplate.triggerAnywhere = val(template.data.triggerAnywhere, true);\n\ttemplate.closeOnEsc = val(template.data.closeOnEsc, true);\n\ttemplate.blurOnSelectItem = val(template.data.blurOnSelectItem, false);\n\ttemplate.prefix = val(template.data.prefix, template.trigger);\n\ttemplate.suffix = val(template.data.suffix, '');\n\tif (template.triggerAnywhere === true) {\n\t\ttemplate.matchSelectorRegex = val(template.data.matchSelectorRegex, new RegExp(`(?:^| |\\n)${template.trigger}[^\\\\s]*$`));\n\t} else {\n\t\ttemplate.matchSelectorRegex = val(template.data.matchSelectorRegex, new RegExp(`(?:^)${template.trigger}[^\\\\s]*$`));\n\t}\n\ttemplate.selectorRegex = val(template.data.selectorRegex, new RegExp(`${template.trigger}([^\\\\s]*)$`));\n\ttemplate.replaceRegex = val(template.data.replaceRegex, new RegExp(`${template.trigger}[^\\\\s]*$`));\n\ttemplate.getValue = val(template.data.getValue, function (_id) {\n\t\treturn _id;\n\t});\n\ttemplate.up = () => {\n\t\tconst current = template.find('.popup-item.selected');\n\t\tconst previous = $(current).prev('.popup-item')[0] || template.find('.popup-item:last-child');\n\t\tif (previous != null) {\n\t\t\tcurrent.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n\t\t\tprevious.className += ' selected sidebar-item__popup-active';\n\t\t\tprevious.scrollIntoView(false);\n\t\t\treturn template.value.set(previous.getAttribute('data-id'));\n\t\t}\n\t};\n\ttemplate.down = () => {\n\t\tconst current = template.find('.popup-item.selected');\n\t\tconst next = $(current).next('.popup-item')[0] || template.find('.popup-item');\n\t\tif (next && next.classList.contains('popup-item')) {\n\t\t\tcurrent.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n\t\t\tnext.className += ' selected sidebar-item__popup-active';\n\t\t\tnext.scrollIntoView(false);\n\t\t\treturn template.value.set(next.getAttribute('data-id'));\n\t\t}\n\t};\n\ttemplate.verifySelection = () => {\n\t\tif (!template.open.curValue) {\n\t\t\treturn;\n\t\t}\n\t\tconst current = template.find('.popup-item.selected');\n\t\tif (current == null) {\n\t\t\tconst first = template.find('.popup-item');\n\t\t\tif (first != null) {\n\t\t\t\tfirst.className += ' selected sidebar-item__popup-active';\n\t\t\t\treturn template.value.set(first.getAttribute('data-id'));\n\t\t\t}\n\t\t\treturn template.value.set(null);\n\t\t}\n\t};\n\ttemplate.onInputKeydown = (event) => {\n\t\tif (template.open.curValue !== true || template.hasData.curValue !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (event.which === keys.ENTER || event.which === keys.TAB) {\n\t\t\tif (template.blurOnSelectItem === true) {\n\t\t\t\ttemplate.input.blur();\n\t\t\t} else {\n\t\t\t\ttemplate.open.set(false);\n\t\t\t}\n\t\t\ttemplate.enterValue();\n\t\t\tif (template.data.cleanOnEnter) {\n\t\t\t\ttemplate.input.value = '';\n\t\t\t}\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\treturn;\n\t\t}\n\t\tif (event.which === keys.ARROW_UP) {\n\t\t\ttemplate.up();\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\treturn;\n\t\t}\n\t\tif (event.which === keys.ARROW_DOWN) {\n\t\t\ttemplate.down();\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\ttemplate.setTextFilter = _.debounce(function (value) {\n\t\treturn template.textFilter.set(value);\n\t}, template.textFilterDelay);\n\n\ttemplate.onInputKeyup = (event) => {\n\t\tif (template.closeOnEsc === true && template.open.curValue === true && event.which === keys.ESC) {\n\t\t\ttemplate.open.set(false);\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\treturn;\n\t\t}\n\t\tconst value = template.input.value.substr(0, getCursorPosition(template.input));\n\n\t\tif (template.matchSelectorRegex.test(value)) {\n\t\t\ttemplate.setTextFilter(value.match(template.selectorRegex)[1]);\n\t\t\ttemplate.open.set(true);\n\t\t} else {\n\t\t\ttemplate.open.set(false);\n\t\t}\n\t\tif (template.open.curValue !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (event.which !== keys.ARROW_UP && event.which !== keys.ARROW_DOWN) {\n\t\t\treturn Meteor.defer(function () {\n\t\t\t\ttemplate.verifySelection();\n\t\t\t});\n\t\t}\n\t};\n\ttemplate.onFocus = () => {\n\t\ttemplate.clickingItem = false;\n\t\tif (template.open.curValue === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst value = template.input.value.substr(0, getCursorPosition(template.input));\n\t\tif (template.matchSelectorRegex.test(value)) {\n\t\t\ttemplate.setTextFilter(value.match(template.selectorRegex)[1]);\n\t\t\ttemplate.open.set(true);\n\t\t\treturn Meteor.defer(function () {\n\t\t\t\treturn template.verifySelection();\n\t\t\t});\n\t\t}\n\t\treturn template.open.set(false);\n\t};\n\n\ttemplate.onBlur = () => {\n\t\tif (template.open.curValue === false) {\n\t\t\treturn;\n\t\t}\n\t\tif (template.clickingItem === true) {\n\t\t\treturn;\n\t\t}\n\t\treturn template.open.set(false);\n\t};\n\n\ttemplate.enterValue = function () {\n\t\tif (template.value.curValue == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst { value } = template.input;\n\t\tconst caret = getCursorPosition(template.input);\n\t\tlet firstPartValue = value.substr(0, caret);\n\t\tconst lastPartValue = value.substr(caret);\n\t\tconst getValue = this.getValue(template.value.curValue, template.data.collection, template.records.get(), firstPartValue);\n\t\tif (!getValue) {\n\t\t\treturn;\n\t\t}\n\t\tfirstPartValue = firstPartValue.replace(template.selectorRegex, template.prefix + getValue + template.suffix);\n\t\ttemplate.input.value = firstPartValue + lastPartValue;\n\t\treturn setCursorPosition(template.input, firstPartValue.length);\n\t};\n\ttemplate.records = new ReactiveVar([]);\n\ttemplate.autorun(function () {\n\t\tconst filter = template.textFilter.get();\n\t\tif (filter != null) {\n\t\t\tconst filterCallback = (result) => {\n\t\t\t\ttemplate.hasData.set(result && result.length > 0);\n\t\t\t\ttemplate.records.set(result);\n\t\t\t\treturn Meteor.defer(function () {\n\t\t\t\t\treturn template.verifySelection();\n\t\t\t\t});\n\t\t\t};\n\t\t\tconst result = template.data.getFilter(template.data.collection, filter, filterCallback);\n\t\t\tif (result != null) {\n\t\t\t\treturn filterCallback(result);\n\t\t\t}\n\t\t}\n\t});\n});\n\nTemplate.messagePopup.onRendered(function () {\n\tif (this.data.getInput != null) {\n\t\tthis.input = typeof this.data.getInput === 'function' && this.data.getInput();\n\t} else if (this.data.input) {\n\t\tthis.input = this.parentTemplate().find(this.data.input);\n\t}\n\tif (this.input == null) {\n\t\tconsole.error('Input not found for popup');\n\t}\n\tconst self = this;\n\tself.autorun(() => {\n\t\tconst open = self.open.get();\n\t\tif ($('.reply-preview').length) {\n\t\t\tif (open === true) {\n\t\t\t\t$('.reply-preview').addClass('reply-preview-with-popup');\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t$('#popup').addClass('popup-with-reply-preview');\n\t\t\t\t}, 50);\n\t\t\t}\n\t\t}\n\t\tif (open === false) {\n\t\t\t$('.reply-preview').removeClass('reply-preview-with-popup');\n\t\t\t$('#popup').removeClass('popup-with-reply-preview');\n\t\t}\n\t});\n\t$(this.input).on('keyup', this.onInputKeyup.bind(this));\n\t$(this.input).on('keydown', this.onInputKeydown.bind(this));\n\t$(this.input).on('focus', this.onFocus.bind(this));\n\t$(this.input).on('blur', this.onBlur.bind(this));\n});\n\nTemplate.messagePopup.onDestroyed(function () {\n\t$(this.input).off('keyup', this.onInputKeyup);\n\t$(this.input).off('keydown', this.onInputKeydown);\n\t$(this.input).off('focus', this.onFocus);\n\t$(this.input).off('blur', this.onBlur);\n});\n\nTemplate.messagePopup.events({\n\t'mouseenter .popup-item'(e) {\n\t\tif (e.currentTarget.className.indexOf('selected') > -1) {\n\t\t\treturn;\n\t\t}\n\t\tconst template = Template.instance();\n\t\tconst current = template.find('.popup-item.selected');\n\t\tif (current != null) {\n\t\t\tcurrent.className = current.className.replace(/\\sselected/, '').replace('sidebar-item__popup-active', '');\n\t\t}\n\t\te.currentTarget.className += ' selected sidebar-item__popup-active';\n\t\treturn template.value.set(this._id);\n\t},\n\t'mousedown .popup-item, touchstart .popup-item'() {\n\t\tconst template = Template.instance();\n\t\ttemplate.clickingItem = true;\n\t},\n\t'mouseup .popup-item, touchend .popup-item'(e) {\n\t\te.stopPropagation();\n\t\tconst template = Template.instance();\n\t\tconst wasMenuIconClicked = e.target.classList.contains('sidebar-item__menu-icon');\n\t\ttemplate.clickingItem = false;\n\t\tif (!wasMenuIconClicked) {\n\t\t\ttemplate.value.set(this._id);\n\t\t\ttemplate.enterValue();\n\t\t\ttemplate.open.set(false);\n\t\t}\n\t},\n});\n\nTemplate.messagePopup.helpers({\n\tisOpen() {\n\t\treturn (\n\t\t\tTemplate.instance().open.get() &&\n\t\t\t(Template.instance().hasData.get() ||\n\t\t\t\tTemplate.instance().data.emptyTemplate != null ||\n\t\t\t\t!Template.instance().parentTemplate(1).subscriptionsReady())\n\t\t);\n\t},\n\tdata() {\n\t\tconst template = Template.instance();\n\t\treturn Object.assign(template.records.get(), { toolbar: true });\n\t},\n\ttoolbarData() {\n\t\treturn { ...Template.currentData(), toolbar: true };\n\t},\n\tsidebarHeaderHeight() {\n\t\treturn `${document.querySelector('.sidebar__header').offsetHeight}px`;\n\t},\n\tsidebarWidth() {\n\t\treturn `${document.querySelector('.sidebar').offsetWidth}px`;\n\t},\n});\n"]},"sourceType":"module","hash":"894c94b94e0d620757b1b21cfe01321aac74dd76"}
