{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/webdav/client/webdavFilePicker.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/webdav/client/webdavFilePicker.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/webdav/client/webdavFilePicker.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/webdav/client/webdavFilePicker.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/webdav/client/webdavFilePicker.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 1);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 2);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 3);\nvar Handlebars;\nmodule.link(\"meteor/ui\", {\n  Handlebars: function (v) {\n    Handlebars = v;\n  }\n}, 4);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 5);\nvar ReactiveDict;\nmodule.link(\"meteor/reactive-dict\", {\n  ReactiveDict: function (v) {\n    ReactiveDict = v;\n  }\n}, 6);\nvar timeAgo;\nmodule.link(\"../../ui/client/views/app/helpers\", {\n  timeAgo: function (v) {\n    timeAgo = v;\n  }\n}, 7);\nvar modal;\nmodule.link(\"../../ui-utils/client\", {\n  modal: function (v) {\n    modal = v;\n  }\n}, 8);\nvar t;\nmodule.link(\"../../utils/client\", {\n  t: function (v) {\n    t = v;\n  }\n}, 9);\nvar fileUploadHandler;\nmodule.link(\"../../file-upload/client\", {\n  fileUploadHandler: function (v) {\n    fileUploadHandler = v;\n  }\n}, 10);\nvar call;\nmodule.link(\"../../../client/lib/utils/call\", {\n  call: function (v) {\n    call = v;\n  }\n}, 11);\nvar dispatchToastMessage;\nmodule.link(\"../../../client/lib/toast\", {\n  dispatchToastMessage: function (v) {\n    dispatchToastMessage = v;\n  }\n}, 12);\n\nfunction sortTable(data, sortBy, sortDirection) {\n  if (sortDirection === 'desc') {\n    if (sortBy === 'name') {\n      data.sort(function (a, b) {\n        return b.basename.localeCompare(a.basename);\n      });\n    }\n\n    if (sortBy === 'size') {\n      data.sort(function (a, b) {\n        return b.size - a.size;\n      });\n    }\n\n    if (sortBy === 'date') {\n      data.sort(function (a, b) {\n        return new Date(b.lastmod) - new Date(a.lastmod);\n      });\n    }\n  } else {\n    if (sortBy === 'name') {\n      data.sort(function (a, b) {\n        return a.basename.localeCompare(b.basename);\n      });\n    }\n\n    if (sortBy === 'size') {\n      data.sort(function (a, b) {\n        return a.size - b.size;\n      });\n    }\n\n    if (sortBy === 'date') {\n      data.sort(function (a, b) {\n        return new Date(a.lastmod) - new Date(b.lastmod);\n      });\n    }\n  }\n\n  return data;\n}\n\nfunction showFilePreviews(accountId, nodes) {\n  var promises;\n  return _regeneratorRuntime.async(function () {\n    function showFilePreviews$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!(!Array.isArray(nodes) || !nodes.length)) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 2:\n            promises = nodes.map(function (node, index) {\n              if (node.type !== 'file') {\n                return;\n              }\n\n              return call('getWebdavFilePreview', accountId, node.filename).then(function (res) {\n                var blob = new Blob([res.data], {\n                  type: 'image/png'\n                });\n                var imgURL = URL.createObjectURL(blob);\n                nodes[index].preview = imgURL;\n              }).catch(function (e) {\n                return e;\n              });\n            }).filter(Boolean);\n            return _context.abrupt(\"return\", Promise.all(promises).then(function () {\n              return nodes;\n            }).catch(function (e) {\n              return e;\n            }));\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }\n\n    return showFilePreviews$;\n  }(), null, null, null, Promise);\n}\n\nfunction showWebdavFileList() {\n  var instance, accountId, directory, unfilteredWebdavNodes, response, nodesWithPreviews;\n  return _regeneratorRuntime.async(function () {\n    function showWebdavFileList$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            instance = Template.instance();\n            accountId = instance.data.accountId;\n            directory = instance.state.get('webdavCurrentFolder');\n            instance.isLoading.set(true);\n            instance.state.set({\n              webdavNodes: []\n            });\n            _context2.prev = 5;\n            _context2.next = 8;\n            return _regeneratorRuntime.awrap(call('getWebdavFileList', accountId, directory).catch(function (err) {\n              return console.log(err);\n            }));\n\n          case 8:\n            response = _context2.sent;\n\n            if (!(!response || !response.success)) {\n              _context2.next = 13;\n              break;\n            }\n\n            instance.isLoading.set(false);\n            modal.close();\n            return _context2.abrupt(\"return\");\n\n          case 13:\n            unfilteredWebdavNodes = response.data;\n            instance.state.set({\n              unfilteredWebdavNodes: unfilteredWebdavNodes\n            });\n            $('.js-webdav-search-input').val('');\n            instance.searchText.set('');\n\n          case 17:\n            _context2.prev = 17;\n            instance.isLoading.set(false);\n            _context2.next = 21;\n            return _regeneratorRuntime.awrap(showFilePreviews(accountId, unfilteredWebdavNodes));\n\n          case 21:\n            nodesWithPreviews = _context2.sent;\n\n            if (Array.isArray(nodesWithPreviews) && nodesWithPreviews.length) {\n              instance.state.set({\n                unfilteredWebdavNodes: nodesWithPreviews\n              });\n            }\n\n            return _context2.finish(17);\n\n          case 24:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }\n\n    return showWebdavFileList$;\n  }(), null, null, [[5,, 17, 24]], Promise);\n}\n\nTemplate.webdavFilePicker.helpers({\n  iconType: function () {\n    // add icon for different types\n    var icon = 'clip';\n    var type = '';\n    var extension = this.basename.split('.').pop();\n\n    if (extension === this.basename) {\n      extension = '';\n    }\n\n    if (this.type === 'directory') {\n      icon = 'folder';\n      type = 'directory';\n    } else if (this.mime.match(/application\\/pdf/)) {\n      icon = 'file-pdf';\n      type = 'pdf';\n    } else if (['application/vnd.oasis.opendocument.text', 'application/vnd.oasis.opendocument.presentation'].includes(this.mime)) {\n      icon = 'file-document';\n      type = 'document';\n    } else if (['application/vnd.ms-excel', 'application/vnd.oasis.opendocument.spreadsheet', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'].includes(this.mime)) {\n      icon = 'file-sheets';\n      type = 'sheets';\n    } else if (['application/vnd.ms-powerpoint', 'application/vnd.oasis.opendocument.presentation'].includes(this.mime)) {\n      icon = 'file-sheets';\n      type = 'ppt';\n    }\n\n    return {\n      icon: icon,\n      type: type,\n      extension: extension\n    };\n  },\n  filePreview: function () {\n    return this.preview;\n  },\n  isLoading: function () {\n    return Template.instance().isLoading.get();\n  },\n  listMode: function () {\n    return Template.instance().isListMode.get();\n  },\n  sortBy: function (key) {\n    return Template.instance().sortBy.get() === key;\n  },\n  getSortBy: function () {\n    return Template.instance().sortBy.get();\n  },\n  getName: function (basename) {\n    var maxwidth = Template.instance().isListMode.get() ? 35 : 20;\n\n    if (basename.length < maxwidth) {\n      return basename;\n    }\n\n    return basename.slice(0, maxwidth - 10) + \"\\u2026\" + basename.slice(-7);\n  },\n  getSize: function () {\n    if (this.type === 'directory') {\n      return '';\n    }\n\n    var bytes = this.size;\n\n    if (bytes === 0) {\n      return '0 B';\n    }\n\n    var k = 1024;\n    var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    var i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n  },\n  getDate: function () {\n    return timeAgo(new Date(this.lastmod), t);\n  },\n  sortIcon: function (key) {\n    var _Template$instance = Template.instance(),\n        sortDirection = _Template$instance.sortDirection,\n        sortBy = _Template$instance.sortBy;\n\n    return key === sortBy.get() && sortDirection.get() === 'asc' ? 'sort-up' : 'sort-down';\n  },\n  onTableSort: function () {\n    var _Template$instance2 = Template.instance(),\n        sortDirection = _Template$instance2.sortDirection,\n        sortBy = _Template$instance2.sortBy;\n\n    return function (type) {\n      if (sortBy.get() === type) {\n        sortDirection.set(sortDirection.get() === 'asc' ? 'desc' : 'asc');\n      } else {\n        sortBy.set(type);\n        sortDirection.set('asc');\n      }\n    };\n  },\n  parentFolders: function () {\n    var currentFolder = Template.instance().state.get('webdavCurrentFolder');\n    return currentFolder ? currentFolder.split('/').filter(function (s) {\n      return s;\n    }) : [];\n  },\n  webdavNodes: function () {\n    return Template.instance().state.get('webdavNodes');\n  },\n  webdavCurrentFolder: function () {\n    return Template.instance().state.get('webdavCurrentFolder');\n  }\n});\nTemplate.webdavFilePicker.events({\n  'click .js-list-grid-mode': function () {\n    var instance = Template.instance();\n    instance.isListMode.set(!instance.isListMode.get());\n  },\n  'click .js-webdav-sort-direction': function () {\n    var _Template$instance3 = Template.instance(),\n        sortDirection = _Template$instance3.sortDirection;\n\n    sortDirection.set(sortDirection.get() === 'asc' ? 'desc' : 'asc');\n  },\n  'change .js-webdav-select-sort': function () {\n    var _Template$instance4 = Template.instance(),\n        sortBy = _Template$instance4.sortBy;\n\n    var newSortBy = $('.js-webdav-select-sort').val();\n    sortBy.set(newSortBy);\n  },\n  'click .js-webdav-search-icon': function () {\n    $('.js-webdav-search-input').focus();\n  },\n  'submit .js-search-form': function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n  },\n  'input .js-webdav-search-input': _.debounce(function (e, t) {\n    t.searchText.set(e.currentTarget.value);\n  }, 200),\n  'blur .js-webdav-search-input': function (e, t) {\n    _.delay(function () {\n      e.target.value = '';\n      t.searchText.set('');\n    }, 200);\n  },\n  'click .js-webdav-grid-back-icon': function () {\n    function _callee() {\n      var instance, currentFolder, parentFolder;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                instance = Template.instance();\n                currentFolder = instance.state.get('webdavCurrentFolder'); // determine parent directory to go back\n\n                parentFolder = '/';\n\n                if (currentFolder && currentFolder !== '/') {\n                  if (currentFolder[currentFolder.length - 1] === '/') {\n                    currentFolder = currentFolder.slice(0, -1);\n                  }\n\n                  parentFolder = currentFolder.substr(0, currentFolder.lastIndexOf('/') + 1);\n                }\n\n                instance.state.set('webdavCurrentFolder', parentFolder);\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }\n\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee;\n  }(),\n  'click .js-webdav_directory': function () {\n    function _callee2() {\n      var instance;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                instance = Template.instance();\n                instance.state.set('webdavCurrentFolder', this.filename);\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }\n\n        return _callee2$;\n      }(), null, this, null, Promise);\n    }\n\n    return _callee2;\n  }(),\n  'click .js-webdav-breadcrumb-folder': function () {\n    function _callee3(event) {\n      var instance, index, currentFolder, parentFolders, targetFolder, i;\n      return _regeneratorRuntime.async(function () {\n        function _callee3$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                instance = Template.instance();\n                index = $(event.target).data('index');\n                currentFolder = instance.state.get('webdavCurrentFolder');\n                parentFolders = currentFolder.split('/').filter(function (s) {\n                  return s;\n                }); // determine parent directory to go to\n\n                targetFolder = '/';\n\n                for (i = 0; i <= index; i++) {\n                  targetFolder += parentFolders[i];\n                  targetFolder += '/';\n                }\n\n                instance.state.set('webdavCurrentFolder', targetFolder);\n\n              case 7:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }\n\n        return _callee3$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee3;\n  }(),\n  'click .js-webdav_file': function () {\n    function _callee4() {\n      var roomId, instance, accountId, file, response, blob, text;\n      return _regeneratorRuntime.async(function () {\n        function _callee4$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                roomId = Session.get('openedRoom');\n                instance = Template.instance();\n                accountId = instance.data.accountId;\n                instance.isLoading.set(true);\n                file = this;\n                _context6.next = 7;\n                return _regeneratorRuntime.awrap(call('getFileFromWebdav', accountId, file).catch(function (error) {\n                  console.log(error);\n                }));\n\n              case 7:\n                response = _context6.sent;\n                instance.isLoading.set(false);\n\n                if (!(!response || !response.success)) {\n                  _context6.next = 12;\n                  break;\n                }\n\n                modal.close();\n                return _context6.abrupt(\"return\", dispatchToastMessage({\n                  type: 'error',\n                  message: t('Failed_to_get_webdav_file')\n                }));\n\n              case 12:\n                blob = new Blob([response.data], {\n                  type: response.type\n                }); // converting to file object\n\n                blob.lastModified = file.lastmod;\n                blob.name = file.basename;\n                text = \"\\n\\t\\t\\t<div class='upload-preview-title'>\\n\\t\\t\\t\\t<div class=\\\"rc-input__wrapper\\\">\\n\\t\\t\\t\\t\\t<input class=\\\"rc-input__element\\\" id='file-name' style='display: inherit;' value='\" + Handlebars._escape(blob.name) + \"' placeholder='\" + t('Upload_file_name') + \"'>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t<div class=\\\"rc-input__wrapper\\\">\\n\\t\\t\\t\\t\\t<input class=\\\"rc-input__element\\\" id='file-description' style='display: inherit;' value='' placeholder='\" + t('Upload_file_description') + \"'>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\";\n                return _context6.abrupt(\"return\", modal.open({\n                  title: t('Upload_file_question'),\n                  text: text,\n                  showCancelButton: true,\n                  closeOnConfirm: false,\n                  closeOnCancel: false,\n                  confirmButtonText: t('Send'),\n                  cancelButtonText: t('Cancel'),\n                  html: true,\n                  onRendered: function () {\n                    return $('#file-name').focus();\n                  }\n                }, function (isConfirm) {\n                  var record = {\n                    name: document.getElementById('file-name').value || blob.name,\n                    size: blob.size,\n                    type: blob.type,\n                    rid: roomId,\n                    description: document.getElementById('file-description').value\n                  };\n                  modal.close();\n\n                  if (!isConfirm) {\n                    return;\n                  }\n\n                  var upload = fileUploadHandler('Uploads', record, blob);\n                  var uploading = Session.get('uploading') || [];\n                  uploading.push({\n                    id: upload.id,\n                    name: upload.getFileName(),\n                    percentage: 0\n                  });\n                  Session.set('uploading', uploading);\n\n                  upload.onProgress = function (progress) {\n                    uploading = Session.get('uploading');\n\n                    var item = _.findWhere(uploading, {\n                      id: upload.id\n                    });\n\n                    if (item != null) {\n                      item.percentage = Math.round(progress * 100) || 0;\n                      return Session.set('uploading', uploading);\n                    }\n                  };\n\n                  upload.start(function (error, file, storage) {\n                    if (error) {\n                      var _uploading = Session.get('uploading');\n\n                      if (!Array.isArray(_uploading)) {\n                        _uploading = [];\n                      }\n\n                      var item = _.findWhere(_uploading, {\n                        id: upload.id\n                      });\n\n                      if (_.isObject(item)) {\n                        item.error = error.message;\n                        item.percentage = 0;\n                      } else {\n                        _uploading.push({\n                          error: error.error,\n                          percentage: 0\n                        });\n                      }\n\n                      return Session.set('uploading', _uploading);\n                    }\n\n                    if (file) {\n                      Meteor.call('sendFileMessage', roomId, storage, file, function () {\n                        setTimeout(function () {\n                          var uploading = Session.get('uploading');\n\n                          if (uploading !== null) {\n                            var _item = _.findWhere(uploading, {\n                              id: upload.id\n                            });\n\n                            return Session.set('uploading', _.without(uploading, _item));\n                          }\n                        }, 2000);\n                      });\n                    }\n                  });\n                }));\n\n              case 17:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }\n\n        return _callee4$;\n      }(), null, this, null, Promise);\n    }\n\n    return _callee4;\n  }()\n});\nTemplate.webdavFilePicker.onRendered(function () {\n  function _callee5() {\n    var _this = this;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee5$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              this.autorun(function () {\n                showWebdavFileList();\n              });\n              this.autorun(function () {\n                var _Template$instance5 = Template.instance(),\n                    sortDirection = _Template$instance5.sortDirection,\n                    sortBy = _Template$instance5.sortBy;\n\n                var data = sortTable(_this.state.get('webdavNodes'), sortBy.get(), sortDirection.get());\n\n                _this.state.set('webdavNodes', data);\n              });\n              this.autorun(function () {\n                var loading = _this.isLoading.get();\n\n                if (loading) {\n                  return;\n                }\n\n                var input = _this.searchText.get();\n\n                var regex = new RegExp(\"\\\\b\" + input, 'i');\n\n                var data = _this.state.get('unfilteredWebdavNodes').filter(function (_ref) {\n                  var basename = _ref.basename;\n                  return basename.match(regex);\n                });\n\n                _this.state.set('webdavNodes', data);\n              });\n\n            case 3:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }\n\n      return _callee5$;\n    }(), null, this, null, Promise);\n  }\n\n  return _callee5;\n}());\nTemplate.webdavFilePicker.onCreated(function () {\n  this.state = new ReactiveDict({\n    webdavCurrentFolder: '/',\n    webdavNodes: [],\n    unfilteredWebdavNodes: []\n  });\n  this.isLoading = new ReactiveVar(true);\n  this.isListMode = new ReactiveVar(true);\n  this.sortBy = new ReactiveVar('name');\n  this.sortDirection = new ReactiveVar('asc');\n  this.searchText = new ReactiveVar('');\n});","map":{"version":3,"sources":["app/webdav/client/webdavFilePicker.js"],"names":["_regeneratorRuntime","module","link","default","v","Meteor","Template","_","Session","Handlebars","ReactiveVar","ReactiveDict","timeAgo","modal","t","fileUploadHandler","call","dispatchToastMessage","sortTable","data","sortBy","sortDirection","sort","a","b","basename","localeCompare","size","Date","lastmod","showFilePreviews","accountId","nodes","Array","isArray","length","promises","map","node","index","type","filename","then","res","blob","Blob","imgURL","URL","createObjectURL","preview","catch","e","filter","Boolean","Promise","all","showWebdavFileList","instance","directory","state","get","isLoading","set","webdavNodes","err","console","log","response","success","close","unfilteredWebdavNodes","$","val","searchText","nodesWithPreviews","webdavFilePicker","helpers","iconType","icon","extension","split","pop","mime","match","includes","filePreview","listMode","isListMode","key","getSortBy","getName","maxwidth","slice","getSize","bytes","k","sizes","i","Math","floor","parseFloat","pow","toFixed","getDate","sortIcon","onTableSort","parentFolders","currentFolder","s","webdavCurrentFolder","events","newSortBy","focus","preventDefault","stopPropagation","debounce","currentTarget","value","delay","target","parentFolder","substr","lastIndexOf","event","targetFolder","roomId","file","error","message","lastModified","name","text","_escape","open","title","showCancelButton","closeOnConfirm","closeOnCancel","confirmButtonText","cancelButtonText","html","onRendered","isConfirm","record","document","getElementById","rid","description","upload","uploading","push","id","getFileName","percentage","onProgress","progress","item","findWhere","round","start","storage","isObject","setTimeout","without","autorun","loading","input","regex","RegExp","onCreated"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\nimport { Session } from 'meteor/session';\nimport { Handlebars } from 'meteor/ui';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { ReactiveDict } from 'meteor/reactive-dict';\n\nimport { timeAgo } from '../../ui/client/views/app/helpers';\nimport { modal } from '../../ui-utils/client';\nimport { t } from '../../utils/client';\nimport { fileUploadHandler } from '../../file-upload/client';\nimport { call } from '../../../client/lib/utils/call';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\n\nfunction sortTable(data, sortBy, sortDirection) {\n\tif (sortDirection === 'desc') {\n\t\tif (sortBy === 'name') {\n\t\t\tdata.sort((a, b) => b.basename.localeCompare(a.basename));\n\t\t}\n\t\tif (sortBy === 'size') {\n\t\t\tdata.sort((a, b) => b.size - a.size);\n\t\t}\n\t\tif (sortBy === 'date') {\n\t\t\tdata.sort((a, b) => new Date(b.lastmod) - new Date(a.lastmod));\n\t\t}\n\t} else {\n\t\tif (sortBy === 'name') {\n\t\t\tdata.sort((a, b) => a.basename.localeCompare(b.basename));\n\t\t}\n\t\tif (sortBy === 'size') {\n\t\t\tdata.sort((a, b) => a.size - b.size);\n\t\t}\n\t\tif (sortBy === 'date') {\n\t\t\tdata.sort((a, b) => new Date(a.lastmod) - new Date(b.lastmod));\n\t\t}\n\t}\n\treturn data;\n}\n\nasync function showFilePreviews(accountId, nodes) {\n\tif (!Array.isArray(nodes) || !nodes.length) {\n\t\treturn;\n\t}\n\tconst promises = nodes\n\t\t.map((node, index) => {\n\t\t\tif (node.type !== 'file') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn call('getWebdavFilePreview', accountId, node.filename)\n\t\t\t\t.then((res) => {\n\t\t\t\t\tconst blob = new Blob([res.data], { type: 'image/png' });\n\t\t\t\t\tconst imgURL = URL.createObjectURL(blob);\n\t\t\t\t\tnodes[index].preview = imgURL;\n\t\t\t\t})\n\t\t\t\t.catch((e) => e);\n\t\t})\n\t\t.filter(Boolean);\n\n\treturn Promise.all(promises)\n\t\t.then(() => nodes)\n\t\t.catch((e) => e);\n}\n\nasync function showWebdavFileList() {\n\tconst instance = Template.instance();\n\tconst { accountId } = instance.data;\n\n\tconst directory = instance.state.get('webdavCurrentFolder');\n\tlet unfilteredWebdavNodes;\n\tinstance.isLoading.set(true);\n\tinstance.state.set({\n\t\twebdavNodes: [],\n\t});\n\ttry {\n\t\tconst response = await call('getWebdavFileList', accountId, directory).catch((err) => console.log(err));\n\t\tif (!response || !response.success) {\n\t\t\tinstance.isLoading.set(false);\n\t\t\tmodal.close();\n\t\t\treturn;\n\t\t}\n\t\tunfilteredWebdavNodes = response.data;\n\t\tinstance.state.set({ unfilteredWebdavNodes });\n\t\t$('.js-webdav-search-input').val('');\n\t\tinstance.searchText.set('');\n\t} finally {\n\t\tinstance.isLoading.set(false);\n\t\tconst nodesWithPreviews = await showFilePreviews(accountId, unfilteredWebdavNodes);\n\t\tif (Array.isArray(nodesWithPreviews) && nodesWithPreviews.length) {\n\t\t\tinstance.state.set({ unfilteredWebdavNodes: nodesWithPreviews });\n\t\t}\n\t}\n}\n\nTemplate.webdavFilePicker.helpers({\n\ticonType() {\n\t\t// add icon for different types\n\t\tlet icon = 'clip';\n\t\tlet type = '';\n\n\t\tlet extension = this.basename.split('.').pop();\n\t\tif (extension === this.basename) {\n\t\t\textension = '';\n\t\t}\n\n\t\tif (this.type === 'directory') {\n\t\t\ticon = 'folder';\n\t\t\ttype = 'directory';\n\t\t} else if (this.mime.match(/application\\/pdf/)) {\n\t\t\ticon = 'file-pdf';\n\t\t\ttype = 'pdf';\n\t\t} else if (['application/vnd.oasis.opendocument.text', 'application/vnd.oasis.opendocument.presentation'].includes(this.mime)) {\n\t\t\ticon = 'file-document';\n\t\t\ttype = 'document';\n\t\t} else if (\n\t\t\t[\n\t\t\t\t'application/vnd.ms-excel',\n\t\t\t\t'application/vnd.oasis.opendocument.spreadsheet',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n\t\t\t].includes(this.mime)\n\t\t) {\n\t\t\ticon = 'file-sheets';\n\t\t\ttype = 'sheets';\n\t\t} else if (['application/vnd.ms-powerpoint', 'application/vnd.oasis.opendocument.presentation'].includes(this.mime)) {\n\t\t\ticon = 'file-sheets';\n\t\t\ttype = 'ppt';\n\t\t}\n\t\treturn { icon, type, extension };\n\t},\n\tfilePreview() {\n\t\treturn this.preview;\n\t},\n\tisLoading() {\n\t\treturn Template.instance().isLoading.get();\n\t},\n\tlistMode() {\n\t\treturn Template.instance().isListMode.get();\n\t},\n\tsortBy(key) {\n\t\treturn Template.instance().sortBy.get() === key;\n\t},\n\tgetSortBy() {\n\t\treturn Template.instance().sortBy.get();\n\t},\n\tgetName(basename) {\n\t\tconst maxwidth = Template.instance().isListMode.get() ? 35 : 20;\n\t\tif (basename.length < maxwidth) {\n\t\t\treturn basename;\n\t\t}\n\t\treturn `${basename.slice(0, maxwidth - 10)}\\u2026${basename.slice(-7)}`;\n\t},\n\tgetSize() {\n\t\tif (this.type === 'directory') {\n\t\t\treturn '';\n\t\t}\n\t\tconst bytes = this.size;\n\t\tif (bytes === 0) {\n\t\t\treturn '0 B';\n\t\t}\n\t\tconst k = 1024;\n\t\tconst sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\t\tconst i = Math.floor(Math.log(bytes) / Math.log(k));\n\t\treturn `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;\n\t},\n\tgetDate() {\n\t\treturn timeAgo(new Date(this.lastmod), t);\n\t},\n\tsortIcon(key) {\n\t\tconst { sortDirection, sortBy } = Template.instance();\n\t\treturn key === sortBy.get() && sortDirection.get() === 'asc' ? 'sort-up' : 'sort-down';\n\t},\n\tonTableSort() {\n\t\tconst { sortDirection, sortBy } = Template.instance();\n\t\treturn function (type) {\n\t\t\tif (sortBy.get() === type) {\n\t\t\t\tsortDirection.set(sortDirection.get() === 'asc' ? 'desc' : 'asc');\n\t\t\t} else {\n\t\t\t\tsortBy.set(type);\n\t\t\t\tsortDirection.set('asc');\n\t\t\t}\n\t\t};\n\t},\n\tparentFolders() {\n\t\tconst currentFolder = Template.instance().state.get('webdavCurrentFolder');\n\t\treturn currentFolder ? currentFolder.split('/').filter((s) => s) : [];\n\t},\n\twebdavNodes() {\n\t\treturn Template.instance().state.get('webdavNodes');\n\t},\n\twebdavCurrentFolder() {\n\t\treturn Template.instance().state.get('webdavCurrentFolder');\n\t},\n});\n\nTemplate.webdavFilePicker.events({\n\t'click .js-list-grid-mode'() {\n\t\tconst instance = Template.instance();\n\t\tinstance.isListMode.set(!instance.isListMode.get());\n\t},\n\t'click .js-webdav-sort-direction'() {\n\t\tconst { sortDirection } = Template.instance();\n\t\tsortDirection.set(sortDirection.get() === 'asc' ? 'desc' : 'asc');\n\t},\n\t'change .js-webdav-select-sort'() {\n\t\tconst { sortBy } = Template.instance();\n\t\tconst newSortBy = $('.js-webdav-select-sort').val();\n\t\tsortBy.set(newSortBy);\n\t},\n\t'click .js-webdav-search-icon'() {\n\t\t$('.js-webdav-search-input').focus();\n\t},\n\t'submit .js-search-form'(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t},\n\t'input .js-webdav-search-input': _.debounce((e, t) => {\n\t\tt.searchText.set(e.currentTarget.value);\n\t}, 200),\n\t'blur .js-webdav-search-input'(e, t) {\n\t\t_.delay(() => {\n\t\t\te.target.value = '';\n\t\t\tt.searchText.set('');\n\t\t}, 200);\n\t},\n\tasync 'click .js-webdav-grid-back-icon'() {\n\t\tconst instance = Template.instance();\n\n\t\tlet currentFolder = instance.state.get('webdavCurrentFolder');\n\t\t// determine parent directory to go back\n\t\tlet parentFolder = '/';\n\t\tif (currentFolder && currentFolder !== '/') {\n\t\t\tif (currentFolder[currentFolder.length - 1] === '/') {\n\t\t\t\tcurrentFolder = currentFolder.slice(0, -1);\n\t\t\t}\n\t\t\tparentFolder = currentFolder.substr(0, currentFolder.lastIndexOf('/') + 1);\n\t\t}\n\t\tinstance.state.set('webdavCurrentFolder', parentFolder);\n\t},\n\tasync 'click .js-webdav_directory'() {\n\t\tconst instance = Template.instance();\n\t\tinstance.state.set('webdavCurrentFolder', this.filename);\n\t},\n\tasync 'click .js-webdav-breadcrumb-folder'(event) {\n\t\tconst instance = Template.instance();\n\t\tconst index = $(event.target).data('index');\n\t\tconst currentFolder = instance.state.get('webdavCurrentFolder');\n\t\tconst parentFolders = currentFolder.split('/').filter((s) => s);\n\t\t// determine parent directory to go to\n\t\tlet targetFolder = '/';\n\t\tfor (let i = 0; i <= index; i++) {\n\t\t\ttargetFolder += parentFolders[i];\n\t\t\ttargetFolder += '/';\n\t\t}\n\t\tinstance.state.set('webdavCurrentFolder', targetFolder);\n\t},\n\tasync 'click .js-webdav_file'() {\n\t\tconst roomId = Session.get('openedRoom');\n\t\tconst instance = Template.instance();\n\t\tconst { accountId } = instance.data;\n\t\tinstance.isLoading.set(true);\n\t\tconst file = this;\n\t\tconst response = await call('getFileFromWebdav', accountId, file).catch((error) => {\n\t\t\tconsole.log(error);\n\t\t});\n\t\tinstance.isLoading.set(false);\n\t\tif (!response || !response.success) {\n\t\t\tmodal.close();\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Failed_to_get_webdav_file') });\n\t\t}\n\t\tconst blob = new Blob([response.data], { type: response.type });\n\t\t// converting to file object\n\t\tblob.lastModified = file.lastmod;\n\t\tblob.name = file.basename;\n\t\tconst text = `\n\t\t\t<div class='upload-preview-title'>\n\t\t\t\t<div class=\"rc-input__wrapper\">\n\t\t\t\t\t<input class=\"rc-input__element\" id='file-name' style='display: inherit;' value='${Handlebars._escape(blob.name)}' placeholder='${t(\n\t\t\t'Upload_file_name',\n\t\t)}'>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"rc-input__wrapper\">\n\t\t\t\t\t<input class=\"rc-input__element\" id='file-description' style='display: inherit;' value='' placeholder='${t('Upload_file_description')}'>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\treturn modal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Upload_file_question'),\n\t\t\t\ttext,\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tcloseOnConfirm: false,\n\t\t\t\tcloseOnCancel: false,\n\t\t\t\tconfirmButtonText: t('Send'),\n\t\t\t\tcancelButtonText: t('Cancel'),\n\t\t\t\thtml: true,\n\t\t\t\tonRendered: () => $('#file-name').focus(),\n\t\t\t},\n\t\t\tfunction (isConfirm) {\n\t\t\t\tconst record = {\n\t\t\t\t\tname: document.getElementById('file-name').value || blob.name,\n\t\t\t\t\tsize: blob.size,\n\t\t\t\t\ttype: blob.type,\n\t\t\t\t\trid: roomId,\n\t\t\t\t\tdescription: document.getElementById('file-description').value,\n\t\t\t\t};\n\t\t\t\tmodal.close();\n\n\t\t\t\tif (!isConfirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst upload = fileUploadHandler('Uploads', record, blob);\n\n\t\t\t\tlet uploading = Session.get('uploading') || [];\n\t\t\t\tuploading.push({\n\t\t\t\t\tid: upload.id,\n\t\t\t\t\tname: upload.getFileName(),\n\t\t\t\t\tpercentage: 0,\n\t\t\t\t});\n\n\t\t\t\tSession.set('uploading', uploading);\n\n\t\t\t\tupload.onProgress = function (progress) {\n\t\t\t\t\tuploading = Session.get('uploading');\n\n\t\t\t\t\tconst item = _.findWhere(uploading, { id: upload.id });\n\t\t\t\t\tif (item != null) {\n\t\t\t\t\t\titem.percentage = Math.round(progress * 100) || 0;\n\t\t\t\t\t\treturn Session.set('uploading', uploading);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tupload.start(function (error, file, storage) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlet uploading = Session.get('uploading');\n\t\t\t\t\t\tif (!Array.isArray(uploading)) {\n\t\t\t\t\t\t\tuploading = [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst item = _.findWhere(uploading, { id: upload.id });\n\n\t\t\t\t\t\tif (_.isObject(item)) {\n\t\t\t\t\t\t\titem.error = error.message;\n\t\t\t\t\t\t\titem.percentage = 0;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuploading.push({\n\t\t\t\t\t\t\t\terror: error.error,\n\t\t\t\t\t\t\t\tpercentage: 0,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Session.set('uploading', uploading);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\tMeteor.call('sendFileMessage', roomId, storage, file, () => {\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tconst uploading = Session.get('uploading');\n\t\t\t\t\t\t\t\tif (uploading !== null) {\n\t\t\t\t\t\t\t\t\tconst item = _.findWhere(uploading, {\n\t\t\t\t\t\t\t\t\t\tid: upload.id,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\treturn Session.set('uploading', _.without(uploading, item));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t},\n});\n\nTemplate.webdavFilePicker.onRendered(async function () {\n\tthis.autorun(() => {\n\t\tshowWebdavFileList();\n\t});\n\n\tthis.autorun(() => {\n\t\tconst { sortDirection, sortBy } = Template.instance();\n\t\tconst data = sortTable(this.state.get('webdavNodes'), sortBy.get(), sortDirection.get());\n\t\tthis.state.set('webdavNodes', data);\n\t});\n\n\tthis.autorun(() => {\n\t\tconst loading = this.isLoading.get();\n\t\tif (loading) {\n\t\t\treturn;\n\t\t}\n\t\tconst input = this.searchText.get();\n\t\tconst regex = new RegExp(`\\\\b${input}`, 'i');\n\t\tconst data = this.state.get('unfilteredWebdavNodes').filter(({ basename }) => basename.match(regex));\n\t\tthis.state.set('webdavNodes', data);\n\t});\n});\n\nTemplate.webdavFilePicker.onCreated(function () {\n\tthis.state = new ReactiveDict({\n\t\twebdavCurrentFolder: '/',\n\t\twebdavNodes: [],\n\t\tunfilteredWebdavNodes: [],\n\t});\n\tthis.isLoading = new ReactiveVar(true);\n\tthis.isListMode = new ReactiveVar(true);\n\tthis.sortBy = new ReactiveVar('name');\n\tthis.sortDirection = new ReactiveVar('asc');\n\tthis.searchText = new ReactiveVar('');\n});\n"]},"sourceType":"module","hash":"638af3817e9fdb8cd971334a2fa5ed006d0de58a"}
