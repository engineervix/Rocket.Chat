{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/directory/chats/contextualBar/ChatInfo.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/omnichannel/directory/chats/contextualBar/ChatInfo.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/directory/chats/contextualBar/ChatInfo.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/omnichannel/directory/chats/contextualBar/ChatInfo.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/omnichannel/directory/chats/contextualBar/ChatInfo.js"}},"code":"var _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nvar Box, Margins, Tag, Button, Icon, ButtonGroup;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box: function (v) {\n    Box = v;\n  },\n  Margins: function (v) {\n    Margins = v;\n  },\n  Tag: function (v) {\n    Tag = v;\n  },\n  Button: function (v) {\n    Button = v;\n  },\n  Icon: function (v) {\n    Icon = v;\n  },\n  ButtonGroup: function (v) {\n    ButtonGroup = v;\n  }\n}, 0);\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 1);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar moment;\nmodule.link(\"moment\", {\n  \"default\": function (v) {\n    moment = v;\n  }\n}, 3);\nvar React, useEffect, useState;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useState: function (v) {\n    useState = v;\n  }\n}, 4);\nvar hasPermission;\nmodule.link(\"../../../../../../app/authorization/client\", {\n  hasPermission: function (v) {\n    hasPermission = v;\n  }\n}, 5);\nvar VerticalBar;\nmodule.link(\"../../../../../components/VerticalBar\", {\n  \"default\": function (v) {\n    VerticalBar = v;\n  }\n}, 6);\nvar useRoute;\nmodule.link(\"../../../../../contexts/RouterContext\", {\n  useRoute: function (v) {\n    useRoute = v;\n  }\n}, 7);\nvar useToastMessageDispatch;\nmodule.link(\"../../../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch: function (v) {\n    useToastMessageDispatch = v;\n  }\n}, 8);\nvar useTranslation;\nmodule.link(\"../../../../../contexts/TranslationContext\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 9);\nvar useUserSubscription;\nmodule.link(\"../../../../../contexts/UserContext\", {\n  useUserSubscription: function (v) {\n    useUserSubscription = v;\n  }\n}, 10);\nvar useEndpointData;\nmodule.link(\"../../../../../hooks/useEndpointData\", {\n  useEndpointData: function (v) {\n    useEndpointData = v;\n  }\n}, 11);\nvar useFormatDateAndTime;\nmodule.link(\"../../../../../hooks/useFormatDateAndTime\", {\n  useFormatDateAndTime: function (v) {\n    useFormatDateAndTime = v;\n  }\n}, 12);\nvar useFormatDuration;\nmodule.link(\"../../../../../hooks/useFormatDuration\", {\n  useFormatDuration: function (v) {\n    useFormatDuration = v;\n  }\n}, 13);\nvar useOmnichannelRoom;\nmodule.link(\"../../../../room/contexts/RoomContext\", {\n  useOmnichannelRoom: function (v) {\n    useOmnichannelRoom = v;\n  }\n}, 14);\nvar CustomField;\nmodule.link(\"../../../components/CustomField\", {\n  \"default\": function (v) {\n    CustomField = v;\n  }\n}, 15);\nvar Field;\nmodule.link(\"../../../components/Field\", {\n  \"default\": function (v) {\n    Field = v;\n  }\n}, 16);\nvar Info;\nmodule.link(\"../../../components/Info\", {\n  \"default\": function (v) {\n    Info = v;\n  }\n}, 17);\nvar Label;\nmodule.link(\"../../../components/Label\", {\n  \"default\": function (v) {\n    Label = v;\n  }\n}, 18);\nvar AgentField;\nmodule.link(\"./AgentField\", {\n  \"default\": function (v) {\n    AgentField = v;\n  }\n}, 19);\nvar ContactField;\nmodule.link(\"./ContactField\", {\n  \"default\": function (v) {\n    ContactField = v;\n  }\n}, 20);\nvar DepartmentField;\nmodule.link(\"./DepartmentField\", {\n  \"default\": function (v) {\n    DepartmentField = v;\n  }\n}, 21);\nvar PriorityField;\nmodule.link(\"./PriorityField\", {\n  \"default\": function (v) {\n    PriorityField = v;\n  }\n}, 22);\nvar SourceField;\nmodule.link(\"./SourceField\", {\n  \"default\": function (v) {\n    SourceField = v;\n  }\n}, 23);\nvar VisitorClientInfo;\nmodule.link(\"./VisitorClientInfo\", {\n  \"default\": function (v) {\n    VisitorClientInfo = v;\n  }\n}, 24);\n\n// TODO: Remove moment we are mixing moment and our own formatters :sadface:\nfunction ChatInfo(_ref) {\n  var _metrics$response;\n\n  var id = _ref.id,\n      route = _ref.route;\n  var t = useTranslation();\n  var formatDateAndTime = useFormatDateAndTime();\n\n  var _useEndpointData = useEndpointData('livechat/custom-fields'),\n      allCustomFields = _useEndpointData.value,\n      stateCustomFields = _useEndpointData.phase;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      customFields = _useState2[0],\n      setCustomFields = _useState2[1];\n\n  var formatDuration = useFormatDuration();\n  var room = useOmnichannelRoom();\n\n  var _ref2 = room || {\n    room: {\n      v: {}\n    }\n  },\n      ts = _ref2.ts,\n      tags = _ref2.tags,\n      closedAt = _ref2.closedAt,\n      departmentId = _ref2.departmentId,\n      v = _ref2.v,\n      servedBy = _ref2.servedBy,\n      metrics = _ref2.metrics,\n      topic = _ref2.topic,\n      waitingResponse = _ref2.waitingResponse,\n      responseBy = _ref2.responseBy,\n      priorityId = _ref2.priorityId,\n      livechatData = _ref2.livechatData,\n      source = _ref2.source,\n      queuedAt = _ref2.queuedAt;\n\n  var routePath = useRoute(route || 'omnichannel-directory'); // TODO: use hook instead\n\n  var canViewCustomFields = function () {\n    return hasPermission('view-livechat-room-customfields');\n  };\n\n  var subscription = useUserSubscription(id); // TODO: use hook instead\n\n  var hasGlobalEditRoomPermission = hasPermission('save-others-livechat-room-info');\n  var hasLocalEditRoomPermission = (servedBy === null || servedBy === void 0 ? void 0 : servedBy._id) === Meteor.userId();\n  var visitorId = v === null || v === void 0 ? void 0 : v._id;\n  var queueStartedAt = queuedAt || ts;\n  var dispatchToastMessage = useToastMessageDispatch();\n  useEffect(function () {\n    if (allCustomFields) {\n      var customFieldsAPI = allCustomFields.customFields;\n      setCustomFields(customFieldsAPI);\n    }\n  }, [allCustomFields, stateCustomFields]);\n\n  var checkIsVisibleAndScopeRoom = function (key) {\n    var field = customFields.find(function (_ref3) {\n      var _id = _ref3._id;\n      return _id === key;\n    });\n\n    if (field && field.visibility === 'visible' && field.scope === 'room') {\n      return true;\n    }\n\n    return false;\n  };\n\n  var onEditClick = useMutableCallback(function () {\n    var hasEditAccess = !!subscription || hasLocalEditRoomPermission || hasGlobalEditRoomPermission;\n\n    if (!hasEditAccess) {\n      return dispatchToastMessage({\n        type: 'error',\n        message: t('Not_authorized')\n      });\n    }\n\n    routePath.push(route ? {\n      tab: 'room-info',\n      context: 'edit',\n      id: id\n    } : {\n      page: 'chats',\n      id: id,\n      bar: 'edit'\n    });\n  });\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(VerticalBar.ScrollableContent, {\n    p: \"x24\"\n  }, /*#__PURE__*/React.createElement(Margins, {\n    block: \"x4\"\n  }, source && /*#__PURE__*/React.createElement(SourceField, {\n    room: room\n  }), room && v && /*#__PURE__*/React.createElement(ContactField, {\n    contact: v,\n    room: room\n  }), visitorId && /*#__PURE__*/React.createElement(VisitorClientInfo, {\n    uid: visitorId\n  }), servedBy && /*#__PURE__*/React.createElement(AgentField, {\n    agent: servedBy\n  }), departmentId && /*#__PURE__*/React.createElement(DepartmentField, {\n    departmentId: departmentId\n  }), tags && tags.length > 0 && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Tags')), /*#__PURE__*/React.createElement(Info, null, tags.map(function (tag) {\n    return /*#__PURE__*/React.createElement(Box, {\n      key: tag,\n      mie: \"x4\",\n      display: \"inline\"\n    }, /*#__PURE__*/React.createElement(Tag, {\n      style: {\n        display: 'inline'\n      },\n      disabled: true\n    }, tag));\n  }))), topic && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Topic')), /*#__PURE__*/React.createElement(Info, null, topic)), queueStartedAt && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Queue_Time')), servedBy ? /*#__PURE__*/React.createElement(Info, null, moment(servedBy.ts).from(moment(queueStartedAt), true)) : /*#__PURE__*/React.createElement(Info, null, moment(queueStartedAt).fromNow(true))), closedAt && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Chat_Duration')), /*#__PURE__*/React.createElement(Info, null, moment(closedAt).from(moment(ts), true))), ts && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Created_at')), /*#__PURE__*/React.createElement(Info, null, formatDateAndTime(ts))), closedAt && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Closed_At')), /*#__PURE__*/React.createElement(Info, null, formatDateAndTime(closedAt))), (servedBy === null || servedBy === void 0 ? void 0 : servedBy.ts) && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Taken_at')), /*#__PURE__*/React.createElement(Info, null, formatDateAndTime(servedBy.ts))), (metrics === null || metrics === void 0 ? void 0 : (_metrics$response = metrics.response) === null || _metrics$response === void 0 ? void 0 : _metrics$response.avg) && formatDuration(metrics.response.avg) && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Avg_response_time')), /*#__PURE__*/React.createElement(Info, null, formatDuration(metrics.response.avg))), !waitingResponse && (responseBy === null || responseBy === void 0 ? void 0 : responseBy.lastMessageTs) && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Label, null, t('Inactivity_Time')), /*#__PURE__*/React.createElement(Info, null, moment(responseBy.lastMessageTs).fromNow(true))), canViewCustomFields() && livechatData && Object.keys(livechatData).map(function (key) {\n    return checkIsVisibleAndScopeRoom(key) && livechatData[key] && /*#__PURE__*/React.createElement(CustomField, {\n      key: key,\n      id: key,\n      value: livechatData[key]\n    });\n  }), priorityId && /*#__PURE__*/React.createElement(PriorityField, {\n    id: priorityId\n  }))), /*#__PURE__*/React.createElement(VerticalBar.Footer, null, /*#__PURE__*/React.createElement(ButtonGroup, {\n    stretch: true\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onEditClick\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"pencil\",\n    size: \"x20\"\n  }), \" \", t('Edit')))));\n}\n\nmodule.exportDefault(ChatInfo);","map":{"version":3,"sources":["client/views/omnichannel/directory/chats/contextualBar/ChatInfo.js"],"names":["_slicedToArray","module","link","default","v","Box","Margins","Tag","Button","Icon","ButtonGroup","useMutableCallback","Meteor","moment","React","useEffect","useState","hasPermission","VerticalBar","useRoute","useToastMessageDispatch","useTranslation","useUserSubscription","useEndpointData","useFormatDateAndTime","useFormatDuration","useOmnichannelRoom","CustomField","Field","Info","Label","AgentField","ContactField","DepartmentField","PriorityField","SourceField","VisitorClientInfo","ChatInfo","id","route","t","formatDateAndTime","allCustomFields","value","stateCustomFields","phase","customFields","setCustomFields","formatDuration","room","ts","tags","closedAt","departmentId","servedBy","metrics","topic","waitingResponse","responseBy","priorityId","livechatData","source","queuedAt","routePath","canViewCustomFields","subscription","hasGlobalEditRoomPermission","hasLocalEditRoomPermission","_id","userId","visitorId","queueStartedAt","dispatchToastMessage","customFieldsAPI","checkIsVisibleAndScopeRoom","key","field","find","visibility","scope","onEditClick","hasEditAccess","type","message","push","tab","context","page","bar","length","map","tag","display","from","fromNow","response","avg","lastMessageTs","Object","keys","exportDefault"],"mappings":"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","sourcesContent":["import { Box, Margins, Tag, Button, Icon, ButtonGroup } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { Meteor } from 'meteor/meteor';\nimport moment from 'moment';\nimport React, { useEffect, useState } from 'react';\n\nimport { hasPermission } from '../../../../../../app/authorization/client';\nimport VerticalBar from '../../../../../components/VerticalBar';\nimport { useRoute } from '../../../../../contexts/RouterContext';\nimport { useToastMessageDispatch } from '../../../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../../../contexts/TranslationContext';\nimport { useUserSubscription } from '../../../../../contexts/UserContext';\nimport { useEndpointData } from '../../../../../hooks/useEndpointData';\nimport { useFormatDateAndTime } from '../../../../../hooks/useFormatDateAndTime';\nimport { useFormatDuration } from '../../../../../hooks/useFormatDuration';\nimport { useOmnichannelRoom } from '../../../../room/contexts/RoomContext';\nimport CustomField from '../../../components/CustomField';\nimport Field from '../../../components/Field';\nimport Info from '../../../components/Info';\nimport Label from '../../../components/Label';\nimport AgentField from './AgentField';\nimport ContactField from './ContactField';\nimport DepartmentField from './DepartmentField';\nimport PriorityField from './PriorityField';\nimport SourceField from './SourceField';\nimport VisitorClientInfo from './VisitorClientInfo';\n\n// TODO: Remove moment we are mixing moment and our own formatters :sadface:\nfunction ChatInfo({ id, route }) {\n\tconst t = useTranslation();\n\n\tconst formatDateAndTime = useFormatDateAndTime();\n\tconst { value: allCustomFields, phase: stateCustomFields } = useEndpointData('livechat/custom-fields');\n\tconst [customFields, setCustomFields] = useState([]);\n\tconst formatDuration = useFormatDuration();\n\n\tconst room = useOmnichannelRoom();\n\n\tconst {\n\t\tts,\n\t\ttags,\n\t\tclosedAt,\n\t\tdepartmentId,\n\t\tv,\n\t\tservedBy,\n\t\tmetrics,\n\t\ttopic,\n\t\twaitingResponse,\n\t\tresponseBy,\n\t\tpriorityId,\n\t\tlivechatData,\n\t\tsource,\n\t\tqueuedAt,\n\t} = room || { room: { v: {} } };\n\n\tconst routePath = useRoute(route || 'omnichannel-directory');\n\t// TODO: use hook instead\n\tconst canViewCustomFields = () => hasPermission('view-livechat-room-customfields');\n\tconst subscription = useUserSubscription(id);\n\t// TODO: use hook instead\n\tconst hasGlobalEditRoomPermission = hasPermission('save-others-livechat-room-info');\n\tconst hasLocalEditRoomPermission = servedBy?._id === Meteor.userId();\n\tconst visitorId = v?._id;\n\tconst queueStartedAt = queuedAt || ts;\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tuseEffect(() => {\n\t\tif (allCustomFields) {\n\t\t\tconst { customFields: customFieldsAPI } = allCustomFields;\n\t\t\tsetCustomFields(customFieldsAPI);\n\t\t}\n\t}, [allCustomFields, stateCustomFields]);\n\n\tconst checkIsVisibleAndScopeRoom = (key) => {\n\t\tconst field = customFields.find(({ _id }) => _id === key);\n\t\tif (field && field.visibility === 'visible' && field.scope === 'room') {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tconst onEditClick = useMutableCallback(() => {\n\t\tconst hasEditAccess = !!subscription || hasLocalEditRoomPermission || hasGlobalEditRoomPermission;\n\t\tif (!hasEditAccess) {\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Not_authorized') });\n\t\t}\n\n\t\troutePath.push(\n\t\t\troute\n\t\t\t\t? {\n\t\t\t\t\t\ttab: 'room-info',\n\t\t\t\t\t\tcontext: 'edit',\n\t\t\t\t\t\tid,\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\tpage: 'chats',\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tbar: 'edit',\n\t\t\t\t  },\n\t\t);\n\t});\n\n\treturn (\n\t\t<>\n\t\t\t<VerticalBar.ScrollableContent p='x24'>\n\t\t\t\t<Margins block='x4'>\n\t\t\t\t\t{source && <SourceField room={room} />}\n\t\t\t\t\t{room && v && <ContactField contact={v} room={room} />}\n\t\t\t\t\t{visitorId && <VisitorClientInfo uid={visitorId} />}\n\t\t\t\t\t{servedBy && <AgentField agent={servedBy} />}\n\t\t\t\t\t{departmentId && <DepartmentField departmentId={departmentId} />}\n\t\t\t\t\t{tags && tags.length > 0 && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Tags')}</Label>\n\t\t\t\t\t\t\t<Info>\n\t\t\t\t\t\t\t\t{tags.map((tag) => (\n\t\t\t\t\t\t\t\t\t<Box key={tag} mie='x4' display='inline'>\n\t\t\t\t\t\t\t\t\t\t<Tag style={{ display: 'inline' }} disabled>\n\t\t\t\t\t\t\t\t\t\t\t{tag}\n\t\t\t\t\t\t\t\t\t\t</Tag>\n\t\t\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</Info>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{topic && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Topic')}</Label>\n\t\t\t\t\t\t\t<Info>{topic}</Info>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{queueStartedAt && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Queue_Time')}</Label>\n\t\t\t\t\t\t\t{servedBy ? (\n\t\t\t\t\t\t\t\t<Info>{moment(servedBy.ts).from(moment(queueStartedAt), true)}</Info>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<Info>{moment(queueStartedAt).fromNow(true)}</Info>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{closedAt && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Chat_Duration')}</Label>\n\t\t\t\t\t\t\t<Info>{moment(closedAt).from(moment(ts), true)}</Info>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{ts && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Created_at')}</Label>\n\t\t\t\t\t\t\t<Info>{formatDateAndTime(ts)}</Info>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{closedAt && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Closed_At')}</Label>\n\t\t\t\t\t\t\t<Info>{formatDateAndTime(closedAt)}</Info>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{servedBy?.ts && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Taken_at')}</Label>\n\t\t\t\t\t\t\t<Info>{formatDateAndTime(servedBy.ts)}</Info>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{metrics?.response?.avg && formatDuration(metrics.response.avg) && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Avg_response_time')}</Label>\n\t\t\t\t\t\t\t<Info>{formatDuration(metrics.response.avg)}</Info>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{!waitingResponse && responseBy?.lastMessageTs && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Label>{t('Inactivity_Time')}</Label>\n\t\t\t\t\t\t\t<Info>{moment(responseBy.lastMessageTs).fromNow(true)}</Info>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t\t{canViewCustomFields() &&\n\t\t\t\t\t\tlivechatData &&\n\t\t\t\t\t\tObject.keys(livechatData).map(\n\t\t\t\t\t\t\t(key) => checkIsVisibleAndScopeRoom(key) && livechatData[key] && <CustomField key={key} id={key} value={livechatData[key]} />,\n\t\t\t\t\t\t)}\n\t\t\t\t\t{priorityId && <PriorityField id={priorityId} />}\n\t\t\t\t</Margins>\n\t\t\t</VerticalBar.ScrollableContent>\n\t\t\t<VerticalBar.Footer>\n\t\t\t\t<ButtonGroup stretch>\n\t\t\t\t\t<Button onClick={onEditClick}>\n\t\t\t\t\t\t<Icon name='pencil' size='x20' /> {t('Edit')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</VerticalBar.Footer>\n\t\t</>\n\t);\n}\n\nexport default ChatInfo;\n"]},"sourceType":"module","hash":"0689452657afc24fea100e39eafde06931c22312"}
