{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/users/UserInfoActions.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/admin/users/UserInfoActions.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/users/UserInfoActions.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/users/UserInfoActions.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/users/UserInfoActions.js"}},"code":"const _excluded = [\"label\"];\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 0);\n\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 1);\n\nlet _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default(v) {\n    _extends = v;\n  }\n\n}, 2);\nmodule.export({\n  UserInfoActions: () => UserInfoActions\n});\nlet ButtonGroup, Menu, Option;\nmodule.link(\"@rocket.chat/fuselage\", {\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  },\n\n  Menu(v) {\n    Menu = v;\n  },\n\n  Option(v) {\n    Option = v;\n  }\n\n}, 0);\nlet React, useCallback, useMemo;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useCallback(v) {\n    useCallback = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  }\n\n}, 1);\nlet ConfirmOwnerChangeWarningModal;\nmodule.link(\"../../../components/ConfirmOwnerChangeWarningModal\", {\n  default(v) {\n    ConfirmOwnerChangeWarningModal = v;\n  }\n\n}, 2);\nlet GenericModal;\nmodule.link(\"../../../components/GenericModal\", {\n  default(v) {\n    GenericModal = v;\n  }\n\n}, 3);\nlet usePermission;\nmodule.link(\"../../../contexts/AuthorizationContext\", {\n  usePermission(v) {\n    usePermission = v;\n  }\n\n}, 4);\nlet useSetModal;\nmodule.link(\"../../../contexts/ModalContext\", {\n  useSetModal(v) {\n    useSetModal = v;\n  }\n\n}, 5);\nlet useRoute;\nmodule.link(\"../../../contexts/RouterContext\", {\n  useRoute(v) {\n    useRoute = v;\n  }\n\n}, 6);\nlet useMethod, useEndpoint;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useMethod(v) {\n    useMethod = v;\n  },\n\n  useEndpoint(v) {\n    useEndpoint = v;\n  }\n\n}, 7);\nlet useSetting;\nmodule.link(\"../../../contexts/SettingsContext\", {\n  useSetting(v) {\n    useSetting = v;\n  }\n\n}, 8);\nlet useToastMessageDispatch;\nmodule.link(\"../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n\n}, 9);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 10);\nlet useActionSpread;\nmodule.link(\"../../hooks/useActionSpread\", {\n  useActionSpread(v) {\n    useActionSpread = v;\n  }\n\n}, 11);\nlet UserInfo;\nmodule.link(\"../../room/contextualBar/UserInfo\", {\n  default(v) {\n    UserInfo = v;\n  }\n\n}, 12);\n\nconst UserInfoActions = _ref => {\n  let {\n    username,\n    _id,\n    isActive,\n    isAdmin,\n    onChange,\n    onReload\n  } = _ref;\n  const t = useTranslation();\n  const setModal = useSetModal();\n  const directRoute = useRoute('direct');\n  const userRoute = useRoute('admin-users');\n  const dispatchToastMessage = useToastMessageDispatch();\n  const canDirectMessage = usePermission('create-d');\n  const canEditOtherUserInfo = usePermission('edit-other-user-info');\n  const canAssignAdminRole = usePermission('assign-admin-role');\n  const canResetE2EEKey = usePermission('edit-other-user-e2ee');\n  const canResetTOTP = usePermission('edit-other-user-totp');\n  const canEditOtherUserActiveStatus = usePermission('edit-other-user-active-status');\n  const canDeleteUser = usePermission('delete-user');\n  const enforcePassword = useSetting('Accounts_TwoFactorAuthentication_Enforce_Password_Fallback');\n  const handleClose = useCallback(() => {\n    setModal();\n    onChange();\n  }, [setModal, onChange]);\n\n  const handleDeletedUser = () => {\n    setModal();\n    userRoute.push({});\n    onReload();\n  };\n\n  const confirmOwnerChanges = function (action) {\n    let modalProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return async () => {\n      try {\n        return await action();\n      } catch (error) {\n        var _error$xhr, _error$xhr$responseJS;\n\n        if (((_error$xhr = error.xhr) === null || _error$xhr === void 0 ? void 0 : (_error$xhr$responseJS = _error$xhr.responseJSON) === null || _error$xhr$responseJS === void 0 ? void 0 : _error$xhr$responseJS.errorType) === 'user-last-owner') {\n          const {\n            shouldChangeOwner,\n            shouldBeRemoved\n          } = error.xhr.responseJSON.details;\n          setModal( /*#__PURE__*/React.createElement(ConfirmOwnerChangeWarningModal, _extends({\n            shouldChangeOwner: shouldChangeOwner,\n            shouldBeRemoved: shouldBeRemoved\n          }, modalProps, {\n            onConfirm: async () => {\n              await action(true);\n              setModal();\n            },\n            onCancel: () => {\n              setModal();\n              onChange();\n            }\n          })));\n          return;\n        }\n\n        dispatchToastMessage({\n          type: 'error',\n          message: error\n        });\n      }\n    };\n  };\n\n  const deleteUserQuery = useMemo(() => ({\n    userId: _id\n  }), [_id]);\n  const deleteUserEndpoint = useEndpoint('POST', 'users.delete');\n  const erasureType = useSetting('Message_ErasureType');\n  const deleteUser = confirmOwnerChanges(async function () {\n    let confirm = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    if (confirm) {\n      deleteUserQuery.confirmRelinquish = confirm;\n    }\n\n    const result = await deleteUserEndpoint(deleteUserQuery);\n\n    if (result.success) {\n      handleDeletedUser();\n      dispatchToastMessage({\n        type: 'success',\n        message: t('User_has_been_deleted')\n      });\n    } else {\n      setModal();\n    }\n  }, {\n    contentTitle: t(\"Delete_User_Warning_\".concat(erasureType)),\n    confirmLabel: t('Delete')\n  });\n  const confirmDeleteUser = useCallback(() => {\n    setModal( /*#__PURE__*/React.createElement(GenericModal, {\n      variant: \"danger\",\n      onConfirm: deleteUser,\n      onCancel: () => setModal(),\n      confirmText: t('Delete')\n    }, t(\"Delete_User_Warning_\".concat(erasureType))));\n  }, [deleteUser, erasureType, setModal, t]);\n  const setAdminStatus = useMethod('setAdminStatus');\n  const changeAdminStatus = useCallback(async () => {\n    try {\n      await setAdminStatus(_id, !isAdmin);\n      const message = isAdmin ? 'User_is_no_longer_an_admin' : 'User_is_now_an_admin';\n      dispatchToastMessage({\n        type: 'success',\n        message: t(message)\n      });\n      onChange();\n    } catch (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    }\n  }, [_id, dispatchToastMessage, isAdmin, onChange, setAdminStatus, t]);\n  const resetE2EEKeyRequest = useEndpoint('POST', 'users.resetE2EKey');\n  const resetTOTPRequest = useEndpoint('POST', 'users.resetTOTP');\n  const resetE2EEKey = useCallback(async () => {\n    setModal();\n    const result = await resetE2EEKeyRequest({\n      userId: _id\n    });\n\n    if (result) {\n      setModal( /*#__PURE__*/React.createElement(GenericModal, {\n        variant: \"success\",\n        onClose: handleClose,\n        onConfirm: handleClose\n      }, t('Users_key_has_been_reset')));\n    }\n  }, [resetE2EEKeyRequest, setModal, t, _id, handleClose]);\n  const resetTOTP = useCallback(async () => {\n    setModal();\n    const result = await resetTOTPRequest({\n      userId: _id\n    });\n\n    if (result) {\n      setModal( /*#__PURE__*/React.createElement(GenericModal, {\n        variant: \"success\",\n        onClose: handleClose,\n        onConfirm: handleClose\n      }, t('Users_TOTP_has_been_reset')));\n    }\n  }, [resetTOTPRequest, setModal, t, _id, handleClose]);\n  const confirmResetE2EEKey = useCallback(() => {\n    setModal( /*#__PURE__*/React.createElement(GenericModal, {\n      variant: \"danger\",\n      onConfirm: resetE2EEKey,\n      onCancel: () => setModal(),\n      confirmText: t('Reset')\n    }, t('E2E_Reset_Other_Key_Warning')));\n  }, [resetE2EEKey, t, setModal]);\n  const confirmResetTOTP = useCallback(() => {\n    setModal( /*#__PURE__*/React.createElement(GenericModal, {\n      variant: \"danger\",\n      onConfirm: resetTOTP,\n      onCancel: () => setModal(),\n      confirmText: t('Reset')\n    }, t('TOTP_Reset_Other_Key_Warning')));\n  }, [resetTOTP, t, setModal]);\n  const activeStatusQuery = useMemo(() => ({\n    userId: _id,\n    activeStatus: !isActive\n  }), [_id, isActive]);\n  const changeActiveStatusMessage = isActive ? 'User_has_been_deactivated' : 'User_has_been_activated';\n  const changeActiveStatusRequest = useEndpoint('POST', 'users.setActiveStatus');\n  const changeActiveStatus = confirmOwnerChanges(async function () {\n    let confirm = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    if (confirm) {\n      activeStatusQuery.confirmRelinquish = confirm;\n    }\n\n    try {\n      const result = await changeActiveStatusRequest(activeStatusQuery);\n\n      if (result.success) {\n        dispatchToastMessage({\n          type: 'success',\n          message: t(changeActiveStatusMessage)\n        });\n        onChange();\n      }\n    } catch (error) {\n      throw error;\n    }\n  }, {\n    confirmLabel: t('Yes_deactivate_it')\n  });\n  const directMessageClick = useCallback(() => directRoute.push({\n    rid: username\n  }), [directRoute, username]);\n  const editUserClick = useCallback(() => userRoute.push({\n    context: 'edit',\n    id: _id\n  }), [_id, userRoute]);\n  const options = useMemo(() => _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({}, canDirectMessage && {\n    directMessage: {\n      icon: 'balloon',\n      label: t('Direct_Message'),\n      action: directMessageClick\n    }\n  }), canEditOtherUserInfo && {\n    editUser: {\n      icon: 'edit',\n      label: t('Edit'),\n      action: editUserClick\n    }\n  }), canAssignAdminRole && username && {\n    makeAdmin: {\n      icon: 'key',\n      label: isAdmin ? t('Remove_Admin') : t('Make_Admin'),\n      action: changeAdminStatus\n    }\n  }), canResetE2EEKey && enforcePassword && {\n    resetE2EEKey: {\n      icon: 'key',\n      label: t('Reset_E2E_Key'),\n      action: confirmResetE2EEKey\n    }\n  }), canResetTOTP && enforcePassword && {\n    resetTOTP: {\n      icon: 'key',\n      label: t('Reset_TOTP'),\n      action: confirmResetTOTP\n    }\n  }), canDeleteUser && {\n    delete: {\n      icon: 'trash',\n      label: t('Delete'),\n      action: confirmDeleteUser\n    }\n  }), canEditOtherUserActiveStatus && {\n    changeActiveStatus: {\n      icon: 'user',\n      label: isActive ? t('Deactivate') : t('Activate'),\n      action: changeActiveStatus\n    }\n  }), [t, canDirectMessage, directMessageClick, canEditOtherUserInfo, editUserClick, canAssignAdminRole, isAdmin, changeAdminStatus, canDeleteUser, confirmDeleteUser, canEditOtherUserActiveStatus, isActive, changeActiveStatus, enforcePassword, canResetE2EEKey, canResetTOTP, confirmResetE2EEKey, confirmResetTOTP, username]);\n  const {\n    actions: actionsDefinition,\n    menu: menuOptions\n  } = useActionSpread(options);\n  const menu = useMemo(() => {\n    if (!menuOptions) {\n      return null;\n    }\n\n    return /*#__PURE__*/React.createElement(Menu, {\n      mi: \"x4\",\n      placement: \"bottom-start\",\n      small: false,\n      ghost: false,\n      flexShrink: 0,\n      key: \"menu\",\n      renderItem: _ref2 => {\n        let {\n          label: {\n            label,\n            icon\n          }\n        } = _ref2,\n            props = _objectWithoutProperties(_ref2, _excluded);\n\n        return /*#__PURE__*/React.createElement(Option, _extends({\n          label: label,\n          title: label,\n          icon: icon\n        }, props));\n      },\n      options: menuOptions\n    });\n  }, [menuOptions]);\n  const actions = useMemo(() => {\n    const mapAction = _ref3 => {\n      let [key, {\n        label,\n        icon,\n        action\n      }] = _ref3;\n      return /*#__PURE__*/React.createElement(UserInfo.Action, {\n        key: key,\n        title: label,\n        label: label,\n        onClick: action,\n        icon: icon\n      });\n    };\n\n    return [...actionsDefinition.map(mapAction), menu].filter(Boolean);\n  }, [actionsDefinition, menu]);\n  return /*#__PURE__*/React.createElement(ButtonGroup, {\n    flexGrow: 0,\n    justifyContent: \"center\"\n  }, actions);\n};","map":{"version":3,"sources":["client/views/admin/users/UserInfoActions.js"],"names":["_objectWithoutProperties","module","link","default","v","_objectSpread","_extends","export","UserInfoActions","ButtonGroup","Menu","Option","React","useCallback","useMemo","ConfirmOwnerChangeWarningModal","GenericModal","usePermission","useSetModal","useRoute","useMethod","useEndpoint","useSetting","useToastMessageDispatch","useTranslation","useActionSpread","UserInfo","username","_id","isActive","isAdmin","onChange","onReload","t","setModal","directRoute","userRoute","dispatchToastMessage","canDirectMessage","canEditOtherUserInfo","canAssignAdminRole","canResetE2EEKey","canResetTOTP","canEditOtherUserActiveStatus","canDeleteUser","enforcePassword","handleClose","handleDeletedUser","push","confirmOwnerChanges","action","modalProps","error","xhr","responseJSON","errorType","shouldChangeOwner","shouldBeRemoved","details","type","message","deleteUserQuery","userId","deleteUserEndpoint","erasureType","deleteUser","confirm","confirmRelinquish","result","success","contentTitle","confirmLabel","confirmDeleteUser","setAdminStatus","changeAdminStatus","resetE2EEKeyRequest","resetTOTPRequest","resetE2EEKey","resetTOTP","confirmResetE2EEKey","confirmResetTOTP","activeStatusQuery","activeStatus","changeActiveStatusMessage","changeActiveStatusRequest","changeActiveStatus","directMessageClick","rid","editUserClick","context","id","options","directMessage","icon","label","editUser","makeAdmin","delete","actions","actionsDefinition","menu","menuOptions","props","mapAction","key","map","filter","Boolean"],"mappings":"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","sourcesContent":["import { ButtonGroup, Menu, Option } from '@rocket.chat/fuselage';\nimport React, { useCallback, useMemo } from 'react';\n\nimport ConfirmOwnerChangeWarningModal from '../../../components/ConfirmOwnerChangeWarningModal';\nimport GenericModal from '../../../components/GenericModal';\nimport { usePermission } from '../../../contexts/AuthorizationContext';\nimport { useSetModal } from '../../../contexts/ModalContext';\nimport { useRoute } from '../../../contexts/RouterContext';\nimport { useMethod, useEndpoint } from '../../../contexts/ServerContext';\nimport { useSetting } from '../../../contexts/SettingsContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useActionSpread } from '../../hooks/useActionSpread';\nimport UserInfo from '../../room/contextualBar/UserInfo';\n\nexport const UserInfoActions = ({ username, _id, isActive, isAdmin, onChange, onReload }) => {\n\tconst t = useTranslation();\n\tconst setModal = useSetModal();\n\n\tconst directRoute = useRoute('direct');\n\tconst userRoute = useRoute('admin-users');\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst canDirectMessage = usePermission('create-d');\n\tconst canEditOtherUserInfo = usePermission('edit-other-user-info');\n\tconst canAssignAdminRole = usePermission('assign-admin-role');\n\tconst canResetE2EEKey = usePermission('edit-other-user-e2ee');\n\tconst canResetTOTP = usePermission('edit-other-user-totp');\n\tconst canEditOtherUserActiveStatus = usePermission('edit-other-user-active-status');\n\tconst canDeleteUser = usePermission('delete-user');\n\n\tconst enforcePassword = useSetting('Accounts_TwoFactorAuthentication_Enforce_Password_Fallback');\n\n\tconst handleClose = useCallback(() => {\n\t\tsetModal();\n\t\tonChange();\n\t}, [setModal, onChange]);\n\n\tconst handleDeletedUser = () => {\n\t\tsetModal();\n\t\tuserRoute.push({});\n\t\tonReload();\n\t};\n\n\tconst confirmOwnerChanges =\n\t\t(action, modalProps = {}) =>\n\t\tasync () => {\n\t\t\ttry {\n\t\t\t\treturn await action();\n\t\t\t} catch (error) {\n\t\t\t\tif (error.xhr?.responseJSON?.errorType === 'user-last-owner') {\n\t\t\t\t\tconst { shouldChangeOwner, shouldBeRemoved } = error.xhr.responseJSON.details;\n\t\t\t\t\tsetModal(\n\t\t\t\t\t\t<ConfirmOwnerChangeWarningModal\n\t\t\t\t\t\t\tshouldChangeOwner={shouldChangeOwner}\n\t\t\t\t\t\t\tshouldBeRemoved={shouldBeRemoved}\n\t\t\t\t\t\t\t{...modalProps}\n\t\t\t\t\t\t\tonConfirm={async () => {\n\t\t\t\t\t\t\t\tawait action(true);\n\t\t\t\t\t\t\t\tsetModal();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonCancel={() => {\n\t\t\t\t\t\t\t\tsetModal();\n\t\t\t\t\t\t\t\tonChange();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>,\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t};\n\n\tconst deleteUserQuery = useMemo(() => ({ userId: _id }), [_id]);\n\tconst deleteUserEndpoint = useEndpoint('POST', 'users.delete');\n\n\tconst erasureType = useSetting('Message_ErasureType');\n\n\tconst deleteUser = confirmOwnerChanges(\n\t\tasync (confirm = false) => {\n\t\t\tif (confirm) {\n\t\t\t\tdeleteUserQuery.confirmRelinquish = confirm;\n\t\t\t}\n\n\t\t\tconst result = await deleteUserEndpoint(deleteUserQuery);\n\t\t\tif (result.success) {\n\t\t\t\thandleDeletedUser();\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('User_has_been_deleted') });\n\t\t\t} else {\n\t\t\t\tsetModal();\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tcontentTitle: t(`Delete_User_Warning_${erasureType}`),\n\t\t\tconfirmLabel: t('Delete'),\n\t\t},\n\t);\n\n\tconst confirmDeleteUser = useCallback(() => {\n\t\tsetModal(\n\t\t\t<GenericModal variant='danger' onConfirm={deleteUser} onCancel={() => setModal()} confirmText={t('Delete')}>\n\t\t\t\t{t(`Delete_User_Warning_${erasureType}`)}\n\t\t\t</GenericModal>,\n\t\t);\n\t}, [deleteUser, erasureType, setModal, t]);\n\n\tconst setAdminStatus = useMethod('setAdminStatus');\n\tconst changeAdminStatus = useCallback(async () => {\n\t\ttry {\n\t\t\tawait setAdminStatus(_id, !isAdmin);\n\t\t\tconst message = isAdmin ? 'User_is_no_longer_an_admin' : 'User_is_now_an_admin';\n\t\t\tdispatchToastMessage({ type: 'success', message: t(message) });\n\t\t\tonChange();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [_id, dispatchToastMessage, isAdmin, onChange, setAdminStatus, t]);\n\n\tconst resetE2EEKeyRequest = useEndpoint('POST', 'users.resetE2EKey');\n\tconst resetTOTPRequest = useEndpoint('POST', 'users.resetTOTP');\n\tconst resetE2EEKey = useCallback(async () => {\n\t\tsetModal();\n\t\tconst result = await resetE2EEKeyRequest({ userId: _id });\n\n\t\tif (result) {\n\t\t\tsetModal(\n\t\t\t\t<GenericModal variant='success' onClose={handleClose} onConfirm={handleClose}>\n\t\t\t\t\t{t('Users_key_has_been_reset')}\n\t\t\t\t</GenericModal>,\n\t\t\t);\n\t\t}\n\t}, [resetE2EEKeyRequest, setModal, t, _id, handleClose]);\n\n\tconst resetTOTP = useCallback(async () => {\n\t\tsetModal();\n\t\tconst result = await resetTOTPRequest({ userId: _id });\n\n\t\tif (result) {\n\t\t\tsetModal(\n\t\t\t\t<GenericModal variant='success' onClose={handleClose} onConfirm={handleClose}>\n\t\t\t\t\t{t('Users_TOTP_has_been_reset')}\n\t\t\t\t</GenericModal>,\n\t\t\t);\n\t\t}\n\t}, [resetTOTPRequest, setModal, t, _id, handleClose]);\n\n\tconst confirmResetE2EEKey = useCallback(() => {\n\t\tsetModal(\n\t\t\t<GenericModal variant='danger' onConfirm={resetE2EEKey} onCancel={() => setModal()} confirmText={t('Reset')}>\n\t\t\t\t{t('E2E_Reset_Other_Key_Warning')}\n\t\t\t</GenericModal>,\n\t\t);\n\t}, [resetE2EEKey, t, setModal]);\n\n\tconst confirmResetTOTP = useCallback(() => {\n\t\tsetModal(\n\t\t\t<GenericModal variant='danger' onConfirm={resetTOTP} onCancel={() => setModal()} confirmText={t('Reset')}>\n\t\t\t\t{t('TOTP_Reset_Other_Key_Warning')}\n\t\t\t</GenericModal>,\n\t\t);\n\t}, [resetTOTP, t, setModal]);\n\n\tconst activeStatusQuery = useMemo(\n\t\t() => ({\n\t\t\tuserId: _id,\n\t\t\tactiveStatus: !isActive,\n\t\t}),\n\t\t[_id, isActive],\n\t);\n\tconst changeActiveStatusMessage = isActive ? 'User_has_been_deactivated' : 'User_has_been_activated';\n\tconst changeActiveStatusRequest = useEndpoint('POST', 'users.setActiveStatus');\n\n\tconst changeActiveStatus = confirmOwnerChanges(\n\t\tasync (confirm = false) => {\n\t\t\tif (confirm) {\n\t\t\t\tactiveStatusQuery.confirmRelinquish = confirm;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst result = await changeActiveStatusRequest(activeStatusQuery);\n\t\t\t\tif (result.success) {\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t(changeActiveStatusMessage) });\n\t\t\t\t\tonChange();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tconfirmLabel: t('Yes_deactivate_it'),\n\t\t},\n\t);\n\n\tconst directMessageClick = useCallback(\n\t\t() =>\n\t\t\tdirectRoute.push({\n\t\t\t\trid: username,\n\t\t\t}),\n\t\t[directRoute, username],\n\t);\n\n\tconst editUserClick = useCallback(\n\t\t() =>\n\t\t\tuserRoute.push({\n\t\t\t\tcontext: 'edit',\n\t\t\t\tid: _id,\n\t\t\t}),\n\t\t[_id, userRoute],\n\t);\n\n\tconst options = useMemo(\n\t\t() => ({\n\t\t\t...(canDirectMessage && {\n\t\t\t\tdirectMessage: {\n\t\t\t\t\ticon: 'balloon',\n\t\t\t\t\tlabel: t('Direct_Message'),\n\t\t\t\t\taction: directMessageClick,\n\t\t\t\t},\n\t\t\t}),\n\t\t\t...(canEditOtherUserInfo && {\n\t\t\t\teditUser: {\n\t\t\t\t\ticon: 'edit',\n\t\t\t\t\tlabel: t('Edit'),\n\t\t\t\t\taction: editUserClick,\n\t\t\t\t},\n\t\t\t}),\n\t\t\t...(canAssignAdminRole &&\n\t\t\t\tusername && {\n\t\t\t\t\tmakeAdmin: {\n\t\t\t\t\t\ticon: 'key',\n\t\t\t\t\t\tlabel: isAdmin ? t('Remove_Admin') : t('Make_Admin'),\n\t\t\t\t\t\taction: changeAdminStatus,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t...(canResetE2EEKey &&\n\t\t\t\tenforcePassword && {\n\t\t\t\t\tresetE2EEKey: {\n\t\t\t\t\t\ticon: 'key',\n\t\t\t\t\t\tlabel: t('Reset_E2E_Key'),\n\t\t\t\t\t\taction: confirmResetE2EEKey,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t...(canResetTOTP &&\n\t\t\t\tenforcePassword && {\n\t\t\t\t\tresetTOTP: {\n\t\t\t\t\t\ticon: 'key',\n\t\t\t\t\t\tlabel: t('Reset_TOTP'),\n\t\t\t\t\t\taction: confirmResetTOTP,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t...(canDeleteUser && {\n\t\t\t\tdelete: {\n\t\t\t\t\ticon: 'trash',\n\t\t\t\t\tlabel: t('Delete'),\n\t\t\t\t\taction: confirmDeleteUser,\n\t\t\t\t},\n\t\t\t}),\n\t\t\t...(canEditOtherUserActiveStatus && {\n\t\t\t\tchangeActiveStatus: {\n\t\t\t\t\ticon: 'user',\n\t\t\t\t\tlabel: isActive ? t('Deactivate') : t('Activate'),\n\t\t\t\t\taction: changeActiveStatus,\n\t\t\t\t},\n\t\t\t}),\n\t\t}),\n\t\t[\n\t\t\tt,\n\t\t\tcanDirectMessage,\n\t\t\tdirectMessageClick,\n\t\t\tcanEditOtherUserInfo,\n\t\t\teditUserClick,\n\t\t\tcanAssignAdminRole,\n\t\t\tisAdmin,\n\t\t\tchangeAdminStatus,\n\t\t\tcanDeleteUser,\n\t\t\tconfirmDeleteUser,\n\t\t\tcanEditOtherUserActiveStatus,\n\t\t\tisActive,\n\t\t\tchangeActiveStatus,\n\t\t\tenforcePassword,\n\t\t\tcanResetE2EEKey,\n\t\t\tcanResetTOTP,\n\t\t\tconfirmResetE2EEKey,\n\t\t\tconfirmResetTOTP,\n\t\t\tusername,\n\t\t],\n\t);\n\n\tconst { actions: actionsDefinition, menu: menuOptions } = useActionSpread(options);\n\n\tconst menu = useMemo(() => {\n\t\tif (!menuOptions) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn (\n\t\t\t<Menu\n\t\t\t\tmi='x4'\n\t\t\t\tplacement='bottom-start'\n\t\t\t\tsmall={false}\n\t\t\t\tghost={false}\n\t\t\t\tflexShrink={0}\n\t\t\t\tkey='menu'\n\t\t\t\trenderItem={({ label: { label, icon }, ...props }) => <Option label={label} title={label} icon={icon} {...props} />}\n\t\t\t\toptions={menuOptions}\n\t\t\t/>\n\t\t);\n\t}, [menuOptions]);\n\n\tconst actions = useMemo(() => {\n\t\tconst mapAction = ([key, { label, icon, action }]) => (\n\t\t\t<UserInfo.Action key={key} title={label} label={label} onClick={action} icon={icon} />\n\t\t);\n\t\treturn [...actionsDefinition.map(mapAction), menu].filter(Boolean);\n\t}, [actionsDefinition, menu]);\n\n\treturn (\n\t\t<ButtonGroup flexGrow={0} justifyContent='center'>\n\t\t\t{actions}\n\t\t</ButtonGroup>\n\t);\n};\n"]},"sourceType":"module","hash":"67d8d8f32caeeb228891c210fd71bf20c9463243"}
