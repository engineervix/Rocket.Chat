{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/cas/client/cas_client.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/cas/client/cas_client.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/cas/client/cas_client.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/cas/client/cas_client.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/cas/client/cas_client.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts(v) {\n    Accounts = v;\n  }\n\n}, 1);\nlet Random;\nmodule.link(\"meteor/random\", {\n  Random(v) {\n    Random = v;\n  }\n\n}, 2);\nlet settings;\nmodule.link(\"../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 3);\n\nconst openCenteredPopup = function (url, width, height) {\n  const screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n  const screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n  const outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n  const outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : document.body.clientHeight - 22; // XXX what is the 22?\n  // Use `outerWidth - width` and `outerHeight - height` for help in\n  // positioning the popup centered relative to the current window\n\n  const left = screenX + (outerWidth - width) / 2;\n  const top = screenY + (outerHeight - height) / 2;\n  const features = \"width=\".concat(width, \",height=\").concat(height, \",left=\").concat(left, \",top=\").concat(top, \",scrollbars=yes\");\n  const newwindow = window.open(url, 'Login', features);\n\n  if (newwindow.focus) {\n    newwindow.focus();\n  }\n\n  return newwindow;\n};\n\nMeteor.loginWithCas = function (options, callback) {\n  options = options || {};\n  const credentialToken = Random.id();\n  const login_url = settings.get('CAS_login_url');\n  const popup_width = settings.get('CAS_popup_width');\n  const popup_height = settings.get('CAS_popup_height');\n\n  if (!login_url) {\n    return;\n  }\n\n  const appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX; // check if the provided CAS URL already has some parameters\n\n\n  const delim = login_url.split('?').length > 1 ? '&' : '?';\n  const loginUrl = \"\".concat(login_url).concat(delim, \"service=\").concat(appUrl, \"/_cas/\").concat(credentialToken);\n  const popup = openCenteredPopup(loginUrl, popup_width || 800, popup_height || 600);\n  const checkPopupOpen = setInterval(function () {\n    let popupClosed;\n\n    try {\n      // Fix for #328 - added a second test criteria (popup.closed === undefined)\n      // to humour this Android quirk:\n      // http://code.google.com/p/android/issues/detail?id=21061\n      popupClosed = popup.closed || popup.closed === undefined;\n    } catch (e) {\n      // For some unknown reason, IE9 (and others?) sometimes (when\n      // the popup closes too quickly?) throws \"SCRIPT16386: No such\n      // interface supported\" when trying to read 'popup.closed'. Try\n      // again in 100ms.\n      return;\n    }\n\n    if (popupClosed) {\n      clearInterval(checkPopupOpen); // check auth on server.\n\n      Accounts.callLoginMethod({\n        methodArguments: [{\n          cas: {\n            credentialToken\n          }\n        }],\n        userCallback: callback\n      });\n    }\n  }, 100);\n};","map":{"version":3,"sources":["app/cas/client/cas_client.js"],"names":["Meteor","module","link","v","Accounts","Random","settings","openCenteredPopup","url","width","height","screenX","window","screenLeft","screenY","screenTop","outerWidth","document","body","clientWidth","outerHeight","clientHeight","left","top","features","newwindow","open","focus","loginWithCas","options","callback","credentialToken","id","login_url","get","popup_width","popup_height","appUrl","absoluteUrl","replace","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","delim","split","length","loginUrl","popup","checkPopupOpen","setInterval","popupClosed","closed","undefined","e","clearInterval","callLoginMethod","methodArguments","cas","userCallback"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Accounts } from 'meteor/accounts-base';\nimport { Random } from 'meteor/random';\n\nimport { settings } from '../../settings';\n\nconst openCenteredPopup = function (url, width, height) {\n\tconst screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n\tconst screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n\tconst outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n\tconst outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : document.body.clientHeight - 22;\n\t// XXX what is the 22?\n\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\tif (newwindow.focus) {\n\t\tnewwindow.focus();\n\t}\n\n\treturn newwindow;\n};\n\nMeteor.loginWithCas = function (options, callback) {\n\toptions = options || {};\n\n\tconst credentialToken = Random.id();\n\tconst login_url = settings.get('CAS_login_url');\n\tconst popup_width = settings.get('CAS_popup_width');\n\tconst popup_height = settings.get('CAS_popup_height');\n\n\tif (!login_url) {\n\t\treturn;\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\t// check if the provided CAS URL already has some parameters\n\tconst delim = login_url.split('?').length > 1 ? '&' : '?';\n\tconst loginUrl = `${login_url}${delim}service=${appUrl}/_cas/${credentialToken}`;\n\n\tconst popup = openCenteredPopup(loginUrl, popup_width || 800, popup_height || 600);\n\n\tconst checkPopupOpen = setInterval(function () {\n\t\tlet popupClosed;\n\t\ttry {\n\t\t\t// Fix for #328 - added a second test criteria (popup.closed === undefined)\n\t\t\t// to humour this Android quirk:\n\t\t\t// http://code.google.com/p/android/issues/detail?id=21061\n\t\t\tpopupClosed = popup.closed || popup.closed === undefined;\n\t\t} catch (e) {\n\t\t\t// For some unknown reason, IE9 (and others?) sometimes (when\n\t\t\t// the popup closes too quickly?) throws \"SCRIPT16386: No such\n\t\t\t// interface supported\" when trying to read 'popup.closed'. Try\n\t\t\t// again in 100ms.\n\t\t\treturn;\n\t\t}\n\n\t\tif (popupClosed) {\n\t\t\tclearInterval(checkPopupOpen);\n\n\t\t\t// check auth on server.\n\t\t\tAccounts.callLoginMethod({\n\t\t\t\tmethodArguments: [{ cas: { credentialToken } }],\n\t\t\t\tuserCallback: callback,\n\t\t\t});\n\t\t}\n\t}, 100);\n};\n"]},"sourceType":"module","hash":"8ebe1d30213e69ccf73b1ebfdf3d06274388e566"}
