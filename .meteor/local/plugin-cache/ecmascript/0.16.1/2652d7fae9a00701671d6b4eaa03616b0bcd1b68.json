{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/import/ImportHistoryPage.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/admin/import/ImportHistoryPage.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/import/ImportHistoryPage.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/import/ImportHistoryPage.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/import/ImportHistoryPage.js"}},"code":"let _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default(v) {\n    _extends = v;\n  }\n\n}, 0);\nlet Button, ButtonGroup, Table;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Button(v) {\n    Button = v;\n  },\n\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  },\n\n  Table(v) {\n    Table = v;\n  }\n\n}, 0);\nlet useMediaQuery, useSafely;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMediaQuery(v) {\n    useMediaQuery = v;\n  },\n\n  useSafely(v) {\n    useSafely = v;\n  }\n\n}, 1);\nlet React, useState, useEffect, useMemo;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useState(v) {\n    useState = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  }\n\n}, 2);\nlet ProgressStep;\nmodule.link(\"../../../../app/importer/lib/ImporterProgressStep\", {\n  ProgressStep(v) {\n    ProgressStep = v;\n  }\n\n}, 3);\nlet Page;\nmodule.link(\"../../../components/Page\", {\n  default(v) {\n    Page = v;\n  }\n\n}, 4);\nlet useRoute;\nmodule.link(\"../../../contexts/RouterContext\", {\n  useRoute(v) {\n    useRoute = v;\n  }\n\n}, 5);\nlet useEndpoint;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useEndpoint(v) {\n    useEndpoint = v;\n  }\n\n}, 6);\nlet useToastMessageDispatch;\nmodule.link(\"../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n\n}, 7);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 8);\nlet ImportOperationSummary;\nmodule.link(\"./ImportOperationSummary\", {\n  default(v) {\n    ImportOperationSummary = v;\n  }\n\n}, 9);\n\nfunction ImportHistoryPage() {\n  var _latestOperations$fil;\n\n  const t = useTranslation();\n  const dispatchToastMessage = useToastMessageDispatch();\n  const [isLoading, setLoading] = useSafely(useState(true));\n  const [currentOperation, setCurrentOperation] = useSafely(useState());\n  const [latestOperations, setLatestOperations] = useSafely(useState([]));\n  const getCurrentImportOperation = useEndpoint('GET', 'getCurrentImportOperation');\n  const getLatestImportOperations = useEndpoint('GET', 'getLatestImportOperations');\n  const downloadPendingFiles = useEndpoint('POST', 'downloadPendingFiles');\n  const downloadPendingAvatars = useEndpoint('POST', 'downloadPendingAvatars');\n  const newImportRoute = useRoute('admin-import-new');\n  const importProgressRoute = useRoute('admin-import-progress');\n  useEffect(() => {\n    const loadData = async () => {\n      setLoading(true);\n\n      try {\n        const {\n          operation\n        } = await getCurrentImportOperation();\n        setCurrentOperation(operation);\n      } catch (error) {\n        dispatchToastMessage({\n          type: 'error',\n          message: t('Failed_To_Load_Import_Operation')\n        });\n      }\n\n      try {\n        const operations = await getLatestImportOperations();\n        setLatestOperations(operations);\n      } catch (error) {\n        dispatchToastMessage({\n          type: 'error',\n          message: t('Failed_To_Load_Import_History')\n        });\n      }\n\n      setLoading(false);\n    };\n\n    loadData();\n  }, [dispatchToastMessage, getCurrentImportOperation, getLatestImportOperations, setCurrentOperation, setLatestOperations, setLoading, t]);\n  const hasAnySuccessfulImport = useMemo(() => latestOperations === null || latestOperations === void 0 ? void 0 : latestOperations.some(_ref => {\n    let {\n      status\n    } = _ref;\n    return status === ProgressStep.DONE;\n  }), [latestOperations]);\n\n  const handleNewImportClick = () => {\n    newImportRoute.push();\n  };\n\n  const handleDownloadPendingFilesClick = async () => {\n    try {\n      setLoading(true);\n      const {\n        count\n      } = await downloadPendingFiles();\n\n      if (!count) {\n        dispatchToastMessage({\n          type: 'info',\n          message: t('No_files_left_to_download')\n        });\n        setLoading(false);\n        return;\n      }\n\n      dispatchToastMessage({\n        type: 'info',\n        message: t('File_Downloads_Started')\n      });\n      importProgressRoute.push();\n    } catch (error) {\n      console.error(error);\n      dispatchToastMessage({\n        type: 'error',\n        message: t('Failed_To_Download_Files')\n      });\n      setLoading(false);\n    }\n  };\n\n  const handleDownloadPendingAvatarsClick = async () => {\n    try {\n      setLoading(true);\n      const {\n        count\n      } = await downloadPendingAvatars();\n\n      if (!count) {\n        dispatchToastMessage({\n          type: 'info',\n          message: t('No_files_left_to_download')\n        });\n        setLoading(false);\n        return;\n      }\n\n      dispatchToastMessage({\n        type: 'info',\n        message: t('File_Downloads_Started')\n      });\n      importProgressRoute.push();\n    } catch (error) {\n      console.error(error);\n      dispatchToastMessage({\n        type: 'error',\n        message: t('Failed_To_Download_Files')\n      });\n      setLoading(false);\n    }\n  };\n\n  const small = useMediaQuery('(max-width: 768px)');\n  return /*#__PURE__*/React.createElement(Page, null, /*#__PURE__*/React.createElement(Page.Header, {\n    title: t('Import')\n  }, /*#__PURE__*/React.createElement(ButtonGroup, null, /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    disabled: isLoading,\n    onClick: handleNewImportClick\n  }, t('Import_New_File')), hasAnySuccessfulImport && /*#__PURE__*/React.createElement(Button, {\n    disabled: isLoading,\n    onClick: handleDownloadPendingFilesClick\n  }, t('Download_Pending_Files')), hasAnySuccessfulImport && /*#__PURE__*/React.createElement(Button, {\n    disabled: isLoading,\n    onClick: handleDownloadPendingAvatarsClick\n  }, t('Download_Pending_Avatars')))), /*#__PURE__*/React.createElement(Page.ScrollableContentWithShadow, null, /*#__PURE__*/React.createElement(Table, {\n    fixed: true\n  }, /*#__PURE__*/React.createElement(Table.Head, null, /*#__PURE__*/React.createElement(Table.Row, null, /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    rowSpan: 2,\n    width: \"x140\"\n  }, t('Import_Type')), /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    rowSpan: 2\n  }, t('Last_Updated')), !small && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    rowSpan: 2\n  }, t('Last_Status')), /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    rowSpan: 2\n  }, t('File')), /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    align: \"center\",\n    colSpan: 4,\n    width: \"x320\"\n  }, t('Counters')))), !small && /*#__PURE__*/React.createElement(Table.Row, null, /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    align: \"center\"\n  }, t('Users')), /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    align: \"center\"\n  }, t('Channels')), /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    align: \"center\"\n  }, t('Messages')), /*#__PURE__*/React.createElement(Table.Cell, {\n    is: \"th\",\n    align: \"center\"\n  }, t('Total')))), /*#__PURE__*/React.createElement(Table.Body, null, isLoading ? Array.from({\n    length: 20\n  }, (_, i) => /*#__PURE__*/React.createElement(ImportOperationSummary.Skeleton, {\n    small: small,\n    key: i\n  })) : /*#__PURE__*/React.createElement(React.Fragment, null, (currentOperation === null || currentOperation === void 0 ? void 0 : currentOperation.valid) && /*#__PURE__*/React.createElement(ImportOperationSummary, _extends({}, currentOperation, {\n    small: small\n  })), latestOperations === null || latestOperations === void 0 ? void 0 : (_latestOperations$fil = latestOperations.filter(_ref2 => {\n    let {\n      _id\n    } = _ref2;\n    return (currentOperation === null || currentOperation === void 0 ? void 0 : currentOperation._id) !== _id || !(currentOperation !== null && currentOperation !== void 0 && currentOperation.valid);\n  }) // Forcing valid=false as the current API only accept preparation/progress over currentOperation\n  ) === null || _latestOperations$fil === void 0 ? void 0 : _latestOperations$fil.map(operation => /*#__PURE__*/React.createElement(ImportOperationSummary, _extends({\n    key: operation._id\n  }, operation, {\n    valid: false,\n    small: small\n  }))))))));\n}\n\nmodule.exportDefault(ImportHistoryPage);","map":{"version":3,"sources":["client/views/admin/import/ImportHistoryPage.js"],"names":["_extends","module","link","default","v","Button","ButtonGroup","Table","useMediaQuery","useSafely","React","useState","useEffect","useMemo","ProgressStep","Page","useRoute","useEndpoint","useToastMessageDispatch","useTranslation","ImportOperationSummary","ImportHistoryPage","t","dispatchToastMessage","isLoading","setLoading","currentOperation","setCurrentOperation","latestOperations","setLatestOperations","getCurrentImportOperation","getLatestImportOperations","downloadPendingFiles","downloadPendingAvatars","newImportRoute","importProgressRoute","loadData","operation","error","type","message","operations","hasAnySuccessfulImport","some","status","DONE","handleNewImportClick","push","handleDownloadPendingFilesClick","count","console","handleDownloadPendingAvatarsClick","small","Array","from","length","_","i","valid","filter","_id","map","exportDefault"],"mappings":"AAAA,IAAIA,QAAJ;;AAAaC,MAAM,CAACC,IAAP,CAAY,gCAAZ,EAA6C;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACJ,IAAAA,QAAQ,GAACI,CAAT;AAAW;;AAAvB,CAA7C,EAAsE,CAAtE;AAAb,IAAIC,MAAJ,EAAWC,WAAX,EAAuBC,KAAvB;AAA6BN,MAAM,CAACC,IAAP,CAAY,uBAAZ,EAAoC;AAACG,EAAAA,MAAM,CAACD,CAAD,EAAG;AAACC,IAAAA,MAAM,GAACD,CAAP;AAAS,GAApB;;AAAqBE,EAAAA,WAAW,CAACF,CAAD,EAAG;AAACE,IAAAA,WAAW,GAACF,CAAZ;AAAc,GAAlD;;AAAmDG,EAAAA,KAAK,CAACH,CAAD,EAAG;AAACG,IAAAA,KAAK,GAACH,CAAN;AAAQ;;AAApE,CAApC,EAA0G,CAA1G;AAA6G,IAAII,aAAJ,EAAkBC,SAAlB;AAA4BR,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACM,EAAAA,aAAa,CAACJ,CAAD,EAAG;AAACI,IAAAA,aAAa,GAACJ,CAAd;AAAgB,GAAlC;;AAAmCK,EAAAA,SAAS,CAACL,CAAD,EAAG;AAACK,IAAAA,SAAS,GAACL,CAAV;AAAY;;AAA5D,CAA1C,EAAwG,CAAxG;AAA2G,IAAIM,KAAJ,EAAUC,QAAV,EAAmBC,SAAnB,EAA6BC,OAA7B;AAAqCZ,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACM,IAAAA,KAAK,GAACN,CAAN;AAAQ,GAApB;;AAAqBO,EAAAA,QAAQ,CAACP,CAAD,EAAG;AAACO,IAAAA,QAAQ,GAACP,CAAT;AAAW,GAA5C;;AAA6CQ,EAAAA,SAAS,CAACR,CAAD,EAAG;AAACQ,IAAAA,SAAS,GAACR,CAAV;AAAY,GAAtE;;AAAuES,EAAAA,OAAO,CAACT,CAAD,EAAG;AAACS,IAAAA,OAAO,GAACT,CAAR;AAAU;;AAA5F,CAApB,EAAkH,CAAlH;AAAqH,IAAIU,YAAJ;AAAiBb,MAAM,CAACC,IAAP,CAAY,mDAAZ,EAAgE;AAACY,EAAAA,YAAY,CAACV,CAAD,EAAG;AAACU,IAAAA,YAAY,GAACV,CAAb;AAAe;;AAAhC,CAAhE,EAAkG,CAAlG;AAAqG,IAAIW,IAAJ;AAASd,MAAM,CAACC,IAAP,CAAY,0BAAZ,EAAuC;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACW,IAAAA,IAAI,GAACX,CAAL;AAAO;;AAAnB,CAAvC,EAA4D,CAA5D;AAA+D,IAAIY,QAAJ;AAAaf,MAAM,CAACC,IAAP,CAAY,iCAAZ,EAA8C;AAACc,EAAAA,QAAQ,CAACZ,CAAD,EAAG;AAACY,IAAAA,QAAQ,GAACZ,CAAT;AAAW;;AAAxB,CAA9C,EAAwE,CAAxE;AAA2E,IAAIa,WAAJ;AAAgBhB,MAAM,CAACC,IAAP,CAAY,iCAAZ,EAA8C;AAACe,EAAAA,WAAW,CAACb,CAAD,EAAG;AAACa,IAAAA,WAAW,GAACb,CAAZ;AAAc;;AAA9B,CAA9C,EAA8E,CAA9E;AAAiF,IAAIc,uBAAJ;AAA4BjB,MAAM,CAACC,IAAP,CAAY,wCAAZ,EAAqD;AAACgB,EAAAA,uBAAuB,CAACd,CAAD,EAAG;AAACc,IAAAA,uBAAuB,GAACd,CAAxB;AAA0B;;AAAtD,CAArD,EAA6G,CAA7G;AAAgH,IAAIe,cAAJ;AAAmBlB,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACiB,EAAAA,cAAc,CAACf,CAAD,EAAG;AAACe,IAAAA,cAAc,GAACf,CAAf;AAAiB;;AAApC,CAAnD,EAAyF,CAAzF;AAA4F,IAAIgB,sBAAJ;AAA2BnB,MAAM,CAACC,IAAP,CAAY,0BAAZ,EAAuC;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACgB,IAAAA,sBAAsB,GAAChB,CAAvB;AAAyB;;AAArC,CAAvC,EAA8E,CAA9E;;AAYxjC,SAASiB,iBAAT,GAA6B;AAAA;;AAC5B,QAAMC,CAAC,GAAGH,cAAc,EAAxB;AACA,QAAMI,oBAAoB,GAAGL,uBAAuB,EAApD;AAEA,QAAM,CAACM,SAAD,EAAYC,UAAZ,IAA0BhB,SAAS,CAACE,QAAQ,CAAC,IAAD,CAAT,CAAzC;AACA,QAAM,CAACe,gBAAD,EAAmBC,mBAAnB,IAA0ClB,SAAS,CAACE,QAAQ,EAAT,CAAzD;AACA,QAAM,CAACiB,gBAAD,EAAmBC,mBAAnB,IAA0CpB,SAAS,CAACE,QAAQ,CAAC,EAAD,CAAT,CAAzD;AAEA,QAAMmB,yBAAyB,GAAGb,WAAW,CAAC,KAAD,EAAQ,2BAAR,CAA7C;AACA,QAAMc,yBAAyB,GAAGd,WAAW,CAAC,KAAD,EAAQ,2BAAR,CAA7C;AACA,QAAMe,oBAAoB,GAAGf,WAAW,CAAC,MAAD,EAAS,sBAAT,CAAxC;AACA,QAAMgB,sBAAsB,GAAGhB,WAAW,CAAC,MAAD,EAAS,wBAAT,CAA1C;AAEA,QAAMiB,cAAc,GAAGlB,QAAQ,CAAC,kBAAD,CAA/B;AACA,QAAMmB,mBAAmB,GAAGnB,QAAQ,CAAC,uBAAD,CAApC;AAEAJ,EAAAA,SAAS,CAAC,MAAM;AACf,UAAMwB,QAAQ,GAAG,YAAY;AAC5BX,MAAAA,UAAU,CAAC,IAAD,CAAV;;AAEA,UAAI;AACH,cAAM;AAAEY,UAAAA;AAAF,YAAgB,MAAMP,yBAAyB,EAArD;AACAH,QAAAA,mBAAmB,CAACU,SAAD,CAAnB;AACA,OAHD,CAGE,OAAOC,KAAP,EAAc;AACff,QAAAA,oBAAoB,CAAC;AAAEgB,UAAAA,IAAI,EAAE,OAAR;AAAiBC,UAAAA,OAAO,EAAElB,CAAC,CAAC,iCAAD;AAA3B,SAAD,CAApB;AACA;;AAED,UAAI;AACH,cAAMmB,UAAU,GAAG,MAAMV,yBAAyB,EAAlD;AACAF,QAAAA,mBAAmB,CAACY,UAAD,CAAnB;AACA,OAHD,CAGE,OAAOH,KAAP,EAAc;AACff,QAAAA,oBAAoB,CAAC;AAAEgB,UAAAA,IAAI,EAAE,OAAR;AAAiBC,UAAAA,OAAO,EAAElB,CAAC,CAAC,+BAAD;AAA3B,SAAD,CAApB;AACA;;AAEDG,MAAAA,UAAU,CAAC,KAAD,CAAV;AACA,KAlBD;;AAoBAW,IAAAA,QAAQ;AACR,GAtBQ,EAsBN,CAACb,oBAAD,EAAuBO,yBAAvB,EAAkDC,yBAAlD,EAA6EJ,mBAA7E,EAAkGE,mBAAlG,EAAuHJ,UAAvH,EAAmIH,CAAnI,CAtBM,CAAT;AAwBA,QAAMoB,sBAAsB,GAAG7B,OAAO,CAAC,MAAMe,gBAAN,aAAMA,gBAAN,uBAAMA,gBAAgB,CAAEe,IAAlB,CAAuB;AAAA,QAAC;AAAEC,MAAAA;AAAF,KAAD;AAAA,WAAgBA,MAAM,KAAK9B,YAAY,CAAC+B,IAAxC;AAAA,GAAvB,CAAP,EAA6E,CAACjB,gBAAD,CAA7E,CAAtC;;AAEA,QAAMkB,oBAAoB,GAAG,MAAM;AAClCZ,IAAAA,cAAc,CAACa,IAAf;AACA,GAFD;;AAIA,QAAMC,+BAA+B,GAAG,YAAY;AACnD,QAAI;AACHvB,MAAAA,UAAU,CAAC,IAAD,CAAV;AACA,YAAM;AAAEwB,QAAAA;AAAF,UAAY,MAAMjB,oBAAoB,EAA5C;;AAEA,UAAI,CAACiB,KAAL,EAAY;AACX1B,QAAAA,oBAAoB,CAAC;AAAEgB,UAAAA,IAAI,EAAE,MAAR;AAAgBC,UAAAA,OAAO,EAAElB,CAAC,CAAC,2BAAD;AAA1B,SAAD,CAApB;AACAG,QAAAA,UAAU,CAAC,KAAD,CAAV;AACA;AACA;;AAEDF,MAAAA,oBAAoB,CAAC;AAAEgB,QAAAA,IAAI,EAAE,MAAR;AAAgBC,QAAAA,OAAO,EAAElB,CAAC,CAAC,wBAAD;AAA1B,OAAD,CAApB;AACAa,MAAAA,mBAAmB,CAACY,IAApB;AACA,KAZD,CAYE,OAAOT,KAAP,EAAc;AACfY,MAAAA,OAAO,CAACZ,KAAR,CAAcA,KAAd;AACAf,MAAAA,oBAAoB,CAAC;AAAEgB,QAAAA,IAAI,EAAE,OAAR;AAAiBC,QAAAA,OAAO,EAAElB,CAAC,CAAC,0BAAD;AAA3B,OAAD,CAApB;AACAG,MAAAA,UAAU,CAAC,KAAD,CAAV;AACA;AACD,GAlBD;;AAoBA,QAAM0B,iCAAiC,GAAG,YAAY;AACrD,QAAI;AACH1B,MAAAA,UAAU,CAAC,IAAD,CAAV;AACA,YAAM;AAAEwB,QAAAA;AAAF,UAAY,MAAMhB,sBAAsB,EAA9C;;AAEA,UAAI,CAACgB,KAAL,EAAY;AACX1B,QAAAA,oBAAoB,CAAC;AAAEgB,UAAAA,IAAI,EAAE,MAAR;AAAgBC,UAAAA,OAAO,EAAElB,CAAC,CAAC,2BAAD;AAA1B,SAAD,CAApB;AACAG,QAAAA,UAAU,CAAC,KAAD,CAAV;AACA;AACA;;AAEDF,MAAAA,oBAAoB,CAAC;AAAEgB,QAAAA,IAAI,EAAE,MAAR;AAAgBC,QAAAA,OAAO,EAAElB,CAAC,CAAC,wBAAD;AAA1B,OAAD,CAApB;AACAa,MAAAA,mBAAmB,CAACY,IAApB;AACA,KAZD,CAYE,OAAOT,KAAP,EAAc;AACfY,MAAAA,OAAO,CAACZ,KAAR,CAAcA,KAAd;AACAf,MAAAA,oBAAoB,CAAC;AAAEgB,QAAAA,IAAI,EAAE,OAAR;AAAiBC,QAAAA,OAAO,EAAElB,CAAC,CAAC,0BAAD;AAA3B,OAAD,CAApB;AACAG,MAAAA,UAAU,CAAC,KAAD,CAAV;AACA;AACD,GAlBD;;AAoBA,QAAM2B,KAAK,GAAG5C,aAAa,CAAC,oBAAD,CAA3B;AAEA,sBACC,oBAAC,IAAD,qBACC,oBAAC,IAAD,CAAM,MAAN;AAAa,IAAA,KAAK,EAAEc,CAAC,CAAC,QAAD;AAArB,kBACC,oBAAC,WAAD,qBACC,oBAAC,MAAD;AAAQ,IAAA,OAAO,MAAf;AAAgB,IAAA,QAAQ,EAAEE,SAA1B;AAAqC,IAAA,OAAO,EAAEsB;AAA9C,KACExB,CAAC,CAAC,iBAAD,CADH,CADD,EAIEoB,sBAAsB,iBACtB,oBAAC,MAAD;AAAQ,IAAA,QAAQ,EAAElB,SAAlB;AAA6B,IAAA,OAAO,EAAEwB;AAAtC,KACE1B,CAAC,CAAC,wBAAD,CADH,CALF,EASEoB,sBAAsB,iBACtB,oBAAC,MAAD;AAAQ,IAAA,QAAQ,EAAElB,SAAlB;AAA6B,IAAA,OAAO,EAAE2B;AAAtC,KACE7B,CAAC,CAAC,0BAAD,CADH,CAVF,CADD,CADD,eAkBC,oBAAC,IAAD,CAAM,2BAAN,qBACC,oBAAC,KAAD;AAAO,IAAA,KAAK;AAAZ,kBACC,oBAAC,KAAD,CAAO,IAAP,qBACC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,OAAO,EAAE,CAA7B;AAAgC,IAAA,KAAK,EAAC;AAAtC,KACEA,CAAC,CAAC,aAAD,CADH,CADD,eAIC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,OAAO,EAAE;AAA7B,KACEA,CAAC,CAAC,cAAD,CADH,CAJD,EAOE,CAAC8B,KAAD,iBACA,uDACC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,OAAO,EAAE;AAA7B,KACE9B,CAAC,CAAC,aAAD,CADH,CADD,eAIC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,OAAO,EAAE;AAA7B,KACEA,CAAC,CAAC,MAAD,CADH,CAJD,eAOC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,KAAK,EAAC,QAA1B;AAAmC,IAAA,OAAO,EAAE,CAA5C;AAA+C,IAAA,KAAK,EAAC;AAArD,KACEA,CAAC,CAAC,UAAD,CADH,CAPD,CARF,CADD,EAsBE,CAAC8B,KAAD,iBACA,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,KAAK,EAAC;AAA1B,KACE9B,CAAC,CAAC,OAAD,CADH,CADD,eAIC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,KAAK,EAAC;AAA1B,KACEA,CAAC,CAAC,UAAD,CADH,CAJD,eAOC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,KAAK,EAAC;AAA1B,KACEA,CAAC,CAAC,UAAD,CADH,CAPD,eAUC,oBAAC,KAAD,CAAO,IAAP;AAAY,IAAA,EAAE,EAAC,IAAf;AAAoB,IAAA,KAAK,EAAC;AAA1B,KACEA,CAAC,CAAC,OAAD,CADH,CAVD,CAvBF,CADD,eAwCC,oBAAC,KAAD,CAAO,IAAP,QACEE,SAAS,GACT6B,KAAK,CAACC,IAAN,CAAW;AAAEC,IAAAA,MAAM,EAAE;AAAV,GAAX,EAA2B,CAACC,CAAD,EAAIC,CAAJ,kBAAU,oBAAC,sBAAD,CAAwB,QAAxB;AAAiC,IAAA,KAAK,EAAEL,KAAxC;AAA+C,IAAA,GAAG,EAAEK;AAApD,IAArC,CADS,gBAGT,0CACE,CAAA/B,gBAAgB,SAAhB,IAAAA,gBAAgB,WAAhB,YAAAA,gBAAgB,CAAEgC,KAAlB,kBAA2B,oBAAC,sBAAD,eAA4BhC,gBAA5B;AAA8C,IAAA,KAAK,EAAE0B;AAArD,KAD7B,EAEExB,gBAFF,aAEEA,gBAFF,gDAEEA,gBAAgB,CACd+B,MADF,CACS;AAAA,QAAC;AAAEC,MAAAA;AAAF,KAAD;AAAA,WAAa,CAAAlC,gBAAgB,SAAhB,IAAAA,gBAAgB,WAAhB,YAAAA,gBAAgB,CAAEkC,GAAlB,MAA0BA,GAA1B,IAAiC,EAAClC,gBAAD,aAACA,gBAAD,eAACA,gBAAgB,CAAEgC,KAAnB,CAA9C;AAAA,GADT,CAFF,CAIE;AAJF,4DAEE,sBAGEG,GAHF,CAGOxB,SAAD,iBACL,oBAAC,sBAAD;AAAwB,IAAA,GAAG,EAAEA,SAAS,CAACuB;AAAvC,KAAgDvB,SAAhD;AAA2D,IAAA,KAAK,EAAE,KAAlE;AAAyE,IAAA,KAAK,EAAEe;AAAhF,KAJD,CAFF,CAJF,CAxCD,CADD,CAlBD,CADD;AA+EA;;AAnLDnD,MAAM,CAAC6D,aAAP,CAqLezC,iBArLf","sourcesContent":["import { Button, ButtonGroup, Table } from '@rocket.chat/fuselage';\nimport { useMediaQuery, useSafely } from '@rocket.chat/fuselage-hooks';\nimport React, { useState, useEffect, useMemo } from 'react';\n\nimport { ProgressStep } from '../../../../app/importer/lib/ImporterProgressStep';\nimport Page from '../../../components/Page';\nimport { useRoute } from '../../../contexts/RouterContext';\nimport { useEndpoint } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport ImportOperationSummary from './ImportOperationSummary';\n\nfunction ImportHistoryPage() {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [isLoading, setLoading] = useSafely(useState(true));\n\tconst [currentOperation, setCurrentOperation] = useSafely(useState());\n\tconst [latestOperations, setLatestOperations] = useSafely(useState([]));\n\n\tconst getCurrentImportOperation = useEndpoint('GET', 'getCurrentImportOperation');\n\tconst getLatestImportOperations = useEndpoint('GET', 'getLatestImportOperations');\n\tconst downloadPendingFiles = useEndpoint('POST', 'downloadPendingFiles');\n\tconst downloadPendingAvatars = useEndpoint('POST', 'downloadPendingAvatars');\n\n\tconst newImportRoute = useRoute('admin-import-new');\n\tconst importProgressRoute = useRoute('admin-import-progress');\n\n\tuseEffect(() => {\n\t\tconst loadData = async () => {\n\t\t\tsetLoading(true);\n\n\t\t\ttry {\n\t\t\t\tconst { operation } = await getCurrentImportOperation();\n\t\t\t\tsetCurrentOperation(operation);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Failed_To_Load_Import_Operation') });\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst operations = await getLatestImportOperations();\n\t\t\t\tsetLatestOperations(operations);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Failed_To_Load_Import_History') });\n\t\t\t}\n\n\t\t\tsetLoading(false);\n\t\t};\n\n\t\tloadData();\n\t}, [dispatchToastMessage, getCurrentImportOperation, getLatestImportOperations, setCurrentOperation, setLatestOperations, setLoading, t]);\n\n\tconst hasAnySuccessfulImport = useMemo(() => latestOperations?.some(({ status }) => status === ProgressStep.DONE), [latestOperations]);\n\n\tconst handleNewImportClick = () => {\n\t\tnewImportRoute.push();\n\t};\n\n\tconst handleDownloadPendingFilesClick = async () => {\n\t\ttry {\n\t\t\tsetLoading(true);\n\t\t\tconst { count } = await downloadPendingFiles();\n\n\t\t\tif (!count) {\n\t\t\t\tdispatchToastMessage({ type: 'info', message: t('No_files_left_to_download') });\n\t\t\t\tsetLoading(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'info', message: t('File_Downloads_Started') });\n\t\t\timportProgressRoute.push();\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tdispatchToastMessage({ type: 'error', message: t('Failed_To_Download_Files') });\n\t\t\tsetLoading(false);\n\t\t}\n\t};\n\n\tconst handleDownloadPendingAvatarsClick = async () => {\n\t\ttry {\n\t\t\tsetLoading(true);\n\t\t\tconst { count } = await downloadPendingAvatars();\n\n\t\t\tif (!count) {\n\t\t\t\tdispatchToastMessage({ type: 'info', message: t('No_files_left_to_download') });\n\t\t\t\tsetLoading(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'info', message: t('File_Downloads_Started') });\n\t\t\timportProgressRoute.push();\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tdispatchToastMessage({ type: 'error', message: t('Failed_To_Download_Files') });\n\t\t\tsetLoading(false);\n\t\t}\n\t};\n\n\tconst small = useMediaQuery('(max-width: 768px)');\n\n\treturn (\n\t\t<Page>\n\t\t\t<Page.Header title={t('Import')}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button primary disabled={isLoading} onClick={handleNewImportClick}>\n\t\t\t\t\t\t{t('Import_New_File')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t{hasAnySuccessfulImport && (\n\t\t\t\t\t\t<Button disabled={isLoading} onClick={handleDownloadPendingFilesClick}>\n\t\t\t\t\t\t\t{t('Download_Pending_Files')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t\t{hasAnySuccessfulImport && (\n\t\t\t\t\t\t<Button disabled={isLoading} onClick={handleDownloadPendingAvatarsClick}>\n\t\t\t\t\t\t\t{t('Download_Pending_Avatars')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t<Table fixed>\n\t\t\t\t\t<Table.Head>\n\t\t\t\t\t\t<Table.Row>\n\t\t\t\t\t\t\t<Table.Cell is='th' rowSpan={2} width='x140'>\n\t\t\t\t\t\t\t\t{t('Import_Type')}\n\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t<Table.Cell is='th' rowSpan={2}>\n\t\t\t\t\t\t\t\t{t('Last_Updated')}\n\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t{!small && (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Table.Cell is='th' rowSpan={2}>\n\t\t\t\t\t\t\t\t\t\t{t('Last_Status')}\n\t\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t\t\t<Table.Cell is='th' rowSpan={2}>\n\t\t\t\t\t\t\t\t\t\t{t('File')}\n\t\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t\t\t<Table.Cell is='th' align='center' colSpan={4} width='x320'>\n\t\t\t\t\t\t\t\t\t\t{t('Counters')}\n\t\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Table.Row>\n\t\t\t\t\t\t{!small && (\n\t\t\t\t\t\t\t<Table.Row>\n\t\t\t\t\t\t\t\t<Table.Cell is='th' align='center'>\n\t\t\t\t\t\t\t\t\t{t('Users')}\n\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t\t<Table.Cell is='th' align='center'>\n\t\t\t\t\t\t\t\t\t{t('Channels')}\n\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t\t<Table.Cell is='th' align='center'>\n\t\t\t\t\t\t\t\t\t{t('Messages')}\n\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t\t<Table.Cell is='th' align='center'>\n\t\t\t\t\t\t\t\t\t{t('Total')}\n\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t</Table.Row>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Table.Head>\n\t\t\t\t\t<Table.Body>\n\t\t\t\t\t\t{isLoading ? (\n\t\t\t\t\t\t\tArray.from({ length: 20 }, (_, i) => <ImportOperationSummary.Skeleton small={small} key={i} />)\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t{currentOperation?.valid && <ImportOperationSummary {...currentOperation} small={small} />}\n\t\t\t\t\t\t\t\t{latestOperations\n\t\t\t\t\t\t\t\t\t?.filter(({ _id }) => currentOperation?._id !== _id || !currentOperation?.valid)\n\t\t\t\t\t\t\t\t\t// Forcing valid=false as the current API only accept preparation/progress over currentOperation\n\t\t\t\t\t\t\t\t\t?.map((operation) => (\n\t\t\t\t\t\t\t\t\t\t<ImportOperationSummary key={operation._id} {...operation} valid={false} small={small} />\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Table.Body>\n\t\t\t\t</Table>\n\t\t\t</Page.ScrollableContentWithShadow>\n\t\t</Page>\n\t);\n}\n\nexport default ImportHistoryPage;\n"]},"sourceType":"module","hash":"2652d7fae9a00701671d6b4eaa03616b0bcd1b68"}
