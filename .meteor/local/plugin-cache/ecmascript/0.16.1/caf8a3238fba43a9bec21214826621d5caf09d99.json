{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/search/client/provider/result.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/search/client/provider/result.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/search/client/provider/result.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/search/client/provider/result.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/search/client/provider/result.js"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 1);\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 2);\nlet FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter(v) {\n    FlowRouter = v;\n  }\n\n}, 3);\nlet Session;\nmodule.link(\"meteor/session\", {\n  Session(v) {\n    Session = v;\n  }\n\n}, 4);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 5);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 6);\nlet messageContext;\nmodule.link(\"../../../ui-utils/client/lib/messageContext\", {\n  messageContext(v) {\n    messageContext = v;\n  }\n\n}, 7);\nlet MessageAction, RoomHistoryManager;\nmodule.link(\"../../../ui-utils\", {\n  MessageAction(v) {\n    MessageAction = v;\n  },\n\n  RoomHistoryManager(v) {\n    RoomHistoryManager = v;\n  }\n\n}, 8);\nlet messageArgs;\nmodule.link(\"../../../ui-utils/client/lib/messageArgs\", {\n  messageArgs(v) {\n    messageArgs = v;\n  }\n\n}, 9);\nlet Rooms;\nmodule.link(\"../../../models/client\", {\n  Rooms(v) {\n    Rooms = v;\n  }\n\n}, 10);\nlet getCommonRoomEvents;\nmodule.link(\"../../../ui/client/views/app/lib/getCommonRoomEvents\", {\n  getCommonRoomEvents(v) {\n    getCommonRoomEvents = v;\n  }\n\n}, 11);\nlet goToRoomById;\nmodule.link(\"../../../../client/lib/utils/goToRoomById\", {\n  goToRoomById(v) {\n    goToRoomById = v;\n  }\n\n}, 12);\nMeteor.startup(function () {\n  MessageAction.addButton({\n    id: 'jump-to-search-message',\n    icon: 'jump',\n    label: 'Jump_to_message',\n    context: ['search'],\n\n    action() {\n      const {\n        msg: message\n      } = messageArgs(this);\n\n      if (message.tmid) {\n        return FlowRouter.go(FlowRouter.getRouteName(), {\n          tab: 'thread',\n          context: message.tmid,\n          rid: message.rid,\n          name: Rooms.findOne({\n            _id: message.rid\n          }).name\n        }, {\n          jump: message._id\n        });\n      }\n\n      if (Session.get('openedRoom') === message.rid) {\n        return RoomHistoryManager.getSurroundingMessages(message, 50);\n      }\n\n      goToRoomById(message.rid); // RocketChat.MessageAction.hideDropDown();\n\n      if (window.matchMedia('(max-width: 500px)').matches) {\n        Template.instance().tabBar.close();\n      }\n\n      window.setTimeout(() => {\n        RoomHistoryManager.getSurroundingMessages(message, 50);\n      }, 400); // 400ms is popular among game devs as a good delay before transition starts\n      // ie. 50, 100, 200, 400, 800 are the favored timings\n    },\n\n    order: 100,\n    group: 'menu'\n  });\n});\nTemplate.DefaultSearchResultTemplate.onRendered(function () {\n  const list = this.firstNode.parentNode.querySelector('.rocket-default-search-results');\n  this.autorun(() => {\n    const result = this.data.result.get();\n\n    if (result && this.hasMore.get()) {\n      Tracker.afterFlush(() => {\n        if (list.scrollHeight < list.offsetHeight) {\n          this.data.payload.limit = (this.data.payload.limit || this.pageSize) + this.pageSize;\n          this.data.search();\n        }\n      });\n    }\n  });\n});\nTemplate.DefaultSearchResultTemplate.onCreated(function () {\n  // paging\n  this.pageSize = this.data.settings.PageSize; // global search\n\n  this.globalSearchEnabled = this.data.settings.GlobalSearchEnabled;\n  this.data.parentPayload.searchAll = this.globalSearchEnabled;\n  this.hasMore = new ReactiveVar(true);\n  this.autorun(() => {\n    const result = this.data.result.get();\n    this.hasMore.set(!(result && result.message.docs.length < (this.data.payload.limit || this.pageSize)));\n  });\n});\nTemplate.DefaultSearchResultTemplate.events(_objectSpread(_objectSpread({}, getCommonRoomEvents()), {}, {\n  'change #global-search'(e, t) {\n    t.data.parentPayload.searchAll = e.target.checked;\n    t.data.payload.limit = t.pageSize;\n    t.data.result.set(undefined);\n    t.data.search();\n  },\n\n  'scroll .rocket-default-search-results': _.throttle(function (e, t) {\n    if (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight && t.hasMore.get()) {\n      t.data.payload.limit = (t.data.payload.limit || t.pageSize) + t.pageSize;\n      t.data.search();\n    }\n  }, 200)\n}));\nTemplate.DefaultSearchResultTemplate.helpers({\n  result() {\n    return Template.instance().data.result.get();\n  },\n\n  globalSearchEnabled() {\n    return Template.instance().globalSearchEnabled;\n  },\n\n  searching() {\n    return Template.instance().data.searching.get();\n  },\n\n  hasMore() {\n    return Template.instance().hasMore.get();\n  },\n\n  messageParse(msg) {\n    const text = Template.instance().data.text.get();\n    msg.searchedText = text;\n    return _objectSpread(_objectSpread({\n      customClass: 'search',\n      actionContext: 'search'\n    }, msg), {}, {\n      groupable: false\n    });\n  },\n\n  messageContext() {\n    const result = messageContext.call(this, {\n      rid: Session.get('openedRoom')\n    });\n    return _objectSpread(_objectSpread({}, result), {}, {\n      settings: _objectSpread(_objectSpread({}, result.settings), {}, {\n        showReplyButton: false,\n        showreply: false\n      })\n    });\n  }\n\n});","map":{"version":3,"sources":["app/search/client/provider/result.js"],"names":["_objectSpread","module","link","default","v","Meteor","Tracker","ReactiveVar","FlowRouter","Session","Template","_","messageContext","MessageAction","RoomHistoryManager","messageArgs","Rooms","getCommonRoomEvents","goToRoomById","startup","addButton","id","icon","label","context","action","msg","message","tmid","go","getRouteName","tab","rid","name","findOne","_id","jump","get","getSurroundingMessages","window","matchMedia","matches","instance","tabBar","close","setTimeout","order","group","DefaultSearchResultTemplate","onRendered","list","firstNode","parentNode","querySelector","autorun","result","data","hasMore","afterFlush","scrollHeight","offsetHeight","payload","limit","pageSize","search","onCreated","settings","PageSize","globalSearchEnabled","GlobalSearchEnabled","parentPayload","searchAll","set","docs","length","events","e","t","target","checked","undefined","throttle","scrollTop","clientHeight","helpers","searching","messageParse","text","searchedText","customClass","actionContext","groupable","call","showReplyButton","showreply"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Session } from 'meteor/session';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\n\nimport { messageContext } from '../../../ui-utils/client/lib/messageContext';\nimport { MessageAction, RoomHistoryManager } from '../../../ui-utils';\nimport { messageArgs } from '../../../ui-utils/client/lib/messageArgs';\nimport { Rooms } from '../../../models/client';\nimport { getCommonRoomEvents } from '../../../ui/client/views/app/lib/getCommonRoomEvents';\nimport { goToRoomById } from '../../../../client/lib/utils/goToRoomById';\n\nMeteor.startup(function () {\n\tMessageAction.addButton({\n\t\tid: 'jump-to-search-message',\n\t\ticon: 'jump',\n\t\tlabel: 'Jump_to_message',\n\t\tcontext: ['search'],\n\t\taction() {\n\t\t\tconst { msg: message } = messageArgs(this);\n\t\t\tif (message.tmid) {\n\t\t\t\treturn FlowRouter.go(\n\t\t\t\t\tFlowRouter.getRouteName(),\n\t\t\t\t\t{\n\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\tcontext: message.tmid,\n\t\t\t\t\t\trid: message.rid,\n\t\t\t\t\t\tname: Rooms.findOne({ _id: message.rid }).name,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tjump: message._id,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (Session.get('openedRoom') === message.rid) {\n\t\t\t\treturn RoomHistoryManager.getSurroundingMessages(message, 50);\n\t\t\t}\n\n\t\t\tgoToRoomById(message.rid);\n\t\t\t// RocketChat.MessageAction.hideDropDown();\n\n\t\t\tif (window.matchMedia('(max-width: 500px)').matches) {\n\t\t\t\tTemplate.instance().tabBar.close();\n\t\t\t}\n\n\t\t\twindow.setTimeout(() => {\n\t\t\t\tRoomHistoryManager.getSurroundingMessages(message, 50);\n\t\t\t}, 400);\n\t\t\t// 400ms is popular among game devs as a good delay before transition starts\n\t\t\t// ie. 50, 100, 200, 400, 800 are the favored timings\n\t\t},\n\t\torder: 100,\n\t\tgroup: 'menu',\n\t});\n});\n\nTemplate.DefaultSearchResultTemplate.onRendered(function () {\n\tconst list = this.firstNode.parentNode.querySelector('.rocket-default-search-results');\n\tthis.autorun(() => {\n\t\tconst result = this.data.result.get();\n\t\tif (result && this.hasMore.get()) {\n\t\t\tTracker.afterFlush(() => {\n\t\t\t\tif (list.scrollHeight < list.offsetHeight) {\n\t\t\t\t\tthis.data.payload.limit = (this.data.payload.limit || this.pageSize) + this.pageSize;\n\t\t\t\t\tthis.data.search();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n\nTemplate.DefaultSearchResultTemplate.onCreated(function () {\n\t// paging\n\tthis.pageSize = this.data.settings.PageSize;\n\n\t// global search\n\tthis.globalSearchEnabled = this.data.settings.GlobalSearchEnabled;\n\tthis.data.parentPayload.searchAll = this.globalSearchEnabled;\n\n\tthis.hasMore = new ReactiveVar(true);\n\n\tthis.autorun(() => {\n\t\tconst result = this.data.result.get();\n\t\tthis.hasMore.set(!(result && result.message.docs.length < (this.data.payload.limit || this.pageSize)));\n\t});\n});\n\nTemplate.DefaultSearchResultTemplate.events({\n\t...getCommonRoomEvents(),\n\t'change #global-search'(e, t) {\n\t\tt.data.parentPayload.searchAll = e.target.checked;\n\t\tt.data.payload.limit = t.pageSize;\n\t\tt.data.result.set(undefined);\n\t\tt.data.search();\n\t},\n\t'scroll .rocket-default-search-results': _.throttle(function (e, t) {\n\t\tif (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight && t.hasMore.get()) {\n\t\t\tt.data.payload.limit = (t.data.payload.limit || t.pageSize) + t.pageSize;\n\t\t\tt.data.search();\n\t\t}\n\t}, 200),\n});\n\nTemplate.DefaultSearchResultTemplate.helpers({\n\tresult() {\n\t\treturn Template.instance().data.result.get();\n\t},\n\tglobalSearchEnabled() {\n\t\treturn Template.instance().globalSearchEnabled;\n\t},\n\tsearching() {\n\t\treturn Template.instance().data.searching.get();\n\t},\n\thasMore() {\n\t\treturn Template.instance().hasMore.get();\n\t},\n\tmessageParse(msg) {\n\t\tconst text = Template.instance().data.text.get();\n\t\tmsg.searchedText = text;\n\t\treturn { customClass: 'search', actionContext: 'search', ...msg, groupable: false };\n\t},\n\tmessageContext() {\n\t\tconst result = messageContext.call(this, { rid: Session.get('openedRoom') });\n\t\treturn {\n\t\t\t...result,\n\t\t\tsettings: {\n\t\t\t\t...result.settings,\n\t\t\t\tshowReplyButton: false,\n\t\t\t\tshowreply: false,\n\t\t\t},\n\t\t};\n\t},\n});\n"]},"sourceType":"module","hash":"caf8a3238fba43a9bec21214826621d5caf09d99"}
