{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/lib/getCommonRoomEvents.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui/client/views/app/lib/getCommonRoomEvents.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/lib/getCommonRoomEvents.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/lib/getCommonRoomEvents.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/views/app/lib/getCommonRoomEvents.js"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nmodule.export({\n  getCommonRoomEvents: () => getCommonRoomEvents\n});\nlet Clipboard;\nmodule.link(\"clipboard\", {\n  default(v) {\n    Clipboard = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet Random;\nmodule.link(\"meteor/random\", {\n  Random(v) {\n    Random = v;\n  }\n\n}, 2);\nlet FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter(v) {\n    FlowRouter = v;\n  }\n\n}, 3);\nlet popover, MessageAction;\nmodule.link(\"../../../../../ui-utils/client\", {\n  popover(v) {\n    popover = v;\n  },\n\n  MessageAction(v) {\n    MessageAction = v;\n  }\n\n}, 4);\nlet addMessageToList;\nmodule.link(\"../../../../../ui-utils/client/lib/MessageAction\", {\n  addMessageToList(v) {\n    addMessageToList = v;\n  }\n\n}, 5);\nlet callWithErrorHandling;\nmodule.link(\"../../../../../../client/lib/utils/callWithErrorHandling\", {\n  callWithErrorHandling(v) {\n    callWithErrorHandling = v;\n  }\n\n}, 6);\nlet isURL;\nmodule.link(\"../../../../../utils/lib/isURL\", {\n  isURL(v) {\n    isURL = v;\n  }\n\n}, 7);\nlet openUserCard;\nmodule.link(\"../../../lib/UserCard\", {\n  openUserCard(v) {\n    openUserCard = v;\n  }\n\n}, 8);\nlet messageArgs;\nmodule.link(\"../../../../../ui-utils/client/lib/messageArgs\", {\n  messageArgs(v) {\n    messageArgs = v;\n  }\n\n}, 9);\nlet ChatMessage, Rooms, Messages;\nmodule.link(\"../../../../../models\", {\n  ChatMessage(v) {\n    ChatMessage = v;\n  },\n\n  Rooms(v) {\n    Rooms = v;\n  },\n\n  Messages(v) {\n    Messages = v;\n  }\n\n}, 10);\nlet t;\nmodule.link(\"../../../../../utils/client\", {\n  t(v) {\n    t = v;\n  }\n\n}, 11);\nlet chatMessages;\nmodule.link(\"../room\", {\n  chatMessages(v) {\n    chatMessages = v;\n  }\n\n}, 12);\nlet EmojiEvents;\nmodule.link(\"../../../../../reactions/client/init\", {\n  EmojiEvents(v) {\n    EmojiEvents = v;\n  }\n\n}, 13);\nlet goToRoomById;\nmodule.link(\"../../../../../../client/lib/utils/goToRoomById\", {\n  goToRoomById(v) {\n    goToRoomById = v;\n  }\n\n}, 14);\nlet fireGlobalEvent;\nmodule.link(\"../../../../../../client/lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent(v) {\n    fireGlobalEvent = v;\n  }\n\n}, 15);\nlet isLayoutEmbedded;\nmodule.link(\"../../../../../../client/lib/utils/isLayoutEmbedded\", {\n  isLayoutEmbedded(v) {\n    isLayoutEmbedded = v;\n  }\n\n}, 16);\nlet onClientBeforeSendMessage;\nmodule.link(\"../../../../../../client/lib/onClientBeforeSendMessage\", {\n  onClientBeforeSendMessage(v) {\n    onClientBeforeSendMessage = v;\n  }\n\n}, 17);\n\nconst mountPopover = (e, i, outerContext) => {\n  let context = $(e.target).parents('.message').data('context');\n\n  if (!context) {\n    context = 'message';\n  }\n\n  const messageContext = messageArgs(outerContext);\n  let menuItems = MessageAction.getButtons(messageContext, context, 'menu').map(item => ({\n    icon: item.icon,\n    name: t(item.label),\n    type: 'message-action',\n    id: item.id,\n    modifier: item.color\n  }));\n\n  if (window.matchMedia('(max-width: 500px)').matches) {\n    const messageItems = MessageAction.getButtons(messageContext, context, 'message').map(item => ({\n      icon: item.icon,\n      name: t(item.label),\n      type: 'message-action',\n      id: item.id,\n      modifier: item.color\n    }));\n    menuItems = menuItems.concat(messageItems);\n  }\n\n  const [items, deleteItem] = menuItems.reduce((result, value) => {\n    result[value.id === 'delete-message' ? 1 : 0].push(value);\n    return result;\n  }, [[], []]);\n  const groups = [{\n    items\n  }];\n\n  if (deleteItem.length) {\n    groups.push({\n      items: deleteItem\n    });\n  }\n\n  const config = {\n    columns: [{\n      groups\n    }],\n    instance: i,\n    currentTarget: e.currentTarget,\n    data: outerContext,\n    activeElement: $(e.currentTarget).parents('.message')[0],\n    onRendered: () => new Clipboard('.rc-popover__item')\n  };\n  popover.open(config);\n};\n\nconst getCommonRoomEvents = () => _objectSpread(_objectSpread({}, (() => {\n  let touchMoved = false;\n  let lastTouchX = null;\n  let lastTouchY = null;\n  let touchtime = null;\n  return _objectSpread(_objectSpread({}, EmojiEvents), {}, {\n    'click .message img'(e) {\n      clearTimeout(touchtime);\n\n      if (touchMoved === true) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    },\n\n    'touchstart .message'(e) {\n      const {\n        touches\n      } = e.originalEvent;\n\n      if (touches && touches.length) {\n        lastTouchX = touches[0].pageX;\n        lastTouchY = touches[0].pagey;\n      }\n\n      touchMoved = false;\n\n      if (e.originalEvent.touches.length !== 1) {\n        return;\n      }\n\n      if ($(e.currentTarget).hasClass('system')) {\n        return;\n      }\n\n      if (e.target && e.target.nodeName === 'AUDIO') {\n        return;\n      }\n\n      if (e.target && e.target.nodeName === 'A' && isURL(e.target.getAttribute('href'))) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      const doLongTouch = () => {\n        mountPopover(e, t, this);\n      };\n\n      clearTimeout(touchtime);\n      touchtime = setTimeout(doLongTouch, 500);\n    },\n\n    'touchend .message'(e) {\n      clearTimeout(touchtime);\n\n      if (e.target && e.target.nodeName === 'A' && isURL(e.target.getAttribute('href'))) {\n        if (touchMoved === true) {\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        window.open(e.target.href);\n      }\n    },\n\n    'touchmove .message'(e) {\n      const {\n        touches\n      } = e.originalEvent;\n\n      if (touches && touches.length) {\n        const deltaX = Math.abs(lastTouchX - touches[0].pageX);\n        const deltaY = Math.abs(lastTouchY - touches[0].pageY);\n\n        if (deltaX > 5 || deltaY > 5) {\n          touchMoved = true;\n        }\n      }\n\n      clearTimeout(touchtime);\n    },\n\n    'touchcancel .message'() {\n      clearTimeout(touchtime);\n    }\n\n  });\n})()), {}, {\n  'click [data-message-action]'(event, template) {\n    const button = MessageAction.getButtonById(event.currentTarget.dataset.messageAction);\n\n    if ((button != null ? button.action : undefined) != null) {\n      button.action.call(this, event, {\n        tabBar: template.tabBar,\n        rid: template.data.rid\n      });\n    }\n  },\n\n  'click .js-follow-thread'(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const {\n      msg\n    } = messageArgs(this);\n    callWithErrorHandling('followMessage', {\n      mid: msg._id\n    });\n  },\n\n  'click .js-unfollow-thread'(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const {\n      msg\n    } = messageArgs(this);\n    callWithErrorHandling('unfollowMessage', {\n      mid: msg._id\n    });\n  },\n\n  'click .js-open-thread'(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    const {\n      msg: {\n        rid,\n        _id,\n        tmid\n      }\n    } = messageArgs(this);\n    const room = Rooms.findOne({\n      _id: rid\n    });\n    FlowRouter.go(FlowRouter.getRouteName(), {\n      rid,\n      name: room.name,\n      tab: 'thread',\n      context: tmid || _id\n    }, {\n      jump: tmid && tmid !== _id && _id && _id\n    });\n  },\n\n  'click .image-to-download'(event) {\n    const {\n      msg\n    } = messageArgs(this);\n    ChatMessage.update({\n      '_id': msg._id,\n      'urls.url': $(event.currentTarget).data('url')\n    }, {\n      $set: {\n        'urls.$.downloadImages': true\n      }\n    });\n    ChatMessage.update({\n      '_id': msg._id,\n      'attachments.image_url': $(event.currentTarget).data('url')\n    }, {\n      $set: {\n        'attachments.$.downloadImages': true\n      }\n    });\n  },\n\n  'click .user-card-message'(e, instance) {\n    const {\n      msg\n    } = messageArgs(this);\n\n    if (!Meteor.userId()) {\n      return;\n    }\n\n    const {\n      username\n    } = msg.u;\n\n    if (username) {\n      openUserCard({\n        username,\n        rid: instance.data.rid,\n        target: e.currentTarget,\n        open: e => {\n          e.preventDefault();\n          instance.data.tabBar.openUserInfo(username);\n        }\n      });\n    }\n  },\n\n  'click .js-actionButton-respondWithMessage'(event, instance) {\n    const {\n      rid\n    } = instance.data;\n    const msg = event.currentTarget.value;\n\n    if (!msg) {\n      return;\n    }\n\n    const {\n      input\n    } = chatMessages[rid];\n    input.value = msg;\n    input.focus();\n  },\n\n  async 'click .js-actionButton-respondWithQuotedMessage'(event, instance) {\n    const {\n      rid\n    } = instance.data;\n    const {\n      id: msgId\n    } = event.currentTarget;\n    const {\n      $input\n    } = chatMessages[rid];\n\n    if (!msgId) {\n      return;\n    }\n\n    const message = Messages.findOne({\n      _id: msgId\n    });\n    let messages = $input.data('reply') || [];\n    messages = addMessageToList(messages, message);\n    $input.focus().data('mention-user', false).data('reply', messages).trigger('dataChange');\n  },\n\n  async 'click .js-actionButton-sendMessage'(event, instance) {\n    const {\n      rid\n    } = instance.data;\n    const msg = event.currentTarget.value;\n    let msgObject = {\n      _id: Random.id(),\n      rid,\n      msg\n    };\n\n    if (!msg) {\n      return;\n    }\n\n    msgObject = await onClientBeforeSendMessage(msgObject);\n    const _chatMessages = chatMessages[rid];\n\n    if (_chatMessages && (await _chatMessages.processSlashCommand(msgObject))) {\n      return;\n    }\n\n    await callWithErrorHandling('sendMessage', msgObject);\n  },\n\n  'click .message-actions__menu'(e, template) {\n    const messageContext = messageArgs(this);\n    const {\n      msg: message,\n      context: ctx\n    } = messageContext;\n    const context = ctx || message.context || message.actionContext || 'message';\n    const allItems = MessageAction.getButtons(messageContext, context, 'menu').map(item => ({\n      icon: item.icon,\n      name: t(item.label),\n      type: 'message-action',\n      id: item.id,\n      modifier: item.color\n    }));\n    const itemsBelowDivider = ['delete-message', 'report-message'];\n    const [items, alertsItem] = allItems.reduce((result, value) => {\n      result[itemsBelowDivider.includes(value.id) ? 1 : 0].push(value);\n      return result;\n    }, [[], []]);\n    const groups = [{\n      items\n    }];\n\n    if (alertsItem.length) {\n      groups.push({\n        items: alertsItem\n      });\n    }\n\n    const config = {\n      columns: [{\n        groups\n      }],\n      instance: template,\n      rid: template.data.rid,\n      data: this,\n      currentTarget: e.currentTarget,\n      activeElement: $(e.currentTarget).parents('.message')[0],\n      onRendered: () => new Clipboard('.rc-popover__item')\n    };\n    popover.open(config);\n  },\n\n  'click .mention-link'(e, instance) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (!Meteor.userId()) {\n      return;\n    }\n\n    const {\n      currentTarget: {\n        dataset: {\n          channel,\n          group,\n          username\n        }\n      }\n    } = e;\n\n    if (channel) {\n      if (isLayoutEmbedded()) {\n        fireGlobalEvent('click-mention-link', {\n          path: FlowRouter.path('channel', {\n            name: channel\n          }),\n          channel\n        });\n      }\n\n      goToRoomById(channel);\n      return;\n    }\n\n    if (group) {\n      return;\n    }\n\n    if (username) {\n      openUserCard({\n        username,\n        rid: instance.data.rid,\n        target: e.currentTarget,\n        open: e => {\n          e.preventDefault();\n          instance.data.tabBar.openUserInfo(username);\n        }\n      });\n    }\n  }\n\n});","map":{"version":3,"sources":["app/ui/client/views/app/lib/getCommonRoomEvents.js"],"names":["_objectSpread","module","link","default","v","export","getCommonRoomEvents","Clipboard","Meteor","Random","FlowRouter","popover","MessageAction","addMessageToList","callWithErrorHandling","isURL","openUserCard","messageArgs","ChatMessage","Rooms","Messages","t","chatMessages","EmojiEvents","goToRoomById","fireGlobalEvent","isLayoutEmbedded","onClientBeforeSendMessage","mountPopover","e","i","outerContext","context","$","target","parents","data","messageContext","menuItems","getButtons","map","item","icon","name","label","type","id","modifier","color","window","matchMedia","matches","messageItems","concat","items","deleteItem","reduce","result","value","push","groups","length","config","columns","instance","currentTarget","activeElement","onRendered","open","touchMoved","lastTouchX","lastTouchY","touchtime","clearTimeout","preventDefault","stopPropagation","touches","originalEvent","pageX","pagey","hasClass","nodeName","getAttribute","doLongTouch","setTimeout","href","deltaX","Math","abs","deltaY","pageY","event","template","button","getButtonById","dataset","messageAction","action","undefined","call","tabBar","rid","msg","mid","_id","tmid","room","findOne","go","getRouteName","tab","jump","update","$set","userId","username","u","openUserInfo","input","focus","msgId","$input","message","messages","trigger","msgObject","_chatMessages","processSlashCommand","ctx","actionContext","allItems","itemsBelowDivider","alertsItem","includes","channel","group","path"],"mappings":"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","sourcesContent":["import Clipboard from 'clipboard';\nimport { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\n\nimport { popover, MessageAction } from '../../../../../ui-utils/client';\nimport { addMessageToList } from '../../../../../ui-utils/client/lib/MessageAction';\nimport { callWithErrorHandling } from '../../../../../../client/lib/utils/callWithErrorHandling';\nimport { isURL } from '../../../../../utils/lib/isURL';\nimport { openUserCard } from '../../../lib/UserCard';\nimport { messageArgs } from '../../../../../ui-utils/client/lib/messageArgs';\nimport { ChatMessage, Rooms, Messages } from '../../../../../models';\nimport { t } from '../../../../../utils/client';\nimport { chatMessages } from '../room';\nimport { EmojiEvents } from '../../../../../reactions/client/init';\nimport { goToRoomById } from '../../../../../../client/lib/utils/goToRoomById';\nimport { fireGlobalEvent } from '../../../../../../client/lib/utils/fireGlobalEvent';\nimport { isLayoutEmbedded } from '../../../../../../client/lib/utils/isLayoutEmbedded';\nimport { onClientBeforeSendMessage } from '../../../../../../client/lib/onClientBeforeSendMessage';\n\nconst mountPopover = (e, i, outerContext) => {\n\tlet context = $(e.target).parents('.message').data('context');\n\tif (!context) {\n\t\tcontext = 'message';\n\t}\n\n\tconst messageContext = messageArgs(outerContext);\n\n\tlet menuItems = MessageAction.getButtons(messageContext, context, 'menu').map((item) => ({\n\t\ticon: item.icon,\n\t\tname: t(item.label),\n\t\ttype: 'message-action',\n\t\tid: item.id,\n\t\tmodifier: item.color,\n\t}));\n\n\tif (window.matchMedia('(max-width: 500px)').matches) {\n\t\tconst messageItems = MessageAction.getButtons(messageContext, context, 'message').map((item) => ({\n\t\t\ticon: item.icon,\n\t\t\tname: t(item.label),\n\t\t\ttype: 'message-action',\n\t\t\tid: item.id,\n\t\t\tmodifier: item.color,\n\t\t}));\n\n\t\tmenuItems = menuItems.concat(messageItems);\n\t}\n\n\tconst [items, deleteItem] = menuItems.reduce(\n\t\t(result, value) => {\n\t\t\tresult[value.id === 'delete-message' ? 1 : 0].push(value);\n\t\t\treturn result;\n\t\t},\n\t\t[[], []],\n\t);\n\tconst groups = [{ items }];\n\n\tif (deleteItem.length) {\n\t\tgroups.push({ items: deleteItem });\n\t}\n\n\tconst config = {\n\t\tcolumns: [\n\t\t\t{\n\t\t\t\tgroups,\n\t\t\t},\n\t\t],\n\t\tinstance: i,\n\t\tcurrentTarget: e.currentTarget,\n\t\tdata: outerContext,\n\t\tactiveElement: $(e.currentTarget).parents('.message')[0],\n\t\tonRendered: () => new Clipboard('.rc-popover__item'),\n\t};\n\n\tpopover.open(config);\n};\n\nexport const getCommonRoomEvents = () => ({\n\t...(() => {\n\t\tlet touchMoved = false;\n\t\tlet lastTouchX = null;\n\t\tlet lastTouchY = null;\n\n\t\tlet touchtime = null;\n\t\treturn {\n\t\t\t...EmojiEvents,\n\t\t\t'click .message img'(e) {\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t\tif (touchMoved === true) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t'touchstart .message'(e) {\n\t\t\t\tconst { touches } = e.originalEvent;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\tlastTouchX = touches[0].pageX;\n\t\t\t\t\tlastTouchY = touches[0].pagey;\n\t\t\t\t}\n\t\t\t\ttouchMoved = false;\n\t\t\t\tif (e.originalEvent.touches.length !== 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ($(e.currentTarget).hasClass('system')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.target && e.target.nodeName === 'AUDIO') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.target && e.target.nodeName === 'A' && isURL(e.target.getAttribute('href'))) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\n\t\t\t\tconst doLongTouch = () => {\n\t\t\t\t\tmountPopover(e, t, this);\n\t\t\t\t};\n\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t\ttouchtime = setTimeout(doLongTouch, 500);\n\t\t\t},\n\n\t\t\t'touchend .message'(e) {\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t\tif (e.target && e.target.nodeName === 'A' && isURL(e.target.getAttribute('href'))) {\n\t\t\t\t\tif (touchMoved === true) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.open(e.target.href);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t'touchmove .message'(e) {\n\t\t\t\tconst { touches } = e.originalEvent;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\tconst deltaX = Math.abs(lastTouchX - touches[0].pageX);\n\t\t\t\t\tconst deltaY = Math.abs(lastTouchY - touches[0].pageY);\n\t\t\t\t\tif (deltaX > 5 || deltaY > 5) {\n\t\t\t\t\t\ttouchMoved = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t},\n\n\t\t\t'touchcancel .message'() {\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t},\n\t\t};\n\t})(),\n\t'click [data-message-action]'(event, template) {\n\t\tconst button = MessageAction.getButtonById(event.currentTarget.dataset.messageAction);\n\t\tif ((button != null ? button.action : undefined) != null) {\n\t\t\tbutton.action.call(this, event, { tabBar: template.tabBar, rid: template.data.rid });\n\t\t}\n\t},\n\t'click .js-follow-thread'(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tconst { msg } = messageArgs(this);\n\t\tcallWithErrorHandling('followMessage', { mid: msg._id });\n\t},\n\t'click .js-unfollow-thread'(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tconst { msg } = messageArgs(this);\n\t\tcallWithErrorHandling('unfollowMessage', { mid: msg._id });\n\t},\n\t'click .js-open-thread'(event) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst {\n\t\t\tmsg: { rid, _id, tmid },\n\t\t} = messageArgs(this);\n\t\tconst room = Rooms.findOne({ _id: rid });\n\n\t\tFlowRouter.go(\n\t\t\tFlowRouter.getRouteName(),\n\t\t\t{\n\t\t\t\trid,\n\t\t\t\tname: room.name,\n\t\t\t\ttab: 'thread',\n\t\t\t\tcontext: tmid || _id,\n\t\t\t},\n\t\t\t{\n\t\t\t\tjump: tmid && tmid !== _id && _id && _id,\n\t\t\t},\n\t\t);\n\t},\n\n\t'click .image-to-download'(event) {\n\t\tconst { msg } = messageArgs(this);\n\t\tChatMessage.update({ '_id': msg._id, 'urls.url': $(event.currentTarget).data('url') }, { $set: { 'urls.$.downloadImages': true } });\n\t\tChatMessage.update(\n\t\t\t{ '_id': msg._id, 'attachments.image_url': $(event.currentTarget).data('url') },\n\t\t\t{ $set: { 'attachments.$.downloadImages': true } },\n\t\t);\n\t},\n\t'click .user-card-message'(e, instance) {\n\t\tconst { msg } = messageArgs(this);\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { username } = msg.u;\n\n\t\tif (username) {\n\t\t\topenUserCard({\n\t\t\t\tusername,\n\t\t\t\trid: instance.data.rid,\n\t\t\t\ttarget: e.currentTarget,\n\t\t\t\topen: (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tinstance.data.tabBar.openUserInfo(username);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\t'click .js-actionButton-respondWithMessage'(event, instance) {\n\t\tconst { rid } = instance.data;\n\t\tconst msg = event.currentTarget.value;\n\t\tif (!msg) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { input } = chatMessages[rid];\n\t\tinput.value = msg;\n\t\tinput.focus();\n\t},\n\tasync 'click .js-actionButton-respondWithQuotedMessage'(event, instance) {\n\t\tconst { rid } = instance.data;\n\t\tconst { id: msgId } = event.currentTarget;\n\t\tconst { $input } = chatMessages[rid];\n\n\t\tif (!msgId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = Messages.findOne({ _id: msgId });\n\n\t\tlet messages = $input.data('reply') || [];\n\t\tmessages = addMessageToList(messages, message);\n\n\t\t$input.focus().data('mention-user', false).data('reply', messages).trigger('dataChange');\n\t},\n\tasync 'click .js-actionButton-sendMessage'(event, instance) {\n\t\tconst { rid } = instance.data;\n\t\tconst msg = event.currentTarget.value;\n\t\tlet msgObject = { _id: Random.id(), rid, msg };\n\t\tif (!msg) {\n\t\t\treturn;\n\t\t}\n\n\t\tmsgObject = await onClientBeforeSendMessage(msgObject);\n\n\t\tconst _chatMessages = chatMessages[rid];\n\t\tif (_chatMessages && (await _chatMessages.processSlashCommand(msgObject))) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait callWithErrorHandling('sendMessage', msgObject);\n\t},\n\t'click .message-actions__menu'(e, template) {\n\t\tconst messageContext = messageArgs(this);\n\t\tconst { msg: message, context: ctx } = messageContext;\n\t\tconst context = ctx || message.context || message.actionContext || 'message';\n\n\t\tconst allItems = MessageAction.getButtons(messageContext, context, 'menu').map((item) => ({\n\t\t\ticon: item.icon,\n\t\t\tname: t(item.label),\n\t\t\ttype: 'message-action',\n\t\t\tid: item.id,\n\t\t\tmodifier: item.color,\n\t\t}));\n\n\t\tconst itemsBelowDivider = ['delete-message', 'report-message'];\n\t\tconst [items, alertsItem] = allItems.reduce(\n\t\t\t(result, value) => {\n\t\t\t\tresult[itemsBelowDivider.includes(value.id) ? 1 : 0].push(value);\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\t[[], []],\n\t\t);\n\t\tconst groups = [{ items }];\n\n\t\tif (alertsItem.length) {\n\t\t\tgroups.push({ items: alertsItem });\n\t\t}\n\t\tconst config = {\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tgroups,\n\t\t\t\t},\n\t\t\t],\n\t\t\tinstance: template,\n\t\t\trid: template.data.rid,\n\t\t\tdata: this,\n\t\t\tcurrentTarget: e.currentTarget,\n\t\t\tactiveElement: $(e.currentTarget).parents('.message')[0],\n\t\t\tonRendered: () => new Clipboard('.rc-popover__item'),\n\t\t};\n\n\t\tpopover.open(config);\n\t},\n\t'click .mention-link'(e, instance) {\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tcurrentTarget: {\n\t\t\t\tdataset: { channel, group, username },\n\t\t\t},\n\t\t} = e;\n\n\t\tif (channel) {\n\t\t\tif (isLayoutEmbedded()) {\n\t\t\t\tfireGlobalEvent('click-mention-link', {\n\t\t\t\t\tpath: FlowRouter.path('channel', { name: channel }),\n\t\t\t\t\tchannel,\n\t\t\t\t});\n\t\t\t}\n\t\t\tgoToRoomById(channel);\n\t\t\treturn;\n\t\t}\n\n\t\tif (group) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (username) {\n\t\t\topenUserCard({\n\t\t\t\tusername,\n\t\t\t\trid: instance.data.rid,\n\t\t\t\ttarget: e.currentTarget,\n\t\t\t\topen: (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tinstance.data.tabBar.openUserInfo(username);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n});\n"]},"sourceType":"module","hash":"12e8c1d291c462f0a42a7a3d00f90e7323e9b715"}
