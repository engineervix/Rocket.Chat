{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/imports/client/@rocket.chat/apps-engine/client/AppsEngineUIHost.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"imports/client/@rocket.chat/apps-engine/client/AppsEngineUIHost.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/imports/client/@rocket.chat/apps-engine/client/AppsEngineUIHost.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/imports/client/@rocket.chat/apps-engine/client/AppsEngineUIHost.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/client/@rocket.chat/apps-engine/client/AppsEngineUIHost.js"}},"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AppsEngineUIHost = void 0;\n\nconst constants_1 = require(\"./constants\");\n\nconst definition_1 = require(\"./definition\");\n/**\n * Represents the host which handles API calls from external components.\n */\n\n\nclass AppsEngineUIHost {\n  constructor() {\n    this.initialize();\n  }\n  /**\n   * initialize the AppClientUIHost by registering window `message` listener\n   */\n\n\n  initialize() {\n    window.addEventListener('message', _ref => {\n      let {\n        data,\n        source\n      } = _ref;\n      return __awaiter(this, void 0, void 0, function* () {\n        if (!(data === null || data === void 0 ? void 0 : data.hasOwnProperty(constants_1.MESSAGE_ID))) {\n          return;\n        }\n\n        this.responseDestination = source;\n        const {\n          [constants_1.MESSAGE_ID]: {\n            action,\n            id\n          }\n        } = data;\n\n        switch (action) {\n          case definition_1.AppsEngineUIMethods.GET_USER_INFO:\n            this.handleAction(action, id, yield this.getClientUserInfo());\n            break;\n\n          case definition_1.AppsEngineUIMethods.GET_ROOM_INFO:\n            this.handleAction(action, id, yield this.getClientRoomInfo());\n            break;\n        }\n      });\n    });\n  }\n  /**\n   * Handle the action sent from the external component.\n   * @param action the name of the action\n   * @param id the unique id of the  API call\n   * @param data The data that will return to the caller\n   */\n\n\n  handleAction(action, id, data) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.responseDestination instanceof MessagePort || this.responseDestination instanceof ServiceWorker) {\n        return;\n      }\n\n      this.responseDestination.postMessage({\n        [constants_1.MESSAGE_ID]: {\n          id,\n          action,\n          payload: data\n        }\n      }, '*');\n    });\n  }\n\n}\n\nexports.AppsEngineUIHost = AppsEngineUIHost;","map":{"version":3,"sources":["src/client/AppsEngineUIHost.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAA,WAAA,GAAA,OAAA,CAAA,aAAA,CAAA;;AACA,MAAA,YAAA,GAAA,OAAA,CAAA,cAAA,CAAA;AASA;;AAEG;;;AACH,MAAsB,gBAAtB,CAAsC;AAMlC,EAAA,WAAA,GAAA;AACI,SAAK,UAAL;AACH;AACD;;AAEG;;;AACI,EAAA,UAAU,GAAA;AACb,IAAA,MAAM,CAAC,gBAAP,CAAwB,SAAxB,EAAmC;AAAA,UAAO;AAAE,QAAA,IAAF;AAAQ,QAAA;AAAR,OAAP;AAAA,aAA2B,SAAA,CAAA,IAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,aAAA;AAC1D,YAAI,EAAC,IAAI,KAAA,IAAJ,IAAA,IAAI,KAAA,KAAA,CAAJ,GAAI,KAAA,CAAJ,GAAA,IAAI,CAAE,cAAN,CAAqB,WAAA,CAAA,UAArB,CAAD,CAAJ,EAAuC;AACnC;AACH;;AAED,aAAK,mBAAL,GAA2B,MAA3B;AAEA,cAAM;AAAE,WAAC,WAAA,CAAA,UAAD,GAAc;AAAE,YAAA,MAAF;AAAU,YAAA;AAAV;AAAhB,YAAmC,IAAzC;;AAEA,gBAAQ,MAAR;AACI,eAAK,YAAA,CAAA,mBAAA,CAAoB,aAAzB;AACI,iBAAK,YAAL,CAAkB,MAAlB,EAA0B,EAA1B,EAA8B,MAAM,KAAK,iBAAL,EAApC;AACA;;AACJ,eAAK,YAAA,CAAA,mBAAA,CAAoB,aAAzB;AACI,iBAAK,YAAL,CAAkB,MAAlB,EAA0B,EAA1B,EAA8B,MAAM,KAAK,iBAAL,EAApC;AACA;AANR;AAQH,OAjB6D,CAA3B;AAAA,KAAnC;AAkBH;AASD;;;;;AAKG;;;AACW,EAAA,YAAY,CAAC,MAAD,EAA8B,EAA9B,EAA0C,IAA1C,EAAgE;;AACtF,UAAK,KAAK,mBAAL,YAAoC,WAArC,IAAsD,KAAK,mBAAL,YAAoC,aAA9F,EAA8G;AAC1G;AACH;;AAED,WAAK,mBAAL,CAAyB,WAAzB,CAAqC;AACjC,SAAC,WAAA,CAAA,UAAD,GAAc;AACV,UAAA,EADU;AAEV,UAAA,MAFU;AAGV,UAAA,OAAO,EAAE;AAHC;AADmB,OAArC,EAMG,GANH;AAOH,K;AAAA;;AA1DiC;;AAAtC,OAAA,CAAA,gBAAA,GAAA,gBAAA","sourcesContent":["import { MESSAGE_ID } from './constants';\nimport {\n    AppsEngineUIMethods,\n    IAppsEngineUIResponse,\n    IExternalComponentRoomInfo,\n    IExternalComponentUserInfo,\n} from './definition';\n\ntype HandleActionData = IExternalComponentUserInfo | IExternalComponentRoomInfo;\n\n/**\n * Represents the host which handles API calls from external components.\n */\nexport abstract class AppsEngineUIHost {\n    /**\n     * The message emitter who calling the API.\n     */\n    private responseDestination!: Window;\n\n    constructor() {\n        this.initialize();\n    }\n    /**\n     * initialize the AppClientUIHost by registering window `message` listener\n     */\n    public initialize() {\n        window.addEventListener('message', async ({ data, source }) => {\n            if (!data?.hasOwnProperty(MESSAGE_ID)) {\n                return;\n            }\n\n            this.responseDestination = source as Window;\n\n            const { [MESSAGE_ID]: { action, id } } = data;\n\n            switch (action) {\n                case AppsEngineUIMethods.GET_USER_INFO:\n                    this.handleAction(action, id, await this.getClientUserInfo());\n                    break;\n                case AppsEngineUIMethods.GET_ROOM_INFO:\n                    this.handleAction(action, id, await this.getClientRoomInfo());\n                    break;\n            }\n        });\n    }\n    /**\n     * Get the current user's information.\n     */\n    public abstract getClientUserInfo(): Promise<IExternalComponentUserInfo>;\n    /**\n     * Get the opened room's information.\n     */\n    public abstract getClientRoomInfo(): Promise<IExternalComponentRoomInfo>;\n    /**\n     * Handle the action sent from the external component.\n     * @param action the name of the action\n     * @param id the unique id of the  API call\n     * @param data The data that will return to the caller\n     */\n    private async handleAction(action: AppsEngineUIMethods, id: string, data: HandleActionData): Promise<void> {\n        if ((this.responseDestination instanceof MessagePort) || (this.responseDestination instanceof ServiceWorker)) {\n            return;\n        }\n\n        this.responseDestination.postMessage({\n            [MESSAGE_ID]: {\n                id,\n                action,\n                payload: data,\n            } as IAppsEngineUIResponse,\n        }, '*');\n    }\n}\n"]},"sourceType":"module","hash":"0ef632d53725eb93099e41f13fa345a7fdf53f15"}
