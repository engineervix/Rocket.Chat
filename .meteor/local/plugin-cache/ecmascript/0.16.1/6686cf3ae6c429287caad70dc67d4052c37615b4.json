{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/visitorInfo.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/livechat/client/views/app/tabbar/visitorInfo.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/visitorInfo.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/visitorInfo.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/client/views/app/tabbar/visitorInfo.js"}},"code":"let TAPi18n;\nmodule.link(\"meteor/rocketchat:tap-i18n\", {\n  TAPi18n(v) {\n    TAPi18n = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 2);\nlet FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter(v) {\n    FlowRouter = v;\n  }\n\n}, 3);\nlet Session;\nmodule.link(\"meteor/session\", {\n  Session(v) {\n    Session = v;\n  }\n\n}, 4);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 5);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 6);\nlet moment;\nmodule.link(\"moment\", {\n  default(v) {\n    moment = v;\n  }\n\n}, 7);\nlet UAParser;\nmodule.link(\"ua-parser-js\", {\n  default(v) {\n    UAParser = v;\n  }\n\n}, 8);\nlet modal;\nmodule.link(\"../../../../../ui-utils\", {\n  modal(v) {\n    modal = v;\n  }\n\n}, 9);\nlet Subscriptions;\nmodule.link(\"../../../../../models\", {\n  Subscriptions(v) {\n    Subscriptions = v;\n  }\n\n}, 10);\nlet settings;\nmodule.link(\"../../../../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 11);\nlet t;\nmodule.link(\"../../../../../utils\", {\n  t(v) {\n    t = v;\n  }\n\n}, 12);\nlet hasRole, hasPermission, hasAtLeastOnePermission;\nmodule.link(\"../../../../../authorization\", {\n  hasRole(v) {\n    hasRole = v;\n  },\n\n  hasPermission(v) {\n    hasPermission = v;\n  },\n\n  hasAtLeastOnePermission(v) {\n    hasAtLeastOnePermission = v;\n  }\n\n}, 13);\nmodule.link(\"./visitorInfo.html\");\nlet APIClient;\nmodule.link(\"../../../../../utils/client\", {\n  APIClient(v) {\n    APIClient = v;\n  }\n\n}, 14);\nlet RoomManager;\nmodule.link(\"../../../../../ui-utils/client\", {\n  RoomManager(v) {\n    RoomManager = v;\n  }\n\n}, 15);\nlet getCustomFormTemplate;\nmodule.link(\"../customTemplates/register\", {\n  getCustomFormTemplate(v) {\n    getCustomFormTemplate = v;\n  }\n\n}, 16);\nlet Markdown;\nmodule.link(\"../../../../../markdown/client\", {\n  Markdown(v) {\n    Markdown = v;\n  }\n\n}, 17);\nlet handleError;\nmodule.link(\"../../../../../../client/lib/utils/handleError\", {\n  handleError(v) {\n    handleError = v;\n  }\n\n}, 18);\nlet formatDateAndTime;\nmodule.link(\"../../../../../../client/lib/utils/formatDateAndTime\", {\n  formatDateAndTime(v) {\n    formatDateAndTime = v;\n  }\n\n}, 19);\nlet roomCoordinator;\nmodule.link(\"../../../../../../client/lib/rooms/roomCoordinator\", {\n  roomCoordinator(v) {\n    roomCoordinator = v;\n  }\n\n}, 20);\n\nconst isSubscribedToRoom = () => {\n  const data = Template.currentData();\n\n  if (!data || !data.rid) {\n    return false;\n  }\n\n  const subscription = Subscriptions.findOne({\n    rid: data.rid\n  });\n  return subscription !== undefined;\n};\n\nconst closingDialogRequired = department => {\n  if (settings.get('Livechat_request_comment_when_closing_conversation')) {\n    return true;\n  }\n\n  return department && department.requestTagBeforeClosingChat;\n};\n\nTemplate.visitorInfo.helpers({\n  user() {\n    const user = Template.instance().user.get();\n\n    if (user && user.userAgent) {\n      var _roomCoordinator$getR;\n\n      const ua = new UAParser();\n      ua.setUA(user.userAgent);\n      user.os = \"\".concat(ua.getOS().name, \" \").concat(ua.getOS().version);\n\n      if (['Mac OS', 'iOS'].indexOf(ua.getOS().name) !== -1) {\n        user.osIcon = 'icon-apple';\n      } else {\n        user.osIcon = \"icon-\".concat(ua.getOS().name.toLowerCase());\n      }\n\n      user.browser = \"\".concat(ua.getBrowser().name, \" \").concat(ua.getBrowser().version);\n      user.browserIcon = \"icon-\".concat(ua.getBrowser().name.toLowerCase());\n      user.status = ((_roomCoordinator$getR = roomCoordinator.getRoomDirectives('l')) === null || _roomCoordinator$getR === void 0 ? void 0 : _roomCoordinator$getR.getUserStatus(this.rid)) || 'offline';\n    }\n\n    return user;\n  },\n\n  room() {\n    return Template.instance().room.get();\n  },\n\n  department() {\n    return Template.instance().department.get();\n  },\n\n  joinTags() {\n    const tags = Template.instance().tags.get();\n    return tags && tags.join(', ');\n  },\n\n  customRoomFields() {\n    const customFields = Template.instance().customFields.get();\n\n    if (!customFields || customFields.length === 0) {\n      return [];\n    }\n\n    const fields = [];\n    const room = Template.instance().room.get();\n    const {\n      livechatData = {}\n    } = room || {};\n    Object.keys(livechatData).forEach(key => {\n      const field = _.findWhere(customFields, {\n        _id: key\n      });\n\n      if (field && field.visibility !== 'hidden' && field.scope === 'room') {\n        fields.push({\n          label: field.label,\n          value: livechatData[key]\n        });\n      }\n    });\n    return fields;\n  },\n\n  customVisitorFields() {\n    const customFields = Template.instance().customFields.get();\n\n    if (!hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields'])) {\n      return;\n    }\n\n    if (!customFields || customFields.length === 0) {\n      return [];\n    }\n\n    const fields = [];\n    const user = Template.instance().user.get();\n    const {\n      livechatData = {}\n    } = user || {};\n    Object.keys(livechatData).forEach(key => {\n      const field = _.findWhere(customFields, {\n        _id: key\n      });\n\n      if (field && field.visibility !== 'hidden' && field.scope === 'visitor') {\n        fields.push({\n          label: field.label,\n          value: livechatData[key]\n        });\n      }\n    });\n    return fields;\n  },\n\n  createdAt() {\n    if (!this.createdAt) {\n      return '';\n    }\n\n    return moment(this.createdAt).format('L LTS');\n  },\n\n  lastLogin() {\n    if (!this.lastLogin) {\n      return '';\n    }\n\n    return moment(this.lastLogin).format('L LTS');\n  },\n\n  editing() {\n    return Template.instance().action.get() === 'edit';\n  },\n\n  forwarding() {\n    return Template.instance().action.get() === 'forward';\n  },\n\n  sendingTranscript() {\n    return Template.instance().action.get() === 'transcript';\n  },\n\n  roomInfoData() {\n    const instance = Template.instance();\n    const user = instance.user.get();\n    return {\n      visitorId: user ? user._id : null,\n      roomId: this.rid,\n\n      save() {\n        instance.action.set();\n      },\n\n      cancel() {\n        instance.action.set();\n      }\n\n    };\n  },\n\n  roomOpen() {\n    const room = Template.instance().room.get();\n    const uid = Meteor.userId();\n    return room && room.open && (room.servedBy && room.servedBy._id === uid || hasRole(uid, 'livechat-manager'));\n  },\n\n  canReturnQueue() {\n    const config = Template.instance().routingConfig.get();\n    return config.returnQueue;\n  },\n\n  showDetail() {\n    if (Template.instance().action.get()) {\n      return 'hidden';\n    }\n  },\n\n  canSeeButtons() {\n    if (hasAtLeastOnePermission(['close-others-livechat-room', 'transfer-livechat-guest'])) {\n      return true;\n    }\n\n    return isSubscribedToRoom();\n  },\n\n  canEditRoom() {\n    if (hasPermission('save-others-livechat-room-info')) {\n      return true;\n    }\n\n    return isSubscribedToRoom();\n  },\n\n  canCloseRoom() {\n    if (hasPermission('close-others-livechat-room')) {\n      return true;\n    }\n\n    return isSubscribedToRoom();\n  },\n\n  canForwardGuest() {\n    return hasPermission('transfer-livechat-guest');\n  },\n\n  canSendTranscript() {\n    const room = Template.instance().room.get();\n    return !room.email && hasPermission('send-omnichannel-chat-transcript');\n  },\n\n  canPlaceChatOnHold() {\n    var _room$lastMessage;\n\n    const room = Template.instance().room.get();\n    return room.open && !room.onHold && room.servedBy && room.lastMessage && !((_room$lastMessage = room.lastMessage) !== null && _room$lastMessage !== void 0 && _room$lastMessage.token) && settings.get('Livechat_allow_manual_on_hold');\n  },\n\n  roomClosedDateTime() {\n    const {\n      closedAt\n    } = this;\n    return formatDateAndTime(closedAt);\n  },\n\n  roomClosedBy() {\n    const {\n      closedBy = {},\n      servedBy = {}\n    } = this;\n    let {\n      closer\n    } = this;\n\n    if (closer === 'user') {\n      if (servedBy._id !== closedBy._id) {\n        return closedBy.username;\n      }\n\n      closer = 'agent';\n    }\n\n    const closerLabel = closer.charAt(0).toUpperCase() + closer.slice(1);\n    return t(\"\".concat(closerLabel));\n  },\n\n  customInfoTemplate() {\n    return getCustomFormTemplate('livechatVisitorInfo');\n  },\n\n  roomDataContext() {\n    // To make the dynamic template reactive we need to pass a ReactiveVar through the data property\n    // because only the dynamic template data will be reloaded\n    return Template.instance().room;\n  },\n\n  transcriptRequest() {\n    const room = Template.instance().room.get();\n    return room === null || room === void 0 ? void 0 : room.transcriptRequest;\n  },\n\n  transcriptRequestedDateTime() {\n    const {\n      requestedAt\n    } = this;\n    return formatDateAndTime(requestedAt);\n  },\n\n  markdown(text) {\n    return Markdown.parse(text);\n  }\n\n});\nTemplate.visitorInfo.events({\n  'click .edit-livechat'(event, instance) {\n    event.preventDefault();\n    instance.action.set('edit');\n  },\n\n  'click .close-livechat'(event, instance) {\n    event.preventDefault();\n\n    if (!closingDialogRequired(instance.department.get())) {\n      const comment = TAPi18n.__('Chat_closed_by_agent');\n\n      return Meteor.call('livechat:closeRoom', this.rid, comment, {\n        clientAction: true\n      }, function (error\n      /* , result*/\n      ) {\n        if (error) {\n          return handleError(error);\n        }\n\n        modal.open({\n          title: t('Chat_closed'),\n          text: t('Chat_closed_successfully'),\n          type: 'success',\n          timer: 1000,\n          showConfirmButton: false\n        });\n      });\n    }\n\n    modal.open({\n      title: t('Closing_chat'),\n      modifier: 'modal',\n      content: 'closeRoom',\n      data: {\n        rid: this.rid\n      },\n      confirmOnEnter: false,\n      showConfirmButton: false,\n      showCancelButton: false\n    });\n  },\n\n  'click .return-inquiry'(event) {\n    event.preventDefault();\n    modal.open({\n      title: t('Would_you_like_to_return_the_inquiry'),\n      type: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#3085d6',\n      cancelButtonColor: '#d33',\n      confirmButtonText: t('Yes')\n    }, () => {\n      Meteor.call('livechat:returnAsInquiry', this.rid, function (error\n      /* , result*/\n      ) {\n        if (error) {\n          handleError(error);\n        } else {\n          Session.set('openedRoom');\n          FlowRouter.go('/home');\n        }\n      });\n    });\n  },\n\n  'click .forward-livechat'(event, instance) {\n    event.preventDefault();\n    instance.action.set('forward');\n  },\n\n  'click .send-transcript'(event, instance) {\n    event.preventDefault();\n    instance.action.set('transcript');\n  },\n\n  'click .on-hold'(event) {\n    event.preventDefault();\n    modal.open({\n      title: t('Would_you_like_to_place_chat_on_hold'),\n      type: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#3085d6',\n      cancelButtonColor: '#d33',\n      confirmButtonText: t('Yes')\n    }, async () => {\n      const {\n        success\n      } = await APIClient.v1.post('livechat/room.onHold', {\n        roomId: this.rid\n      });\n\n      if (success) {\n        modal.open({\n          title: t('Chat_On_Hold'),\n          text: t('Chat_On_Hold_Successfully'),\n          type: 'success',\n          timer: 1500,\n          showConfirmButton: false\n        });\n      }\n    });\n  }\n\n});\nTemplate.visitorInfo.onCreated(function () {\n  this.visitorId = new ReactiveVar(null);\n  this.customFields = new ReactiveVar([]);\n  this.action = new ReactiveVar();\n  this.user = new ReactiveVar();\n  this.departmentId = new ReactiveVar(null);\n  this.tags = new ReactiveVar(null);\n  this.routingConfig = new ReactiveVar({});\n  this.department = new ReactiveVar({});\n  this.room = new ReactiveVar({});\n\n  this.updateVisitor = async visitorId => {\n    const {\n      visitor\n    } = await APIClient.v1.get(\"livechat/visitors.info?visitorId=\".concat(visitorId));\n    this.user.set(visitor);\n  };\n\n  this.updateRoom = room => {\n    this.departmentId.set(room && room.departmentId);\n    this.tags.set(room && room.tags);\n    this.room.set(room);\n    const visitorId = room && room.v && room.v._id;\n    this.visitorId.set(visitorId);\n    this.updateVisitor(visitorId);\n  };\n\n  Meteor.call('livechat:getCustomFields', (err, customFields) => {\n    if (customFields) {\n      this.customFields.set(customFields);\n    }\n  });\n  const {\n    rid\n  } = Template.currentData();\n  Meteor.call('livechat:getRoutingConfig', (err, config) => {\n    if (config) {\n      this.routingConfig.set(config);\n    }\n  });\n\n  const loadRoomData = async rid => {\n    const {\n      room\n    } = await APIClient.v1.get(\"rooms.info?roomId=\".concat(rid));\n    this.updateRoom(room);\n  };\n\n  if (rid) {\n    RoomManager.roomStream.on(rid, this.updateRoom);\n    loadRoomData(rid);\n  }\n\n  this.autorun(async () => {\n    if (this.departmentId.get()) {\n      const {\n        department\n      } = await APIClient.v1.get(\"livechat/department/\".concat(this.departmentId.get(), \"?includeAgents=false\"));\n      this.department.set(department);\n    }\n  });\n  this.autorun(() => {\n    const visitorId = this.visitorId.get();\n\n    if (visitorId) {\n      this.updateVisitor(visitorId);\n    }\n  });\n});\nTemplate.visitorInfo.onDestroyed(function () {\n  const {\n    rid\n  } = Template.currentData();\n  RoomManager.roomStream.removeListener(rid, this.updateRoom);\n});","map":{"version":3,"sources":["app/livechat/client/views/app/tabbar/visitorInfo.js"],"names":["TAPi18n","module","link","v","Meteor","ReactiveVar","FlowRouter","Session","Template","_","default","moment","UAParser","modal","Subscriptions","settings","t","hasRole","hasPermission","hasAtLeastOnePermission","APIClient","RoomManager","getCustomFormTemplate","Markdown","handleError","formatDateAndTime","roomCoordinator","isSubscribedToRoom","data","currentData","rid","subscription","findOne","undefined","closingDialogRequired","department","get","requestTagBeforeClosingChat","visitorInfo","helpers","user","instance","userAgent","ua","setUA","os","getOS","name","version","indexOf","osIcon","toLowerCase","browser","getBrowser","browserIcon","status","getRoomDirectives","getUserStatus","room","joinTags","tags","join","customRoomFields","customFields","length","fields","livechatData","Object","keys","forEach","key","field","findWhere","_id","visibility","scope","push","label","value","customVisitorFields","createdAt","format","lastLogin","editing","action","forwarding","sendingTranscript","roomInfoData","visitorId","roomId","save","set","cancel","roomOpen","uid","userId","open","servedBy","canReturnQueue","config","routingConfig","returnQueue","showDetail","canSeeButtons","canEditRoom","canCloseRoom","canForwardGuest","canSendTranscript","email","canPlaceChatOnHold","onHold","lastMessage","token","roomClosedDateTime","closedAt","roomClosedBy","closedBy","closer","username","closerLabel","charAt","toUpperCase","slice","customInfoTemplate","roomDataContext","transcriptRequest","transcriptRequestedDateTime","requestedAt","markdown","text","parse","events","event","preventDefault","comment","__","call","clientAction","error","title","type","timer","showConfirmButton","modifier","content","confirmOnEnter","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","go","success","v1","post","onCreated","departmentId","updateVisitor","visitor","updateRoom","err","loadRoomData","roomStream","on","autorun","onDestroyed","removeListener"],"mappings":"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","sourcesContent":["import { TAPi18n } from 'meteor/rocketchat:tap-i18n';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Session } from 'meteor/session';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\nimport moment from 'moment';\nimport UAParser from 'ua-parser-js';\n\nimport { modal } from '../../../../../ui-utils';\nimport { Subscriptions } from '../../../../../models';\nimport { settings } from '../../../../../settings';\nimport { t } from '../../../../../utils';\nimport { hasRole, hasPermission, hasAtLeastOnePermission } from '../../../../../authorization';\nimport './visitorInfo.html';\nimport { APIClient } from '../../../../../utils/client';\nimport { RoomManager } from '../../../../../ui-utils/client';\nimport { getCustomFormTemplate } from '../customTemplates/register';\nimport { Markdown } from '../../../../../markdown/client';\nimport { handleError } from '../../../../../../client/lib/utils/handleError';\nimport { formatDateAndTime } from '../../../../../../client/lib/utils/formatDateAndTime';\nimport { roomCoordinator } from '../../../../../../client/lib/rooms/roomCoordinator';\n\nconst isSubscribedToRoom = () => {\n\tconst data = Template.currentData();\n\tif (!data || !data.rid) {\n\t\treturn false;\n\t}\n\n\tconst subscription = Subscriptions.findOne({ rid: data.rid });\n\treturn subscription !== undefined;\n};\n\nconst closingDialogRequired = (department) => {\n\tif (settings.get('Livechat_request_comment_when_closing_conversation')) {\n\t\treturn true;\n\t}\n\n\treturn department && department.requestTagBeforeClosingChat;\n};\n\nTemplate.visitorInfo.helpers({\n\tuser() {\n\t\tconst user = Template.instance().user.get();\n\t\tif (user && user.userAgent) {\n\t\t\tconst ua = new UAParser();\n\t\t\tua.setUA(user.userAgent);\n\n\t\t\tuser.os = `${ua.getOS().name} ${ua.getOS().version}`;\n\t\t\tif (['Mac OS', 'iOS'].indexOf(ua.getOS().name) !== -1) {\n\t\t\t\tuser.osIcon = 'icon-apple';\n\t\t\t} else {\n\t\t\t\tuser.osIcon = `icon-${ua.getOS().name.toLowerCase()}`;\n\t\t\t}\n\t\t\tuser.browser = `${ua.getBrowser().name} ${ua.getBrowser().version}`;\n\t\t\tuser.browserIcon = `icon-${ua.getBrowser().name.toLowerCase()}`;\n\n\t\t\tuser.status = roomCoordinator.getRoomDirectives('l')?.getUserStatus(this.rid) || 'offline';\n\t\t}\n\t\treturn user;\n\t},\n\n\troom() {\n\t\treturn Template.instance().room.get();\n\t},\n\n\tdepartment() {\n\t\treturn Template.instance().department.get();\n\t},\n\n\tjoinTags() {\n\t\tconst tags = Template.instance().tags.get();\n\t\treturn tags && tags.join(', ');\n\t},\n\n\tcustomRoomFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\t\tif (!customFields || customFields.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst fields = [];\n\t\tconst room = Template.instance().room.get();\n\t\tconst { livechatData = {} } = room || {};\n\n\t\tObject.keys(livechatData).forEach((key) => {\n\t\t\tconst field = _.findWhere(customFields, { _id: key });\n\t\t\tif (field && field.visibility !== 'hidden' && field.scope === 'room') {\n\t\t\t\tfields.push({ label: field.label, value: livechatData[key] });\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t},\n\n\tcustomVisitorFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\t\tif (!hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields'])) {\n\t\t\treturn;\n\t\t}\n\t\tif (!customFields || customFields.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst fields = [];\n\t\tconst user = Template.instance().user.get();\n\t\tconst { livechatData = {} } = user || {};\n\n\t\tObject.keys(livechatData).forEach((key) => {\n\t\t\tconst field = _.findWhere(customFields, { _id: key });\n\t\t\tif (field && field.visibility !== 'hidden' && field.scope === 'visitor') {\n\t\t\t\tfields.push({ label: field.label, value: livechatData[key] });\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t},\n\n\tcreatedAt() {\n\t\tif (!this.createdAt) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.createdAt).format('L LTS');\n\t},\n\n\tlastLogin() {\n\t\tif (!this.lastLogin) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.lastLogin).format('L LTS');\n\t},\n\n\tediting() {\n\t\treturn Template.instance().action.get() === 'edit';\n\t},\n\n\tforwarding() {\n\t\treturn Template.instance().action.get() === 'forward';\n\t},\n\n\tsendingTranscript() {\n\t\treturn Template.instance().action.get() === 'transcript';\n\t},\n\n\troomInfoData() {\n\t\tconst instance = Template.instance();\n\t\tconst user = instance.user.get();\n\t\treturn {\n\t\t\tvisitorId: user ? user._id : null,\n\t\t\troomId: this.rid,\n\t\t\tsave() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t\tcancel() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t};\n\t},\n\n\troomOpen() {\n\t\tconst room = Template.instance().room.get();\n\t\tconst uid = Meteor.userId();\n\t\treturn room && room.open && ((room.servedBy && room.servedBy._id === uid) || hasRole(uid, 'livechat-manager'));\n\t},\n\n\tcanReturnQueue() {\n\t\tconst config = Template.instance().routingConfig.get();\n\t\treturn config.returnQueue;\n\t},\n\n\tshowDetail() {\n\t\tif (Template.instance().action.get()) {\n\t\t\treturn 'hidden';\n\t\t}\n\t},\n\n\tcanSeeButtons() {\n\t\tif (hasAtLeastOnePermission(['close-others-livechat-room', 'transfer-livechat-guest'])) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanEditRoom() {\n\t\tif (hasPermission('save-others-livechat-room-info')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanCloseRoom() {\n\t\tif (hasPermission('close-others-livechat-room')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanForwardGuest() {\n\t\treturn hasPermission('transfer-livechat-guest');\n\t},\n\n\tcanSendTranscript() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn !room.email && hasPermission('send-omnichannel-chat-transcript');\n\t},\n\n\tcanPlaceChatOnHold() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn (\n\t\t\troom.open &&\n\t\t\t!room.onHold &&\n\t\t\troom.servedBy &&\n\t\t\troom.lastMessage &&\n\t\t\t!room.lastMessage?.token &&\n\t\t\tsettings.get('Livechat_allow_manual_on_hold')\n\t\t);\n\t},\n\n\troomClosedDateTime() {\n\t\tconst { closedAt } = this;\n\t\treturn formatDateAndTime(closedAt);\n\t},\n\n\troomClosedBy() {\n\t\tconst { closedBy = {}, servedBy = {} } = this;\n\t\tlet { closer } = this;\n\n\t\tif (closer === 'user') {\n\t\t\tif (servedBy._id !== closedBy._id) {\n\t\t\t\treturn closedBy.username;\n\t\t\t}\n\n\t\t\tcloser = 'agent';\n\t\t}\n\n\t\tconst closerLabel = closer.charAt(0).toUpperCase() + closer.slice(1);\n\t\treturn t(`${closerLabel}`);\n\t},\n\n\tcustomInfoTemplate() {\n\t\treturn getCustomFormTemplate('livechatVisitorInfo');\n\t},\n\n\troomDataContext() {\n\t\t// To make the dynamic template reactive we need to pass a ReactiveVar through the data property\n\t\t// because only the dynamic template data will be reloaded\n\t\treturn Template.instance().room;\n\t},\n\n\ttranscriptRequest() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn room?.transcriptRequest;\n\t},\n\n\ttranscriptRequestedDateTime() {\n\t\tconst { requestedAt } = this;\n\t\treturn formatDateAndTime(requestedAt);\n\t},\n\n\tmarkdown(text) {\n\t\treturn Markdown.parse(text);\n\t},\n});\n\nTemplate.visitorInfo.events({\n\t'click .edit-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('edit');\n\t},\n\t'click .close-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tif (!closingDialogRequired(instance.department.get())) {\n\t\t\tconst comment = TAPi18n.__('Chat_closed_by_agent');\n\t\t\treturn Meteor.call('livechat:closeRoom', this.rid, comment, { clientAction: true }, function (error /* , result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\n\t\t\t\tmodal.open({\n\t\t\t\t\ttitle: t('Chat_closed'),\n\t\t\t\t\ttext: t('Chat_closed_successfully'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tmodal.open({\n\t\t\ttitle: t('Closing_chat'),\n\t\t\tmodifier: 'modal',\n\t\t\tcontent: 'closeRoom',\n\t\t\tdata: {\n\t\t\t\trid: this.rid,\n\t\t\t},\n\t\t\tconfirmOnEnter: false,\n\t\t\tshowConfirmButton: false,\n\t\t\tshowCancelButton: false,\n\t\t});\n\t},\n\n\t'click .return-inquiry'(event) {\n\t\tevent.preventDefault();\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Would_you_like_to_return_the_inquiry'),\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\t\tcancelButtonColor: '#d33',\n\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tMeteor.call('livechat:returnAsInquiry', this.rid, function (error /* , result*/) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\thandleError(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tSession.set('openedRoom');\n\t\t\t\t\t\tFlowRouter.go('/home');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t},\n\n\t'click .forward-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('forward');\n\t},\n\n\t'click .send-transcript'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('transcript');\n\t},\n\n\t'click .on-hold'(event) {\n\t\tevent.preventDefault();\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Would_you_like_to_place_chat_on_hold'),\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\t\tcancelButtonColor: '#d33',\n\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t},\n\t\t\tasync () => {\n\t\t\t\tconst { success } = await APIClient.v1.post('livechat/room.onHold', { roomId: this.rid });\n\t\t\t\tif (success) {\n\t\t\t\t\tmodal.open({\n\t\t\t\t\t\ttitle: t('Chat_On_Hold'),\n\t\t\t\t\t\ttext: t('Chat_On_Hold_Successfully'),\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\ttimer: 1500,\n\t\t\t\t\t\tshowConfirmButton: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t},\n});\n\nTemplate.visitorInfo.onCreated(function () {\n\tthis.visitorId = new ReactiveVar(null);\n\tthis.customFields = new ReactiveVar([]);\n\tthis.action = new ReactiveVar();\n\tthis.user = new ReactiveVar();\n\tthis.departmentId = new ReactiveVar(null);\n\tthis.tags = new ReactiveVar(null);\n\tthis.routingConfig = new ReactiveVar({});\n\tthis.department = new ReactiveVar({});\n\tthis.room = new ReactiveVar({});\n\n\tthis.updateVisitor = async (visitorId) => {\n\t\tconst { visitor } = await APIClient.v1.get(`livechat/visitors.info?visitorId=${visitorId}`);\n\t\tthis.user.set(visitor);\n\t};\n\n\tthis.updateRoom = (room) => {\n\t\tthis.departmentId.set(room && room.departmentId);\n\t\tthis.tags.set(room && room.tags);\n\t\tthis.room.set(room);\n\t\tconst visitorId = room && room.v && room.v._id;\n\t\tthis.visitorId.set(visitorId);\n\t\tthis.updateVisitor(visitorId);\n\t};\n\n\tMeteor.call('livechat:getCustomFields', (err, customFields) => {\n\t\tif (customFields) {\n\t\t\tthis.customFields.set(customFields);\n\t\t}\n\t});\n\n\tconst { rid } = Template.currentData();\n\tMeteor.call('livechat:getRoutingConfig', (err, config) => {\n\t\tif (config) {\n\t\t\tthis.routingConfig.set(config);\n\t\t}\n\t});\n\n\tconst loadRoomData = async (rid) => {\n\t\tconst { room } = await APIClient.v1.get(`rooms.info?roomId=${rid}`);\n\t\tthis.updateRoom(room);\n\t};\n\n\tif (rid) {\n\t\tRoomManager.roomStream.on(rid, this.updateRoom);\n\t\tloadRoomData(rid);\n\t}\n\n\tthis.autorun(async () => {\n\t\tif (this.departmentId.get()) {\n\t\t\tconst { department } = await APIClient.v1.get(`livechat/department/${this.departmentId.get()}?includeAgents=false`);\n\t\t\tthis.department.set(department);\n\t\t}\n\t});\n\n\tthis.autorun(() => {\n\t\tconst visitorId = this.visitorId.get();\n\t\tif (visitorId) {\n\t\t\tthis.updateVisitor(visitorId);\n\t\t}\n\t});\n});\n\nTemplate.visitorInfo.onDestroyed(function () {\n\tconst { rid } = Template.currentData();\n\tRoomManager.roomStream.removeListener(rid, this.updateRoom);\n});\n"]},"sourceType":"module","hash":"6686cf3ae6c429287caad70dc67d4052c37615b4"}
