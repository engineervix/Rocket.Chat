{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/apps/client/orchestrator.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/apps/client/orchestrator.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/apps/client/orchestrator.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/apps/client/orchestrator.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/apps/client/orchestrator.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 2);\nmodule.export({\n  Apps: function () {\n    return Apps;\n  }\n});\nvar AppClientManager;\nmodule.link(\"@rocket.chat/apps-engine/client/AppClientManager\", {\n  AppClientManager: function (v) {\n    AppClientManager = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 2);\nvar dispatchToastMessage;\nmodule.link(\"../../../client/lib/toast\", {\n  dispatchToastMessage: function (v) {\n    dispatchToastMessage = v;\n  }\n}, 3);\nvar hasAtLeastOnePermission;\nmodule.link(\"../../authorization\", {\n  hasAtLeastOnePermission: function (v) {\n    hasAtLeastOnePermission = v;\n  }\n}, 4);\nvar settings;\nmodule.link(\"../../settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 5);\nvar CachedCollectionManager;\nmodule.link(\"../../ui-cached-collection\", {\n  CachedCollectionManager: function (v) {\n    CachedCollectionManager = v;\n  }\n}, 6);\nvar APIClient;\nmodule.link(\"../../utils\", {\n  APIClient: function (v) {\n    APIClient = v;\n  }\n}, 7);\nvar AppWebsocketReceiver;\nmodule.link(\"./communication\", {\n  AppWebsocketReceiver: function (v) {\n    AppWebsocketReceiver = v;\n  }\n}, 8);\nvar handleI18nResources;\nmodule.link(\"./i18n\", {\n  handleI18nResources: function (v) {\n    handleI18nResources = v;\n  }\n}, 9);\nvar RealAppsEngineUIHost;\nmodule.link(\"./RealAppsEngineUIHost\", {\n  RealAppsEngineUIHost: function (v) {\n    RealAppsEngineUIHost = v;\n  }\n}, 10);\n\nvar createDeferredValue = function () {\n  var resolve;\n  var reject;\n  var promise = new Promise(function (_resolve, _reject) {\n    resolve = _resolve;\n    reject = _reject;\n  });\n  return [promise, resolve, reject];\n};\n\nvar AppClientOrchestrator = function () {\n  function AppClientOrchestrator() {\n    var _this = this;\n\n    this.load = function () {\n      function _callee(isEnabled) {\n        var _createDeferredValue, _createDeferredValue2;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (!_this.isLoaded) {\n                    _this.ws = new AppWebsocketReceiver();\n                    _this.isLoaded = true;\n                  }\n\n                  _this.setEnabled(isEnabled); // Since the deferred value (a promise) is immutable after resolved,\n                  // it need to be recreated to resolve a new value\n\n\n                  _createDeferredValue = createDeferredValue();\n                  _createDeferredValue2 = _slicedToArray(_createDeferredValue, 2);\n                  _this.deferredIsEnabled = _createDeferredValue2[0];\n                  _this.setEnabled = _createDeferredValue2[1];\n                  _context.next = 8;\n                  return _regeneratorRuntime.awrap(handleI18nResources());\n\n                case 8:\n                  _this.setEnabled(isEnabled);\n\n                case 9:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }\n\n          return _callee$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee;\n    }();\n\n    this.getWsListener = function () {\n      return _this.ws;\n    };\n\n    this.getAppClientManager = function () {\n      return _this._manager;\n    };\n\n    this.handleError = function (error) {\n      console.error(error);\n\n      if (hasAtLeastOnePermission(['manage-apps'])) {\n        dispatchToastMessage({\n          type: 'error',\n          message: error.message\n        });\n      }\n    };\n\n    this.isEnabled = function () {\n      return _this.deferredIsEnabled;\n    };\n\n    this.getApps = function () {\n      function _callee2() {\n        var _await$APIClient$get, apps;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get('apps'));\n\n                case 2:\n                  _await$APIClient$get = _context2.sent;\n                  apps = _await$APIClient$get.apps;\n                  return _context2.abrupt(\"return\", apps);\n\n                case 5:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }\n\n          return _callee2$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee2;\n    }();\n\n    this.getAppsFromMarketplace = function () {\n      function _callee3() {\n        var appsOverviews;\n        return _regeneratorRuntime.async(function () {\n          function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  _context3.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get('apps', {\n                    marketplace: 'true'\n                  }));\n\n                case 2:\n                  appsOverviews = _context3.sent;\n                  return _context3.abrupt(\"return\", appsOverviews.map(function (_ref) {\n                    var latest = _ref.latest,\n                        price = _ref.price,\n                        pricingPlans = _ref.pricingPlans,\n                        purchaseType = _ref.purchaseType,\n                        isEnterpriseOnly = _ref.isEnterpriseOnly,\n                        modifiedAt = _ref.modifiedAt;\n                    return _objectSpread(_objectSpread({}, latest), {}, {\n                      price: price,\n                      pricingPlans: pricingPlans,\n                      purchaseType: purchaseType,\n                      isEnterpriseOnly: isEnterpriseOnly,\n                      modifiedAt: modifiedAt\n                    });\n                  }));\n\n                case 4:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }\n\n          return _callee3$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee3;\n    }();\n\n    this.getAppsOnBundle = function () {\n      function _callee4(bundleId) {\n        var _await$APIClient$get2, apps;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  _context4.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get(\"apps/bundles/\" + bundleId + \"/apps\"));\n\n                case 2:\n                  _await$APIClient$get2 = _context4.sent;\n                  apps = _await$APIClient$get2.apps;\n                  return _context4.abrupt(\"return\", apps);\n\n                case 5:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }\n\n          return _callee4$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee4;\n    }();\n\n    this.getAppsLanguages = function () {\n      function _callee5() {\n        var _await$APIClient$get3, apps;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee5$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  _context5.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get('apps/languages'));\n\n                case 2:\n                  _await$APIClient$get3 = _context5.sent;\n                  apps = _await$APIClient$get3.apps;\n                  return _context5.abrupt(\"return\", apps);\n\n                case 5:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }\n\n          return _callee5$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee5;\n    }();\n\n    this.getApp = function () {\n      function _callee6(appId) {\n        var _await$APIClient$get4, app;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee6$(_context6) {\n            while (1) {\n              switch (_context6.prev = _context6.next) {\n                case 0:\n                  _context6.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get(\"apps/\" + appId));\n\n                case 2:\n                  _await$APIClient$get4 = _context6.sent;\n                  app = _await$APIClient$get4.app;\n                  return _context6.abrupt(\"return\", app);\n\n                case 5:\n                case \"end\":\n                  return _context6.stop();\n              }\n            }\n          }\n\n          return _callee6$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee6;\n    }();\n\n    this.getAppFromMarketplace = function () {\n      function _callee7(appId, version) {\n        var _await$APIClient$get5, app;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee7$(_context7) {\n            while (1) {\n              switch (_context7.prev = _context7.next) {\n                case 0:\n                  _context7.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get(\"apps/\" + appId, {\n                    marketplace: 'true',\n                    version: version\n                  }));\n\n                case 2:\n                  _await$APIClient$get5 = _context7.sent;\n                  app = _await$APIClient$get5.app;\n                  return _context7.abrupt(\"return\", app);\n\n                case 5:\n                case \"end\":\n                  return _context7.stop();\n              }\n            }\n          }\n\n          return _callee7$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee7;\n    }();\n\n    this.getLatestAppFromMarketplace = function () {\n      function _callee8(appId, version) {\n        var _await$APIClient$get6, app;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee8$(_context8) {\n            while (1) {\n              switch (_context8.prev = _context8.next) {\n                case 0:\n                  _context8.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get(\"apps/\" + appId, {\n                    marketplace: 'true',\n                    update: 'true',\n                    appVersion: version\n                  }));\n\n                case 2:\n                  _await$APIClient$get6 = _context8.sent;\n                  app = _await$APIClient$get6.app;\n                  return _context8.abrupt(\"return\", app);\n\n                case 5:\n                case \"end\":\n                  return _context8.stop();\n              }\n            }\n          }\n\n          return _callee8$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee8;\n    }();\n\n    this.getAppSettings = function () {\n      function _callee9(appId) {\n        var _await$APIClient$get7, settings;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee9$(_context9) {\n            while (1) {\n              switch (_context9.prev = _context9.next) {\n                case 0:\n                  _context9.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get(\"apps/\" + appId + \"/settings\"));\n\n                case 2:\n                  _await$APIClient$get7 = _context9.sent;\n                  settings = _await$APIClient$get7.settings;\n                  return _context9.abrupt(\"return\", settings);\n\n                case 5:\n                case \"end\":\n                  return _context9.stop();\n              }\n            }\n          }\n\n          return _callee9$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee9;\n    }();\n\n    this.setAppSettings = function () {\n      function _callee10(appId, settings) {\n        var _await$APIClient$post, updated;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee10$(_context10) {\n            while (1) {\n              switch (_context10.prev = _context10.next) {\n                case 0:\n                  _context10.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.post(\"apps/\" + appId + \"/settings\", undefined, {\n                    settings: settings\n                  }));\n\n                case 2:\n                  _await$APIClient$post = _context10.sent;\n                  updated = _await$APIClient$post.updated;\n                  return _context10.abrupt(\"return\", updated);\n\n                case 5:\n                case \"end\":\n                  return _context10.stop();\n              }\n            }\n          }\n\n          return _callee10$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee10;\n    }();\n\n    this.getAppApis = function () {\n      function _callee11(appId) {\n        var _await$APIClient$get8, apis;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee11$(_context11) {\n            while (1) {\n              switch (_context11.prev = _context11.next) {\n                case 0:\n                  _context11.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get(\"apps/\" + appId + \"/apis\"));\n\n                case 2:\n                  _await$APIClient$get8 = _context11.sent;\n                  apis = _await$APIClient$get8.apis;\n                  return _context11.abrupt(\"return\", apis);\n\n                case 5:\n                case \"end\":\n                  return _context11.stop();\n              }\n            }\n          }\n\n          return _callee11$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee11;\n    }();\n\n    this.getAppLanguages = function () {\n      function _callee12(appId) {\n        var _await$APIClient$get9, languages;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee12$(_context12) {\n            while (1) {\n              switch (_context12.prev = _context12.next) {\n                case 0:\n                  _context12.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get(\"apps/\" + appId + \"/languages\"));\n\n                case 2:\n                  _await$APIClient$get9 = _context12.sent;\n                  languages = _await$APIClient$get9.languages;\n                  return _context12.abrupt(\"return\", languages);\n\n                case 5:\n                case \"end\":\n                  return _context12.stop();\n              }\n            }\n          }\n\n          return _callee12$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee12;\n    }();\n\n    this.installApp = function () {\n      function _callee13(appId, version, permissionsGranted) {\n        var _await$APIClient$post2, app;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee13$(_context13) {\n            while (1) {\n              switch (_context13.prev = _context13.next) {\n                case 0:\n                  _context13.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.post('apps/', {\n                    appId: appId,\n                    marketplace: true,\n                    version: version,\n                    permissionsGranted: permissionsGranted\n                  }));\n\n                case 2:\n                  _await$APIClient$post2 = _context13.sent;\n                  app = _await$APIClient$post2.app;\n                  return _context13.abrupt(\"return\", app);\n\n                case 5:\n                case \"end\":\n                  return _context13.stop();\n              }\n            }\n          }\n\n          return _callee13$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee13;\n    }();\n\n    this.updateApp = function () {\n      function _callee14(appId, version, permissionsGranted) {\n        var _await$APIClient$post3, app;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee14$(_context14) {\n            while (1) {\n              switch (_context14.prev = _context14.next) {\n                case 0:\n                  _context14.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.post(\"apps/\" + appId, {\n                    appId: appId,\n                    marketplace: true,\n                    version: version,\n                    permissionsGranted: permissionsGranted\n                  }));\n\n                case 2:\n                  _await$APIClient$post3 = _context14.sent;\n                  app = _await$APIClient$post3.app;\n                  return _context14.abrupt(\"return\", app);\n\n                case 5:\n                case \"end\":\n                  return _context14.stop();\n              }\n            }\n          }\n\n          return _callee14$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee14;\n    }();\n\n    this.uninstallApp = function (appId) {\n      return APIClient.delete(\"apps/\" + appId);\n    };\n\n    this.syncApp = function (appId) {\n      return APIClient.post(\"apps/\" + appId + \"/sync\");\n    };\n\n    this.setAppStatus = function () {\n      function _callee15(appId, status) {\n        var _await$APIClient$post4, effectiveStatus;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee15$(_context15) {\n            while (1) {\n              switch (_context15.prev = _context15.next) {\n                case 0:\n                  _context15.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.post(\"apps/\" + appId + \"/status\", {\n                    status: status\n                  }));\n\n                case 2:\n                  _await$APIClient$post4 = _context15.sent;\n                  effectiveStatus = _await$APIClient$post4.status;\n                  return _context15.abrupt(\"return\", effectiveStatus);\n\n                case 5:\n                case \"end\":\n                  return _context15.stop();\n              }\n            }\n          }\n\n          return _callee15$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee15;\n    }();\n\n    this.enableApp = function (appId) {\n      return _this.setAppStatus(appId, 'manually_enabled');\n    };\n\n    this.disableApp = function (appId) {\n      return _this.setAppStatus(appId, 'manually_disabled');\n    };\n\n    this.buildExternalUrl = function (appId) {\n      var purchaseType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'buy';\n      var details = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      return APIClient.get('apps', {\n        buildExternalUrl: 'true',\n        appId: appId,\n        purchaseType: purchaseType,\n        details: details\n      });\n    };\n\n    this.getCategories = function () {\n      function _callee16() {\n        var categories;\n        return _regeneratorRuntime.async(function () {\n          function _callee16$(_context16) {\n            while (1) {\n              switch (_context16.prev = _context16.next) {\n                case 0:\n                  _context16.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.get('apps', {\n                    categories: 'true'\n                  }));\n\n                case 2:\n                  categories = _context16.sent;\n                  return _context16.abrupt(\"return\", categories);\n\n                case 4:\n                case \"end\":\n                  return _context16.stop();\n              }\n            }\n          }\n\n          return _callee16$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee16;\n    }();\n\n    this.getUIHost = function () {\n      return _this._appClientUIHost;\n    };\n\n    this._appClientUIHost = new RealAppsEngineUIHost();\n    this._manager = new AppClientManager(this._appClientUIHost);\n    this.isLoaded = false;\n\n    var _createDeferredValue3 = createDeferredValue();\n\n    var _createDeferredValue4 = _slicedToArray(_createDeferredValue3, 2);\n\n    this.deferredIsEnabled = _createDeferredValue4[0];\n    this.setEnabled = _createDeferredValue4[1];\n  }\n\n  return AppClientOrchestrator;\n}();\n\nvar Apps = new AppClientOrchestrator();\nMeteor.startup(function () {\n  CachedCollectionManager.onLogin(function () {\n    Meteor.call('apps/is-enabled', function (error, isEnabled) {\n      if (error) {\n        Apps.handleError(error);\n        return;\n      }\n\n      Apps.getAppClientManager().initialize();\n      Apps.load(isEnabled);\n    });\n  });\n  Tracker.autorun(function () {\n    var isEnabled = settings.get('Apps_Framework_enabled');\n    Apps.load(isEnabled);\n  });\n});","map":{"version":3,"sources":["app/apps/client/orchestrator.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","_slicedToArray","export","Apps","AppClientManager","Meteor","Tracker","dispatchToastMessage","hasAtLeastOnePermission","settings","CachedCollectionManager","APIClient","AppWebsocketReceiver","handleI18nResources","RealAppsEngineUIHost","createDeferredValue","resolve","reject","promise","Promise","_resolve","_reject","AppClientOrchestrator","load","isEnabled","isLoaded","ws","setEnabled","deferredIsEnabled","getWsListener","getAppClientManager","_manager","handleError","error","console","type","message","getApps","get","apps","getAppsFromMarketplace","marketplace","appsOverviews","map","latest","price","pricingPlans","purchaseType","isEnterpriseOnly","modifiedAt","getAppsOnBundle","bundleId","getAppsLanguages","getApp","appId","app","getAppFromMarketplace","version","getLatestAppFromMarketplace","update","appVersion","getAppSettings","setAppSettings","post","undefined","updated","getAppApis","apis","getAppLanguages","languages","installApp","permissionsGranted","updateApp","uninstallApp","delete","syncApp","setAppStatus","status","effectiveStatus","enableApp","disableApp","buildExternalUrl","details","getCategories","categories","getUIHost","_appClientUIHost","startup","onLogin","call","initialize","autorun"],"mappings":"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","sourcesContent":["import { AppClientManager } from '@rocket.chat/apps-engine/client/AppClientManager';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { dispatchToastMessage } from '../../../client/lib/toast';\nimport { hasAtLeastOnePermission } from '../../authorization';\nimport { settings } from '../../settings/client';\nimport { CachedCollectionManager } from '../../ui-cached-collection';\nimport { APIClient } from '../../utils';\nimport { AppWebsocketReceiver } from './communication';\nimport { handleI18nResources } from './i18n';\nimport { RealAppsEngineUIHost } from './RealAppsEngineUIHost';\n\nconst createDeferredValue = () => {\n\tlet resolve;\n\tlet reject;\n\tconst promise = new Promise((_resolve, _reject) => {\n\t\tresolve = _resolve;\n\t\treject = _reject;\n\t});\n\n\treturn [promise, resolve, reject];\n};\n\nclass AppClientOrchestrator {\n\tconstructor() {\n\t\tthis._appClientUIHost = new RealAppsEngineUIHost();\n\t\tthis._manager = new AppClientManager(this._appClientUIHost);\n\t\tthis.isLoaded = false;\n\t\t[this.deferredIsEnabled, this.setEnabled] = createDeferredValue();\n\t}\n\n\tload = async (isEnabled) => {\n\t\tif (!this.isLoaded) {\n\t\t\tthis.ws = new AppWebsocketReceiver();\n\t\t\tthis.isLoaded = true;\n\t\t}\n\n\t\tthis.setEnabled(isEnabled);\n\n\t\t// Since the deferred value (a promise) is immutable after resolved,\n\t\t// it need to be recreated to resolve a new value\n\t\t[this.deferredIsEnabled, this.setEnabled] = createDeferredValue();\n\n\t\tawait handleI18nResources();\n\t\tthis.setEnabled(isEnabled);\n\t};\n\n\tgetWsListener = () => this.ws;\n\n\tgetAppClientManager = () => this._manager;\n\n\thandleError = (error) => {\n\t\tconsole.error(error);\n\t\tif (hasAtLeastOnePermission(['manage-apps'])) {\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'error',\n\t\t\t\tmessage: error.message,\n\t\t\t});\n\t\t}\n\t};\n\n\tisEnabled = () => this.deferredIsEnabled;\n\n\tgetApps = async () => {\n\t\tconst { apps } = await APIClient.get('apps');\n\t\treturn apps;\n\t};\n\n\tgetAppsFromMarketplace = async () => {\n\t\tconst appsOverviews = await APIClient.get('apps', { marketplace: 'true' });\n\t\treturn appsOverviews.map(({ latest, price, pricingPlans, purchaseType, isEnterpriseOnly, modifiedAt }) => ({\n\t\t\t...latest,\n\t\t\tprice,\n\t\t\tpricingPlans,\n\t\t\tpurchaseType,\n\t\t\tisEnterpriseOnly,\n\t\t\tmodifiedAt,\n\t\t}));\n\t};\n\n\tgetAppsOnBundle = async (bundleId) => {\n\t\tconst { apps } = await APIClient.get(`apps/bundles/${bundleId}/apps`);\n\t\treturn apps;\n\t};\n\n\tgetAppsLanguages = async () => {\n\t\tconst { apps } = await APIClient.get('apps/languages');\n\t\treturn apps;\n\t};\n\n\tgetApp = async (appId) => {\n\t\tconst { app } = await APIClient.get(`apps/${appId}`);\n\t\treturn app;\n\t};\n\n\tgetAppFromMarketplace = async (appId, version) => {\n\t\tconst { app } = await APIClient.get(`apps/${appId}`, {\n\t\t\tmarketplace: 'true',\n\t\t\tversion,\n\t\t});\n\t\treturn app;\n\t};\n\n\tgetLatestAppFromMarketplace = async (appId, version) => {\n\t\tconst { app } = await APIClient.get(`apps/${appId}`, {\n\t\t\tmarketplace: 'true',\n\t\t\tupdate: 'true',\n\t\t\tappVersion: version,\n\t\t});\n\t\treturn app;\n\t};\n\n\tgetAppSettings = async (appId) => {\n\t\tconst { settings } = await APIClient.get(`apps/${appId}/settings`);\n\t\treturn settings;\n\t};\n\n\tsetAppSettings = async (appId, settings) => {\n\t\tconst { updated } = await APIClient.post(`apps/${appId}/settings`, undefined, { settings });\n\t\treturn updated;\n\t};\n\n\tgetAppApis = async (appId) => {\n\t\tconst { apis } = await APIClient.get(`apps/${appId}/apis`);\n\t\treturn apis;\n\t};\n\n\tgetAppLanguages = async (appId) => {\n\t\tconst { languages } = await APIClient.get(`apps/${appId}/languages`);\n\t\treturn languages;\n\t};\n\n\tinstallApp = async (appId, version, permissionsGranted) => {\n\t\tconst { app } = await APIClient.post('apps/', {\n\t\t\tappId,\n\t\t\tmarketplace: true,\n\t\t\tversion,\n\t\t\tpermissionsGranted,\n\t\t});\n\t\treturn app;\n\t};\n\n\tupdateApp = async (appId, version, permissionsGranted) => {\n\t\tconst { app } = await APIClient.post(`apps/${appId}`, {\n\t\t\tappId,\n\t\t\tmarketplace: true,\n\t\t\tversion,\n\t\t\tpermissionsGranted,\n\t\t});\n\t\treturn app;\n\t};\n\n\tuninstallApp = (appId) => APIClient.delete(`apps/${appId}`);\n\n\tsyncApp = (appId) => APIClient.post(`apps/${appId}/sync`);\n\n\tsetAppStatus = async (appId, status) => {\n\t\tconst { status: effectiveStatus } = await APIClient.post(`apps/${appId}/status`, { status });\n\t\treturn effectiveStatus;\n\t};\n\n\tenableApp = (appId) => this.setAppStatus(appId, 'manually_enabled');\n\n\tdisableApp = (appId) => this.setAppStatus(appId, 'manually_disabled');\n\n\tbuildExternalUrl = (appId, purchaseType = 'buy', details = false) =>\n\t\tAPIClient.get('apps', {\n\t\t\tbuildExternalUrl: 'true',\n\t\t\tappId,\n\t\t\tpurchaseType,\n\t\t\tdetails,\n\t\t});\n\n\tgetCategories = async () => {\n\t\tconst categories = await APIClient.get('apps', { categories: 'true' });\n\t\treturn categories;\n\t};\n\n\tgetUIHost = () => this._appClientUIHost;\n}\n\nexport const Apps = new AppClientOrchestrator();\n\nMeteor.startup(() => {\n\tCachedCollectionManager.onLogin(() => {\n\t\tMeteor.call('apps/is-enabled', (error, isEnabled) => {\n\t\t\tif (error) {\n\t\t\t\tApps.handleError(error);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tApps.getAppClientManager().initialize();\n\t\t\tApps.load(isEnabled);\n\t\t});\n\t});\n\n\tTracker.autorun(() => {\n\t\tconst isEnabled = settings.get('Apps_Framework_enabled');\n\t\tApps.load(isEnabled);\n\t});\n});\n"]},"sourceType":"module","hash":"d5740dd2740818a1716102089bc518c9baaf71a2"}
