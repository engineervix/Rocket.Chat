{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ModalBlock.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/blocks/ModalBlock.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ModalBlock.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ModalBlock.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/blocks/ModalBlock.js"}},"code":"module.export({\n  modalParser: () => modalParser\n});\nlet Modal, AnimatedVisibility, ButtonGroup, Button, Box;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Modal(v) {\n    Modal = v;\n  },\n\n  AnimatedVisibility(v) {\n    AnimatedVisibility = v;\n  },\n\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  },\n\n  Button(v) {\n    Button = v;\n  },\n\n  Box(v) {\n    Box = v;\n  }\n\n}, 0);\nlet useUniqueId;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useUniqueId(v) {\n    useUniqueId = v;\n  }\n\n}, 1);\nlet UiKitComponent, UiKitModal, modalParser;\nmodule.link(\"@rocket.chat/fuselage-ui-kit\", {\n  UiKitComponent(v) {\n    UiKitComponent = v;\n  },\n\n  UiKitModal(v) {\n    UiKitModal = v;\n  },\n\n  modalParser(v) {\n    modalParser = v;\n  }\n\n}, 2);\nlet React, useCallback, useEffect, useMemo, useRef;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useCallback(v) {\n    useCallback = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  },\n\n  useRef(v) {\n    useRef = v;\n  }\n\n}, 3);\nlet getURL;\nmodule.link(\"../../../app/utils/lib/getURL\", {\n  getURL(v) {\n    getURL = v;\n  }\n\n}, 4);\nmodule.link(\"./textParsers\");\nconst focusableElementsString = \"\\n\\ta[href]:not([tabindex=\\\"-1\\\"]),\\n\\tarea[href]:not([tabindex=\\\"-1\\\"]),\\n\\tinput:not([disabled]):not([tabindex=\\\"-1\\\"]),\\n\\tselect:not([disabled]):not([tabindex=\\\"-1\\\"]),\\n\\ttextarea:not([disabled]):not([tabindex=\\\"-1\\\"]),\\n\\tbutton:not([disabled]):not([tabindex=\\\"-1\\\"]),\\n\\tiframe,\\n\\tobject,\\n\\tembed,\\n\\t[tabindex]:not([tabindex=\\\"-1\\\"]),\\n\\t[contenteditable]\";\nconst focusableElementsStringInvalid = \"\\n\\ta[href]:not([tabindex=\\\"-1\\\"]):invalid,\\n\\tarea[href]:not([tabindex=\\\"-1\\\"]):invalid,\\n\\tinput:not([disabled]):not([tabindex=\\\"-1\\\"]):invalid,\\n\\tselect:not([disabled]):not([tabindex=\\\"-1\\\"]):invalid,\\n\\ttextarea:not([disabled]):not([tabindex=\\\"-1\\\"]):invalid,\\n\\tbutton:not([disabled]):not([tabindex=\\\"-1\\\"]):invalid,\\n\\tiframe:invalid,\\n\\tobject:invalid,\\n\\tembed:invalid,\\n\\t[tabindex]:not([tabindex=\\\"-1\\\"]):invalid,\\n\\t[contenteditable]:invalid\";\n\nfunction ModalBlock(_ref) {\n  let {\n    view,\n    errors,\n    appId,\n    onSubmit,\n    onClose,\n    onCancel\n  } = _ref;\n  const id = \"modal_id_\".concat(useUniqueId());\n  const ref = useRef(); // Auto focus\n\n  useEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    if (errors && Object.keys(errors).length) {\n      const element = ref.current.querySelector(focusableElementsStringInvalid);\n      element && element.focus();\n    } else {\n      const element = ref.current.querySelector(focusableElementsString);\n      element && element.focus();\n    }\n  }, [errors]); // save focus to restore after close\n\n  const previousFocus = useMemo(() => document.activeElement, []); // restore the focus after the component unmount\n\n  useEffect(() => () => previousFocus && previousFocus.focus(), [previousFocus]); // Handle Tab, Shift + Tab, Enter and Escape\n\n  const handleKeyDown = useCallback(event => {\n    if (event.keyCode === 13) {\n      var _event$target;\n\n      // ENTER\n      if ((event === null || event === void 0 ? void 0 : (_event$target = event.target) === null || _event$target === void 0 ? void 0 : _event$target.nodeName) !== 'TEXTAREA') {\n        return onSubmit(event);\n      }\n    }\n\n    if (event.keyCode === 27) {\n      // ESC\n      event.stopPropagation();\n      event.preventDefault();\n      onClose();\n      return false;\n    }\n\n    if (event.keyCode === 9) {\n      // TAB\n      const elements = Array.from(ref.current.querySelectorAll(focusableElementsString));\n      const [first] = elements;\n      const last = elements.pop();\n\n      if (!ref.current.contains(document.activeElement)) {\n        return first.focus();\n      }\n\n      if (event.shiftKey) {\n        if (!first || first === document.activeElement) {\n          last.focus();\n          event.stopPropagation();\n          event.preventDefault();\n        }\n\n        return;\n      }\n\n      if (!last || last === document.activeElement) {\n        first.focus();\n        event.stopPropagation();\n        event.preventDefault();\n      }\n    }\n  }, [onClose, onSubmit]); // Clean the events\n\n  useEffect(() => {\n    const element = document.querySelector('.rc-modal-wrapper');\n    const container = element.querySelector('.rcx-modal__content');\n\n    const close = e => {\n      if (e.target !== element) {\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n      onClose();\n      return false;\n    };\n\n    const ignoreIfnotContains = e => {\n      if (!container.contains(e.target)) {\n        return;\n      }\n\n      return handleKeyDown(e);\n    };\n\n    document.addEventListener('keydown', ignoreIfnotContains);\n    element.addEventListener('click', close);\n    return () => {\n      document.removeEventListener('keydown', ignoreIfnotContains);\n      element.removeEventListener('click', close);\n    };\n  }, [handleKeyDown, onClose]);\n  return /*#__PURE__*/React.createElement(AnimatedVisibility, {\n    visibility: AnimatedVisibility.UNHIDING\n  }, /*#__PURE__*/React.createElement(Modal, {\n    open: true,\n    id: id,\n    ref: ref\n  }, /*#__PURE__*/React.createElement(Modal.Header, null, view.showIcon ? /*#__PURE__*/React.createElement(Modal.Thumb, {\n    url: getURL(\"/api/apps/\".concat(appId, \"/icon\"))\n  }) : null, /*#__PURE__*/React.createElement(Modal.Title, null, modalParser.text(view.title)), /*#__PURE__*/React.createElement(Modal.Close, {\n    tabIndex: -1,\n    onClick: onClose\n  })), /*#__PURE__*/React.createElement(Modal.Content, null, /*#__PURE__*/React.createElement(Box, {\n    is: \"form\",\n    method: \"post\",\n    action: \"#\",\n    onSubmit: onSubmit\n  }, /*#__PURE__*/React.createElement(UiKitComponent, {\n    render: UiKitModal,\n    blocks: view.blocks\n  }))), /*#__PURE__*/React.createElement(Modal.Footer, null, /*#__PURE__*/React.createElement(ButtonGroup, {\n    align: \"end\"\n  }, view.close && /*#__PURE__*/React.createElement(Button, {\n    onClick: onCancel\n  }, modalParser.text(view.close.text)), view.submit && /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    onClick: onSubmit\n  }, modalParser.text(view.submit.text))))));\n}\n\nmodule.exportDefault(ModalBlock);","map":{"version":3,"sources":["client/views/blocks/ModalBlock.js"],"names":["module","export","modalParser","Modal","AnimatedVisibility","ButtonGroup","Button","Box","link","v","useUniqueId","UiKitComponent","UiKitModal","React","useCallback","useEffect","useMemo","useRef","default","getURL","focusableElementsString","focusableElementsStringInvalid","ModalBlock","view","errors","appId","onSubmit","onClose","onCancel","id","ref","current","Object","keys","length","element","querySelector","focus","previousFocus","document","activeElement","handleKeyDown","event","keyCode","target","nodeName","stopPropagation","preventDefault","elements","Array","from","querySelectorAll","first","last","pop","contains","shiftKey","container","close","e","ignoreIfnotContains","addEventListener","removeEventListener","UNHIDING","showIcon","text","title","blocks","submit","exportDefault"],"mappings":"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","sourcesContent":["import { Modal, AnimatedVisibility, ButtonGroup, Button, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UiKitComponent, UiKitModal, modalParser } from '@rocket.chat/fuselage-ui-kit';\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\n\nimport { getURL } from '../../../app/utils/lib/getURL';\nimport './textParsers';\n\nconst focusableElementsString = `\n\ta[href]:not([tabindex=\"-1\"]),\n\tarea[href]:not([tabindex=\"-1\"]),\n\tinput:not([disabled]):not([tabindex=\"-1\"]),\n\tselect:not([disabled]):not([tabindex=\"-1\"]),\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]),\n\tbutton:not([disabled]):not([tabindex=\"-1\"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex=\"-1\"]),\n\t[contenteditable]`;\n\nconst focusableElementsStringInvalid = `\n\ta[href]:not([tabindex=\"-1\"]):invalid,\n\tarea[href]:not([tabindex=\"-1\"]):invalid,\n\tinput:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tselect:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tbutton:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex=\"-1\"]):invalid,\n\t[contenteditable]:invalid`;\n\nfunction ModalBlock({ view, errors, appId, onSubmit, onClose, onCancel }) {\n\tconst id = `modal_id_${useUniqueId()}`;\n\tconst ref = useRef();\n\n\t// Auto focus\n\tuseEffect(() => {\n\t\tif (!ref.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (errors && Object.keys(errors).length) {\n\t\t\tconst element = ref.current.querySelector(focusableElementsStringInvalid);\n\t\t\telement && element.focus();\n\t\t} else {\n\t\t\tconst element = ref.current.querySelector(focusableElementsString);\n\t\t\telement && element.focus();\n\t\t}\n\t}, [errors]);\n\t// save focus to restore after close\n\tconst previousFocus = useMemo(() => document.activeElement, []);\n\t// restore the focus after the component unmount\n\tuseEffect(() => () => previousFocus && previousFocus.focus(), [previousFocus]);\n\t// Handle Tab, Shift + Tab, Enter and Escape\n\tconst handleKeyDown = useCallback(\n\t\t(event) => {\n\t\t\tif (event.keyCode === 13) {\n\t\t\t\t// ENTER\n\t\t\t\tif (event?.target?.nodeName !== 'TEXTAREA') {\n\t\t\t\t\treturn onSubmit(event);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (event.keyCode === 27) {\n\t\t\t\t// ESC\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tonClose();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (event.keyCode === 9) {\n\t\t\t\t// TAB\n\t\t\t\tconst elements = Array.from(ref.current.querySelectorAll(focusableElementsString));\n\t\t\t\tconst [first] = elements;\n\t\t\t\tconst last = elements.pop();\n\n\t\t\t\tif (!ref.current.contains(document.activeElement)) {\n\t\t\t\t\treturn first.focus();\n\t\t\t\t}\n\n\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\tif (!first || first === document.activeElement) {\n\t\t\t\t\t\tlast.focus();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!last || last === document.activeElement) {\n\t\t\t\t\tfirst.focus();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[onClose, onSubmit],\n\t);\n\t// Clean the events\n\tuseEffect(() => {\n\t\tconst element = document.querySelector('.rc-modal-wrapper');\n\t\tconst container = element.querySelector('.rcx-modal__content');\n\t\tconst close = (e) => {\n\t\t\tif (e.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tonClose();\n\t\t\treturn false;\n\t\t};\n\n\t\tconst ignoreIfnotContains = (e) => {\n\t\t\tif (!container.contains(e.target)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleKeyDown(e);\n\t\t};\n\n\t\tdocument.addEventListener('keydown', ignoreIfnotContains);\n\t\telement.addEventListener('click', close);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('keydown', ignoreIfnotContains);\n\t\t\telement.removeEventListener('click', close);\n\t\t};\n\t}, [handleKeyDown, onClose]);\n\n\treturn (\n\t\t<AnimatedVisibility visibility={AnimatedVisibility.UNHIDING}>\n\t\t\t<Modal open id={id} ref={ref}>\n\t\t\t\t<Modal.Header>\n\t\t\t\t\t{view.showIcon ? <Modal.Thumb url={getURL(`/api/apps/${appId}/icon`)} /> : null}\n\t\t\t\t\t<Modal.Title>{modalParser.text(view.title)}</Modal.Title>\n\t\t\t\t\t<Modal.Close tabIndex={-1} onClick={onClose} />\n\t\t\t\t</Modal.Header>\n\t\t\t\t<Modal.Content>\n\t\t\t\t\t<Box is='form' method='post' action='#' onSubmit={onSubmit}>\n\t\t\t\t\t\t<UiKitComponent render={UiKitModal} blocks={view.blocks} />\n\t\t\t\t\t</Box>\n\t\t\t\t</Modal.Content>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t\t{view.close && <Button onClick={onCancel}>{modalParser.text(view.close.text)}</Button>}\n\t\t\t\t\t\t{view.submit && (\n\t\t\t\t\t\t\t<Button primary onClick={onSubmit}>\n\t\t\t\t\t\t\t\t{modalParser.text(view.submit.text)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t</AnimatedVisibility>\n\t);\n}\n\nexport default ModalBlock;\nexport { modalParser };\n"]},"sourceType":"module","hash":"40f271bd9de611c3357f3281cef7f15bd3470553"}
