{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/ee/app/auditing/client/templates/audit/audit.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"ee/app/auditing/client/templates/audit/audit.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/ee/app/auditing/client/templates/audit/audit.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/ee/app/auditing/client/templates/audit/audit.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"ee/app/auditing/client/templates/audit/audit.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 0);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 1);\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 2);\nvar hasAllPermission;\nmodule.link(\"../../../../../../app/authorization/client\", {\n  hasAllPermission: function (v) {\n    hasAllPermission = v;\n  }\n}, 3);\nvar messageContext;\nmodule.link(\"../../../../../../app/ui-utils/client/lib/messageContext\", {\n  messageContext: function (v) {\n    messageContext = v;\n  }\n}, 4);\nvar call;\nmodule.link(\"../../utils.js\", {\n  call: function (v) {\n    call = v;\n  }\n}, 5);\nmodule.link(\"./audit.html\");\n\nvar loadMessages = function () {\n  function _callee(_ref) {\n    var rid, users, startDate, _ref$endDate, endDate, msg, type, visitor, agent, messages;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              rid = _ref.rid, users = _ref.users, startDate = _ref.startDate, _ref$endDate = _ref.endDate, endDate = _ref$endDate === void 0 ? new Date() : _ref$endDate, msg = _ref.msg, type = _ref.type, visitor = _ref.visitor, agent = _ref.agent;\n              this.messages = this.messages || new ReactiveVar([]);\n              this.loading = this.loading || new ReactiveVar(true);\n              _context.prev = 3;\n              this.loading.set(true);\n\n              if (!(type === 'l')) {\n                _context.next = 11;\n                break;\n              }\n\n              _context.next = 8;\n              return _regeneratorRuntime.awrap(call('auditGetOmnichannelMessages', {\n                rid: rid,\n                users: users,\n                startDate: startDate,\n                endDate: endDate,\n                msg: msg,\n                type: type,\n                visitor: visitor,\n                agent: agent\n              }));\n\n            case 8:\n              _context.t0 = _context.sent;\n              _context.next = 14;\n              break;\n\n            case 11:\n              _context.next = 13;\n              return _regeneratorRuntime.awrap(call('auditGetMessages', {\n                rid: rid,\n                users: users,\n                startDate: startDate,\n                endDate: endDate,\n                msg: msg,\n                type: type,\n                visitor: visitor,\n                agent: agent\n              }));\n\n            case 13:\n              _context.t0 = _context.sent;\n\n            case 14:\n              messages = _context.t0;\n              this.messagesContext.set(_objectSpread(_objectSpread({}, messageContext({\n                rid: rid\n              })), {}, {\n                messages: messages\n              }));\n              _context.next = 21;\n              break;\n\n            case 18:\n              _context.prev = 18;\n              _context.t1 = _context[\"catch\"](3);\n              this.messagesContext.set({});\n\n            case 21:\n              _context.prev = 21;\n              this.loading.set(false);\n              return _context.finish(21);\n\n            case 24:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }\n\n      return _callee$;\n    }(), null, this, [[3, 18, 21, 24]], Promise);\n  }\n\n  return _callee;\n}();\n\nTemplate.audit.helpers({\n  isLoading: function () {\n    return Template.instance().loading.get();\n  },\n  messageContext: function () {\n    return Template.instance().messagesContext.get();\n  },\n  hasResults: function () {\n    return Template.instance().hasResults.get();\n  }\n});\nTemplate.audit.onCreated(function () {\n  function _callee2() {\n    var _this = this;\n\n    var _this$data, visitor, agent, users, rid;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              this.messagesContext = new ReactiveVar({});\n              this.loading = new ReactiveVar(false);\n              this.hasResults = new ReactiveVar(false);\n\n              if (hasAllPermission('can-audit')) {\n                _context2.next = 5;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", FlowRouter.go('/home'));\n\n            case 5:\n              this.autorun(function () {\n                var messagesContext = _this.messagesContext.get();\n\n                _this.hasResults.set(messagesContext && messagesContext.messages && messagesContext.messages.length > 0);\n              });\n              this.loadMessages = loadMessages.bind(this);\n              _this$data = this.data, visitor = _this$data.visitor, agent = _this$data.agent, users = _this$data.users, rid = _this$data.rid;\n\n              if (!(rid || users.length || agent || visitor)) {\n                _context2.next = 11;\n                break;\n              }\n\n              _context2.next = 11;\n              return _regeneratorRuntime.awrap(this.loadMessages(this.data));\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }\n\n      return _callee2$;\n    }(), null, this, null, Promise);\n  }\n\n  return _callee2;\n}());","map":{"version":3,"sources":["ee/app/auditing/client/templates/audit/audit.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","Template","ReactiveVar","FlowRouter","hasAllPermission","messageContext","call","loadMessages","rid","users","startDate","endDate","Date","msg","type","visitor","agent","messages","loading","set","messagesContext","audit","helpers","isLoading","instance","get","hasResults","onCreated","go","autorun","length","bind","data"],"mappings":"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","sourcesContent":["import { Template } from 'meteor/templating';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\n\nimport { hasAllPermission } from '../../../../../../app/authorization/client';\nimport { messageContext } from '../../../../../../app/ui-utils/client/lib/messageContext';\nimport { call } from '../../utils.js';\n\nimport './audit.html';\n\nconst loadMessages = async function ({ rid, users, startDate, endDate = new Date(), msg, type, visitor, agent }) {\n\tthis.messages = this.messages || new ReactiveVar([]);\n\tthis.loading = this.loading || new ReactiveVar(true);\n\ttry {\n\t\tthis.loading.set(true);\n\t\tconst messages =\n\t\t\ttype === 'l'\n\t\t\t\t? await call('auditGetOmnichannelMessages', {\n\t\t\t\t\t\trid,\n\t\t\t\t\t\tusers,\n\t\t\t\t\t\tstartDate,\n\t\t\t\t\t\tendDate,\n\t\t\t\t\t\tmsg,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tvisitor,\n\t\t\t\t\t\tagent,\n\t\t\t\t  })\n\t\t\t\t: await call('auditGetMessages', {\n\t\t\t\t\t\trid,\n\t\t\t\t\t\tusers,\n\t\t\t\t\t\tstartDate,\n\t\t\t\t\t\tendDate,\n\t\t\t\t\t\tmsg,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tvisitor,\n\t\t\t\t\t\tagent,\n\t\t\t\t  });\n\t\tthis.messagesContext.set({\n\t\t\t...messageContext({ rid }),\n\t\t\tmessages,\n\t\t});\n\t} catch (e) {\n\t\tthis.messagesContext.set({});\n\t} finally {\n\t\tthis.loading.set(false);\n\t}\n};\n\nTemplate.audit.helpers({\n\tisLoading() {\n\t\treturn Template.instance().loading.get();\n\t},\n\tmessageContext() {\n\t\treturn Template.instance().messagesContext.get();\n\t},\n\thasResults() {\n\t\treturn Template.instance().hasResults.get();\n\t},\n});\n\nTemplate.audit.onCreated(async function () {\n\tthis.messagesContext = new ReactiveVar({});\n\tthis.loading = new ReactiveVar(false);\n\tthis.hasResults = new ReactiveVar(false);\n\n\tif (!hasAllPermission('can-audit')) {\n\t\treturn FlowRouter.go('/home');\n\t}\n\n\tthis.autorun(() => {\n\t\tconst messagesContext = this.messagesContext.get();\n\n\t\tthis.hasResults.set(messagesContext && messagesContext.messages && messagesContext.messages.length > 0);\n\t});\n\n\tthis.loadMessages = loadMessages.bind(this);\n\n\tconst { visitor, agent, users, rid } = this.data;\n\tif (rid || users.length || agent || visitor) {\n\t\tawait this.loadMessages(this.data);\n\t}\n});\n"]},"sourceType":"module","hash":"cc934b220f668516f30eaa0aa3863cce773b3fc5"}
