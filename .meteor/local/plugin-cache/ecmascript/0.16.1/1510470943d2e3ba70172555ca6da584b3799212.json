{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/jalik:ufs/ufs.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/jalik:ufs/ufs.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/jalik:ufs/ufs.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/jalik:ufs/ufs.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/jalik:ufs/ufs.js"}},"code":"!function (module1) {\n  var _typeof;\n\n  module1.link(\"@babel/runtime/helpers/typeof\", {\n    default: function (v) {\n      _typeof = v;\n    }\n  }, 0);\n  module1.export({\n    UploadFS: function () {\n      return UploadFS;\n    }\n  });\n  var Meteor;\n  module1.link(\"meteor/meteor\", {\n    Meteor: function (v) {\n      Meteor = v;\n    }\n  }, 0);\n  var Random;\n  module1.link(\"meteor/random\", {\n    Random: function (v) {\n      Random = v;\n    }\n  }, 1);\n  var Config;\n  module1.link(\"./ufs-config\", {\n    Config: function (v) {\n      Config = v;\n    }\n  }, 2);\n  var Filter;\n  module1.link(\"./ufs-filter\", {\n    Filter: function (v) {\n      Filter = v;\n    }\n  }, 3);\n  var MIME;\n  module1.link(\"./ufs-mime\", {\n    MIME: function (v) {\n      MIME = v;\n    }\n  }, 4);\n  var Store;\n  module1.link(\"./ufs-store\", {\n    Store: function (v) {\n      Store = v;\n    }\n  }, 5);\n  var StorePermissions;\n  module1.link(\"./ufs-store-permissions\", {\n    StorePermissions: function (v) {\n      StorePermissions = v;\n    }\n  }, 6);\n  var Tokens;\n  module1.link(\"./ufs-tokens\", {\n    Tokens: function (v) {\n      Tokens = v;\n    }\n  }, 7);\n  var Uploader;\n  module1.link(\"./ufs-uploader\", {\n    Uploader: function (v) {\n      Uploader = v;\n    }\n  }, 8);\n  var stores = {};\n  var UploadFS = {\n    /**\n     * Contains all stores\n     */\n    store: {},\n\n    /**\n     * Collection of tokens\n     */\n    tokens: Tokens,\n\n    /**\n     * Adds the \"etag\" attribute to files\n     * @param where\n     */\n    addETagAttributeToFiles: function (where) {\n      var _this = this;\n\n      this.getStores().forEach(function (store) {\n        var files = store.getCollection(); // By default update only files with no path set\n\n        files.find(where || {\n          etag: null\n        }, {\n          fields: {\n            _id: 1\n          }\n        }).forEach(function (file) {\n          files.direct.update(file._id, {\n            $set: {\n              etag: _this.generateEtag()\n            }\n          });\n        });\n      });\n    },\n\n    /**\n     * Adds the MIME type for an extension\n     * @param extension\n     * @param mime\n     */\n    addMimeType: function (extension, mime) {\n      MIME[extension.toLowerCase()] = mime;\n    },\n\n    /**\n     * Adds the \"path\" attribute to files\n     * @param where\n     */\n    addPathAttributeToFiles: function (where) {\n      this.getStores().forEach(function (store) {\n        var files = store.getCollection(); // By default update only files with no path set\n\n        files.find(where || {\n          path: null\n        }, {\n          fields: {\n            _id: 1\n          }\n        }).forEach(function (file) {\n          files.direct.update(file._id, {\n            $set: {\n              path: store.getFileRelativeURL(file._id)\n            }\n          });\n        });\n      });\n    },\n\n    /**\n     * Registers the store\n     * @param store\n     */\n    addStore: function (store) {\n      if (!(store instanceof Store)) {\n        throw new TypeError('ufs: store is not an instance of UploadFS.Store.');\n      }\n\n      stores[store.getName()] = store;\n    },\n\n    /**\n     * Generates a unique ETag\n     * @return {string}\n     */\n    generateEtag: function () {\n      return Random.id();\n    },\n\n    /**\n     * Returns the MIME type of the extension\n     * @param extension\n     * @returns {*}\n     */\n    getMimeType: function (extension) {\n      extension = extension.toLowerCase();\n      return MIME[extension];\n    },\n\n    /**\n     * Returns all MIME types\n     */\n    getMimeTypes: function () {\n      return MIME;\n    },\n\n    /**\n     * Returns the store by its name\n     * @param name\n     * @return {UploadFS.Store}\n     */\n    getStore: function (name) {\n      return stores[name];\n    },\n\n    /**\n     * Returns all stores\n     * @return {object}\n     */\n    getStores: function () {\n      return stores;\n    },\n\n    /**\n     * Returns the temporary file path\n     * @param fileId\n     * @return {string}\n     */\n    getTempFilePath: function (fileId) {\n      return this.config.tmpDir + \"/\" + fileId;\n    },\n\n    /**\n     * Imports a file from a URL\n     * @param url\n     * @param file\n     * @param store\n     * @param callback\n     */\n    importFromURL: function (url, file, store, callback) {\n      if (typeof store === 'string') {\n        Meteor.call('ufsImportURL', url, file, store, callback);\n      } else if (_typeof(store) === 'object') {\n        store.importFromURL(url, file, callback);\n      }\n    },\n\n    /**\n     * Returns file and data as ArrayBuffer for each files in the event\n     * @deprecated\n     * @param event\n     * @param callback\n     */\n    readAsArrayBuffer: function () {\n      console.error('UploadFS.readAsArrayBuffer is deprecated, see https://github.com/jalik/jalik-ufs#uploading-from-a-file');\n    },\n\n    /**\n     * Opens a dialog to select a single file\n     * @param callback\n     */\n    selectFile: function (callback) {\n      var input = document.createElement('input');\n      input.type = 'file';\n      input.multiple = false;\n\n      input.onchange = function (ev) {\n        var files = ev.target.files;\n        callback.call(UploadFS, files[0]);\n      }; // Fix for iOS/Safari\n\n\n      var div = document.createElement('div');\n      div.className = 'ufs-file-selector';\n      div.style = 'display:none; height:0; width:0; overflow: hidden;';\n      div.appendChild(input);\n      document.body.appendChild(div); // Trigger file selection\n\n      input.click();\n    },\n\n    /**\n     * Opens a dialog to select multiple files\n     * @param callback\n     */\n    selectFiles: function (callback) {\n      var input = document.createElement('input');\n      input.type = 'file';\n      input.multiple = true;\n\n      input.onchange = function (ev) {\n        var files = ev.target.files;\n\n        for (var i = 0; i < files.length; i += 1) {\n          callback.call(UploadFS, files[i]);\n        }\n      }; // Fix for iOS/Safari\n\n\n      var div = document.createElement('div');\n      div.className = 'ufs-file-selector';\n      div.style = 'display:none; height:0; width:0; overflow: hidden;';\n      div.appendChild(input);\n      document.body.appendChild(div); // Trigger file selection\n\n      input.click();\n    }\n  };\n\n  if (Meteor.isServer) {\n    require('./ufs-methods');\n\n    require('./ufs-server');\n  }\n  /**\n   * UploadFS Configuration\n   * @type {Config}\n   */\n\n\n  UploadFS.config = new Config(); // Add classes to global namespace\n\n  UploadFS.Config = Config;\n  UploadFS.Filter = Filter;\n  UploadFS.Store = Store;\n  UploadFS.StorePermissions = StorePermissions;\n  UploadFS.Uploader = Uploader;\n\n  if (Meteor.isServer) {\n    // Expose the module globally\n    if (typeof global !== 'undefined') {\n      global.UploadFS = UploadFS;\n    }\n  } else if (Meteor.isClient) {\n    // Expose the module globally\n    if (typeof window !== 'undefined') {\n      window.UploadFS = UploadFS;\n    }\n  }\n}.call(this, module);","map":{"version":3,"sources":["packages/jalik:ufs/ufs.js"],"names":["_typeof","module1","link","default","v","export","UploadFS","Meteor","Random","Config","Filter","MIME","Store","StorePermissions","Tokens","Uploader","stores","store","tokens","addETagAttributeToFiles","where","getStores","forEach","files","getCollection","find","etag","fields","_id","file","direct","update","$set","generateEtag","addMimeType","extension","mime","toLowerCase","addPathAttributeToFiles","path","getFileRelativeURL","addStore","TypeError","getName","id","getMimeType","getMimeTypes","getStore","name","getTempFilePath","fileId","config","tmpDir","importFromURL","url","callback","call","readAsArrayBuffer","console","error","selectFile","input","document","createElement","type","multiple","onchange","ev","target","div","className","style","appendChild","body","click","selectFiles","i","length","isServer","require","global","isClient","window"],"mappings":"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","sourcesContent":["/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2017 Karl STEIN\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n */\nimport { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\n\nimport { Config } from './ufs-config';\nimport { Filter } from './ufs-filter';\nimport { MIME } from './ufs-mime';\nimport { Store } from './ufs-store';\nimport { StorePermissions } from './ufs-store-permissions';\nimport { Tokens } from './ufs-tokens';\nimport { Uploader } from './ufs-uploader';\n\nconst stores = {};\n\nexport const UploadFS = {\n\t/**\n\t * Contains all stores\n\t */\n\tstore: {},\n\n\t/**\n\t * Collection of tokens\n\t */\n\ttokens: Tokens,\n\n\t/**\n\t * Adds the \"etag\" attribute to files\n\t * @param where\n\t */\n\taddETagAttributeToFiles(where) {\n\t\tthis.getStores().forEach((store) => {\n\t\t\tconst files = store.getCollection();\n\n\t\t\t// By default update only files with no path set\n\t\t\tfiles.find(where || { etag: null }, { fields: { _id: 1 } }).forEach((file) => {\n\t\t\t\tfiles.direct.update(file._id, { $set: { etag: this.generateEtag() } });\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Adds the MIME type for an extension\n\t * @param extension\n\t * @param mime\n\t */\n\taddMimeType(extension, mime) {\n\t\tMIME[extension.toLowerCase()] = mime;\n\t},\n\n\t/**\n\t * Adds the \"path\" attribute to files\n\t * @param where\n\t */\n\taddPathAttributeToFiles(where) {\n\t\tthis.getStores().forEach((store) => {\n\t\t\tconst files = store.getCollection();\n\n\t\t\t// By default update only files with no path set\n\t\t\tfiles.find(where || { path: null }, { fields: { _id: 1 } }).forEach((file) => {\n\t\t\t\tfiles.direct.update(file._id, { $set: { path: store.getFileRelativeURL(file._id) } });\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Registers the store\n\t * @param store\n\t */\n\taddStore(store) {\n\t\tif (!(store instanceof Store)) {\n\t\t\tthrow new TypeError('ufs: store is not an instance of UploadFS.Store.');\n\t\t}\n\t\tstores[store.getName()] = store;\n\t},\n\n\t/**\n\t * Generates a unique ETag\n\t * @return {string}\n\t */\n\tgenerateEtag() {\n\t\treturn Random.id();\n\t},\n\n\t/**\n\t * Returns the MIME type of the extension\n\t * @param extension\n\t * @returns {*}\n\t */\n\tgetMimeType(extension) {\n\t\textension = extension.toLowerCase();\n\t\treturn MIME[extension];\n\t},\n\n\t/**\n\t * Returns all MIME types\n\t */\n\tgetMimeTypes() {\n\t\treturn MIME;\n\t},\n\n\t/**\n\t * Returns the store by its name\n\t * @param name\n\t * @return {UploadFS.Store}\n\t */\n\tgetStore(name) {\n\t\treturn stores[name];\n\t},\n\n\t/**\n\t * Returns all stores\n\t * @return {object}\n\t */\n\tgetStores() {\n\t\treturn stores;\n\t},\n\n\t/**\n\t * Returns the temporary file path\n\t * @param fileId\n\t * @return {string}\n\t */\n\tgetTempFilePath(fileId) {\n\t\treturn `${this.config.tmpDir}/${fileId}`;\n\t},\n\n\t/**\n\t * Imports a file from a URL\n\t * @param url\n\t * @param file\n\t * @param store\n\t * @param callback\n\t */\n\timportFromURL(url, file, store, callback) {\n\t\tif (typeof store === 'string') {\n\t\t\tMeteor.call('ufsImportURL', url, file, store, callback);\n\t\t} else if (typeof store === 'object') {\n\t\t\tstore.importFromURL(url, file, callback);\n\t\t}\n\t},\n\n\t/**\n\t * Returns file and data as ArrayBuffer for each files in the event\n\t * @deprecated\n\t * @param event\n\t * @param callback\n\t */\n\treadAsArrayBuffer() {\n\t\tconsole.error('UploadFS.readAsArrayBuffer is deprecated, see https://github.com/jalik/jalik-ufs#uploading-from-a-file');\n\t},\n\n\t/**\n\t * Opens a dialog to select a single file\n\t * @param callback\n\t */\n\tselectFile(callback) {\n\t\tconst input = document.createElement('input');\n\t\tinput.type = 'file';\n\t\tinput.multiple = false;\n\t\tinput.onchange = (ev) => {\n\t\t\tconst { files } = ev.target;\n\t\t\tcallback.call(UploadFS, files[0]);\n\t\t};\n\t\t// Fix for iOS/Safari\n\t\tconst div = document.createElement('div');\n\t\tdiv.className = 'ufs-file-selector';\n\t\tdiv.style = 'display:none; height:0; width:0; overflow: hidden;';\n\t\tdiv.appendChild(input);\n\t\tdocument.body.appendChild(div);\n\t\t// Trigger file selection\n\t\tinput.click();\n\t},\n\n\t/**\n\t * Opens a dialog to select multiple files\n\t * @param callback\n\t */\n\tselectFiles(callback) {\n\t\tconst input = document.createElement('input');\n\t\tinput.type = 'file';\n\t\tinput.multiple = true;\n\t\tinput.onchange = (ev) => {\n\t\t\tconst { files } = ev.target;\n\n\t\t\tfor (let i = 0; i < files.length; i += 1) {\n\t\t\t\tcallback.call(UploadFS, files[i]);\n\t\t\t}\n\t\t};\n\t\t// Fix for iOS/Safari\n\t\tconst div = document.createElement('div');\n\t\tdiv.className = 'ufs-file-selector';\n\t\tdiv.style = 'display:none; height:0; width:0; overflow: hidden;';\n\t\tdiv.appendChild(input);\n\t\tdocument.body.appendChild(div);\n\t\t// Trigger file selection\n\t\tinput.click();\n\t},\n};\n\nif (Meteor.isServer) {\n\trequire('./ufs-methods');\n\trequire('./ufs-server');\n}\n\n/**\n * UploadFS Configuration\n * @type {Config}\n */\nUploadFS.config = new Config();\n\n// Add classes to global namespace\nUploadFS.Config = Config;\nUploadFS.Filter = Filter;\nUploadFS.Store = Store;\nUploadFS.StorePermissions = StorePermissions;\nUploadFS.Uploader = Uploader;\n\nif (Meteor.isServer) {\n\t// Expose the module globally\n\tif (typeof global !== 'undefined') {\n\t\tglobal.UploadFS = UploadFS;\n\t}\n} else if (Meteor.isClient) {\n\t// Expose the module globally\n\tif (typeof window !== 'undefined') {\n\t\twindow.UploadFS = UploadFS;\n\t}\n}\n"]},"sourceType":"module","hash":"1510470943d2e3ba70172555ca6da584b3799212"}
