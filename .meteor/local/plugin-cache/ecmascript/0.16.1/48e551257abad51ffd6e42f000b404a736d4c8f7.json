{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji/client/lib/EmojiPicker.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/emoji/client/lib/EmojiPicker.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji/client/lib/EmojiPicker.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji/client/lib/EmojiPicker.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/emoji/client/lib/EmojiPicker.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nmodule.export({\n  EmojiPicker: function () {\n    return EmojiPicker;\n  }\n});\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 0);\nvar Blaze;\nmodule.link(\"meteor/blaze\", {\n  Blaze: function (v) {\n    Blaze = v;\n  }\n}, 1);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 3);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 4);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 5);\nvar emoji;\nmodule.link(\"../../lib/rocketchat\", {\n  emoji: function (v) {\n    emoji = v;\n  }\n}, 6);\nvar updatePositions = true;\nvar EmojiPicker = {\n  width: 365,\n  height: 300,\n  initiated: false,\n  input: null,\n  source: null,\n  recent: [],\n  tone: null,\n  opened: false,\n  pickCallback: null,\n  scrollingToCategory: false,\n  currentCategory: new ReactiveVar('recent'),\n  init: function () {\n    function _callee() {\n      var _this = this;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.initiated) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                this.initiated = true;\n                this.recent = Meteor._localStorage.getItem('emoji.recent') ? Meteor._localStorage.getItem('emoji.recent').split(',') : [];\n                this.tone = Meteor._localStorage.getItem('emoji.tone') || 0;\n                Blaze.render(Template.emojiPicker, document.body);\n                $(document).click(function (event) {\n                  if (!_this.opened) {\n                    return;\n                  }\n\n                  if (!$(event.target).closest('.emoji-picker').length && !$(event.target).is('.emoji-picker')) {\n                    if (_this.opened) {\n                      _this.close();\n                    }\n                  }\n                });\n                $(window).resize(_.debounce(function () {\n                  if (!_this.opened) {\n                    return;\n                  }\n\n                  _this.setPosition();\n                }, 300));\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return _callee$;\n      }(), null, this, null, Promise);\n    }\n\n    return _callee;\n  }(),\n  isOpened: function () {\n    return this.opened;\n  },\n  setTone: function (tone) {\n    this.tone = tone;\n\n    Meteor._localStorage.setItem('emoji.tone', tone);\n  },\n  getTone: function () {\n    return this.tone;\n  },\n  getRecent: function () {\n    return this.recent;\n  },\n  setPosition: function () {\n    var windowHeight = window.innerHeight;\n    var windowWidth = window.innerWidth;\n    var windowBorder = 10;\n    var sourcePos = $(this.source).offset();\n    var left = sourcePos.left,\n        top = sourcePos.top;\n    var cssProperties = {\n      top: top,\n      left: left\n    };\n    var isLargerThanWindow = this.width + windowBorder > windowWidth;\n\n    if (top + this.height >= windowHeight) {\n      cssProperties.top = windowHeight - this.height - windowBorder - 75;\n    }\n\n    if (left < windowBorder) {\n      cssProperties.left = isLargerThanWindow ? 0 : windowBorder;\n    }\n\n    if (left + this.width >= windowWidth) {\n      cssProperties.left = isLargerThanWindow ? 0 : windowWidth - this.width - windowBorder;\n    }\n\n    return $('.emoji-picker').css(cssProperties);\n  },\n  open: function () {\n    function _callee2(source, callback) {\n      var containerEl, emojiInput;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.initiated) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(this.init());\n\n              case 3:\n                this.pickCallback = callback;\n                this.source = source;\n                containerEl = this.setPosition();\n                containerEl.addClass('show');\n                emojiInput = containerEl.find('.js-emojipicker-search');\n\n                if (emojiInput) {\n                  emojiInput.focus();\n                }\n\n                this.calculateCategoryPositions();\n\n                if (this.recent.length === 0 && this.currentCategory.get() === 'recent') {\n                  this.showCategory(emoji.packages.emojiCustom.list.length > 0 ? 'rocket' : 'people', false);\n                }\n\n                this.opened = true;\n\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }\n\n        return _callee2$;\n      }(), null, this, null, Promise);\n    }\n\n    return _callee2;\n  }(),\n  close: function () {\n    $('.emoji-picker').removeClass('show');\n    this.opened = false;\n    this.source.focus();\n  },\n  pickEmoji: function (emoji) {\n    this.pickCallback(emoji);\n    this.close();\n    this.addRecent(emoji);\n  },\n  addRecent: function (_emoji) {\n    var pos = this.recent.indexOf(_emoji);\n\n    if (pos !== -1) {\n      this.recent.splice(pos, 1);\n    }\n\n    this.recent.unshift(_emoji); // limit recent emojis to 27 (3 rows of 9)\n\n    this.recent.splice(27);\n    updatePositions = true;\n\n    Meteor._localStorage.setItem('emoji.recent', this.recent);\n\n    emoji.packages.base.emojisByCategory.recent = this.recent;\n    this.updateRecent('recent');\n  },\n  removeFromRecent: function (_emoji) {\n    var pos = this.recent.indexOf(_emoji);\n\n    if (pos === -1) {\n      return;\n    }\n\n    this.recent.splice(pos, 1);\n\n    Meteor._localStorage.setItem('emoji.recent', this.recent);\n  },\n  updateRecent: function () {\n    function _callee3(category) {\n      var emojiPickerImport, updateRecentEmoji;\n      return _regeneratorRuntime.async(function () {\n        function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return _regeneratorRuntime.awrap(module.dynamicImport('../emojiPicker'));\n\n              case 2:\n                emojiPickerImport = _context3.sent;\n                updateRecentEmoji = emojiPickerImport.updateRecentEmoji;\n                updateRecentEmoji(category);\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }\n\n        return _callee3$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee3;\n  }(),\n  calculateCategoryPositions: function () {\n    if (!updatePositions) {\n      return;\n    }\n\n    updatePositions = false;\n    var containerScroll = $('.emoji-picker .emojis').scrollTop();\n    this.catPositions = Array.from(document.querySelectorAll('.emoji-list-category')).map(function (el) {\n      var _$$position = $(el).position(),\n          top = _$$position.top;\n\n      return {\n        el: el,\n        top: top + containerScroll\n      };\n    });\n  },\n  getCategoryPositions: function () {\n    return this.catPositions;\n  },\n  showCategory: function (category) {\n    var _this2 = this;\n\n    var animate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    this.scrollingToCategory = animate;\n    $('.emoji-picker .js-emojipicker-search').val('').change().focus();\n    this.currentCategory.set(category);\n    Tracker.afterFlush(function () {\n      var header = $(\"#emoji-list-category-\" + category);\n      var container = $('.emoji-picker .emojis');\n      var scrollTop = header.position().top + container.scrollTop(); // - container.position().top;\n\n      if (animate) {\n        return container.animate({\n          scrollTop: scrollTop\n        }, 300, function () {\n          _this2.scrollingToCategory = false;\n        });\n      }\n\n      container.scrollTop(scrollTop);\n    });\n  }\n};","map":{"version":3,"sources":["app/emoji/client/lib/EmojiPicker.js"],"names":["_regeneratorRuntime","module","link","default","v","export","EmojiPicker","_","Blaze","Meteor","Template","ReactiveVar","Tracker","emoji","updatePositions","width","height","initiated","input","source","recent","tone","opened","pickCallback","scrollingToCategory","currentCategory","init","_localStorage","getItem","split","render","emojiPicker","document","body","$","click","event","target","closest","length","is","close","window","resize","debounce","setPosition","isOpened","setTone","setItem","getTone","getRecent","windowHeight","innerHeight","windowWidth","innerWidth","windowBorder","sourcePos","offset","left","top","cssProperties","isLargerThanWindow","css","open","callback","containerEl","addClass","emojiInput","find","focus","calculateCategoryPositions","get","showCategory","packages","emojiCustom","list","removeClass","pickEmoji","addRecent","_emoji","pos","indexOf","splice","unshift","base","emojisByCategory","updateRecent","removeFromRecent","category","emojiPickerImport","updateRecentEmoji","containerScroll","scrollTop","catPositions","Array","from","querySelectorAll","map","el","position","getCategoryPositions","animate","val","change","set","afterFlush","header","container"],"mappings":"AAAA,IAAIA,mBAAJ;;AAAwBC,MAAM,CAACC,IAAP,CAAY,4BAAZ,EAAyC;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACJ,IAAAA,mBAAmB,GAACI,CAApB;AAAsB;AAA3C,CAAzC,EAAsF,CAAtF;AAAxBH,MAAM,CAACI,MAAP,CAAc;AAACC,EAAAA,WAAW,EAAC,YAAU;AAAC,WAAOA,WAAP;AAAmB;AAA3C,CAAd;;AAA4D,IAAIC,CAAJ;;AAAMN,MAAM,CAACC,IAAP,CAAY,YAAZ,EAAyB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACG,IAAAA,CAAC,GAACH,CAAF;AAAI;AAAzB,CAAzB,EAAoD,CAApD;AAAuD,IAAII,KAAJ;AAAUP,MAAM,CAACC,IAAP,CAAY,cAAZ,EAA2B;AAACM,EAAAA,KAAK,EAAC,UAASJ,CAAT,EAAW;AAACI,IAAAA,KAAK,GAACJ,CAAN;AAAQ;AAA3B,CAA3B,EAAwD,CAAxD;AAA2D,IAAIK,MAAJ;AAAWR,MAAM,CAACC,IAAP,CAAY,eAAZ,EAA4B;AAACO,EAAAA,MAAM,EAAC,UAASL,CAAT,EAAW;AAACK,IAAAA,MAAM,GAACL,CAAP;AAAS;AAA7B,CAA5B,EAA2D,CAA3D;AAA8D,IAAIM,QAAJ;AAAaT,MAAM,CAACC,IAAP,CAAY,mBAAZ,EAAgC;AAACQ,EAAAA,QAAQ,EAAC,UAASN,CAAT,EAAW;AAACM,IAAAA,QAAQ,GAACN,CAAT;AAAW;AAAjC,CAAhC,EAAmE,CAAnE;AAAsE,IAAIO,WAAJ;AAAgBV,MAAM,CAACC,IAAP,CAAY,qBAAZ,EAAkC;AAACS,EAAAA,WAAW,EAAC,UAASP,CAAT,EAAW;AAACO,IAAAA,WAAW,GAACP,CAAZ;AAAc;AAAvC,CAAlC,EAA2E,CAA3E;AAA8E,IAAIQ,OAAJ;AAAYX,MAAM,CAACC,IAAP,CAAY,gBAAZ,EAA6B;AAACU,EAAAA,OAAO,EAAC,UAASR,CAAT,EAAW;AAACQ,IAAAA,OAAO,GAACR,CAAR;AAAU;AAA/B,CAA7B,EAA8D,CAA9D;AAAiE,IAAIS,KAAJ;AAAUZ,MAAM,CAACC,IAAP,CAAY,sBAAZ,EAAmC;AAACW,EAAAA,KAAK,EAAC,UAAST,CAAT,EAAW;AAACS,IAAAA,KAAK,GAACT,CAAN;AAAQ;AAA3B,CAAnC,EAAgE,CAAhE;AAS/gB,IAAIU,eAAe,GAAG,IAAtB;AAEO,IAAMR,WAAW,GAAG;AAC1BS,EAAAA,KAAK,EAAE,GADmB;AAE1BC,EAAAA,MAAM,EAAE,GAFkB;AAG1BC,EAAAA,SAAS,EAAE,KAHe;AAI1BC,EAAAA,KAAK,EAAE,IAJmB;AAK1BC,EAAAA,MAAM,EAAE,IALkB;AAM1BC,EAAAA,MAAM,EAAE,EANkB;AAO1BC,EAAAA,IAAI,EAAE,IAPoB;AAQ1BC,EAAAA,MAAM,EAAE,KARkB;AAS1BC,EAAAA,YAAY,EAAE,IATY;AAU1BC,EAAAA,mBAAmB,EAAE,KAVK;AAW1BC,EAAAA,eAAe,EAAE,IAAId,WAAJ,CAAgB,QAAhB,CAXS;AAYpBe,EAAAA,IAZoB;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAarB,KAAKT,SAbgB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAiBzB,qBAAKA,SAAL,GAAiB,IAAjB;AAEA,qBAAKG,MAAL,GAAcX,MAAM,CAACkB,aAAP,CAAqBC,OAArB,CAA6B,cAA7B,IAA+CnB,MAAM,CAACkB,aAAP,CAAqBC,OAArB,CAA6B,cAA7B,EAA6CC,KAA7C,CAAmD,GAAnD,CAA/C,GAAyG,EAAvH;AACA,qBAAKR,IAAL,GAAYZ,MAAM,CAACkB,aAAP,CAAqBC,OAArB,CAA6B,YAA7B,KAA8C,CAA1D;AAEApB,gBAAAA,KAAK,CAACsB,MAAN,CAAapB,QAAQ,CAACqB,WAAtB,EAAmCC,QAAQ,CAACC,IAA5C;AAEAC,gBAAAA,CAAC,CAACF,QAAD,CAAD,CAAYG,KAAZ,CAAkB,UAACC,KAAD,EAAW;AAC5B,sBAAI,CAAC,KAAI,CAACd,MAAV,EAAkB;AACjB;AACA;;AACD,sBAAI,CAACY,CAAC,CAACE,KAAK,CAACC,MAAP,CAAD,CAAgBC,OAAhB,CAAwB,eAAxB,EAAyCC,MAA1C,IAAoD,CAACL,CAAC,CAACE,KAAK,CAACC,MAAP,CAAD,CAAgBG,EAAhB,CAAmB,eAAnB,CAAzD,EAA8F;AAC7F,wBAAI,KAAI,CAAClB,MAAT,EAAiB;AAChB,sBAAA,KAAI,CAACmB,KAAL;AACA;AACD;AACD,iBATD;AAWAP,gBAAAA,CAAC,CAACQ,MAAD,CAAD,CAAUC,MAAV,CACCpC,CAAC,CAACqC,QAAF,CAAW,YAAM;AAChB,sBAAI,CAAC,KAAI,CAACtB,MAAV,EAAkB;AACjB;AACA;;AACD,kBAAA,KAAI,CAACuB,WAAL;AACA,iBALD,EAKG,GALH,CADD;;AAnCyB;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA4C1BC,EAAAA,QA5C0B,cA4Cf;AACV,WAAO,KAAKxB,MAAZ;AACA,GA9CyB;AA+C1ByB,EAAAA,OA/C0B,YA+ClB1B,IA/CkB,EA+CZ;AACb,SAAKA,IAAL,GAAYA,IAAZ;;AACAZ,IAAAA,MAAM,CAACkB,aAAP,CAAqBqB,OAArB,CAA6B,YAA7B,EAA2C3B,IAA3C;AACA,GAlDyB;AAmD1B4B,EAAAA,OAnD0B,cAmDhB;AACT,WAAO,KAAK5B,IAAZ;AACA,GArDyB;AAsD1B6B,EAAAA,SAtD0B,cAsDd;AACX,WAAO,KAAK9B,MAAZ;AACA,GAxDyB;AAyD1ByB,EAAAA,WAzD0B,cAyDZ;AACb,QAAMM,YAAY,GAAGT,MAAM,CAACU,WAA5B;AACA,QAAMC,WAAW,GAAGX,MAAM,CAACY,UAA3B;AACA,QAAMC,YAAY,GAAG,EAArB;AACA,QAAMC,SAAS,GAAGtB,CAAC,CAAC,KAAKf,MAAN,CAAD,CAAesC,MAAf,EAAlB;AACA,QAAQC,IAAR,GAAsBF,SAAtB,CAAQE,IAAR;AAAA,QAAcC,GAAd,GAAsBH,SAAtB,CAAcG,GAAd;AACA,QAAMC,aAAa,GAAG;AAAED,MAAAA,GAAG,EAAHA,GAAF;AAAOD,MAAAA,IAAI,EAAJA;AAAP,KAAtB;AACA,QAAMG,kBAAkB,GAAG,KAAK9C,KAAL,GAAawC,YAAb,GAA4BF,WAAvD;;AAEA,QAAIM,GAAG,GAAG,KAAK3C,MAAX,IAAqBmC,YAAzB,EAAuC;AACtCS,MAAAA,aAAa,CAACD,GAAd,GAAoBR,YAAY,GAAG,KAAKnC,MAApB,GAA6BuC,YAA7B,GAA4C,EAAhE;AACA;;AAED,QAAIG,IAAI,GAAGH,YAAX,EAAyB;AACxBK,MAAAA,aAAa,CAACF,IAAd,GAAqBG,kBAAkB,GAAG,CAAH,GAAON,YAA9C;AACA;;AAED,QAAIG,IAAI,GAAG,KAAK3C,KAAZ,IAAqBsC,WAAzB,EAAsC;AACrCO,MAAAA,aAAa,CAACF,IAAd,GAAqBG,kBAAkB,GAAG,CAAH,GAAOR,WAAW,GAAG,KAAKtC,KAAnB,GAA2BwC,YAAzE;AACA;;AAED,WAAOrB,CAAC,CAAC,eAAD,CAAD,CAAmB4B,GAAnB,CAAuBF,aAAvB,CAAP;AACA,GA/EyB;AAgFpBG,EAAAA,IAhFoB;AAAA,sBAgFf5C,MAhFe,EAgFP6C,QAhFO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAiFpB,KAAK/C,SAjFe;AAAA;AAAA;AAAA;;AAAA;AAAA,iDAkFlB,KAAKS,IAAL,EAlFkB;;AAAA;AAoFzB,qBAAKH,YAAL,GAAoByC,QAApB;AACA,qBAAK7C,MAAL,GAAcA,MAAd;AAEM8C,gBAAAA,WAvFmB,GAuFL,KAAKpB,WAAL,EAvFK;AAwFzBoB,gBAAAA,WAAW,CAACC,QAAZ,CAAqB,MAArB;AAEMC,gBAAAA,UA1FmB,GA0FNF,WAAW,CAACG,IAAZ,CAAiB,wBAAjB,CA1FM;;AA2FzB,oBAAID,UAAJ,EAAgB;AACfA,kBAAAA,UAAU,CAACE,KAAX;AACA;;AAED,qBAAKC,0BAAL;;AAEA,oBAAI,KAAKlD,MAAL,CAAYmB,MAAZ,KAAuB,CAAvB,IAA4B,KAAKd,eAAL,CAAqB8C,GAArB,OAA+B,QAA/D,EAAyE;AACxE,uBAAKC,YAAL,CAAkB3D,KAAK,CAAC4D,QAAN,CAAeC,WAAf,CAA2BC,IAA3B,CAAgCpC,MAAhC,GAAyC,CAAzC,GAA6C,QAA7C,GAAwD,QAA1E,EAAoF,KAApF;AACA;;AAED,qBAAKjB,MAAL,GAAc,IAAd;;AArGyB;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAuG1BmB,EAAAA,KAvG0B,cAuGlB;AACPP,IAAAA,CAAC,CAAC,eAAD,CAAD,CAAmB0C,WAAnB,CAA+B,MAA/B;AACA,SAAKtD,MAAL,GAAc,KAAd;AACA,SAAKH,MAAL,CAAYkD,KAAZ;AACA,GA3GyB;AA4G1BQ,EAAAA,SA5G0B,YA4GhBhE,KA5GgB,EA4GT;AAChB,SAAKU,YAAL,CAAkBV,KAAlB;AAEA,SAAK4B,KAAL;AACA,SAAKqC,SAAL,CAAejE,KAAf;AACA,GAjHyB;AAkH1BiE,EAAAA,SAlH0B,YAkHhBC,MAlHgB,EAkHR;AACjB,QAAMC,GAAG,GAAG,KAAK5D,MAAL,CAAY6D,OAAZ,CAAoBF,MAApB,CAAZ;;AAEA,QAAIC,GAAG,KAAK,CAAC,CAAb,EAAgB;AACf,WAAK5D,MAAL,CAAY8D,MAAZ,CAAmBF,GAAnB,EAAwB,CAAxB;AACA;;AAED,SAAK5D,MAAL,CAAY+D,OAAZ,CAAoBJ,MAApB,EAPiB,CASjB;;AACA,SAAK3D,MAAL,CAAY8D,MAAZ,CAAmB,EAAnB;AAEApE,IAAAA,eAAe,GAAG,IAAlB;;AAEAL,IAAAA,MAAM,CAACkB,aAAP,CAAqBqB,OAArB,CAA6B,cAA7B,EAA6C,KAAK5B,MAAlD;;AACAP,IAAAA,KAAK,CAAC4D,QAAN,CAAeW,IAAf,CAAoBC,gBAApB,CAAqCjE,MAArC,GAA8C,KAAKA,MAAnD;AACA,SAAKkE,YAAL,CAAkB,QAAlB;AACA,GAnIyB;AAoI1BC,EAAAA,gBApI0B,YAoITR,MApIS,EAoID;AACxB,QAAMC,GAAG,GAAG,KAAK5D,MAAL,CAAY6D,OAAZ,CAAoBF,MAApB,CAAZ;;AACA,QAAIC,GAAG,KAAK,CAAC,CAAb,EAAgB;AACf;AACA;;AACD,SAAK5D,MAAL,CAAY8D,MAAZ,CAAmBF,GAAnB,EAAwB,CAAxB;;AACAvE,IAAAA,MAAM,CAACkB,aAAP,CAAqBqB,OAArB,CAA6B,cAA7B,EAA6C,KAAK5B,MAAlD;AACA,GA3IyB;AA4IpBkE,EAAAA,YA5IoB;AAAA,sBA4IPE,QA5IO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDA6IO,qBAAO,gBAAP,CA7IP;;AAAA;AA6InBC,gBAAAA,iBA7ImB;AA8IjBC,gBAAAA,iBA9IiB,GA8IKD,iBA9IL,CA8IjBC,iBA9IiB;AA+IzBA,gBAAAA,iBAAiB,CAACF,QAAD,CAAjB;;AA/IyB;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAiJ1BlB,EAAAA,0BAjJ0B,cAiJG;AAC5B,QAAI,CAACxD,eAAL,EAAsB;AACrB;AACA;;AACDA,IAAAA,eAAe,GAAG,KAAlB;AAEA,QAAM6E,eAAe,GAAGzD,CAAC,CAAC,uBAAD,CAAD,CAA2B0D,SAA3B,EAAxB;AAEA,SAAKC,YAAL,GAAoBC,KAAK,CAACC,IAAN,CAAW/D,QAAQ,CAACgE,gBAAT,CAA0B,sBAA1B,CAAX,EAA8DC,GAA9D,CAAkE,UAACC,EAAD,EAAQ;AAC7F,wBAAgBhE,CAAC,CAACgE,EAAD,CAAD,CAAMC,QAAN,EAAhB;AAAA,UAAQxC,GAAR,eAAQA,GAAR;;AACA,aAAO;AACNuC,QAAAA,EAAE,EAAFA,EADM;AAENvC,QAAAA,GAAG,EAAEA,GAAG,GAAGgC;AAFL,OAAP;AAIA,KANmB,CAApB;AAOA,GAhKyB;AAiK1BS,EAAAA,oBAjK0B,cAiKH;AACtB,WAAO,KAAKP,YAAZ;AACA,GAnKyB;AAoK1BrB,EAAAA,YApK0B,YAoKbgB,QApKa,EAoKa;AAAA;;AAAA,QAAhBa,OAAgB,uEAAN,IAAM;AACtC,SAAK7E,mBAAL,GAA2B6E,OAA3B;AAEAnE,IAAAA,CAAC,CAAC,sCAAD,CAAD,CAA0CoE,GAA1C,CAA8C,EAA9C,EAAkDC,MAAlD,GAA2DlC,KAA3D;AAEA,SAAK5C,eAAL,CAAqB+E,GAArB,CAAyBhB,QAAzB;AAEA5E,IAAAA,OAAO,CAAC6F,UAAR,CAAmB,YAAM;AACxB,UAAMC,MAAM,GAAGxE,CAAC,2BAAyBsD,QAAzB,CAAhB;AACA,UAAMmB,SAAS,GAAGzE,CAAC,CAAC,uBAAD,CAAnB;AAEA,UAAM0D,SAAS,GAAGc,MAAM,CAACP,QAAP,GAAkBxC,GAAlB,GAAwBgD,SAAS,CAACf,SAAV,EAA1C,CAJwB,CAIyC;;AAEjE,UAAIS,OAAJ,EAAa;AACZ,eAAOM,SAAS,CAACN,OAAV,CACN;AACCT,UAAAA,SAAS,EAATA;AADD,SADM,EAIN,GAJM,EAKN,YAAM;AACL,UAAA,MAAI,CAACpE,mBAAL,GAA2B,KAA3B;AACA,SAPK,CAAP;AASA;;AAEDmF,MAAAA,SAAS,CAACf,SAAV,CAAoBA,SAApB;AACA,KAnBD;AAoBA;AA/LyB,CAApB","sourcesContent":["import _ from 'underscore';\nimport { Blaze } from 'meteor/blaze';\nimport { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport { emoji } from '../../lib/rocketchat';\n\nlet updatePositions = true;\n\nexport const EmojiPicker = {\n\twidth: 365,\n\theight: 300,\n\tinitiated: false,\n\tinput: null,\n\tsource: null,\n\trecent: [],\n\ttone: null,\n\topened: false,\n\tpickCallback: null,\n\tscrollingToCategory: false,\n\tcurrentCategory: new ReactiveVar('recent'),\n\tasync init() {\n\t\tif (this.initiated) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initiated = true;\n\n\t\tthis.recent = Meteor._localStorage.getItem('emoji.recent') ? Meteor._localStorage.getItem('emoji.recent').split(',') : [];\n\t\tthis.tone = Meteor._localStorage.getItem('emoji.tone') || 0;\n\n\t\tBlaze.render(Template.emojiPicker, document.body);\n\n\t\t$(document).click((event) => {\n\t\t\tif (!this.opened) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!$(event.target).closest('.emoji-picker').length && !$(event.target).is('.emoji-picker')) {\n\t\t\t\tif (this.opened) {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(window).resize(\n\t\t\t_.debounce(() => {\n\t\t\t\tif (!this.opened) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.setPosition();\n\t\t\t}, 300),\n\t\t);\n\t},\n\tisOpened() {\n\t\treturn this.opened;\n\t},\n\tsetTone(tone) {\n\t\tthis.tone = tone;\n\t\tMeteor._localStorage.setItem('emoji.tone', tone);\n\t},\n\tgetTone() {\n\t\treturn this.tone;\n\t},\n\tgetRecent() {\n\t\treturn this.recent;\n\t},\n\tsetPosition() {\n\t\tconst windowHeight = window.innerHeight;\n\t\tconst windowWidth = window.innerWidth;\n\t\tconst windowBorder = 10;\n\t\tconst sourcePos = $(this.source).offset();\n\t\tconst { left, top } = sourcePos;\n\t\tconst cssProperties = { top, left };\n\t\tconst isLargerThanWindow = this.width + windowBorder > windowWidth;\n\n\t\tif (top + this.height >= windowHeight) {\n\t\t\tcssProperties.top = windowHeight - this.height - windowBorder - 75;\n\t\t}\n\n\t\tif (left < windowBorder) {\n\t\t\tcssProperties.left = isLargerThanWindow ? 0 : windowBorder;\n\t\t}\n\n\t\tif (left + this.width >= windowWidth) {\n\t\t\tcssProperties.left = isLargerThanWindow ? 0 : windowWidth - this.width - windowBorder;\n\t\t}\n\n\t\treturn $('.emoji-picker').css(cssProperties);\n\t},\n\tasync open(source, callback) {\n\t\tif (!this.initiated) {\n\t\t\tawait this.init();\n\t\t}\n\t\tthis.pickCallback = callback;\n\t\tthis.source = source;\n\n\t\tconst containerEl = this.setPosition();\n\t\tcontainerEl.addClass('show');\n\n\t\tconst emojiInput = containerEl.find('.js-emojipicker-search');\n\t\tif (emojiInput) {\n\t\t\temojiInput.focus();\n\t\t}\n\n\t\tthis.calculateCategoryPositions();\n\n\t\tif (this.recent.length === 0 && this.currentCategory.get() === 'recent') {\n\t\t\tthis.showCategory(emoji.packages.emojiCustom.list.length > 0 ? 'rocket' : 'people', false);\n\t\t}\n\n\t\tthis.opened = true;\n\t},\n\tclose() {\n\t\t$('.emoji-picker').removeClass('show');\n\t\tthis.opened = false;\n\t\tthis.source.focus();\n\t},\n\tpickEmoji(emoji) {\n\t\tthis.pickCallback(emoji);\n\n\t\tthis.close();\n\t\tthis.addRecent(emoji);\n\t},\n\taddRecent(_emoji) {\n\t\tconst pos = this.recent.indexOf(_emoji);\n\n\t\tif (pos !== -1) {\n\t\t\tthis.recent.splice(pos, 1);\n\t\t}\n\n\t\tthis.recent.unshift(_emoji);\n\n\t\t// limit recent emojis to 27 (3 rows of 9)\n\t\tthis.recent.splice(27);\n\n\t\tupdatePositions = true;\n\n\t\tMeteor._localStorage.setItem('emoji.recent', this.recent);\n\t\temoji.packages.base.emojisByCategory.recent = this.recent;\n\t\tthis.updateRecent('recent');\n\t},\n\tremoveFromRecent(_emoji) {\n\t\tconst pos = this.recent.indexOf(_emoji);\n\t\tif (pos === -1) {\n\t\t\treturn;\n\t\t}\n\t\tthis.recent.splice(pos, 1);\n\t\tMeteor._localStorage.setItem('emoji.recent', this.recent);\n\t},\n\tasync updateRecent(category) {\n\t\tconst emojiPickerImport = await import('../emojiPicker');\n\t\tconst { updateRecentEmoji } = emojiPickerImport;\n\t\tupdateRecentEmoji(category);\n\t},\n\tcalculateCategoryPositions() {\n\t\tif (!updatePositions) {\n\t\t\treturn;\n\t\t}\n\t\tupdatePositions = false;\n\n\t\tconst containerScroll = $('.emoji-picker .emojis').scrollTop();\n\n\t\tthis.catPositions = Array.from(document.querySelectorAll('.emoji-list-category')).map((el) => {\n\t\t\tconst { top } = $(el).position();\n\t\t\treturn {\n\t\t\t\tel,\n\t\t\t\ttop: top + containerScroll,\n\t\t\t};\n\t\t});\n\t},\n\tgetCategoryPositions() {\n\t\treturn this.catPositions;\n\t},\n\tshowCategory(category, animate = true) {\n\t\tthis.scrollingToCategory = animate;\n\n\t\t$('.emoji-picker .js-emojipicker-search').val('').change().focus();\n\n\t\tthis.currentCategory.set(category);\n\n\t\tTracker.afterFlush(() => {\n\t\t\tconst header = $(`#emoji-list-category-${category}`);\n\t\t\tconst container = $('.emoji-picker .emojis');\n\n\t\t\tconst scrollTop = header.position().top + container.scrollTop(); // - container.position().top;\n\n\t\t\tif (animate) {\n\t\t\t\treturn container.animate(\n\t\t\t\t\t{\n\t\t\t\t\t\tscrollTop,\n\t\t\t\t\t},\n\t\t\t\t\t300,\n\t\t\t\t\t() => {\n\t\t\t\t\t\tthis.scrollingToCategory = false;\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tcontainer.scrollTop(scrollTop);\n\t\t});\n\t},\n};\n"]},"sourceType":"module","hash":"48e551257abad51ffd6e42f000b404a736d4c8f7"}
