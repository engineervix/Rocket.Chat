{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/utils/lib/getURL.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/utils/lib/getURL.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/utils/lib/getURL.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/utils/lib/getURL.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/utils/lib/getURL.js"}},"code":"module.export({\n  _getURL: () => _getURL,\n  getURL: () => getURL\n});\nlet s;\nmodule.link(\"underscore.string\", {\n  default(v) {\n    s = v;\n  }\n\n}, 0);\nlet escapeRegExp;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeRegExp(v) {\n    escapeRegExp = v;\n  }\n\n}, 1);\nlet isURL;\nmodule.link(\"./isURL\", {\n  isURL(v) {\n    isURL = v;\n  }\n\n}, 2);\nlet settings;\nmodule.link(\"../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 3);\n\nfunction getCloudUrl(path, _site_url, cloudRoute) {\n  let cloudParams = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n  const cloudBaseUrl = (settings.get('DeepLink_Url') || '').replace(/\\/+$/, '');\n  const siteUrl = s.rtrim(_site_url, '/'); // Remove the protocol\n\n  const host = siteUrl.replace(/https?\\:\\/\\//i, '');\n  path = s.ltrim(path, '/');\n  Object.assign(cloudParams, {\n    host,\n    path\n  });\n\n  if (siteUrl.includes('http://')) {\n    cloudParams.secure = 'no';\n  }\n\n  const params = Object.entries(cloudParams).map(_ref => {\n    let [key, value] = _ref;\n    return \"\".concat(key, \"=\").concat(encodeURIComponent(value));\n  }).join('&');\n  return \"\".concat(cloudBaseUrl, \"/\").concat(cloudRoute, \"?\").concat(params);\n}\n\nconst _getURL = (path, _ref2) => {\n  let {\n    cdn,\n    full,\n    cloud,\n    cloud_route,\n    cloud_params,\n    _cdn_prefix,\n    _root_url_path_prefix,\n    _site_url\n  } = _ref2;\n\n  if (isURL(path)) {\n    return path;\n  }\n\n  const [_path, _query] = path.split('?');\n  path = _path;\n  const query = _query ? \"?\".concat(_query) : '';\n  const siteUrl = s.rtrim(s.trim(_site_url || ''), '/');\n  const cloudRoute = s.trim(cloud_route || '');\n  const cdnPrefix = s.rtrim(s.trim(_cdn_prefix || ''), '/');\n  const pathPrefix = s.rtrim(s.trim(_root_url_path_prefix || ''), '/');\n  const finalPath = s.ltrim(s.trim(path), '/');\n  const url = s.rtrim(\"\".concat(pathPrefix, \"/\").concat(finalPath), '/') + query;\n\n  if (cloud) {\n    const cloudParams = cloud_params || {};\n    return getCloudUrl(url, siteUrl, cloudRoute, cloudParams);\n  }\n\n  if (cdn && cdnPrefix !== '') {\n    return cdnPrefix + url;\n  }\n\n  if (full) {\n    return siteUrl.replace(new RegExp(\"\".concat(escapeRegExp(pathPrefix), \"$\")), '') + url;\n  }\n\n  return url;\n};\n\nconst getURL = function (path) {\n  let {\n    cdn = true,\n    full = false,\n    cloud = false,\n    cloud_route = '',\n    cloud_params = {}\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return _getURL(path, {\n    cdn,\n    full,\n    cloud,\n    cloud_route,\n    cloud_params,\n    _cdn_prefix: settings.get('CDN_PREFIX'),\n    _root_url_path_prefix: __meteor_runtime_config__.ROOT_URL_PATH_PREFIX,\n    _site_url: settings.get('Site_Url')\n  });\n};","map":{"version":3,"sources":["app/utils/lib/getURL.js"],"names":["module","export","_getURL","getURL","s","link","default","v","escapeRegExp","isURL","settings","getCloudUrl","path","_site_url","cloudRoute","cloudParams","cloudBaseUrl","get","replace","siteUrl","rtrim","host","ltrim","Object","assign","includes","secure","params","entries","map","key","value","encodeURIComponent","join","cdn","full","cloud","cloud_route","cloud_params","_cdn_prefix","_root_url_path_prefix","_path","_query","split","query","trim","cdnPrefix","pathPrefix","finalPath","url","RegExp","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX"],"mappings":"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","sourcesContent":["import s from 'underscore.string';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\n\nimport { isURL } from './isURL';\nimport { settings } from '../../settings';\n\nfunction getCloudUrl(path, _site_url, cloudRoute, cloudParams = {}) {\n\tconst cloudBaseUrl = (settings.get('DeepLink_Url') || '').replace(/\\/+$/, '');\n\n\tconst siteUrl = s.rtrim(_site_url, '/');\n\n\t// Remove the protocol\n\tconst host = siteUrl.replace(/https?\\:\\/\\//i, '');\n\tpath = s.ltrim(path, '/');\n\n\tObject.assign(cloudParams, {\n\t\thost,\n\t\tpath,\n\t});\n\n\tif (siteUrl.includes('http://')) {\n\t\tcloudParams.secure = 'no';\n\t}\n\n\tconst params = Object.entries(cloudParams)\n\t\t.map(([key, value]) => `${key}=${encodeURIComponent(value)}`)\n\t\t.join('&');\n\n\treturn `${cloudBaseUrl}/${cloudRoute}?${params}`;\n}\n\nexport const _getURL = (path, { cdn, full, cloud, cloud_route, cloud_params, _cdn_prefix, _root_url_path_prefix, _site_url }) => {\n\tif (isURL(path)) {\n\t\treturn path;\n\t}\n\n\tconst [_path, _query] = path.split('?');\n\tpath = _path;\n\tconst query = _query ? `?${_query}` : '';\n\n\tconst siteUrl = s.rtrim(s.trim(_site_url || ''), '/');\n\tconst cloudRoute = s.trim(cloud_route || '');\n\tconst cdnPrefix = s.rtrim(s.trim(_cdn_prefix || ''), '/');\n\tconst pathPrefix = s.rtrim(s.trim(_root_url_path_prefix || ''), '/');\n\n\tconst finalPath = s.ltrim(s.trim(path), '/');\n\n\tconst url = s.rtrim(`${pathPrefix}/${finalPath}`, '/') + query;\n\n\tif (cloud) {\n\t\tconst cloudParams = cloud_params || {};\n\t\treturn getCloudUrl(url, siteUrl, cloudRoute, cloudParams);\n\t}\n\n\tif (cdn && cdnPrefix !== '') {\n\t\treturn cdnPrefix + url;\n\t}\n\n\tif (full) {\n\t\treturn siteUrl.replace(new RegExp(`${escapeRegExp(pathPrefix)}$`), '') + url;\n\t}\n\n\treturn url;\n};\n\nexport const getURL = (path, { cdn = true, full = false, cloud = false, cloud_route = '', cloud_params = {} } = {}) =>\n\t_getURL(path, {\n\t\tcdn,\n\t\tfull,\n\t\tcloud,\n\t\tcloud_route,\n\t\tcloud_params,\n\t\t_cdn_prefix: settings.get('CDN_PREFIX'),\n\t\t_root_url_path_prefix: __meteor_runtime_config__.ROOT_URL_PATH_PREFIX,\n\t\t_site_url: settings.get('Site_Url'),\n\t});\n"]},"sourceType":"module","hash":"b1a3f90327906a5ede7aa3622214ab961ef3ab47"}
