{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/notification.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui/client/lib/notification.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/notification.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/notification.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/notification.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nmodule.export({\n  KonchatNotification: function () {\n    return KonchatNotification;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 1);\nvar Random;\nmodule.link(\"meteor/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 4);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 5);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 6);\nvar s;\nmodule.link(\"underscore.string\", {\n  \"default\": function (v) {\n    s = v;\n  }\n}, 7);\nvar e2e;\nmodule.link(\"../../../e2e/client\", {\n  e2e: function (v) {\n    e2e = v;\n  }\n}, 8);\nvar Users, ChatSubscription;\nmodule.link(\"../../../models\", {\n  Users: function (v) {\n    Users = v;\n  },\n  ChatSubscription: function (v) {\n    ChatSubscription = v;\n  }\n}, 9);\nvar getUserPreference;\nmodule.link(\"../../../utils\", {\n  getUserPreference: function (v) {\n    getUserPreference = v;\n  }\n}, 10);\nvar getUserAvatarURL;\nmodule.link(\"../../../utils/lib/getUserAvatarURL\", {\n  getUserAvatarURL: function (v) {\n    getUserAvatarURL = v;\n  }\n}, 11);\nvar CustomSounds;\nmodule.link(\"../../../custom-sounds/client/lib/CustomSounds\", {\n  CustomSounds: function (v) {\n    CustomSounds = v;\n  }\n}, 12);\nvar getAvatarAsPng;\nmodule.link(\"../../../../client/lib/utils/getAvatarAsPng\", {\n  getAvatarAsPng: function (v) {\n    getAvatarAsPng = v;\n  }\n}, 13);\nvar onClientMessageReceived;\nmodule.link(\"../../../../client/lib/onClientMessageReceived\", {\n  onClientMessageReceived: function (v) {\n    onClientMessageReceived = v;\n  }\n}, 14);\nvar KonchatNotification = {\n  notificationStatus: new ReactiveVar(),\n  // notificacoes HTML5\n  getDesktopPermission: function () {\n    if (window.Notification && Notification.permission !== 'granted') {\n      return Notification.requestPermission(function (status) {\n        KonchatNotification.notificationStatus.set(status);\n\n        if (Notification.permission !== status) {\n          Notification.permission = status;\n        }\n      });\n    }\n  },\n  notify: function (notification) {\n    if (window.Notification && Notification.permission === 'granted') {\n      var message = {\n        rid: notification.payload != null ? notification.payload.rid : undefined,\n        msg: notification.text,\n        notification: true\n      };\n      return onClientMessageReceived(message).then(function (message) {\n        var requireInteraction = getUserPreference(Meteor.userId(), 'desktopNotificationRequireInteraction');\n        var n = new Notification(notification.title, {\n          icon: notification.icon || getUserAvatarURL(notification.payload.sender.username),\n          body: s.stripTags(message.msg),\n          tag: notification.payload._id,\n          canReply: true,\n          silent: true,\n          requireInteraction: requireInteraction\n        });\n        var notificationDuration = !requireInteraction && (notification.duration - 0 || 10);\n\n        if (notificationDuration > 0) {\n          setTimeout(function () {\n            return n.close();\n          }, notificationDuration * 1000);\n        }\n\n        if (notification.payload && notification.payload.rid) {\n          if (n.addEventListener) {\n            n.addEventListener('reply', function (_ref) {\n              var response = _ref.response;\n              return Meteor.call('sendMessage', {\n                _id: Random.id(),\n                rid: notification.payload.rid,\n                msg: response\n              });\n            });\n          }\n\n          n.onclick = function () {\n            this.close();\n            window.focus();\n\n            switch (notification.payload.type) {\n              case 'd':\n                return FlowRouter.go('direct', _objectSpread({\n                  rid: notification.payload.rid\n                }, notification.payload.tmid && {\n                  tab: 'thread',\n                  context: notification.payload.tmid\n                }), _objectSpread(_objectSpread({}, FlowRouter.current().queryParams), {}, {\n                  jump: notification.payload._id\n                }));\n\n              case 'c':\n                return FlowRouter.go('channel', _objectSpread({\n                  name: notification.payload.name\n                }, notification.payload.tmid && {\n                  tab: 'thread',\n                  context: notification.payload.tmid\n                }), _objectSpread(_objectSpread({}, FlowRouter.current().queryParams), {}, {\n                  jump: notification.payload._id\n                }));\n\n              case 'p':\n                return FlowRouter.go('group', _objectSpread({\n                  name: notification.payload.name\n                }, notification.payload.tmid && {\n                  tab: 'thread',\n                  context: notification.payload.tmid\n                }), _objectSpread(_objectSpread({}, FlowRouter.current().queryParams), {}, {\n                  jump: notification.payload._id\n                }));\n            }\n          };\n        }\n      });\n    }\n  },\n  showDesktop: function () {\n    function _callee(notification) {\n      var e2eRoom;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(notification.payload.rid === Session.get('openedRoom') && (typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined))) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                if (!(Meteor.user().status === 'busy')) {\n                  _context.next = 4;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 4:\n                if (!(notification.payload.message && notification.payload.message.t === 'e2e')) {\n                  _context.next = 12;\n                  break;\n                }\n\n                _context.next = 7;\n                return _regeneratorRuntime.awrap(e2e.getInstanceByRoomId(notification.payload.rid));\n\n              case 7:\n                e2eRoom = _context.sent;\n\n                if (!e2eRoom) {\n                  _context.next = 12;\n                  break;\n                }\n\n                _context.next = 11;\n                return _regeneratorRuntime.awrap(e2eRoom.decrypt(notification.payload.message.msg));\n\n              case 11:\n                notification.text = _context.sent.text;\n\n              case 12:\n                return _context.abrupt(\"return\", getAvatarAsPng(notification.payload.sender.username, function (avatarAsPng) {\n                  notification.icon = avatarAsPng;\n                  return KonchatNotification.notify(notification);\n                }));\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee;\n  }(),\n  newMessage: function (rid) {\n    if (Session.equals(\"user_\" + Meteor.user().username + \"_status\", 'busy')) {\n      return;\n    }\n\n    var userId = Meteor.userId();\n    var newMessageNotification = getUserPreference(userId, 'newMessageNotification');\n    var audioVolume = getUserPreference(userId, 'notificationsSoundVolume');\n    var sub = ChatSubscription.findOne({\n      rid: rid\n    }, {\n      fields: {\n        audioNotificationValue: 1\n      }\n    });\n\n    if (!sub || sub.audioNotificationValue === 'none') {\n      return;\n    }\n\n    try {\n      if (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n        CustomSounds.play(sub.audioNotificationValue, {\n          volume: Number((audioVolume / 100).toPrecision(2))\n        });\n        return;\n      }\n\n      if (newMessageNotification !== 'none') {\n        CustomSounds.play(newMessageNotification, {\n          volume: Number((audioVolume / 100).toPrecision(2))\n        });\n      }\n    } catch (e) {// do nothing\n    }\n  },\n  newRoom: function (rid\n  /* , withSound = true*/\n  ) {\n    Tracker.nonreactive(function () {\n      var newRoomSound = Session.get('newRoomSound');\n\n      if (newRoomSound != null) {\n        newRoomSound = _.union(newRoomSound, [rid]);\n      } else {\n        newRoomSound = [rid];\n      }\n\n      return Session.set('newRoomSound', newRoomSound);\n    });\n  },\n  // $('.link-room-' + rid).addClass('new-room-highlight')\n  removeRoomNotification: function (rid) {\n    var newRoomSound = Session.get('newRoomSound');\n    newRoomSound = _.without(newRoomSound, rid);\n    Tracker.nonreactive(function () {\n      return Session.set('newRoomSound', newRoomSound);\n    });\n    return $(\".link-room-\" + rid).removeClass('new-room-highlight');\n  }\n};\nMeteor.startup(function () {\n  Tracker.autorun(function () {\n    var user = Users.findOne(Meteor.userId(), {\n      fields: {\n        'settings.preferences.newRoomNotification': 1,\n        'settings.preferences.notificationsSoundVolume': 1\n      }\n    });\n    var newRoomNotification = getUserPreference(user, 'newRoomNotification');\n    var audioVolume = getUserPreference(user, 'notificationsSoundVolume');\n\n    if ((Session.get('newRoomSound') || []).length > 0) {\n      Meteor.defer(function () {\n        if (newRoomNotification !== 'none') {\n          CustomSounds.play(newRoomNotification, {\n            volume: Number((audioVolume / 100).toPrecision(2))\n          });\n        }\n      });\n    } else {\n      CustomSounds.pause(newRoomNotification);\n    }\n  });\n});","map":{"version":3,"sources":["app/ui/client/lib/notification.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","export","KonchatNotification","Meteor","ReactiveVar","Random","Tracker","FlowRouter","Session","_","s","e2e","Users","ChatSubscription","getUserPreference","getUserAvatarURL","CustomSounds","getAvatarAsPng","onClientMessageReceived","notificationStatus","getDesktopPermission","window","Notification","permission","requestPermission","status","set","notify","notification","message","rid","payload","undefined","msg","text","then","requireInteraction","userId","n","title","icon","sender","username","body","stripTags","tag","_id","canReply","silent","notificationDuration","duration","setTimeout","close","addEventListener","response","call","id","onclick","focus","type","go","tmid","tab","context","current","queryParams","jump","name","showDesktop","get","document","hasFocus","user","t","getInstanceByRoomId","e2eRoom","decrypt","avatarAsPng","newMessage","equals","newMessageNotification","audioVolume","sub","findOne","fields","audioNotificationValue","play","volume","Number","toPrecision","e","newRoom","nonreactive","newRoomSound","union","removeRoomNotification","without","$","removeClass","startup","autorun","newRoomNotification","length","defer","pause"],"mappings":"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","sourcesContent":["// @TODO implementar 'clicar na notificacao' abre a janela do chat\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Random } from 'meteor/random';\nimport { Tracker } from 'meteor/tracker';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Session } from 'meteor/session';\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nimport { e2e } from '../../../e2e/client';\nimport { Users, ChatSubscription } from '../../../models';\nimport { getUserPreference } from '../../../utils';\nimport { getUserAvatarURL } from '../../../utils/lib/getUserAvatarURL';\nimport { CustomSounds } from '../../../custom-sounds/client/lib/CustomSounds';\nimport { getAvatarAsPng } from '../../../../client/lib/utils/getAvatarAsPng';\nimport { onClientMessageReceived } from '../../../../client/lib/onClientMessageReceived';\n\nexport const KonchatNotification = {\n\tnotificationStatus: new ReactiveVar(),\n\n\t// notificacoes HTML5\n\tgetDesktopPermission() {\n\t\tif (window.Notification && Notification.permission !== 'granted') {\n\t\t\treturn Notification.requestPermission(function (status) {\n\t\t\t\tKonchatNotification.notificationStatus.set(status);\n\t\t\t\tif (Notification.permission !== status) {\n\t\t\t\t\tNotification.permission = status;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tnotify(notification) {\n\t\tif (window.Notification && Notification.permission === 'granted') {\n\t\t\tconst message = {\n\t\t\t\trid: notification.payload != null ? notification.payload.rid : undefined,\n\t\t\t\tmsg: notification.text,\n\t\t\t\tnotification: true,\n\t\t\t};\n\t\t\treturn onClientMessageReceived(message).then(function (message) {\n\t\t\t\tconst requireInteraction = getUserPreference(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\t\t\t\tconst n = new Notification(notification.title, {\n\t\t\t\t\ticon: notification.icon || getUserAvatarURL(notification.payload.sender.username),\n\t\t\t\t\tbody: s.stripTags(message.msg),\n\t\t\t\t\ttag: notification.payload._id,\n\t\t\t\t\tcanReply: true,\n\t\t\t\t\tsilent: true,\n\t\t\t\t\trequireInteraction,\n\t\t\t\t});\n\n\t\t\t\tconst notificationDuration = !requireInteraction && (notification.duration - 0 || 10);\n\t\t\t\tif (notificationDuration > 0) {\n\t\t\t\t\tsetTimeout(() => n.close(), notificationDuration * 1000);\n\t\t\t\t}\n\n\t\t\t\tif (notification.payload && notification.payload.rid) {\n\t\t\t\t\tif (n.addEventListener) {\n\t\t\t\t\t\tn.addEventListener('reply', ({ response }) =>\n\t\t\t\t\t\t\tMeteor.call('sendMessage', {\n\t\t\t\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\t\t\t\trid: notification.payload.rid,\n\t\t\t\t\t\t\t\tmsg: response,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tn.onclick = function () {\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\twindow.focus();\n\t\t\t\t\t\tswitch (notification.payload.type) {\n\t\t\t\t\t\t\tcase 'd':\n\t\t\t\t\t\t\t\treturn FlowRouter.go(\n\t\t\t\t\t\t\t\t\t'direct',\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\trid: notification.payload.rid,\n\t\t\t\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{ ...FlowRouter.current().queryParams, jump: notification.payload._id },\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcase 'c':\n\t\t\t\t\t\t\t\treturn FlowRouter.go(\n\t\t\t\t\t\t\t\t\t'channel',\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{ ...FlowRouter.current().queryParams, jump: notification.payload._id },\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcase 'p':\n\t\t\t\t\t\t\t\treturn FlowRouter.go(\n\t\t\t\t\t\t\t\t\t'group',\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{ ...FlowRouter.current().queryParams, jump: notification.payload._id },\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tasync showDesktop(notification) {\n\t\tif (\n\t\t\tnotification.payload.rid === Session.get('openedRoom') &&\n\t\t\t(typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (Meteor.user().status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (notification.payload.message && notification.payload.message.t === 'e2e') {\n\t\t\tconst e2eRoom = await e2e.getInstanceByRoomId(notification.payload.rid);\n\t\t\tif (e2eRoom) {\n\t\t\t\tnotification.text = (await e2eRoom.decrypt(notification.payload.message.msg)).text;\n\t\t\t}\n\t\t}\n\n\t\treturn getAvatarAsPng(notification.payload.sender.username, function (avatarAsPng) {\n\t\t\tnotification.icon = avatarAsPng;\n\t\t\treturn KonchatNotification.notify(notification);\n\t\t});\n\t},\n\n\tnewMessage(rid) {\n\t\tif (Session.equals(`user_${Meteor.user().username}_status`, 'busy')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst newMessageNotification = getUserPreference(userId, 'newMessageNotification');\n\t\tconst audioVolume = getUserPreference(userId, 'notificationsSoundVolume');\n\n\t\tconst sub = ChatSubscription.findOne({ rid }, { fields: { audioNotificationValue: 1 } });\n\n\t\tif (!sub || sub.audioNotificationValue === 'none') {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tif (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n\t\t\t\tCustomSounds.play(sub.audioNotificationValue, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newMessageNotification !== 'none') {\n\t\t\t\tCustomSounds.play(newMessageNotification, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t},\n\n\tnewRoom(rid /* , withSound = true*/) {\n\t\tTracker.nonreactive(function () {\n\t\t\tlet newRoomSound = Session.get('newRoomSound');\n\t\t\tif (newRoomSound != null) {\n\t\t\t\tnewRoomSound = _.union(newRoomSound, [rid]);\n\t\t\t} else {\n\t\t\t\tnewRoomSound = [rid];\n\t\t\t}\n\n\t\t\treturn Session.set('newRoomSound', newRoomSound);\n\t\t});\n\t},\n\n\t// $('.link-room-' + rid).addClass('new-room-highlight')\n\n\tremoveRoomNotification(rid) {\n\t\tlet newRoomSound = Session.get('newRoomSound');\n\t\tnewRoomSound = _.without(newRoomSound, rid);\n\t\tTracker.nonreactive(() => Session.set('newRoomSound', newRoomSound));\n\n\t\treturn $(`.link-room-${rid}`).removeClass('new-room-highlight');\n\t},\n};\n\nMeteor.startup(() => {\n\tTracker.autorun(function () {\n\t\tconst user = Users.findOne(Meteor.userId(), {\n\t\t\tfields: {\n\t\t\t\t'settings.preferences.newRoomNotification': 1,\n\t\t\t\t'settings.preferences.notificationsSoundVolume': 1,\n\t\t\t},\n\t\t});\n\t\tconst newRoomNotification = getUserPreference(user, 'newRoomNotification');\n\t\tconst audioVolume = getUserPreference(user, 'notificationsSoundVolume');\n\n\t\tif ((Session.get('newRoomSound') || []).length > 0) {\n\t\t\tMeteor.defer(function () {\n\t\t\t\tif (newRoomNotification !== 'none') {\n\t\t\t\t\tCustomSounds.play(newRoomNotification, {\n\t\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tCustomSounds.pause(newRoomNotification);\n\t\t}\n\t});\n});\n"]},"sourceType":"module","hash":"bbea4545890703b6d36fa48b4cee37cf7337bbd5"}
