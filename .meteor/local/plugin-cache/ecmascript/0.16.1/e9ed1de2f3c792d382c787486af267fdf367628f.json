{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/ActionManager.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-message/client/ActionManager.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/ActionManager.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-message/client/ActionManager.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/ActionManager.js"}},"code":"var _excluded = [\"triggerId\"],\n    _excluded2 = [\"type\", \"actionId\", \"appId\", \"rid\", \"mid\", \"viewId\", \"container\"],\n    _excluded3 = [\"type\"],\n    _excluded4 = [\"viewId\"],\n    _excluded5 = [\"view\"],\n    _excluded6 = [\"type\"];\n\nvar _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\n\nvar _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default: function (v) {\n    _objectWithoutProperties = v;\n  }\n}, 2);\nmodule.export({\n  on: function () {\n    return on;\n  },\n  off: function () {\n    return off;\n  },\n  generateTriggerId: function () {\n    return generateTriggerId;\n  },\n  triggerAction: function () {\n    return triggerAction;\n  },\n  triggerBlockAction: function () {\n    return triggerBlockAction;\n  },\n  triggerActionButtonAction: function () {\n    return triggerActionButtonAction;\n  },\n  triggerSubmitView: function () {\n    return triggerSubmitView;\n  },\n  triggerCancel: function () {\n    return triggerCancel;\n  },\n  getUserInteractionPayloadByViewId: function () {\n    return getUserInteractionPayloadByViewId;\n  }\n});\nvar UIKitIncomingInteractionType;\nmodule.link(\"@rocket.chat/apps-engine/definition/uikit\", {\n  UIKitIncomingInteractionType: function (v) {\n    UIKitIncomingInteractionType = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 2);\nvar Random;\nmodule.link(\"meteor/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 3);\nvar Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter: function (v) {\n    Emitter = v;\n  }\n}, 4);\nvar Notifications;\nmodule.link(\"../../notifications/client/lib/Notifications\", {\n  \"default\": function (v) {\n    Notifications = v;\n  }\n}, 5);\nvar CachedCollectionManager;\nmodule.link(\"../../ui-cached-collection\", {\n  CachedCollectionManager: function (v) {\n    CachedCollectionManager = v;\n  }\n}, 6);\nvar modal;\nmodule.link(\"../../ui-utils/client/lib/modal\", {\n  modal: function (v) {\n    modal = v;\n  }\n}, 7);\nvar APIClient;\nmodule.link(\"../../utils\", {\n  APIClient: function (v) {\n    APIClient = v;\n  }\n}, 8);\nvar UIKitInteractionTypes;\nmodule.link(\"../../../definition/UIKit\", {\n  UIKitInteractionTypes: function (v) {\n    UIKitInteractionTypes = v;\n  }\n}, 9);\nvar banners;\nmodule.link(\"../../../client/lib/banners\", {\n  \"*\": function (v) {\n    banners = v;\n  }\n}, 10);\nvar dispatchToastMessage;\nmodule.link(\"../../../client/lib/toast\", {\n  dispatchToastMessage: function (v) {\n    dispatchToastMessage = v;\n  }\n}, 11);\nvar t;\nmodule.link(\"../../utils/client\", {\n  t: function (v) {\n    t = v;\n  }\n}, 12);\nvar events = new Emitter();\n\nvar on = function () {\n  events.on.apply(events, arguments);\n};\n\nvar off = function () {\n  events.off.apply(events, arguments);\n};\n\nvar TRIGGER_TIMEOUT = 5000;\nvar TRIGGER_TIMEOUT_ERROR = 'TRIGGER_TIMEOUT_ERROR';\nvar triggersId = new Map();\nvar instances = new Map();\n\nvar invalidateTriggerId = function (id) {\n  var appId = triggersId.get(id);\n  triggersId.delete(id);\n  return appId;\n};\n\nvar generateTriggerId = function (appId) {\n  var triggerId = Random.id();\n  triggersId.set(triggerId, appId);\n  setTimeout(invalidateTriggerId, TRIGGER_TIMEOUT, triggerId);\n  return triggerId;\n};\n\nvar handlePayloadUserInteraction = function (type, _ref) {\n  var triggerId = _ref.triggerId,\n      data = _objectWithoutProperties(_ref, _excluded);\n\n  if (!triggersId.has(triggerId)) {\n    return;\n  }\n\n  var appId = invalidateTriggerId(triggerId);\n\n  if (!appId) {\n    return;\n  }\n\n  var view = data.view;\n  var viewId = data.viewId;\n\n  if (view && view.id) {\n    viewId = view.id;\n  }\n\n  if (!viewId) {\n    return;\n  }\n\n  if ([UIKitInteractionTypes.ERRORS].includes(type)) {\n    events.emit(viewId, _objectSpread({\n      type: type,\n      triggerId: triggerId,\n      viewId: viewId,\n      appId: appId\n    }, data));\n    return UIKitInteractionTypes.ERRORS;\n  }\n\n  if ([UIKitInteractionTypes.BANNER_UPDATE, UIKitInteractionTypes.MODAL_UPDATE, UIKitInteractionTypes.CONTEXTUAL_BAR_UPDATE].includes(type)) {\n    events.emit(viewId, _objectSpread({\n      type: type,\n      triggerId: triggerId,\n      viewId: viewId,\n      appId: appId\n    }, data));\n    return type;\n  }\n\n  if ([UIKitInteractionTypes.MODAL_OPEN].includes(type)) {\n    var instance = modal.push({\n      template: 'ModalBlock',\n      modifier: 'uikit',\n      closeOnEscape: false,\n      data: _objectSpread({\n        triggerId: triggerId,\n        viewId: viewId,\n        appId: appId\n      }, data)\n    });\n    instances.set(viewId, {\n      close: function () {\n        instance.close();\n        instances.delete(viewId);\n      }\n    });\n    return UIKitInteractionTypes.MODAL_OPEN;\n  }\n\n  if ([UIKitInteractionTypes.CONTEXTUAL_BAR_OPEN].includes(type)) {\n    instances.set(viewId, {\n      payload: _objectSpread({\n        type: type,\n        triggerId: triggerId,\n        appId: appId,\n        viewId: viewId\n      }, data),\n      close: function () {\n        instances.delete(viewId);\n      }\n    });\n    FlowRouter.setParams({\n      tab: 'app',\n      context: viewId\n    });\n    return UIKitInteractionTypes.CONTEXTUAL_BAR_OPEN;\n  }\n\n  if ([UIKitInteractionTypes.BANNER_OPEN].includes(type)) {\n    banners.open(data);\n    instances.set(viewId, {\n      close: function () {\n        banners.closeById(viewId);\n      }\n    });\n    return UIKitInteractionTypes.BANNER_OPEN;\n  }\n\n  if ([UIKitIncomingInteractionType.BANNER_CLOSE].includes(type)) {\n    var _instance = instances.get(viewId);\n\n    if (_instance) {\n      _instance.close();\n    }\n\n    return UIKitIncomingInteractionType.BANNER_CLOSE;\n  }\n\n  if ([UIKitIncomingInteractionType.CONTEXTUAL_BAR_CLOSE].includes(type)) {\n    var _instance2 = instances.get(viewId);\n\n    if (_instance2) {\n      _instance2.close();\n    }\n\n    return UIKitIncomingInteractionType.CONTEXTUAL_BAR_CLOSE;\n  }\n\n  return UIKitInteractionTypes.MODAL_ClOSE;\n};\n\nvar triggerAction = function () {\n  function _callee2(_ref2) {\n    var type, actionId, appId, rid, mid, viewId, container, rest;\n    return _regeneratorRuntime.async(function () {\n      function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              type = _ref2.type, actionId = _ref2.actionId, appId = _ref2.appId, rid = _ref2.rid, mid = _ref2.mid, viewId = _ref2.viewId, container = _ref2.container, rest = _objectWithoutProperties(_ref2, _excluded2);\n              return _context2.abrupt(\"return\", new Promise(function () {\n                function _callee(resolve, reject) {\n                  var triggerId, payload, _await$APIClient$post, interactionType, data;\n\n                  return _regeneratorRuntime.async(function () {\n                    function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            triggerId = generateTriggerId(appId);\n                            payload = rest.payload || rest;\n                            setTimeout(reject, TRIGGER_TIMEOUT, [TRIGGER_TIMEOUT_ERROR, {\n                              triggerId: triggerId,\n                              appId: appId\n                            }]);\n                            _context.next = 5;\n                            return _regeneratorRuntime.awrap(APIClient.post(\"apps/ui.interaction/\" + appId, {\n                              type: type,\n                              actionId: actionId,\n                              payload: payload,\n                              container: container,\n                              mid: mid,\n                              rid: rid,\n                              triggerId: triggerId,\n                              viewId: viewId\n                            }));\n\n                          case 5:\n                            _await$APIClient$post = _context.sent;\n                            interactionType = _await$APIClient$post.type;\n                            data = _objectWithoutProperties(_await$APIClient$post, _excluded3);\n                            return _context.abrupt(\"return\", resolve(handlePayloadUserInteraction(interactionType, data)));\n\n                          case 9:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }\n\n                    return _callee$;\n                  }(), null, null, null, Promise);\n                }\n\n                return _callee;\n              }()));\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }\n\n      return _callee2$;\n    }(), null, null, null, Promise);\n  }\n\n  return _callee2;\n}();\n\nvar triggerBlockAction = function (options) {\n  return triggerAction(_objectSpread({\n    type: UIKitIncomingInteractionType.BLOCK\n  }, options));\n};\n\nvar triggerActionButtonAction = function (options) {\n  return triggerAction(_objectSpread({\n    type: UIKitIncomingInteractionType.ACTION_BUTTON\n  }, options)).catch(function () {\n    function _callee3(reason) {\n      return _regeneratorRuntime.async(function () {\n        function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (Array.isArray(reason) && reason[0] === TRIGGER_TIMEOUT_ERROR) {\n                  dispatchToastMessage({\n                    type: 'error',\n                    message: t('UIKit_Interaction_Timeout')\n                  });\n                }\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }\n\n        return _callee3$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee3;\n  }());\n};\n\nvar triggerSubmitView = function () {\n  function _callee4(_ref3) {\n    var viewId, options, close, result;\n    return _regeneratorRuntime.async(function () {\n      function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              viewId = _ref3.viewId, options = _objectWithoutProperties(_ref3, _excluded4);\n\n              close = function () {\n                var instance = instances.get(viewId);\n\n                if (instance) {\n                  instance.close();\n                }\n              };\n\n              _context4.prev = 2;\n              _context4.next = 5;\n              return _regeneratorRuntime.awrap(triggerAction(_objectSpread({\n                type: UIKitIncomingInteractionType.VIEW_SUBMIT,\n                viewId: viewId\n              }, options)));\n\n            case 5:\n              result = _context4.sent;\n\n              if (!result || UIKitInteractionTypes.MODAL_CLOSE === result) {\n                close();\n              }\n\n              _context4.next = 12;\n              break;\n\n            case 9:\n              _context4.prev = 9;\n              _context4.t0 = _context4[\"catch\"](2);\n              close();\n\n            case 12:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }\n\n      return _callee4$;\n    }(), null, null, [[2, 9]], Promise);\n  }\n\n  return _callee4;\n}();\n\nvar triggerCancel = function () {\n  function _callee5(_ref4) {\n    var view, options, instance;\n    return _regeneratorRuntime.async(function () {\n      function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              view = _ref4.view, options = _objectWithoutProperties(_ref4, _excluded5);\n              instance = instances.get(view.id);\n              _context5.prev = 2;\n              _context5.next = 5;\n              return _regeneratorRuntime.awrap(triggerAction(_objectSpread({\n                type: UIKitIncomingInteractionType.VIEW_CLOSED,\n                view: view\n              }, options)));\n\n            case 5:\n              _context5.prev = 5;\n\n              if (instance) {\n                instance.close();\n              }\n\n              return _context5.finish(5);\n\n            case 8:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }\n\n      return _callee5$;\n    }(), null, null, [[2,, 5, 8]], Promise);\n  }\n\n  return _callee5;\n}();\n\nvar getUserInteractionPayloadByViewId = function (viewId) {\n  if (!viewId) {\n    throw new Error('No viewId provided when checking for `user interaction payload`');\n  }\n\n  var instance = instances.get(viewId);\n\n  if (!instance) {\n    return {};\n  }\n\n  return instance.payload;\n};\n\nMeteor.startup(function () {\n  return CachedCollectionManager.onLogin(function () {\n    return Notifications.onUser('uiInteraction', function (_ref5) {\n      var type = _ref5.type,\n          data = _objectWithoutProperties(_ref5, _excluded6);\n\n      handlePayloadUserInteraction(type, data);\n    });\n  });\n});","map":{"version":3,"sources":["app/ui-message/client/ActionManager.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","_objectWithoutProperties","export","on","off","generateTriggerId","triggerAction","triggerBlockAction","triggerActionButtonAction","triggerSubmitView","triggerCancel","getUserInteractionPayloadByViewId","UIKitIncomingInteractionType","Meteor","FlowRouter","Random","Emitter","Notifications","CachedCollectionManager","modal","APIClient","UIKitInteractionTypes","banners","dispatchToastMessage","t","events","TRIGGER_TIMEOUT","TRIGGER_TIMEOUT_ERROR","triggersId","Map","instances","invalidateTriggerId","id","appId","get","delete","triggerId","set","setTimeout","handlePayloadUserInteraction","type","data","has","view","viewId","ERRORS","includes","emit","BANNER_UPDATE","MODAL_UPDATE","CONTEXTUAL_BAR_UPDATE","MODAL_OPEN","instance","push","template","modifier","closeOnEscape","close","CONTEXTUAL_BAR_OPEN","payload","setParams","tab","context","BANNER_OPEN","open","closeById","BANNER_CLOSE","CONTEXTUAL_BAR_CLOSE","MODAL_ClOSE","actionId","rid","mid","container","rest","Promise","resolve","reject","post","interactionType","options","BLOCK","ACTION_BUTTON","catch","reason","Array","isArray","message","VIEW_SUBMIT","result","MODAL_CLOSE","VIEW_CLOSED","Error","startup","onLogin","onUser"],"mappings":"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","sourcesContent":["import { UIKitIncomingInteractionType } from '@rocket.chat/apps-engine/definition/uikit';\nimport { Meteor } from 'meteor/meteor';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Random } from 'meteor/random';\nimport { Emitter } from '@rocket.chat/emitter';\n\nimport Notifications from '../../notifications/client/lib/Notifications';\nimport { CachedCollectionManager } from '../../ui-cached-collection';\nimport { modal } from '../../ui-utils/client/lib/modal';\nimport { APIClient } from '../../utils';\nimport { UIKitInteractionTypes } from '../../../definition/UIKit';\nimport * as banners from '../../../client/lib/banners';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\nimport { t } from '../../utils/client';\n\nconst events = new Emitter();\n\nexport const on = (...args) => {\n\tevents.on(...args);\n};\n\nexport const off = (...args) => {\n\tevents.off(...args);\n};\n\nconst TRIGGER_TIMEOUT = 5000;\n\nconst TRIGGER_TIMEOUT_ERROR = 'TRIGGER_TIMEOUT_ERROR';\n\nconst triggersId = new Map();\n\nconst instances = new Map();\n\nconst invalidateTriggerId = (id) => {\n\tconst appId = triggersId.get(id);\n\ttriggersId.delete(id);\n\treturn appId;\n};\n\nexport const generateTriggerId = (appId) => {\n\tconst triggerId = Random.id();\n\ttriggersId.set(triggerId, appId);\n\tsetTimeout(invalidateTriggerId, TRIGGER_TIMEOUT, triggerId);\n\treturn triggerId;\n};\n\nconst handlePayloadUserInteraction = (type, { /* appId,*/ triggerId, ...data }) => {\n\tif (!triggersId.has(triggerId)) {\n\t\treturn;\n\t}\n\tconst appId = invalidateTriggerId(triggerId);\n\tif (!appId) {\n\t\treturn;\n\t}\n\n\tconst { view } = data;\n\tlet { viewId } = data;\n\n\tif (view && view.id) {\n\t\tviewId = view.id;\n\t}\n\n\tif (!viewId) {\n\t\treturn;\n\t}\n\n\tif ([UIKitInteractionTypes.ERRORS].includes(type)) {\n\t\tevents.emit(viewId, {\n\t\t\ttype,\n\t\t\ttriggerId,\n\t\t\tviewId,\n\t\t\tappId,\n\t\t\t...data,\n\t\t});\n\t\treturn UIKitInteractionTypes.ERRORS;\n\t}\n\n\tif (\n\t\t[UIKitInteractionTypes.BANNER_UPDATE, UIKitInteractionTypes.MODAL_UPDATE, UIKitInteractionTypes.CONTEXTUAL_BAR_UPDATE].includes(type)\n\t) {\n\t\tevents.emit(viewId, {\n\t\t\ttype,\n\t\t\ttriggerId,\n\t\t\tviewId,\n\t\t\tappId,\n\t\t\t...data,\n\t\t});\n\t\treturn type;\n\t}\n\n\tif ([UIKitInteractionTypes.MODAL_OPEN].includes(type)) {\n\t\tconst instance = modal.push({\n\t\t\ttemplate: 'ModalBlock',\n\t\t\tmodifier: 'uikit',\n\t\t\tcloseOnEscape: false,\n\t\t\tdata: {\n\t\t\t\ttriggerId,\n\t\t\t\tviewId,\n\t\t\t\tappId,\n\t\t\t\t...data,\n\t\t\t},\n\t\t});\n\n\t\tinstances.set(viewId, {\n\t\t\tclose() {\n\t\t\t\tinstance.close();\n\t\t\t\tinstances.delete(viewId);\n\t\t\t},\n\t\t});\n\n\t\treturn UIKitInteractionTypes.MODAL_OPEN;\n\t}\n\n\tif ([UIKitInteractionTypes.CONTEXTUAL_BAR_OPEN].includes(type)) {\n\t\tinstances.set(viewId, {\n\t\t\tpayload: {\n\t\t\t\ttype,\n\t\t\t\ttriggerId,\n\t\t\t\tappId,\n\t\t\t\tviewId,\n\t\t\t\t...data,\n\t\t\t},\n\t\t\tclose() {\n\t\t\t\tinstances.delete(viewId);\n\t\t\t},\n\t\t});\n\n\t\tFlowRouter.setParams({ tab: 'app', context: viewId });\n\n\t\treturn UIKitInteractionTypes.CONTEXTUAL_BAR_OPEN;\n\t}\n\n\tif ([UIKitInteractionTypes.BANNER_OPEN].includes(type)) {\n\t\tbanners.open(data);\n\t\tinstances.set(viewId, {\n\t\t\tclose() {\n\t\t\t\tbanners.closeById(viewId);\n\t\t\t},\n\t\t});\n\t\treturn UIKitInteractionTypes.BANNER_OPEN;\n\t}\n\n\tif ([UIKitIncomingInteractionType.BANNER_CLOSE].includes(type)) {\n\t\tconst instance = instances.get(viewId);\n\n\t\tif (instance) {\n\t\t\tinstance.close();\n\t\t}\n\t\treturn UIKitIncomingInteractionType.BANNER_CLOSE;\n\t}\n\n\tif ([UIKitIncomingInteractionType.CONTEXTUAL_BAR_CLOSE].includes(type)) {\n\t\tconst instance = instances.get(viewId);\n\n\t\tif (instance) {\n\t\t\tinstance.close();\n\t\t}\n\t\treturn UIKitIncomingInteractionType.CONTEXTUAL_BAR_CLOSE;\n\t}\n\n\treturn UIKitInteractionTypes.MODAL_ClOSE;\n};\n\nexport const triggerAction = async ({ type, actionId, appId, rid, mid, viewId, container, ...rest }) =>\n\tnew Promise(async (resolve, reject) => {\n\t\tconst triggerId = generateTriggerId(appId);\n\n\t\tconst payload = rest.payload || rest;\n\n\t\tsetTimeout(reject, TRIGGER_TIMEOUT, [TRIGGER_TIMEOUT_ERROR, { triggerId, appId }]);\n\n\t\tconst { type: interactionType, ...data } = await APIClient.post(`apps/ui.interaction/${appId}`, {\n\t\t\ttype,\n\t\t\tactionId,\n\t\t\tpayload,\n\t\t\tcontainer,\n\t\t\tmid,\n\t\t\trid,\n\t\t\ttriggerId,\n\t\t\tviewId,\n\t\t});\n\n\t\treturn resolve(handlePayloadUserInteraction(interactionType, data));\n\t});\n\nexport const triggerBlockAction = (options) => triggerAction({ type: UIKitIncomingInteractionType.BLOCK, ...options });\n\nexport const triggerActionButtonAction = (options) =>\n\ttriggerAction({ type: UIKitIncomingInteractionType.ACTION_BUTTON, ...options }).catch(async (reason) => {\n\t\tif (Array.isArray(reason) && reason[0] === TRIGGER_TIMEOUT_ERROR) {\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'error',\n\t\t\t\tmessage: t('UIKit_Interaction_Timeout'),\n\t\t\t});\n\t\t}\n\t});\n\nexport const triggerSubmitView = async ({ viewId, ...options }) => {\n\tconst close = () => {\n\t\tconst instance = instances.get(viewId);\n\n\t\tif (instance) {\n\t\t\tinstance.close();\n\t\t}\n\t};\n\n\ttry {\n\t\tconst result = await triggerAction({\n\t\t\ttype: UIKitIncomingInteractionType.VIEW_SUBMIT,\n\t\t\tviewId,\n\t\t\t...options,\n\t\t});\n\t\tif (!result || UIKitInteractionTypes.MODAL_CLOSE === result) {\n\t\t\tclose();\n\t\t}\n\t} catch {\n\t\tclose();\n\t}\n};\n\nexport const triggerCancel = async ({ view, ...options }) => {\n\tconst instance = instances.get(view.id);\n\ttry {\n\t\tawait triggerAction({ type: UIKitIncomingInteractionType.VIEW_CLOSED, view, ...options });\n\t} finally {\n\t\tif (instance) {\n\t\t\tinstance.close();\n\t\t}\n\t}\n};\n\nexport const getUserInteractionPayloadByViewId = (viewId) => {\n\tif (!viewId) {\n\t\tthrow new Error('No viewId provided when checking for `user interaction payload`');\n\t}\n\n\tconst instance = instances.get(viewId);\n\n\tif (!instance) {\n\t\treturn {};\n\t}\n\n\treturn instance.payload;\n};\n\nMeteor.startup(() =>\n\tCachedCollectionManager.onLogin(() =>\n\t\tNotifications.onUser('uiInteraction', ({ type, ...data }) => {\n\t\t\thandlePayloadUserInteraction(type, data);\n\t\t}),\n\t),\n);\n"]},"sourceType":"module","hash":"e9ed1de2f3c792d382c787486af267fdf367628f"}
