{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/customSounds/AddCustomSound.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/admin/customSounds/AddCustomSound.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/customSounds/AddCustomSound.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/customSounds/AddCustomSound.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/customSounds/AddCustomSound.js"}},"code":"const _excluded = [\"goToNew\", \"close\", \"onChange\"];\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 0);\nlet Field, TextInput, Box, Icon, Margins, Button, ButtonGroup;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Field(v) {\n    Field = v;\n  },\n\n  TextInput(v) {\n    TextInput = v;\n  },\n\n  Box(v) {\n    Box = v;\n  },\n\n  Icon(v) {\n    Icon = v;\n  },\n\n  Margins(v) {\n    Margins = v;\n  },\n\n  Button(v) {\n    Button = v;\n  },\n\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  }\n\n}, 0);\nlet React, useState, useCallback;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useState(v) {\n    useState = v;\n  },\n\n  useCallback(v) {\n    useCallback = v;\n  }\n\n}, 1);\nlet VerticalBar;\nmodule.link(\"../../../components/VerticalBar\", {\n  default(v) {\n    VerticalBar = v;\n  }\n\n}, 2);\nlet useMethod;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useMethod(v) {\n    useMethod = v;\n  }\n\n}, 3);\nlet useToastMessageDispatch;\nmodule.link(\"../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n\n}, 4);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 5);\nlet useFileInput;\nmodule.link(\"../../../hooks/useFileInput\", {\n  useFileInput(v) {\n    useFileInput = v;\n  }\n\n}, 6);\nlet validate, createSoundData;\nmodule.link(\"./lib\", {\n  validate(v) {\n    validate = v;\n  },\n\n  createSoundData(v) {\n    createSoundData = v;\n  }\n\n}, 7);\n\nfunction AddCustomSound(_ref) {\n  let {\n    goToNew,\n    close,\n    onChange\n  } = _ref,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  const t = useTranslation();\n  const dispatchToastMessage = useToastMessageDispatch();\n  const [name, setName] = useState('');\n  const [sound, setSound] = useState();\n  const uploadCustomSound = useMethod('uploadCustomSound');\n  const insertOrUpdateSound = useMethod('insertOrUpdateSound');\n  const handleChangeFile = useCallback(soundFile => {\n    setSound(soundFile);\n  }, []);\n  const [clickUpload] = useFileInput(handleChangeFile, 'audio/mp3');\n  const saveAction = useCallback(async (name, soundFile) => {\n    const soundData = createSoundData(soundFile, name);\n    const validation = validate(soundData, soundFile);\n\n    if (validation.length === 0) {\n      let soundId;\n\n      try {\n        soundId = await insertOrUpdateSound(soundData);\n      } catch (error) {\n        dispatchToastMessage({\n          type: 'error',\n          message: error\n        });\n      }\n\n      soundData._id = soundId;\n      soundData.random = Math.round(Math.random() * 1000);\n\n      if (soundId) {\n        dispatchToastMessage({\n          type: 'success',\n          message: t('Uploading_file')\n        });\n        const reader = new FileReader();\n        reader.readAsBinaryString(soundFile);\n\n        reader.onloadend = () => {\n          try {\n            uploadCustomSound(reader.result, soundFile.type, soundData);\n            dispatchToastMessage({\n              type: 'success',\n              message: t('File_uploaded')\n            });\n          } catch (error) {\n            dispatchToastMessage({\n              type: 'error',\n              message: error\n            });\n          }\n        };\n      }\n\n      return soundId;\n    }\n\n    validation.forEach(error => {\n      throw new Error({\n        type: 'error',\n        message: t('error-the-field-is-required', {\n          field: t(error)\n        })\n      });\n    });\n  }, [dispatchToastMessage, insertOrUpdateSound, t, uploadCustomSound]);\n  const handleSave = useCallback(async () => {\n    try {\n      const result = await saveAction(name, sound);\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Custom_Sound_Saved_Successfully')\n      });\n      goToNew(result)();\n      onChange();\n    } catch (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    }\n  }, [dispatchToastMessage, goToNew, name, onChange, saveAction, sound, t]);\n  return /*#__PURE__*/React.createElement(VerticalBar.ScrollableContent, props, /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Label, null, t('Name')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextInput, {\n    value: name,\n    onChange: e => setName(e.currentTarget.value),\n    placeholder: t('Name')\n  }))), /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Label, {\n    alignSelf: \"stretch\"\n  }, t('Sound_File_mp3')), /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"row\",\n    mbs: \"none\"\n  }, /*#__PURE__*/React.createElement(Margins, {\n    inline: \"x4\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    square: true,\n    onClick: clickUpload\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"upload\",\n    size: \"x20\"\n  })), sound && sound.name || 'none'))), /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(ButtonGroup, {\n    stretch: true,\n    w: \"full\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    mie: \"x4\",\n    onClick: close\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    onClick: handleSave,\n    disabled: name === ''\n  }, t('Save'))))));\n}\n\nmodule.exportDefault(AddCustomSound);","map":{"version":3,"sources":["client/views/admin/customSounds/AddCustomSound.js"],"names":["_objectWithoutProperties","module","link","default","v","Field","TextInput","Box","Icon","Margins","Button","ButtonGroup","React","useState","useCallback","VerticalBar","useMethod","useToastMessageDispatch","useTranslation","useFileInput","validate","createSoundData","AddCustomSound","goToNew","close","onChange","props","t","dispatchToastMessage","name","setName","sound","setSound","uploadCustomSound","insertOrUpdateSound","handleChangeFile","soundFile","clickUpload","saveAction","soundData","validation","length","soundId","error","type","message","_id","random","Math","round","reader","FileReader","readAsBinaryString","onloadend","result","forEach","Error","field","handleSave","e","currentTarget","value","exportDefault"],"mappings":"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","sourcesContent":["import { Field, TextInput, Box, Icon, Margins, Button, ButtonGroup } from '@rocket.chat/fuselage';\nimport React, { useState, useCallback } from 'react';\n\nimport VerticalBar from '../../../components/VerticalBar';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { validate, createSoundData } from './lib';\n\nfunction AddCustomSound({ goToNew, close, onChange, ...props }) {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [name, setName] = useState('');\n\tconst [sound, setSound] = useState();\n\n\tconst uploadCustomSound = useMethod('uploadCustomSound');\n\n\tconst insertOrUpdateSound = useMethod('insertOrUpdateSound');\n\n\tconst handleChangeFile = useCallback((soundFile) => {\n\t\tsetSound(soundFile);\n\t}, []);\n\n\tconst [clickUpload] = useFileInput(handleChangeFile, 'audio/mp3');\n\n\tconst saveAction = useCallback(\n\t\tasync (name, soundFile) => {\n\t\t\tconst soundData = createSoundData(soundFile, name);\n\t\t\tconst validation = validate(soundData, soundFile);\n\t\t\tif (validation.length === 0) {\n\t\t\t\tlet soundId;\n\t\t\t\ttry {\n\t\t\t\t\tsoundId = await insertOrUpdateSound(soundData);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t}\n\n\t\t\t\tsoundData._id = soundId;\n\t\t\t\tsoundData.random = Math.round(Math.random() * 1000);\n\n\t\t\t\tif (soundId) {\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Uploading_file') });\n\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\treader.readAsBinaryString(soundFile);\n\t\t\t\t\treader.onloadend = () => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tuploadCustomSound(reader.result, soundFile.type, soundData);\n\t\t\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn soundId;\n\t\t\t}\n\t\t\tvalidation.forEach((error) => {\n\t\t\t\tthrow new Error({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmessage: t('error-the-field-is-required', { field: t(error) }),\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t[dispatchToastMessage, insertOrUpdateSound, t, uploadCustomSound],\n\t);\n\n\tconst handleSave = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await saveAction(name, sound);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Custom_Sound_Saved_Successfully') });\n\t\t\tgoToNew(result)();\n\t\t\tonChange();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, goToNew, name, onChange, saveAction, sound, t]);\n\n\treturn (\n\t\t<VerticalBar.ScrollableContent {...props}>\n\t\t\t<Field>\n\t\t\t\t<Field.Label>{t('Name')}</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<TextInput value={name} onChange={(e) => setName(e.currentTarget.value)} placeholder={t('Name')} />\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Label alignSelf='stretch'>{t('Sound_File_mp3')}</Field.Label>\n\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t<Margins inline='x4'>\n\t\t\t\t\t\t<Button square onClick={clickUpload}>\n\t\t\t\t\t\t\t<Icon name='upload' size='x20' />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{(sound && sound.name) || 'none'}\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<ButtonGroup stretch w='full'>\n\t\t\t\t\t\t<Button mie='x4' onClick={close}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary onClick={handleSave} disabled={name === ''}>\n\t\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\t\t</VerticalBar.ScrollableContent>\n\t);\n}\n\nexport default AddCustomSound;\n"]},"sourceType":"module","hash":"427e48b7d0370bb1bacea0b842cfd23d2898cf0c"}
