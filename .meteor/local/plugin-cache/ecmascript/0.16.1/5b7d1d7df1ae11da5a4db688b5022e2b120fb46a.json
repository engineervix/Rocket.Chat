{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/ForwardChatModal.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/components/Omnichannel/modals/ForwardChatModal.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/ForwardChatModal.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/ForwardChatModal.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/Omnichannel/modals/ForwardChatModal.js"}},"code":"const _excluded = [\"onForward\", \"onCancel\", \"room\"];\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 0);\nlet Field, Button, TextAreaInput, Icon, ButtonGroup, Modal, Box, PaginatedSelectFiltered;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Field(v) {\n    Field = v;\n  },\n\n  Button(v) {\n    Button = v;\n  },\n\n  TextAreaInput(v) {\n    TextAreaInput = v;\n  },\n\n  Icon(v) {\n    Icon = v;\n  },\n\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  },\n\n  Modal(v) {\n    Modal = v;\n  },\n\n  Box(v) {\n    Box = v;\n  },\n\n  PaginatedSelectFiltered(v) {\n    PaginatedSelectFiltered = v;\n  }\n\n}, 0);\nlet useMutableCallback, useAutoFocus, useDebouncedValue;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  },\n\n  useAutoFocus(v) {\n    useAutoFocus = v;\n  },\n\n  useDebouncedValue(v) {\n    useDebouncedValue = v;\n  }\n\n}, 1);\nlet React, useEffect, useMemo, useState;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  },\n\n  useState(v) {\n    useState = v;\n  }\n\n}, 2);\nlet useEndpoint;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useEndpoint(v) {\n    useEndpoint = v;\n  }\n\n}, 3);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 4);\nlet useRecordList;\nmodule.link(\"../../../hooks/lists/useRecordList\", {\n  useRecordList(v) {\n    useRecordList = v;\n  }\n\n}, 5);\nlet AsyncStatePhase;\nmodule.link(\"../../../hooks/useAsyncState\", {\n  AsyncStatePhase(v) {\n    AsyncStatePhase = v;\n  }\n\n}, 6);\nlet useForm;\nmodule.link(\"../../../hooks/useForm\", {\n  useForm(v) {\n    useForm = v;\n  }\n\n}, 7);\nlet UserAutoComplete;\nmodule.link(\"../../UserAutoComplete\", {\n  default(v) {\n    UserAutoComplete = v;\n  }\n\n}, 8);\nlet useDepartmentsList;\nmodule.link(\"../hooks/useDepartmentsList\", {\n  useDepartmentsList(v) {\n    useDepartmentsList = v;\n  }\n\n}, 9);\nlet ModalSeparator;\nmodule.link(\"./ModalSeparator\", {\n  default(v) {\n    ModalSeparator = v;\n  }\n\n}, 10);\n\nconst ForwardChatModal = _ref => {\n  let {\n    onForward,\n    onCancel,\n    room\n  } = _ref,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  const t = useTranslation();\n  const inputRef = useAutoFocus(true);\n  const {\n    values,\n    handlers\n  } = useForm({\n    username: '',\n    comment: '',\n    department: {}\n  });\n  const {\n    username,\n    comment,\n    department\n  } = values;\n  const [userId, setUserId] = useState('');\n  const {\n    handleUsername,\n    handleComment,\n    handleDepartment\n  } = handlers;\n  const getUserData = useEndpoint('GET', \"users.info?username=\".concat(username));\n  const [departmentsFilter, setDepartmentsFilter] = useState('');\n  const debouncedDepartmentsFilter = useDebouncedValue(departmentsFilter, 500);\n  const {\n    itemsList: departmentsList,\n    loadMoreItems: loadMoreDepartments\n  } = useDepartmentsList(useMemo(() => ({\n    filter: debouncedDepartmentsFilter,\n    enabled: true\n  }), [debouncedDepartmentsFilter]));\n  const {\n    phase: departmentsPhase,\n    items: departmentsItems,\n    itemCount: departmentsTotal\n  } = useRecordList(departmentsList);\n  const handleSend = useMutableCallback(() => {\n    onForward(department === null || department === void 0 ? void 0 : department.value, userId, comment);\n  }, [onForward, department.value, userId, comment]);\n  const onChangeUsername = useMutableCallback(username => {\n    handleUsername(username);\n  });\n  useEffect(() => {\n    if (!username) {\n      return;\n    }\n\n    const fetchData = async () => {\n      const {\n        user\n      } = await getUserData();\n      setUserId(user._id);\n    };\n\n    fetchData(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [username]);\n  const canForward = department || username;\n  const departments = departmentsItems;\n  const hasDepartments = departments && departments.length > 0;\n  const {\n    servedBy: {\n      _id: agentId\n    } = {}\n  } = room || {};\n\n  const _id = agentId && {\n    $ne: agentId\n  };\n\n  const conditions = {\n    _id,\n    status: {\n      $ne: 'offline'\n    },\n    statusLivechat: 'available'\n  };\n  return /*#__PURE__*/React.createElement(Modal, props, /*#__PURE__*/React.createElement(Modal.Header, null, /*#__PURE__*/React.createElement(Icon, {\n    name: \"baloon-arrow-top-right\",\n    size: 20\n  }), /*#__PURE__*/React.createElement(Modal.Title, null, t('Forward_chat')), /*#__PURE__*/React.createElement(Modal.Close, {\n    onClick: onCancel\n  })), /*#__PURE__*/React.createElement(Modal.Content, {\n    fontScale: \"p2\"\n  }, /*#__PURE__*/React.createElement(Field, {\n    mbe: 'x30'\n  }, /*#__PURE__*/React.createElement(Field.Label, null, t('Forward_to_department')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(PaginatedSelectFiltered, {\n    withTitle: true,\n    filter: departmentsFilter,\n    setFilter: setDepartmentsFilter,\n    options: departmentsItems,\n    value: department,\n    maxWidth: \"100%\",\n    placeholder: t('Select_an_option'),\n    onChange: handleDepartment,\n    flexGrow: 1,\n    endReached: departmentsPhase === AsyncStatePhase.LOADING ? () => {} : start => loadMoreDepartments(start, Math.min(50, departmentsTotal))\n  }))), /*#__PURE__*/React.createElement(ModalSeparator, {\n    text: t('or')\n  }), /*#__PURE__*/React.createElement(Field, {\n    mbs: hasDepartments && 'x30'\n  }, /*#__PURE__*/React.createElement(Field.Label, null, t('Forward_to_user')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(UserAutoComplete, {\n    conditions: conditions,\n    flexGrow: 1,\n    value: username,\n    onChange: onChangeUsername,\n    placeholder: t('Username')\n  }))), /*#__PURE__*/React.createElement(Field, {\n    marginBlock: \"x15\"\n  }, /*#__PURE__*/React.createElement(Field.Label, null, t('Leave_a_comment'), ' ', /*#__PURE__*/React.createElement(Box, {\n    is: \"span\",\n    color: \"neutral-600\"\n  }, \"(\", t('Optional'), \")\")), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextAreaInput, {\n    ref: inputRef,\n    rows: 8,\n    flexGrow: 1,\n    value: comment,\n    onChange: handleComment\n  })))), /*#__PURE__*/React.createElement(Modal.Footer, null, /*#__PURE__*/React.createElement(ButtonGroup, {\n    align: \"end\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onCancel\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    disabled: !canForward,\n    primary: true,\n    onClick: handleSend\n  }, t('Forward')))));\n};\n\nmodule.exportDefault(ForwardChatModal);","map":{"version":3,"sources":["client/components/Omnichannel/modals/ForwardChatModal.js"],"names":["_objectWithoutProperties","module","link","default","v","Field","Button","TextAreaInput","Icon","ButtonGroup","Modal","Box","PaginatedSelectFiltered","useMutableCallback","useAutoFocus","useDebouncedValue","React","useEffect","useMemo","useState","useEndpoint","useTranslation","useRecordList","AsyncStatePhase","useForm","UserAutoComplete","useDepartmentsList","ModalSeparator","ForwardChatModal","onForward","onCancel","room","props","t","inputRef","values","handlers","username","comment","department","userId","setUserId","handleUsername","handleComment","handleDepartment","getUserData","departmentsFilter","setDepartmentsFilter","debouncedDepartmentsFilter","itemsList","departmentsList","loadMoreItems","loadMoreDepartments","filter","enabled","phase","departmentsPhase","items","departmentsItems","itemCount","departmentsTotal","handleSend","value","onChangeUsername","fetchData","user","_id","canForward","departments","hasDepartments","length","servedBy","agentId","$ne","conditions","status","statusLivechat","LOADING","start","Math","min","exportDefault"],"mappings":"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","sourcesContent":["import { Field, Button, TextAreaInput, Icon, ButtonGroup, Modal, Box, PaginatedSelectFiltered } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useAutoFocus, useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport { useEndpoint } from '../../../contexts/ServerContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useRecordList } from '../../../hooks/lists/useRecordList';\nimport { AsyncStatePhase } from '../../../hooks/useAsyncState';\nimport { useForm } from '../../../hooks/useForm';\nimport UserAutoComplete from '../../UserAutoComplete';\nimport { useDepartmentsList } from '../hooks/useDepartmentsList';\nimport ModalSeparator from './ModalSeparator';\n\nconst ForwardChatModal = ({ onForward, onCancel, room, ...props }) => {\n\tconst t = useTranslation();\n\n\tconst inputRef = useAutoFocus(true);\n\n\tconst { values, handlers } = useForm({\n\t\tusername: '',\n\t\tcomment: '',\n\t\tdepartment: {},\n\t});\n\tconst { username, comment, department } = values;\n\tconst [userId, setUserId] = useState('');\n\n\tconst { handleUsername, handleComment, handleDepartment } = handlers;\n\tconst getUserData = useEndpoint('GET', `users.info?username=${username}`);\n\n\tconst [departmentsFilter, setDepartmentsFilter] = useState('');\n\n\tconst debouncedDepartmentsFilter = useDebouncedValue(departmentsFilter, 500);\n\n\tconst { itemsList: departmentsList, loadMoreItems: loadMoreDepartments } = useDepartmentsList(\n\t\tuseMemo(() => ({ filter: debouncedDepartmentsFilter, enabled: true }), [debouncedDepartmentsFilter]),\n\t);\n\n\tconst { phase: departmentsPhase, items: departmentsItems, itemCount: departmentsTotal } = useRecordList(departmentsList);\n\n\tconst handleSend = useMutableCallback(() => {\n\t\tonForward(department?.value, userId, comment);\n\t}, [onForward, department.value, userId, comment]);\n\n\tconst onChangeUsername = useMutableCallback((username) => {\n\t\thandleUsername(username);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!username) {\n\t\t\treturn;\n\t\t}\n\t\tconst fetchData = async () => {\n\t\t\tconst { user } = await getUserData();\n\t\t\tsetUserId(user._id);\n\t\t};\n\t\tfetchData();\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [username]);\n\n\tconst canForward = department || username;\n\n\tconst departments = departmentsItems;\n\n\tconst hasDepartments = departments && departments.length > 0;\n\n\tconst { servedBy: { _id: agentId } = {} } = room || {};\n\n\tconst _id = agentId && { $ne: agentId };\n\n\tconst conditions = { _id, status: { $ne: 'offline' }, statusLivechat: 'available' };\n\n\treturn (\n\t\t<Modal {...props}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Icon name='baloon-arrow-top-right' size={20} />\n\t\t\t\t<Modal.Title>{t('Forward_chat')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t<Field mbe={'x30'}>\n\t\t\t\t\t<Field.Label>{t('Forward_to_department')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<PaginatedSelectFiltered\n\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\tfilter={departmentsFilter}\n\t\t\t\t\t\t\tsetFilter={setDepartmentsFilter}\n\t\t\t\t\t\t\toptions={departmentsItems}\n\t\t\t\t\t\t\tvalue={department}\n\t\t\t\t\t\t\tmaxWidth='100%'\n\t\t\t\t\t\t\tplaceholder={t('Select_an_option')}\n\t\t\t\t\t\t\tonChange={handleDepartment}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tendReached={\n\t\t\t\t\t\t\t\tdepartmentsPhase === AsyncStatePhase.LOADING\n\t\t\t\t\t\t\t\t\t? () => {}\n\t\t\t\t\t\t\t\t\t: (start) => loadMoreDepartments(start, Math.min(50, departmentsTotal))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t\t<ModalSeparator text={t('or')} />\n\t\t\t\t<Field mbs={hasDepartments && 'x30'}>\n\t\t\t\t\t<Field.Label>{t('Forward_to_user')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<UserAutoComplete\n\t\t\t\t\t\t\tconditions={conditions}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tvalue={username}\n\t\t\t\t\t\t\tonChange={onChangeUsername}\n\t\t\t\t\t\t\tplaceholder={t('Username')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t\t<Field marginBlock='x15'>\n\t\t\t\t\t<Field.Label>\n\t\t\t\t\t\t{t('Leave_a_comment')}{' '}\n\t\t\t\t\t\t<Box is='span' color='neutral-600'>\n\t\t\t\t\t\t\t({t('Optional')})\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<TextAreaInput ref={inputRef} rows={8} flexGrow={1} value={comment} onChange={handleComment} />\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button disabled={!canForward} primary onClick={handleSend}>\n\t\t\t\t\t\t{t('Forward')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default ForwardChatModal;\n"]},"sourceType":"module","hash":"5b7d1d7df1ae11da5a4db688b5022e2b120fb46a"}
