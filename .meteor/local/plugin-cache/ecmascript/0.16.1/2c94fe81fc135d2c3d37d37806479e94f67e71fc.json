{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji-custom/client/lib/emojiCustom.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/emoji-custom/client/lib/emojiCustom.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji-custom/client/lib/emojiCustom.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji-custom/client/lib/emojiCustom.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/emoji-custom/client/lib/emojiCustom.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _createForOfIteratorHelperLoose;\n\nmodule.link(\"@babel/runtime/helpers/createForOfIteratorHelperLoose\", {\n  default: function (v) {\n    _createForOfIteratorHelperLoose = v;\n  }\n}, 1);\nmodule.export({\n  getEmojiUrlFromName: function () {\n    return getEmojiUrlFromName;\n  },\n  deleteEmojiCustom: function () {\n    return deleteEmojiCustom;\n  },\n  updateEmojiCustom: function () {\n    return updateEmojiCustom;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 1);\nvar escapeRegExp;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeRegExp: function (v) {\n    escapeRegExp = v;\n  }\n}, 2);\nvar isSetNotNull;\nmodule.link(\"./function-isSet\", {\n  isSetNotNull: function (v) {\n    isSetNotNull = v;\n  }\n}, 3);\nvar RoomManager;\nmodule.link(\"../../../ui-utils/client\", {\n  RoomManager: function (v) {\n    RoomManager = v;\n  }\n}, 4);\nvar emoji, EmojiPicker;\nmodule.link(\"../../../emoji/client\", {\n  emoji: function (v) {\n    emoji = v;\n  },\n  EmojiPicker: function (v) {\n    EmojiPicker = v;\n  }\n}, 5);\nvar CachedCollectionManager;\nmodule.link(\"../../../ui-cached-collection/client\", {\n  CachedCollectionManager: function (v) {\n    CachedCollectionManager = v;\n  }\n}, 6);\nvar APIClient;\nmodule.link(\"../../../utils/client\", {\n  APIClient: function (v) {\n    APIClient = v;\n  }\n}, 7);\n\nvar getEmojiUrlFromName = function (name, extension) {\n  Session.get;\n  var key = \"emoji_random_\" + name;\n  var random = 0;\n\n  if (isSetNotNull(function () {\n    return Session.keys[key];\n  })) {\n    random = Session.keys[key];\n  }\n\n  if (name == null) {\n    return;\n  }\n\n  var path = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '';\n  return path + \"/emoji-custom/\" + encodeURIComponent(name) + \".\" + extension + \"?_dc=\" + random;\n};\n\nvar deleteEmojiCustom = function (emojiData) {\n  delete emoji.list[\":\" + emojiData.name + \":\"];\n  var arrayIndex = emoji.packages.emojiCustom.emojisByCategory.rocket.indexOf(emojiData.name);\n\n  if (arrayIndex !== -1) {\n    emoji.packages.emojiCustom.emojisByCategory.rocket.splice(arrayIndex, 1);\n  }\n\n  var arrayIndexList = emoji.packages.emojiCustom.list.indexOf(\":\" + emojiData.name + \":\");\n\n  if (arrayIndexList !== -1) {\n    emoji.packages.emojiCustom.list.splice(arrayIndexList, 1);\n  }\n\n  if (isSetNotNull(function () {\n    return emojiData.aliases;\n  })) {\n    for (var _iterator = _createForOfIteratorHelperLoose(emojiData.aliases), _step; !(_step = _iterator()).done;) {\n      var alias = _step.value;\n      delete emoji.list[\":\" + alias + \":\"];\n      var aliasIndex = emoji.packages.emojiCustom.list.indexOf(\":\" + alias + \":\");\n\n      if (aliasIndex !== -1) {\n        emoji.packages.emojiCustom.list.splice(aliasIndex, 1);\n      }\n    }\n  }\n\n  EmojiPicker.updateRecent('rocket');\n};\n\nvar updateEmojiCustom = function (emojiData) {\n  var key = \"emoji_random_\" + emojiData.name;\n  Session.set(key, Math.round(Math.random() * 1000));\n  var previousExists = isSetNotNull(function () {\n    return emojiData.previousName;\n  });\n  var currentAliases = isSetNotNull(function () {\n    return emojiData.aliases;\n  });\n\n  if (previousExists && isSetNotNull(function () {\n    return emoji.list[\":\" + emojiData.previousName + \":\"].aliases;\n  })) {\n    for (var _iterator2 = _createForOfIteratorHelperLoose(emoji.list[\":\" + emojiData.previousName + \":\"].aliases), _step2; !(_step2 = _iterator2()).done;) {\n      var alias = _step2.value;\n      delete emoji.list[\":\" + alias + \":\"];\n      var aliasIndex = emoji.packages.emojiCustom.list.indexOf(\":\" + alias + \":\");\n\n      if (aliasIndex !== -1) {\n        emoji.packages.emojiCustom.list.splice(aliasIndex, 1);\n      }\n    }\n  }\n\n  if (previousExists && emojiData.name !== emojiData.previousName) {\n    var arrayIndex = emoji.packages.emojiCustom.emojisByCategory.rocket.indexOf(emojiData.previousName);\n\n    if (arrayIndex !== -1) {\n      emoji.packages.emojiCustom.emojisByCategory.rocket.splice(arrayIndex, 1);\n    }\n\n    var arrayIndexList = emoji.packages.emojiCustom.list.indexOf(\":\" + emojiData.previousName + \":\");\n\n    if (arrayIndexList !== -1) {\n      emoji.packages.emojiCustom.list.splice(arrayIndexList, 1);\n    }\n\n    delete emoji.list[\":\" + emojiData.previousName + \":\"];\n  }\n\n  var categoryIndex = emoji.packages.emojiCustom.emojisByCategory.rocket.indexOf(\"\" + emojiData.name);\n\n  if (categoryIndex === -1) {\n    emoji.packages.emojiCustom.emojisByCategory.rocket.push(\"\" + emojiData.name);\n    emoji.packages.emojiCustom.list.push(\":\" + emojiData.name + \":\");\n  }\n\n  emoji.list[\":\" + emojiData.name + \":\"] = Object.assign({\n    emojiPackage: 'emojiCustom'\n  }, emoji.list[\":\" + emojiData.name + \":\"], emojiData);\n\n  if (currentAliases) {\n    for (var _iterator3 = _createForOfIteratorHelperLoose(emojiData.aliases), _step3; !(_step3 = _iterator3()).done;) {\n      var _alias = _step3.value;\n      emoji.packages.emojiCustom.list.push(\":\" + _alias + \":\");\n      emoji.list[\":\" + _alias + \":\"] = {};\n      emoji.list[\":\" + _alias + \":\"].emojiPackage = 'emojiCustom';\n      emoji.list[\":\" + _alias + \":\"].aliasOf = emojiData.name;\n    }\n  }\n\n  var url = getEmojiUrlFromName(emojiData.name, emojiData.extension); // update in admin interface\n\n  if (previousExists && emojiData.name !== emojiData.previousName) {\n    $(document).find(\".emojiAdminPreview-image[data-emoji='\" + emojiData.previousName + \"']\").css('background-image', \"url('\" + url + \")'\").attr('data-emoji', \"\" + emojiData.name);\n  } else {\n    $(document).find(\".emojiAdminPreview-image[data-emoji='\" + emojiData.name + \"']\").css('background-image', \"url('\" + url + \"')\");\n  } // update in picker\n\n\n  if (previousExists && emojiData.name !== emojiData.previousName) {\n    $(document).find(\"li[data-emoji='\" + emojiData.previousName + \"'] span\").css('background-image', \"url('\" + url + \"')\").attr('data-emoji', \"\" + emojiData.name);\n    $(document).find(\"li[data-emoji='\" + emojiData.previousName + \"']\").attr('data-emoji', \"\" + emojiData.name).attr('class', \"emoji-\" + emojiData.name);\n  } else {\n    $(document).find(\"li[data-emoji='\" + emojiData.name + \"'] span\").css('background-image', \"url('\" + url + \"')\");\n  } // update in picker and opened rooms\n\n\n  for (key in meteorBabelHelpers.sanitizeForInObject(RoomManager.openedRooms)) {\n    if (RoomManager.openedRooms.hasOwnProperty(key)) {\n      var room = RoomManager.openedRooms[key];\n\n      if (previousExists && emojiData.name !== emojiData.previousName) {\n        $(room.dom).find(\"span[data-emoji='\" + emojiData.previousName + \"']\").css('background-image', \"url('\" + url + \"')\").attr('data-emoji', \"\" + emojiData.name);\n      } else {\n        $(room.dom).find(\"span[data-emoji='\" + emojiData.name + \"']\").css('background-image', \"url('\" + url + \"')\");\n      }\n    }\n  }\n\n  EmojiPicker.updateRecent('rocket');\n};\n\nvar customRender = function (html) {\n  var emojisMatchGroup = emoji.packages.emojiCustom.list.map(escapeRegExp).join('|');\n\n  if (emojisMatchGroup !== emoji.packages.emojiCustom._regexpSignature) {\n    emoji.packages.emojiCustom._regexpSignature = emojisMatchGroup;\n    emoji.packages.emojiCustom._regexp = new RegExp(\"<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|(\" + emojisMatchGroup + \")\", 'gi');\n  }\n\n  html = html.replace(emoji.packages.emojiCustom._regexp, function (shortname) {\n    if (typeof shortname === 'undefined' || shortname === '' || emoji.packages.emojiCustom.list.indexOf(shortname) === -1) {\n      return shortname;\n    }\n\n    var emojiAlias = shortname.replace(/:/g, '');\n    var dataCheck = emoji.list[shortname];\n\n    if (dataCheck.hasOwnProperty('aliasOf')) {\n      emojiAlias = dataCheck.aliasOf;\n      dataCheck = emoji.list[\":\" + emojiAlias + \":\"];\n    }\n\n    return \"<span class=\\\"emoji\\\" style=\\\"background-image:url(\" + getEmojiUrlFromName(emojiAlias, dataCheck.extension) + \");\\\" data-emoji=\\\"\" + emojiAlias + \"\\\" title=\\\"\" + shortname + \"\\\">\" + shortname + \"</span>\";\n  });\n  return html;\n};\n\nemoji.packages.emojiCustom = {\n  emojiCategories: [{\n    key: 'rocket',\n    i18n: 'Custom'\n  }],\n  categoryIndex: 1,\n  toneList: {},\n  list: [],\n  _regexpSignature: null,\n  _regexp: null,\n  render: customRender,\n  renderPicker: customRender\n};\nMeteor.startup(function () {\n  return CachedCollectionManager.onLogin(function () {\n    function _callee() {\n      var _await$APIClient$v1$g, emojis, _iterator4, _step4, currentEmoji, _iterator5, _step5, alias;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return _regeneratorRuntime.awrap(APIClient.v1.get('emoji-custom.list'));\n\n              case 3:\n                _await$APIClient$v1$g = _context.sent;\n                emojis = _await$APIClient$v1$g.emojis.update;\n                emoji.packages.emojiCustom.emojisByCategory = {\n                  rocket: []\n                };\n\n                for (_iterator4 = _createForOfIteratorHelperLoose(emojis); !(_step4 = _iterator4()).done;) {\n                  currentEmoji = _step4.value;\n                  emoji.packages.emojiCustom.emojisByCategory.rocket.push(currentEmoji.name);\n                  emoji.packages.emojiCustom.list.push(\":\" + currentEmoji.name + \":\");\n                  emoji.list[\":\" + currentEmoji.name + \":\"] = currentEmoji;\n                  emoji.list[\":\" + currentEmoji.name + \":\"].emojiPackage = 'emojiCustom';\n\n                  for (_iterator5 = _createForOfIteratorHelperLoose(currentEmoji.aliases); !(_step5 = _iterator5()).done;) {\n                    alias = _step5.value;\n                    emoji.packages.emojiCustom.list.push(\":\" + alias + \":\");\n                    emoji.list[\":\" + alias + \":\"] = {\n                      emojiPackage: 'emojiCustom',\n                      aliasOf: currentEmoji.name\n                    };\n                  }\n                }\n\n                EmojiPicker.updateRecent('rocket');\n                _context.next = 13;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](0);\n                console.error('Error getting custom emoji', _context.t0);\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return _callee$;\n      }(), null, null, [[0, 10]], Promise);\n    }\n\n    return _callee;\n  }());\n});","map":{"version":3,"sources":["app/emoji-custom/client/lib/emojiCustom.js"],"names":["_regeneratorRuntime","module","link","default","v","_createForOfIteratorHelperLoose","export","getEmojiUrlFromName","deleteEmojiCustom","updateEmojiCustom","Meteor","Session","escapeRegExp","isSetNotNull","RoomManager","emoji","EmojiPicker","CachedCollectionManager","APIClient","name","extension","get","key","random","keys","path","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","encodeURIComponent","emojiData","list","arrayIndex","packages","emojiCustom","emojisByCategory","rocket","indexOf","splice","arrayIndexList","aliases","alias","aliasIndex","updateRecent","set","Math","round","previousExists","previousName","currentAliases","categoryIndex","push","Object","assign","emojiPackage","aliasOf","url","$","document","find","css","attr","openedRooms","hasOwnProperty","room","dom","customRender","html","emojisMatchGroup","map","join","_regexpSignature","_regexp","RegExp","replace","shortname","emojiAlias","dataCheck","emojiCategories","i18n","toneList","render","renderPicker","startup","onLogin","v1","emojis","update","currentEmoji","console","error"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Session } from 'meteor/session';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\n\nimport { isSetNotNull } from './function-isSet';\nimport { RoomManager } from '../../../ui-utils/client';\nimport { emoji, EmojiPicker } from '../../../emoji/client';\nimport { CachedCollectionManager } from '../../../ui-cached-collection/client';\nimport { APIClient } from '../../../utils/client';\n\nexport const getEmojiUrlFromName = function (name, extension) {\n\tSession.get;\n\n\tconst key = `emoji_random_${name}`;\n\n\tlet random = 0;\n\tif (isSetNotNull(() => Session.keys[key])) {\n\t\trandom = Session.keys[key];\n\t}\n\n\tif (name == null) {\n\t\treturn;\n\t}\n\tconst path = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '';\n\treturn `${path}/emoji-custom/${encodeURIComponent(name)}.${extension}?_dc=${random}`;\n};\n\nexport const deleteEmojiCustom = function (emojiData) {\n\tdelete emoji.list[`:${emojiData.name}:`];\n\tconst arrayIndex = emoji.packages.emojiCustom.emojisByCategory.rocket.indexOf(emojiData.name);\n\tif (arrayIndex !== -1) {\n\t\temoji.packages.emojiCustom.emojisByCategory.rocket.splice(arrayIndex, 1);\n\t}\n\tconst arrayIndexList = emoji.packages.emojiCustom.list.indexOf(`:${emojiData.name}:`);\n\tif (arrayIndexList !== -1) {\n\t\temoji.packages.emojiCustom.list.splice(arrayIndexList, 1);\n\t}\n\tif (isSetNotNull(() => emojiData.aliases)) {\n\t\tfor (const alias of emojiData.aliases) {\n\t\t\tdelete emoji.list[`:${alias}:`];\n\t\t\tconst aliasIndex = emoji.packages.emojiCustom.list.indexOf(`:${alias}:`);\n\t\t\tif (aliasIndex !== -1) {\n\t\t\t\temoji.packages.emojiCustom.list.splice(aliasIndex, 1);\n\t\t\t}\n\t\t}\n\t}\n\tEmojiPicker.updateRecent('rocket');\n};\n\nexport const updateEmojiCustom = function (emojiData) {\n\tlet key = `emoji_random_${emojiData.name}`;\n\tSession.set(key, Math.round(Math.random() * 1000));\n\n\tconst previousExists = isSetNotNull(() => emojiData.previousName);\n\tconst currentAliases = isSetNotNull(() => emojiData.aliases);\n\n\tif (previousExists && isSetNotNull(() => emoji.list[`:${emojiData.previousName}:`].aliases)) {\n\t\tfor (const alias of emoji.list[`:${emojiData.previousName}:`].aliases) {\n\t\t\tdelete emoji.list[`:${alias}:`];\n\t\t\tconst aliasIndex = emoji.packages.emojiCustom.list.indexOf(`:${alias}:`);\n\t\t\tif (aliasIndex !== -1) {\n\t\t\t\temoji.packages.emojiCustom.list.splice(aliasIndex, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (previousExists && emojiData.name !== emojiData.previousName) {\n\t\tconst arrayIndex = emoji.packages.emojiCustom.emojisByCategory.rocket.indexOf(emojiData.previousName);\n\t\tif (arrayIndex !== -1) {\n\t\t\temoji.packages.emojiCustom.emojisByCategory.rocket.splice(arrayIndex, 1);\n\t\t}\n\t\tconst arrayIndexList = emoji.packages.emojiCustom.list.indexOf(`:${emojiData.previousName}:`);\n\t\tif (arrayIndexList !== -1) {\n\t\t\temoji.packages.emojiCustom.list.splice(arrayIndexList, 1);\n\t\t}\n\t\tdelete emoji.list[`:${emojiData.previousName}:`];\n\t}\n\n\tconst categoryIndex = emoji.packages.emojiCustom.emojisByCategory.rocket.indexOf(`${emojiData.name}`);\n\tif (categoryIndex === -1) {\n\t\temoji.packages.emojiCustom.emojisByCategory.rocket.push(`${emojiData.name}`);\n\t\temoji.packages.emojiCustom.list.push(`:${emojiData.name}:`);\n\t}\n\temoji.list[`:${emojiData.name}:`] = Object.assign({ emojiPackage: 'emojiCustom' }, emoji.list[`:${emojiData.name}:`], emojiData);\n\tif (currentAliases) {\n\t\tfor (const alias of emojiData.aliases) {\n\t\t\temoji.packages.emojiCustom.list.push(`:${alias}:`);\n\t\t\temoji.list[`:${alias}:`] = {};\n\t\t\temoji.list[`:${alias}:`].emojiPackage = 'emojiCustom';\n\t\t\temoji.list[`:${alias}:`].aliasOf = emojiData.name;\n\t\t}\n\t}\n\n\tconst url = getEmojiUrlFromName(emojiData.name, emojiData.extension);\n\n\t// update in admin interface\n\tif (previousExists && emojiData.name !== emojiData.previousName) {\n\t\t$(document)\n\t\t\t.find(`.emojiAdminPreview-image[data-emoji='${emojiData.previousName}']`)\n\t\t\t.css('background-image', `url('${url})'`)\n\t\t\t.attr('data-emoji', `${emojiData.name}`);\n\t} else {\n\t\t$(document).find(`.emojiAdminPreview-image[data-emoji='${emojiData.name}']`).css('background-image', `url('${url}')`);\n\t}\n\n\t// update in picker\n\tif (previousExists && emojiData.name !== emojiData.previousName) {\n\t\t$(document)\n\t\t\t.find(`li[data-emoji='${emojiData.previousName}'] span`)\n\t\t\t.css('background-image', `url('${url}')`)\n\t\t\t.attr('data-emoji', `${emojiData.name}`);\n\t\t$(document)\n\t\t\t.find(`li[data-emoji='${emojiData.previousName}']`)\n\t\t\t.attr('data-emoji', `${emojiData.name}`)\n\t\t\t.attr('class', `emoji-${emojiData.name}`);\n\t} else {\n\t\t$(document).find(`li[data-emoji='${emojiData.name}'] span`).css('background-image', `url('${url}')`);\n\t}\n\n\t// update in picker and opened rooms\n\tfor (key in RoomManager.openedRooms) {\n\t\tif (RoomManager.openedRooms.hasOwnProperty(key)) {\n\t\t\tconst room = RoomManager.openedRooms[key];\n\t\t\tif (previousExists && emojiData.name !== emojiData.previousName) {\n\t\t\t\t$(room.dom)\n\t\t\t\t\t.find(`span[data-emoji='${emojiData.previousName}']`)\n\t\t\t\t\t.css('background-image', `url('${url}')`)\n\t\t\t\t\t.attr('data-emoji', `${emojiData.name}`);\n\t\t\t} else {\n\t\t\t\t$(room.dom).find(`span[data-emoji='${emojiData.name}']`).css('background-image', `url('${url}')`);\n\t\t\t}\n\t\t}\n\t}\n\n\tEmojiPicker.updateRecent('rocket');\n};\n\nconst customRender = (html) => {\n\tconst emojisMatchGroup = emoji.packages.emojiCustom.list.map(escapeRegExp).join('|');\n\tif (emojisMatchGroup !== emoji.packages.emojiCustom._regexpSignature) {\n\t\temoji.packages.emojiCustom._regexpSignature = emojisMatchGroup;\n\t\temoji.packages.emojiCustom._regexp = new RegExp(\n\t\t\t`<object[^>]*>.*?<\\/object>|<span[^>]*>.*?<\\/span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|(${emojisMatchGroup})`,\n\t\t\t'gi',\n\t\t);\n\t}\n\n\thtml = html.replace(emoji.packages.emojiCustom._regexp, (shortname) => {\n\t\tif (typeof shortname === 'undefined' || shortname === '' || emoji.packages.emojiCustom.list.indexOf(shortname) === -1) {\n\t\t\treturn shortname;\n\t\t}\n\n\t\tlet emojiAlias = shortname.replace(/:/g, '');\n\n\t\tlet dataCheck = emoji.list[shortname];\n\t\tif (dataCheck.hasOwnProperty('aliasOf')) {\n\t\t\temojiAlias = dataCheck.aliasOf;\n\t\t\tdataCheck = emoji.list[`:${emojiAlias}:`];\n\t\t}\n\n\t\treturn `<span class=\"emoji\" style=\"background-image:url(${getEmojiUrlFromName(\n\t\t\temojiAlias,\n\t\t\tdataCheck.extension,\n\t\t)});\" data-emoji=\"${emojiAlias}\" title=\"${shortname}\">${shortname}</span>`;\n\t});\n\n\treturn html;\n};\n\nemoji.packages.emojiCustom = {\n\temojiCategories: [{ key: 'rocket', i18n: 'Custom' }],\n\tcategoryIndex: 1,\n\ttoneList: {},\n\tlist: [],\n\t_regexpSignature: null,\n\t_regexp: null,\n\n\trender: customRender,\n\trenderPicker: customRender,\n};\n\nMeteor.startup(() =>\n\tCachedCollectionManager.onLogin(async () => {\n\t\ttry {\n\t\t\tconst {\n\t\t\t\temojis: { update: emojis },\n\t\t\t} = await APIClient.v1.get('emoji-custom.list');\n\n\t\t\temoji.packages.emojiCustom.emojisByCategory = { rocket: [] };\n\t\t\tfor (const currentEmoji of emojis) {\n\t\t\t\temoji.packages.emojiCustom.emojisByCategory.rocket.push(currentEmoji.name);\n\t\t\t\temoji.packages.emojiCustom.list.push(`:${currentEmoji.name}:`);\n\t\t\t\temoji.list[`:${currentEmoji.name}:`] = currentEmoji;\n\t\t\t\temoji.list[`:${currentEmoji.name}:`].emojiPackage = 'emojiCustom';\n\t\t\t\tfor (const alias of currentEmoji.aliases) {\n\t\t\t\t\temoji.packages.emojiCustom.list.push(`:${alias}:`);\n\t\t\t\t\temoji.list[`:${alias}:`] = {\n\t\t\t\t\t\temojiPackage: 'emojiCustom',\n\t\t\t\t\t\taliasOf: currentEmoji.name,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tEmojiPicker.updateRecent('rocket');\n\t\t} catch (e) {\n\t\t\tconsole.error('Error getting custom emoji', e);\n\t\t}\n\t}),\n);\n"]},"sourceType":"module","hash":"2c94fe81fc135d2c3d37d37806479e94f67e71fc"}
