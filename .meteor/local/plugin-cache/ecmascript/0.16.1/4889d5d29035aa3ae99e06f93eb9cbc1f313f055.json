{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/markdown/lib/markdown.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/markdown/lib/markdown.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/markdown/lib/markdown.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/markdown/lib/markdown.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/markdown/lib/markdown.js"}},"code":"const _excluded = [\"parser\"];\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 0);\nmodule.export({\n  Markdown: () => Markdown,\n  filterMarkdown: () => filterMarkdown,\n  createMarkdownMessageRenderer: () => createMarkdownMessageRenderer,\n  createMarkdownNotificationRenderer: () => createMarkdownNotificationRenderer\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet escapeHTML;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeHTML(v) {\n    escapeHTML = v;\n  }\n\n}, 1);\nlet marked;\nmodule.link(\"./parser/marked/marked\", {\n  marked(v) {\n    marked = v;\n  }\n\n}, 2);\nlet original;\nmodule.link(\"./parser/original/original\", {\n  original(v) {\n    original = v;\n  }\n\n}, 3);\nlet filtered;\nmodule.link(\"./parser/filtered/filtered\", {\n  filtered(v) {\n    filtered = v;\n  }\n\n}, 4);\nlet code;\nmodule.link(\"./parser/original/code\", {\n  code(v) {\n    code = v;\n  }\n\n}, 5);\nlet settings;\nmodule.link(\"../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 6);\nconst parsers = {\n  original,\n  marked,\n  filtered\n};\n\nclass MarkdownClass {\n  parse(text) {\n    const message = {\n      html: escapeHTML(text)\n    };\n    return this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n  }\n\n  parseNotEscaped(text) {\n    const message = {\n      html: text\n    };\n    return this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n  }\n\n  parseMessageNotEscaped(message) {\n    const parser = settings.get('Markdown_Parser');\n\n    if (parser === 'disabled') {\n      return message;\n    }\n\n    const options = {\n      supportSchemesForLink: settings.get('Markdown_SupportSchemesForLink'),\n      headers: settings.get('Markdown_Headers'),\n      rootUrl: Meteor.absoluteUrl(),\n      marked: {\n        gfm: settings.get('Markdown_Marked_GFM'),\n        tables: settings.get('Markdown_Marked_Tables'),\n        breaks: settings.get('Markdown_Marked_Breaks'),\n        pedantic: settings.get('Markdown_Marked_Pedantic'),\n        smartLists: settings.get('Markdown_Marked_SmartLists'),\n        smartypants: settings.get('Markdown_Marked_Smartypants')\n      }\n    };\n    const parse = typeof parsers[parser] === 'function' ? parsers[parser] : parsers.original;\n    return parse(message, options);\n  }\n\n  mountTokensBackRecursively(message, tokenList) {\n    let useHtml = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    const missingTokens = [];\n\n    if (tokenList.length > 0) {\n      for (const {\n        token,\n        text,\n        noHtml\n      } of tokenList) {\n        if (message.html.indexOf(token) >= 0) {\n          message.html = message.html.replace(token, () => useHtml ? text : noHtml); // Uses lambda so doesn't need to escape $\n        } else {\n          missingTokens.push({\n            token,\n            text,\n            noHtml\n          });\n        }\n      }\n    } // If there are tokens that were missing from the string, but the last iteration replaced at least one token, then go again\n    // this is done because one of the tokens may have been hidden by another one\n\n\n    if (missingTokens.length > 0 && missingTokens.length < tokenList.length) {\n      this.mountTokensBackRecursively(message, missingTokens, useHtml);\n    }\n  }\n\n  mountTokensBack(message) {\n    let useHtml = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n    if (message.tokens) {\n      this.mountTokensBackRecursively(message, message.tokens, useHtml);\n    }\n\n    return message;\n  }\n\n  code() {\n    return code(...arguments);\n  }\n\n  filterMarkdownFromMessage(message) {\n    return parsers.filtered(message, {\n      supportSchemesForLink: settings.get('Markdown_SupportSchemesForLink')\n    });\n  }\n\n}\n\nconst Markdown = new MarkdownClass();\n\nconst filterMarkdown = message => Markdown.filterMarkdownFromMessage(message);\n\nconst createMarkdownMessageRenderer = _ref => {\n  let {\n    parser\n  } = _ref,\n      options = _objectWithoutProperties(_ref, _excluded);\n\n  if (!parser || parser === 'disabled') {\n    return message => message;\n  }\n\n  const parse = typeof parsers[parser] === 'function' ? parsers[parser] : parsers.original;\n  return message => {\n    var _message$html;\n\n    if (!(message !== null && message !== void 0 && (_message$html = message.html) !== null && _message$html !== void 0 && _message$html.trim())) {\n      return message;\n    }\n\n    return parse(message, options);\n  };\n};\n\nconst createMarkdownNotificationRenderer = options => message => parsers.filtered(message, options);","map":{"version":3,"sources":["app/markdown/lib/markdown.js"],"names":["_objectWithoutProperties","module","link","default","v","export","Markdown","filterMarkdown","createMarkdownMessageRenderer","createMarkdownNotificationRenderer","Meteor","escapeHTML","marked","original","filtered","code","settings","parsers","MarkdownClass","parse","text","message","html","mountTokensBack","parseMessageNotEscaped","parseNotEscaped","parser","get","options","supportSchemesForLink","headers","rootUrl","absoluteUrl","gfm","tables","breaks","pedantic","smartLists","smartypants","mountTokensBackRecursively","tokenList","useHtml","missingTokens","length","token","noHtml","indexOf","replace","push","tokens","filterMarkdownFromMessage","trim"],"mappings":"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","sourcesContent":["/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { Meteor } from 'meteor/meteor';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\n\nimport { marked } from './parser/marked/marked';\nimport { original } from './parser/original/original';\nimport { filtered } from './parser/filtered/filtered';\nimport { code } from './parser/original/code';\nimport { settings } from '../../settings';\n\nconst parsers = {\n\toriginal,\n\tmarked,\n\tfiltered,\n};\n\nclass MarkdownClass {\n\tparse(text) {\n\t\tconst message = {\n\t\t\thtml: escapeHTML(text),\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseNotEscaped(text) {\n\t\tconst message = {\n\t\t\thtml: text,\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseMessageNotEscaped(message) {\n\t\tconst parser = settings.get('Markdown_Parser');\n\n\t\tif (parser === 'disabled') {\n\t\t\treturn message;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsupportSchemesForLink: settings.get('Markdown_SupportSchemesForLink'),\n\t\t\theaders: settings.get('Markdown_Headers'),\n\t\t\trootUrl: Meteor.absoluteUrl(),\n\t\t\tmarked: {\n\t\t\t\tgfm: settings.get('Markdown_Marked_GFM'),\n\t\t\t\ttables: settings.get('Markdown_Marked_Tables'),\n\t\t\t\tbreaks: settings.get('Markdown_Marked_Breaks'),\n\t\t\t\tpedantic: settings.get('Markdown_Marked_Pedantic'),\n\t\t\t\tsmartLists: settings.get('Markdown_Marked_SmartLists'),\n\t\t\t\tsmartypants: settings.get('Markdown_Marked_Smartypants'),\n\t\t\t},\n\t\t};\n\n\t\tconst parse = typeof parsers[parser] === 'function' ? parsers[parser] : parsers.original;\n\n\t\treturn parse(message, options);\n\t}\n\n\tmountTokensBackRecursively(message, tokenList, useHtml = true) {\n\t\tconst missingTokens = [];\n\n\t\tif (tokenList.length > 0) {\n\t\t\tfor (const { token, text, noHtml } of tokenList) {\n\t\t\t\tif (message.html.indexOf(token) >= 0) {\n\t\t\t\t\tmessage.html = message.html.replace(token, () => (useHtml ? text : noHtml)); // Uses lambda so doesn't need to escape $\n\t\t\t\t} else {\n\t\t\t\t\tmissingTokens.push({ token, text, noHtml });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If there are tokens that were missing from the string, but the last iteration replaced at least one token, then go again\n\t\t// this is done because one of the tokens may have been hidden by another one\n\t\tif (missingTokens.length > 0 && missingTokens.length < tokenList.length) {\n\t\t\tthis.mountTokensBackRecursively(message, missingTokens, useHtml);\n\t\t}\n\t}\n\n\tmountTokensBack(message, useHtml = true) {\n\t\tif (message.tokens) {\n\t\t\tthis.mountTokensBackRecursively(message, message.tokens, useHtml);\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tcode(...args) {\n\t\treturn code(...args);\n\t}\n\n\tfilterMarkdownFromMessage(message) {\n\t\treturn parsers.filtered(message, {\n\t\t\tsupportSchemesForLink: settings.get('Markdown_SupportSchemesForLink'),\n\t\t});\n\t}\n}\n\nexport const Markdown = new MarkdownClass();\n\nexport const filterMarkdown = (message) => Markdown.filterMarkdownFromMessage(message);\n\nexport const createMarkdownMessageRenderer = ({ parser, ...options }) => {\n\tif (!parser || parser === 'disabled') {\n\t\treturn (message) => message;\n\t}\n\n\tconst parse = typeof parsers[parser] === 'function' ? parsers[parser] : parsers.original;\n\n\treturn (message) => {\n\t\tif (!message?.html?.trim()) {\n\t\t\treturn message;\n\t\t}\n\n\t\treturn parse(message, options);\n\t};\n};\n\nexport const createMarkdownNotificationRenderer = (options) => (message) => parsers.filtered(message, options);\n"]},"sourceType":"module","hash":"4889d5d29035aa3ae99e06f93eb9cbc1f313f055"}
