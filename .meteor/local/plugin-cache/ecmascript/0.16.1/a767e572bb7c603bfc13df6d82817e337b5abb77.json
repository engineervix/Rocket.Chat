{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/avatar/UserAvatarEditor/UserAvatarEditor.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/components/avatar/UserAvatarEditor/UserAvatarEditor.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/avatar/UserAvatarEditor/UserAvatarEditor.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/avatar/UserAvatarEditor/UserAvatarEditor.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/avatar/UserAvatarEditor/UserAvatarEditor.js"}},"code":"let Box, Button, Icon, TextInput, Margins, Avatar;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box(v) {\n    Box = v;\n  },\n\n  Button(v) {\n    Button = v;\n  },\n\n  Icon(v) {\n    Icon = v;\n  },\n\n  TextInput(v) {\n    TextInput = v;\n  },\n\n  Margins(v) {\n    Margins = v;\n  },\n\n  Avatar(v) {\n    Avatar = v;\n  }\n\n}, 0);\nlet React, useState, useCallback;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useState(v) {\n    useState = v;\n  },\n\n  useCallback(v) {\n    useCallback = v;\n  }\n\n}, 1);\nlet useSetting;\nmodule.link(\"../../../contexts/SettingsContext\", {\n  useSetting(v) {\n    useSetting = v;\n  }\n\n}, 2);\nlet useToastMessageDispatch;\nmodule.link(\"../../../contexts/ToastMessagesContext\", {\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n\n}, 3);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 4);\nlet useFileInput;\nmodule.link(\"../../../hooks/useFileInput\", {\n  useFileInput(v) {\n    useFileInput = v;\n  }\n\n}, 5);\nlet UserAvatar;\nmodule.link(\"../UserAvatar\", {\n  default(v) {\n    UserAvatar = v;\n  }\n\n}, 6);\nlet UserAvatarSuggestions;\nmodule.link(\"./UserAvatarSuggestions\", {\n  default(v) {\n    UserAvatarSuggestions = v;\n  }\n\n}, 7);\n\nfunction UserAvatarEditor(_ref) {\n  let {\n    currentUsername,\n    username,\n    setAvatarObj,\n    suggestions,\n    disabled,\n    etag\n  } = _ref;\n  const t = useTranslation();\n  const rotateImages = useSetting('FileUpload_RotateImages');\n  const [avatarFromUrl, setAvatarFromUrl] = useState('');\n  const [newAvatarSource, setNewAvatarSource] = useState();\n  const [urlEmpty, setUrlEmpty] = useState(true);\n  const dispatchToastMessage = useToastMessageDispatch();\n\n  const toDataURL = (file, callback) => {\n    const reader = new FileReader();\n\n    reader.onload = function (e) {\n      callback(e.target.result);\n    };\n\n    reader.readAsDataURL(file);\n  };\n\n  const setUploadedPreview = useCallback(async (file, avatarObj) => {\n    if (file.type.startsWith('image/')) {\n      setAvatarObj(avatarObj);\n      toDataURL(file, dataurl => {\n        setNewAvatarSource(dataurl);\n      });\n    } else dispatchToastMessage({\n      type: 'error',\n      message: t('Avatar_format_invalid')\n    });\n  }, [setAvatarObj, t, dispatchToastMessage]);\n  const [clickUpload] = useFileInput(setUploadedPreview);\n\n  const clickUrl = () => {\n    if (avatarFromUrl === '') {\n      return;\n    }\n\n    setNewAvatarSource(avatarFromUrl);\n    setAvatarObj({\n      avatarUrl: avatarFromUrl\n    });\n  };\n\n  const clickReset = () => {\n    setNewAvatarSource(\"/avatar/%40\".concat(username));\n    setAvatarObj('reset');\n  };\n\n  const url = newAvatarSource;\n\n  const handleAvatarFromUrlChange = event => {\n    event.currentTarget.value !== '' ? setUrlEmpty(false) : setUrlEmpty(true);\n    setAvatarFromUrl(event.currentTarget.value);\n  };\n\n  return /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"column\",\n    fontScale: \"p2m\"\n  }, t('Profile_picture'), /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"row\",\n    mbs: \"x4\"\n  }, /*#__PURE__*/React.createElement(UserAvatar, {\n    size: \"x124\",\n    url: url,\n    username: currentUsername,\n    etag: etag,\n    style: {\n      objectFit: 'contain',\n      imageOrientation: rotateImages ? 'from-image' : 'none'\n    },\n    mie: \"x4\"\n  }), /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: \"1\",\n    justifyContent: \"space-between\",\n    mis: \"x4\"\n  }, /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"row\",\n    mbs: \"none\"\n  }, /*#__PURE__*/React.createElement(Margins, {\n    inline: \"x4\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    square: true,\n    mis: \"none\",\n    onClick: clickReset,\n    disabled: disabled,\n    mie: \"x4\",\n    title: t('Accounts_SetDefaultAvatar')\n  }, /*#__PURE__*/React.createElement(Avatar, {\n    url: \"/avatar/%40\".concat(username)\n  })), /*#__PURE__*/React.createElement(Button, {\n    square: true,\n    onClick: clickUpload,\n    disabled: disabled,\n    title: t('Upload')\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"upload\",\n    size: \"x20\"\n  })), /*#__PURE__*/React.createElement(Button, {\n    square: true,\n    mie: \"none\",\n    onClick: clickUrl,\n    disabled: disabled || urlEmpty,\n    title: t('Add URL')\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"permalink\",\n    size: \"x20\"\n  })), suggestions && /*#__PURE__*/React.createElement(UserAvatarSuggestions, {\n    suggestions: suggestions,\n    setAvatarObj: setAvatarObj,\n    setNewAvatarSource: setNewAvatarSource,\n    disabled: disabled\n  }))), /*#__PURE__*/React.createElement(Margins, {\n    inlineStart: \"x4\"\n  }, /*#__PURE__*/React.createElement(Box, null, t('Use_url_for_avatar')), /*#__PURE__*/React.createElement(TextInput, {\n    flexGrow: 0,\n    placeholder: t('Use_url_for_avatar'),\n    value: avatarFromUrl,\n    onChange: handleAvatarFromUrlChange\n  })))));\n}\n\nmodule.exportDefault(UserAvatarEditor);","map":{"version":3,"sources":["client/components/avatar/UserAvatarEditor/UserAvatarEditor.js"],"names":["Box","Button","Icon","TextInput","Margins","Avatar","module","link","v","React","useState","useCallback","default","useSetting","useToastMessageDispatch","useTranslation","useFileInput","UserAvatar","UserAvatarSuggestions","UserAvatarEditor","currentUsername","username","setAvatarObj","suggestions","disabled","etag","t","rotateImages","avatarFromUrl","setAvatarFromUrl","newAvatarSource","setNewAvatarSource","urlEmpty","setUrlEmpty","dispatchToastMessage","toDataURL","file","callback","reader","FileReader","onload","e","target","result","readAsDataURL","setUploadedPreview","avatarObj","type","startsWith","dataurl","message","clickUpload","clickUrl","avatarUrl","clickReset","url","handleAvatarFromUrlChange","event","currentTarget","value","objectFit","imageOrientation","exportDefault"],"mappings":"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","sourcesContent":["import { Box, Button, Icon, TextInput, Margins, Avatar } from '@rocket.chat/fuselage';\nimport React, { useState, useCallback } from 'react';\n\nimport { useSetting } from '../../../contexts/SettingsContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport UserAvatar from '../UserAvatar';\nimport UserAvatarSuggestions from './UserAvatarSuggestions';\n\nfunction UserAvatarEditor({ currentUsername, username, setAvatarObj, suggestions, disabled, etag }) {\n\tconst t = useTranslation();\n\tconst rotateImages = useSetting('FileUpload_RotateImages');\n\tconst [avatarFromUrl, setAvatarFromUrl] = useState('');\n\tconst [newAvatarSource, setNewAvatarSource] = useState();\n\tconst [urlEmpty, setUrlEmpty] = useState(true);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst toDataURL = (file, callback) => {\n\t\tconst reader = new FileReader();\n\t\treader.onload = function (e) {\n\t\t\tcallback(e.target.result);\n\t\t};\n\t\treader.readAsDataURL(file);\n\t};\n\n\tconst setUploadedPreview = useCallback(\n\t\tasync (file, avatarObj) => {\n\t\t\tif (file.type.startsWith('image/')) {\n\t\t\t\tsetAvatarObj(avatarObj);\n\t\t\t\ttoDataURL(file, (dataurl) => {\n\t\t\t\t\tsetNewAvatarSource(dataurl);\n\t\t\t\t});\n\t\t\t} else dispatchToastMessage({ type: 'error', message: t('Avatar_format_invalid') });\n\t\t},\n\t\t[setAvatarObj, t, dispatchToastMessage],\n\t);\n\n\tconst [clickUpload] = useFileInput(setUploadedPreview);\n\n\tconst clickUrl = () => {\n\t\tif (avatarFromUrl === '') {\n\t\t\treturn;\n\t\t}\n\t\tsetNewAvatarSource(avatarFromUrl);\n\t\tsetAvatarObj({ avatarUrl: avatarFromUrl });\n\t};\n\tconst clickReset = () => {\n\t\tsetNewAvatarSource(`/avatar/%40${username}`);\n\t\tsetAvatarObj('reset');\n\t};\n\n\tconst url = newAvatarSource;\n\n\tconst handleAvatarFromUrlChange = (event) => {\n\t\tevent.currentTarget.value !== '' ? setUrlEmpty(false) : setUrlEmpty(true);\n\t\tsetAvatarFromUrl(event.currentTarget.value);\n\t};\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' fontScale='p2m'>\n\t\t\t{t('Profile_picture')}\n\t\t\t<Box display='flex' flexDirection='row' mbs='x4'>\n\t\t\t\t<UserAvatar\n\t\t\t\t\tsize='x124'\n\t\t\t\t\turl={url}\n\t\t\t\t\tusername={currentUsername}\n\t\t\t\t\tetag={etag}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tobjectFit: 'contain',\n\t\t\t\t\t\timageOrientation: rotateImages ? 'from-image' : 'none',\n\t\t\t\t\t}}\n\t\t\t\t\tmie='x4'\n\t\t\t\t/>\n\t\t\t\t<Box display='flex' flexDirection='column' flexGrow='1' justifyContent='space-between' mis='x4'>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Margins inline='x4'>\n\t\t\t\t\t\t\t<Button square mis='none' onClick={clickReset} disabled={disabled} mie='x4' title={t('Accounts_SetDefaultAvatar')}>\n\t\t\t\t\t\t\t\t<Avatar url={`/avatar/%40${username}`} />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button square onClick={clickUpload} disabled={disabled} title={t('Upload')}>\n\t\t\t\t\t\t\t\t<Icon name='upload' size='x20' />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button square mie='none' onClick={clickUrl} disabled={disabled || urlEmpty} title={t('Add URL')}>\n\t\t\t\t\t\t\t\t<Icon name='permalink' size='x20' />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{suggestions && (\n\t\t\t\t\t\t\t\t<UserAvatarSuggestions\n\t\t\t\t\t\t\t\t\tsuggestions={suggestions}\n\t\t\t\t\t\t\t\t\tsetAvatarObj={setAvatarObj}\n\t\t\t\t\t\t\t\t\tsetNewAvatarSource={setNewAvatarSource}\n\t\t\t\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Margins>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Margins inlineStart='x4'>\n\t\t\t\t\t\t<Box>{t('Use_url_for_avatar')}</Box>\n\t\t\t\t\t\t<TextInput flexGrow={0} placeholder={t('Use_url_for_avatar')} value={avatarFromUrl} onChange={handleAvatarFromUrlChange} />\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n}\n\nexport default UserAvatarEditor;\n"]},"sourceType":"module","hash":"a767e572bb7c603bfc13df6d82817e337b5abb77"}
