{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-vrecord/client/vrecord.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-vrecord/client/vrecord.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-vrecord/client/vrecord.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-vrecord/client/vrecord.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-vrecord/client/vrecord.js"}},"code":"var Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 0);\nvar TAPi18n;\nmodule.link(\"meteor/rocketchat:tap-i18n\", {\n  TAPi18n: function (v) {\n    TAPi18n = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 3);\nvar VRecDialog;\nmodule.link(\"./VRecDialog\", {\n  VRecDialog: function (v) {\n    VRecDialog = v;\n  }\n}, 4);\nvar VideoRecorder, fileUpload, UserAction, USER_ACTIVITIES;\nmodule.link(\"../../ui\", {\n  VideoRecorder: function (v) {\n    VideoRecorder = v;\n  },\n  fileUpload: function (v) {\n    fileUpload = v;\n  },\n  UserAction: function (v) {\n    UserAction = v;\n  },\n  USER_ACTIVITIES: function (v) {\n    USER_ACTIVITIES = v;\n  }\n}, 5);\nTemplate.vrecDialog.helpers({\n  recordIcon: function () {\n    if (VideoRecorder.cameraStarted.get() && VideoRecorder.recording.get()) {\n      return 'icon-stop';\n    }\n\n    return 'icon-circle';\n  },\n  okDisabled: function () {\n    if (VideoRecorder.cameraStarted.get() && VideoRecorder.recordingAvailable.get()) {\n      return '';\n    }\n\n    return 'disabled';\n  },\n  recordDisabled: function () {\n    return VideoRecorder.cameraStarted.get() ? '' : 'disabled';\n  },\n  time: function () {\n    return Template.instance().time.get();\n  }\n});\nvar recordingInterval = new ReactiveVar(null);\n\nvar stopVideoRecording = function (rid, tmid) {\n  if (recordingInterval.get()) {\n    clearInterval(recordingInterval.get());\n    recordingInterval.set(null);\n  }\n\n  UserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, {\n    tmid: tmid\n  });\n};\n\nTemplate.vrecDialog.events({\n  'click .vrec-dialog .cancel': function (e, t) {\n    var rid = t.rid.get();\n    var tmid = t.tmid.get();\n    VideoRecorder.stop();\n    VRecDialog.close();\n    t.time.set('');\n    stopVideoRecording(rid, tmid);\n  },\n  'click .vrec-dialog .record': function (e, t) {\n    var rid = t.rid.get();\n    var tmid = t.tmid.get();\n\n    if (VideoRecorder.recording.get()) {\n      VideoRecorder.stopRecording();\n      stopVideoRecording(rid, tmid);\n    } else {\n      VideoRecorder.record();\n      UserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, {\n        tmid: tmid\n      });\n      t.time.set('00:00');\n      var startTime = new Date();\n      recordingInterval.set(setInterval(function () {\n        var now = new Date();\n        var distance = (now.getTime() - startTime.getTime()) / 1000;\n        var minutes = Math.floor(distance / 60);\n        var seconds = Math.floor(distance % 60);\n        t.time.set(String(minutes).padStart(2, '0') + \":\" + String(seconds).padStart(2, '0'));\n      }, 1000));\n    }\n  },\n  'click .vrec-dialog .ok': function (e, instance) {\n    var _ref = [instance.rid.get(), instance.tmid.get(), instance.input.get()],\n        rid = _ref[0],\n        tmid = _ref[1],\n        input = _ref[2];\n\n    var cb = function (blob) {\n      fileUpload([{\n        file: blob,\n        type: 'video',\n        name: TAPi18n.__('Video record') + \".webm\"\n      }], input, {\n        rid: rid,\n        tmid: tmid\n      });\n      VRecDialog.close();\n    };\n\n    VideoRecorder.stop(cb);\n    instance.time.set('');\n    stopVideoRecording(rid, tmid);\n  }\n});\nTemplate.vrecDialog.onCreated(function () {\n  var _this = this;\n\n  this.width = 400;\n  this.height = 290;\n  this.rid = new ReactiveVar();\n  this.tmid = new ReactiveVar();\n  this.input = new ReactiveVar();\n  this.time = new ReactiveVar('');\n\n  this.update = function (_ref2) {\n    var rid = _ref2.rid,\n        tmid = _ref2.tmid,\n        input = _ref2.input;\n\n    _this.rid.set(rid);\n\n    _this.tmid.set(tmid);\n\n    _this.input.set(input);\n  };\n\n  this.setPosition = function (dialog, source) {\n    var _this2 = this;\n\n    var anchor = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'left';\n\n    var _set = function () {\n      var sourcePos = $(source).offset();\n      var top = sourcePos.top - _this2.height - 5;\n\n      if (top < 0) {\n        top = 10;\n      }\n\n      if (anchor === 'left') {\n        var right = window.innerWidth - (sourcePos.left + source.offsetWidth - 25);\n\n        if (right < 0) {\n          right = 10;\n        }\n\n        return dialog.css({\n          top: top + \"px\",\n          right: right + \"px\"\n        });\n      }\n\n      var left = sourcePos.left - _this2.width + 100;\n\n      if (left < 0) {\n        left = 10;\n      }\n\n      return dialog.css({\n        top: top + \"px\",\n        left: left + \"px\"\n      });\n    };\n\n    var set = _.debounce(_set, 2000);\n\n    _set();\n\n    this.remove = set;\n    $(window).on('resize', set);\n  };\n});\nTemplate.vrecDialog.onDestroyed(function () {\n  VRecDialog.close(this.rid.get());\n  $(window).off('resize', this.remove);\n});","map":{"version":3,"sources":["app/ui-vrecord/client/vrecord.js"],"names":["Template","module","link","v","TAPi18n","ReactiveVar","_","VRecDialog","VideoRecorder","fileUpload","UserAction","USER_ACTIVITIES","vrecDialog","helpers","recordIcon","cameraStarted","get","recording","okDisabled","recordingAvailable","recordDisabled","time","instance","recordingInterval","stopVideoRecording","rid","tmid","clearInterval","set","stop","USER_RECORDING","events","e","t","close","stopRecording","record","performContinuously","startTime","Date","setInterval","now","distance","getTime","minutes","Math","floor","seconds","String","padStart","input","cb","blob","file","type","name","__","onCreated","width","height","update","setPosition","dialog","source","anchor","_set","sourcePos","$","offset","top","right","window","innerWidth","left","offsetWidth","css","debounce","remove","on","onDestroyed","off"],"mappings":"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","sourcesContent":["import { Template } from 'meteor/templating';\nimport { TAPi18n } from 'meteor/rocketchat:tap-i18n';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport _ from 'underscore';\n\nimport { VRecDialog } from './VRecDialog';\nimport { VideoRecorder, fileUpload, UserAction, USER_ACTIVITIES } from '../../ui';\n\nTemplate.vrecDialog.helpers({\n\trecordIcon() {\n\t\tif (VideoRecorder.cameraStarted.get() && VideoRecorder.recording.get()) {\n\t\t\treturn 'icon-stop';\n\t\t}\n\t\treturn 'icon-circle';\n\t},\n\n\tokDisabled() {\n\t\tif (VideoRecorder.cameraStarted.get() && VideoRecorder.recordingAvailable.get()) {\n\t\t\treturn '';\n\t\t}\n\t\treturn 'disabled';\n\t},\n\n\trecordDisabled() {\n\t\treturn VideoRecorder.cameraStarted.get() ? '' : 'disabled';\n\t},\n\n\ttime() {\n\t\treturn Template.instance().time.get();\n\t},\n});\n\nconst recordingInterval = new ReactiveVar(null);\n\nconst stopVideoRecording = (rid, tmid) => {\n\tif (recordingInterval.get()) {\n\t\tclearInterval(recordingInterval.get());\n\t\trecordingInterval.set(null);\n\t}\n\tUserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n};\n\nTemplate.vrecDialog.events({\n\t'click .vrec-dialog .cancel'(e, t) {\n\t\tconst rid = t.rid.get();\n\t\tconst tmid = t.tmid.get();\n\n\t\tVideoRecorder.stop();\n\t\tVRecDialog.close();\n\t\tt.time.set('');\n\t\tstopVideoRecording(rid, tmid);\n\t},\n\n\t'click .vrec-dialog .record'(e, t) {\n\t\tconst rid = t.rid.get();\n\t\tconst tmid = t.tmid.get();\n\t\tif (VideoRecorder.recording.get()) {\n\t\t\tVideoRecorder.stopRecording();\n\t\t\tstopVideoRecording(rid, tmid);\n\t\t} else {\n\t\t\tVideoRecorder.record();\n\t\t\tUserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\t\tt.time.set('00:00');\n\t\t\tconst startTime = new Date();\n\t\t\trecordingInterval.set(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tt.time.set(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t}\n\t},\n\n\t'click .vrec-dialog .ok'(e, instance) {\n\t\tconst [rid, tmid, input] = [instance.rid.get(), instance.tmid.get(), instance.input.get()];\n\t\tconst cb = (blob) => {\n\t\t\tfileUpload([{ file: blob, type: 'video', name: `${TAPi18n.__('Video record')}.webm` }], input, { rid, tmid });\n\t\t\tVRecDialog.close();\n\t\t};\n\t\tVideoRecorder.stop(cb);\n\t\tinstance.time.set('');\n\t\tstopVideoRecording(rid, tmid);\n\t},\n});\n\nTemplate.vrecDialog.onCreated(function () {\n\tthis.width = 400;\n\tthis.height = 290;\n\n\tthis.rid = new ReactiveVar();\n\tthis.tmid = new ReactiveVar();\n\tthis.input = new ReactiveVar();\n\tthis.time = new ReactiveVar('');\n\tthis.update = ({ rid, tmid, input }) => {\n\t\tthis.rid.set(rid);\n\t\tthis.tmid.set(tmid);\n\t\tthis.input.set(input);\n\t};\n\n\tthis.setPosition = function (dialog, source, anchor = 'left') {\n\t\tconst _set = () => {\n\t\t\tconst sourcePos = $(source).offset();\n\t\t\tlet top = sourcePos.top - this.height - 5;\n\n\t\t\tif (top < 0) {\n\t\t\t\ttop = 10;\n\t\t\t}\n\t\t\tif (anchor === 'left') {\n\t\t\t\tlet right = window.innerWidth - (sourcePos.left + source.offsetWidth - 25);\n\t\t\t\tif (right < 0) {\n\t\t\t\t\tright = 10;\n\t\t\t\t}\n\t\t\t\treturn dialog.css({ top: `${top}px`, right: `${right}px` });\n\t\t\t}\n\t\t\tlet left = sourcePos.left - this.width + 100;\n\t\t\tif (left < 0) {\n\t\t\t\tleft = 10;\n\t\t\t}\n\t\t\treturn dialog.css({ top: `${top}px`, left: `${left}px` });\n\t\t};\n\n\t\tconst set = _.debounce(_set, 2000);\n\t\t_set();\n\t\tthis.remove = set;\n\t\t$(window).on('resize', set);\n\t};\n});\n\nTemplate.vrecDialog.onDestroyed(function () {\n\tVRecDialog.close(this.rid.get());\n\t$(window).off('resize', this.remove);\n});\n"]},"sourceType":"module","hash":"f1b680f4c2529beba0ad212e890773d9abb8ee90"}
