{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/iframeCommands.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui/client/lib/iframeCommands.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/iframeCommands.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/lib/iframeCommands.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/iframeCommands.js"}},"code":"var _typeof;\n\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 2);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 1);\nvar ServiceConfiguration;\nmodule.link(\"meteor/service-configuration\", {\n  ServiceConfiguration: function (v) {\n    ServiceConfiguration = v;\n  }\n}, 2);\nvar s;\nmodule.link(\"underscore.string\", {\n  \"default\": function (v) {\n    s = v;\n  }\n}, 3);\nvar escapeRegExp;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeRegExp: function (v) {\n    escapeRegExp = v;\n  }\n}, 4);\nvar AccountBox;\nmodule.link(\"../../../ui-utils\", {\n  AccountBox: function (v) {\n    AccountBox = v;\n  }\n}, 5);\nvar settings;\nmodule.link(\"../../../settings\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 6);\nvar callbacks;\nmodule.link(\"../../../../lib/callbacks\", {\n  callbacks: function (v) {\n    callbacks = v;\n  }\n}, 7);\nvar add, remove;\nmodule.link(\"../../../../client/views/room/lib/Toolbox/IframeButtons\", {\n  add: function (v) {\n    add = v;\n  },\n  remove: function (v) {\n    remove = v;\n  }\n}, 8);\nvar baseURI;\nmodule.link(\"../../../../client/lib/baseURI\", {\n  baseURI: function (v) {\n    baseURI = v;\n  }\n}, 9);\nvar commands = {\n  'go': function (data) {\n    if (typeof data.path !== 'string' || data.path.trim().length === 0) {\n      return console.error('`path` not defined');\n    }\n\n    var newUrl = new URL(s.rtrim(baseURI, '/') + \"/\" + s.ltrim(data.path, '/'));\n    var newParams = Array.from(newUrl.searchParams.entries()).reduce(function (ret, _ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n          key = _ref2[0],\n          value = _ref2[1];\n\n      ret[key] = value;\n      return ret;\n    }, {});\n    var newPath = newUrl.pathname.replace(new RegExp(\"^\" + escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)), '');\n    FlowRouter.go(newPath, null, _objectSpread(_objectSpread({}, FlowRouter.current().queryParams), newParams));\n  },\n  'set-user-status': function (data) {\n    AccountBox.setStatus(data.status);\n  },\n  'call-custom-oauth-login': function (data, event) {\n    var customOAuthCallback = function (response) {\n      event.source.postMessage({\n        event: 'custom-oauth-callback',\n        response: response\n      }, event.origin);\n    };\n\n    var siteUrl = Meteor.settings.Site_Url + \"/\";\n\n    if (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n      data.redirectUrl = null;\n    }\n\n    if (typeof data.service === 'string' && window.ServiceConfiguration) {\n      var customOauth = ServiceConfiguration.configurations.findOne({\n        service: data.service\n      });\n\n      if (customOauth) {\n        var customLoginWith = Meteor[\"loginWith\" + s.capitalize(customOauth.service, true)];\n        var customRedirectUri = data.redirectUrl || siteUrl;\n        customLoginWith.call(Meteor, {\n          redirectUrl: customRedirectUri\n        }, customOAuthCallback);\n      }\n    }\n  },\n  'login-with-token': function (data) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    if (typeof data.token === 'string') {\n      Meteor.loginWithToken(data.token, function () {\n        console.log('Iframe command [login-with-token]: result', [data].concat(args));\n      });\n    }\n  },\n  'logout': function () {\n    var user = Meteor.user();\n    Meteor.logout(function () {\n      callbacks.run('afterLogoutCleanUp', user);\n      Meteor.call('logoutCleanUp', user);\n      return FlowRouter.go('home');\n    });\n  },\n  'set-toolbar-button': function (_ref3) {\n    var id = _ref3.id,\n        icon = _ref3.icon,\n        label = _ref3.label;\n    add(id, {\n      id: id,\n      icon: icon,\n      label: label\n    });\n  },\n  'remove-toolbar-button': function (_ref4) {\n    var id = _ref4.id;\n    remove(id);\n  }\n};\nwindow.addEventListener('message', function (e) {\n  if (settings.get('Iframe_Integration_receive_enable') !== true) {\n    return;\n  }\n\n  if (_typeof(e.data) !== 'object' || typeof e.data.externalCommand !== 'string') {\n    return;\n  }\n\n  var origins = settings.get('Iframe_Integration_receive_origin');\n\n  if (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n    return console.error('Origin not allowed', e.origin);\n  }\n\n  var command = commands[e.data.externalCommand];\n\n  if (command) {\n    command(e.data, e);\n  }\n});","map":{"version":3,"sources":["app/ui/client/lib/iframeCommands.js"],"names":["_typeof","module","link","default","v","_objectSpread","_slicedToArray","Meteor","FlowRouter","ServiceConfiguration","s","escapeRegExp","AccountBox","settings","callbacks","add","remove","baseURI","commands","data","path","trim","length","console","error","newUrl","URL","rtrim","ltrim","newParams","Array","from","searchParams","entries","reduce","ret","key","value","newPath","pathname","replace","RegExp","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","go","current","queryParams","setStatus","status","event","customOAuthCallback","response","source","postMessage","origin","siteUrl","Site_Url","redirectUrl","startsWith","service","window","customOauth","configurations","findOne","customLoginWith","capitalize","customRedirectUri","call","args","token","loginWithToken","log","user","logout","run","id","icon","label","addEventListener","e","get","externalCommand","origins","split","indexOf","command"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { ServiceConfiguration } from 'meteor/service-configuration';\nimport s from 'underscore.string';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\n\nimport { AccountBox } from '../../../ui-utils';\nimport { settings } from '../../../settings';\nimport { callbacks } from '../../../../lib/callbacks';\nimport { add, remove } from '../../../../client/views/room/lib/Toolbox/IframeButtons';\nimport { baseURI } from '../../../../client/lib/baseURI';\n\nconst commands = {\n\t'go'(data) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tconst newUrl = new URL(`${s.rtrim(baseURI, '/')}/${s.ltrim(data.path, '/')}`);\n\n\t\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, [key, value]) => {\n\t\t\tret[key] = value;\n\t\t\treturn ret;\n\t\t}, {});\n\n\t\tconst newPath = newUrl.pathname.replace(new RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`), '');\n\t\tFlowRouter.go(newPath, null, { ...FlowRouter.current().queryParams, ...newParams });\n\t},\n\n\t'set-user-status'(data) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data, event) {\n\t\tconst customOAuthCallback = (response) => {\n\t\t\tevent.source.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\t\tresponse,\n\t\t\t\t},\n\t\t\t\tevent.origin,\n\t\t\t);\n\t\t};\n\n\t\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = ServiceConfiguration.configurations.findOne({ service: data.service });\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = Meteor[`loginWith${s.capitalize(customOauth.service, true)}`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data, ...args) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, function () {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', [data, ...args]);\n\t\t\t});\n\t\t}\n\t},\n\n\t'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tcallbacks.run('afterLogoutCleanUp', user);\n\t\t\tMeteor.call('logoutCleanUp', user);\n\t\t\treturn FlowRouter.go('home');\n\t\t});\n\t},\n\n\t'set-toolbar-button'({ id, icon, label }) {\n\t\tadd(id, { id, icon, label });\n\t},\n\t'remove-toolbar-button'({ id }) {\n\t\tremove(id);\n\t},\n};\n\nwindow.addEventListener('message', (e) => {\n\tif (settings.get('Iframe_Integration_receive_enable') !== true) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = settings.get('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\treturn console.error('Origin not allowed', e.origin);\n\t}\n\n\tconst command = commands[e.data.externalCommand];\n\tif (command) {\n\t\tcommand(e.data, e);\n\t}\n});\n"]},"sourceType":"module","hash":"6ede2c05a36fcc1765abcdd4e90a2bcf6be10d9a"}
