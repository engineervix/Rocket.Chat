{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/CloseChatModal.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/components/Omnichannel/modals/CloseChatModal.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/CloseChatModal.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/CloseChatModal.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/Omnichannel/modals/CloseChatModal.js"}},"code":"let Field, Button, TextInput, Icon, ButtonGroup, Modal, Box;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Field(v) {\n    Field = v;\n  },\n\n  Button(v) {\n    Button = v;\n  },\n\n  TextInput(v) {\n    TextInput = v;\n  },\n\n  Icon(v) {\n    Icon = v;\n  },\n\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  },\n\n  Modal(v) {\n    Modal = v;\n  },\n\n  Box(v) {\n    Box = v;\n  }\n\n}, 0);\nlet useAutoFocus;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useAutoFocus(v) {\n    useAutoFocus = v;\n  }\n\n}, 1);\nlet React, useCallback, useState, useMemo, useEffect;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n\n  useCallback(v) {\n    useCallback = v;\n  },\n\n  useState(v) {\n    useState = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  }\n\n}, 2);\nlet useSetting;\nmodule.link(\"../../../contexts/SettingsContext\", {\n  useSetting(v) {\n    useSetting = v;\n  }\n\n}, 3);\nlet useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n\n}, 4);\nlet useComponentDidUpdate;\nmodule.link(\"../../../hooks/useComponentDidUpdate\", {\n  useComponentDidUpdate(v) {\n    useComponentDidUpdate = v;\n  }\n\n}, 5);\nlet useForm;\nmodule.link(\"../../../hooks/useForm\", {\n  useForm(v) {\n    useForm = v;\n  }\n\n}, 6);\nlet GenericModal;\nmodule.link(\"../../GenericModal\", {\n  default(v) {\n    GenericModal = v;\n  }\n\n}, 7);\nlet Tags;\nmodule.link(\"../Tags\", {\n  default(v) {\n    Tags = v;\n  }\n\n}, 8);\n\nconst CloseChatModal = _ref => {\n  let {\n    department = {},\n    onCancel,\n    onConfirm\n  } = _ref;\n  const t = useTranslation();\n  const inputRef = useAutoFocus(true);\n  const {\n    values,\n    handlers\n  } = useForm({\n    comment: '',\n    tags: []\n  });\n  const commentRequired = useSetting('Livechat_request_comment_when_closing_conversation');\n  const {\n    comment,\n    tags\n  } = values;\n  const {\n    handleComment,\n    handleTags\n  } = handlers;\n  const [commentError, setCommentError] = useState('');\n  const [tagError, setTagError] = useState('');\n  const [tagRequired, setTagRequired] = useState(false);\n  const handleConfirm = useCallback(() => {\n    onConfirm(comment, tags);\n  }, [comment, onConfirm, tags]);\n  useComponentDidUpdate(() => {\n    setCommentError(!comment && commentRequired ? t('The_field_is_required', t('Comment')) : '');\n  }, [commentRequired, comment, t]);\n  const canConfirm = useMemo(() => {\n    const canConfirmTag = !tagError && (tagRequired ? tags.length > 0 : true);\n    const canConfirmComment = !commentError && (commentRequired ? !!comment : true);\n    return canConfirmTag && canConfirmComment;\n  }, [comment, commentError, commentRequired, tagError, tagRequired, tags.length]);\n  useEffect(() => {\n    (department === null || department === void 0 ? void 0 : department.requestTagBeforeClosingChat) && setTagRequired(true);\n    setTagError(tagRequired && (!tags || tags.length === 0) ? t('error-tags-must-be-assigned-before-closing-chat') : '');\n  }, [department, tagRequired, t, tags]);\n\n  if (!commentRequired && !tagRequired) {\n    return /*#__PURE__*/React.createElement(GenericModal, {\n      variant: \"warning\",\n      title: t('Are_you_sure_you_want_to_close_this_chat'),\n      onConfirm: handleConfirm,\n      onCancel: onCancel,\n      onClose: onCancel,\n      confirmText: t('Confirm')\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(Modal, null, /*#__PURE__*/React.createElement(Modal.Header, null, /*#__PURE__*/React.createElement(Icon, {\n    name: \"baloon-close-top-right\",\n    size: 20\n  }), /*#__PURE__*/React.createElement(Modal.Title, null, t('Closing_chat')), /*#__PURE__*/React.createElement(Modal.Close, {\n    onClick: onCancel\n  })), /*#__PURE__*/React.createElement(Modal.Content, {\n    fontScale: \"p2\"\n  }, /*#__PURE__*/React.createElement(Box, {\n    color: \"neutral-600\"\n  }, t('Close_room_description')), /*#__PURE__*/React.createElement(Field, {\n    marginBlock: \"x15\"\n  }, /*#__PURE__*/React.createElement(Field.Label, {\n    required: commentRequired\n  }, t('Comment')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextInput, {\n    ref: inputRef,\n    error: commentError,\n    flexGrow: 1,\n    value: comment,\n    onChange: handleComment,\n    placeholder: t('Please_add_a_comment')\n  })), /*#__PURE__*/React.createElement(Field.Error, null, commentError)), Tags && /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Tags, {\n    tagRequired: tagRequired,\n    tags: tags,\n    handler: handleTags,\n    error: tagError\n  }), /*#__PURE__*/React.createElement(Field.Error, null, tagError))), /*#__PURE__*/React.createElement(Modal.Footer, null, /*#__PURE__*/React.createElement(ButtonGroup, {\n    align: \"end\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onCancel\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    disabled: !canConfirm,\n    primary: true,\n    onClick: handleConfirm\n  }, t('Confirm')))));\n};\n\nmodule.exportDefault(CloseChatModal);","map":{"version":3,"sources":["client/components/Omnichannel/modals/CloseChatModal.js"],"names":["Field","Button","TextInput","Icon","ButtonGroup","Modal","Box","module","link","v","useAutoFocus","React","useCallback","useState","useMemo","useEffect","default","useSetting","useTranslation","useComponentDidUpdate","useForm","GenericModal","Tags","CloseChatModal","department","onCancel","onConfirm","t","inputRef","values","handlers","comment","tags","commentRequired","handleComment","handleTags","commentError","setCommentError","tagError","setTagError","tagRequired","setTagRequired","handleConfirm","canConfirm","canConfirmTag","length","canConfirmComment","requestTagBeforeClosingChat","exportDefault"],"mappings":"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","sourcesContent":["import { Field, Button, TextInput, Icon, ButtonGroup, Modal, Box } from '@rocket.chat/fuselage';\nimport { useAutoFocus } from '@rocket.chat/fuselage-hooks';\nimport React, { useCallback, useState, useMemo, useEffect } from 'react';\n\nimport { useSetting } from '../../../contexts/SettingsContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useComponentDidUpdate } from '../../../hooks/useComponentDidUpdate';\nimport { useForm } from '../../../hooks/useForm';\nimport GenericModal from '../../GenericModal';\nimport Tags from '../Tags';\n\nconst CloseChatModal = ({ department = {}, onCancel, onConfirm }) => {\n\tconst t = useTranslation();\n\n\tconst inputRef = useAutoFocus(true);\n\n\tconst { values, handlers } = useForm({ comment: '', tags: [] });\n\n\tconst commentRequired = useSetting('Livechat_request_comment_when_closing_conversation');\n\n\tconst { comment, tags } = values;\n\tconst { handleComment, handleTags } = handlers;\n\tconst [commentError, setCommentError] = useState('');\n\tconst [tagError, setTagError] = useState('');\n\tconst [tagRequired, setTagRequired] = useState(false);\n\n\tconst handleConfirm = useCallback(() => {\n\t\tonConfirm(comment, tags);\n\t}, [comment, onConfirm, tags]);\n\n\tuseComponentDidUpdate(() => {\n\t\tsetCommentError(!comment && commentRequired ? t('The_field_is_required', t('Comment')) : '');\n\t}, [commentRequired, comment, t]);\n\n\tconst canConfirm = useMemo(() => {\n\t\tconst canConfirmTag = !tagError && (tagRequired ? tags.length > 0 : true);\n\t\tconst canConfirmComment = !commentError && (commentRequired ? !!comment : true);\n\t\treturn canConfirmTag && canConfirmComment;\n\t}, [comment, commentError, commentRequired, tagError, tagRequired, tags.length]);\n\n\tuseEffect(() => {\n\t\tdepartment?.requestTagBeforeClosingChat && setTagRequired(true);\n\t\tsetTagError(tagRequired && (!tags || tags.length === 0) ? t('error-tags-must-be-assigned-before-closing-chat') : '');\n\t}, [department, tagRequired, t, tags]);\n\n\tif (!commentRequired && !tagRequired) {\n\t\treturn (\n\t\t\t<GenericModal\n\t\t\t\tvariant='warning'\n\t\t\t\ttitle={t('Are_you_sure_you_want_to_close_this_chat')}\n\t\t\t\tonConfirm={handleConfirm}\n\t\t\t\tonCancel={onCancel}\n\t\t\t\tonClose={onCancel}\n\t\t\t\tconfirmText={t('Confirm')}\n\t\t\t></GenericModal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Modal>\n\t\t\t<Modal.Header>\n\t\t\t\t<Icon name='baloon-close-top-right' size={20} />\n\t\t\t\t<Modal.Title>{t('Closing_chat')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t<Box color='neutral-600'>{t('Close_room_description')}</Box>\n\t\t\t\t<Field marginBlock='x15'>\n\t\t\t\t\t<Field.Label required={commentRequired}>{t('Comment')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tref={inputRef}\n\t\t\t\t\t\t\terror={commentError}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tvalue={comment}\n\t\t\t\t\t\t\tonChange={handleComment}\n\t\t\t\t\t\t\tplaceholder={t('Please_add_a_comment')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t\t<Field.Error>{commentError}</Field.Error>\n\t\t\t\t</Field>\n\t\t\t\t{Tags && (\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<Tags tagRequired={tagRequired} tags={tags} handler={handleTags} error={tagError} />\n\t\t\t\t\t\t<Field.Error>{tagError}</Field.Error>\n\t\t\t\t\t</Field>\n\t\t\t\t)}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button disabled={!canConfirm} primary onClick={handleConfirm}>\n\t\t\t\t\t\t{t('Confirm')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default CloseChatModal;\n"]},"sourceType":"module","hash":"5be332384283c05b0ef3a660f12300c1fb5a55a3"}
