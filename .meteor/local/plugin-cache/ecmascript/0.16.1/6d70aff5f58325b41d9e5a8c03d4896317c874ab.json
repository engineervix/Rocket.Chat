{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/messageContext.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-utils/client/lib/messageContext.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/messageContext.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/messageContext.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-utils/client/lib/messageContext.js"}},"code":"var _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\nmodule.export({\n  messageContext: function () {\n    return messageContext;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 1);\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar Subscriptions, Rooms, Users;\nmodule.link(\"../../../models/client\", {\n  Subscriptions: function (v) {\n    Subscriptions = v;\n  },\n  Rooms: function (v) {\n    Rooms = v;\n  },\n  Users: function (v) {\n    Users = v;\n  }\n}, 4);\nvar hasPermission;\nmodule.link(\"../../../authorization/client\", {\n  hasPermission: function (v) {\n    hasPermission = v;\n  }\n}, 5);\nvar settings;\nmodule.link(\"../../../settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 6);\nvar getUserPreference;\nmodule.link(\"../../../utils/client\", {\n  getUserPreference: function (v) {\n    getUserPreference = v;\n  }\n}, 7);\nvar AutoTranslate;\nmodule.link(\"../../../autotranslate/client\", {\n  AutoTranslate: function (v) {\n    AutoTranslate = v;\n  }\n}, 8);\nvar fireGlobalEvent;\nmodule.link(\"../../../../client/lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent: function (v) {\n    fireGlobalEvent = v;\n  }\n}, 9);\nvar actionLinks;\nmodule.link(\"../../../action-links/client\", {\n  actionLinks: function (v) {\n    actionLinks = v;\n  }\n}, 10);\nvar goToRoomById;\nmodule.link(\"../../../../client/lib/utils/goToRoomById\", {\n  goToRoomById: function (v) {\n    goToRoomById = v;\n  }\n}, 11);\nvar isLayoutEmbedded;\nmodule.link(\"../../../../client/lib/utils/isLayoutEmbedded\", {\n  isLayoutEmbedded: function (v) {\n    isLayoutEmbedded = v;\n  }\n}, 12);\nvar handleError;\nmodule.link(\"../../../../client/lib/utils/handleError\", {\n  handleError: function (v) {\n    handleError = v;\n  }\n}, 13);\nvar roomCoordinator;\nmodule.link(\"../../../../client/lib/rooms/roomCoordinator\", {\n  roomCoordinator: function (v) {\n    roomCoordinator = v;\n  }\n}, 14);\nvar fields = {\n  'name': 1,\n  'username': 1,\n  'settings.preferences.enableMessageParserEarlyAdoption': 1,\n  'settings.preferences.showMessageInMainThread': 1,\n  'settings.preferences.autoImageLoad': 1,\n  'settings.preferences.saveMobileBandwidth': 1,\n  'settings.preferences.collapseMediaByDefault': 1,\n  'settings.preferences.hideRoles': 1\n};\n\nfunction messageContext() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Template.instance(),\n      rid = _ref.rid;\n\n  var uid = Meteor.userId();\n  var user = Users.findOne({\n    _id: uid\n  }, {\n    fields: fields\n  }) || {};\n  var instance = Template.instance();\n\n  var openThread = function (e) {\n    var _e$currentTarget$data = e.currentTarget.dataset,\n        rid = _e$currentTarget$data.rid,\n        mid = _e$currentTarget$data.mid,\n        tmid = _e$currentTarget$data.tmid;\n    var room = Rooms.findOne({\n      _id: rid\n    });\n    FlowRouter.go(FlowRouter.getRouteName(), {\n      rid: rid,\n      name: room.name,\n      tab: 'thread',\n      context: tmid || mid\n    }, {\n      jump: tmid && tmid !== mid && mid && mid\n    });\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  var runAction = isLayoutEmbedded() ? function (msg, e) {\n    var actionlink = e.currentTarget.dataset.actionlink;\n    return fireGlobalEvent('click-action-link', {\n      actionlink: actionlink,\n      value: msg._id,\n      message: msg\n    });\n  } : function (msg, e) {\n    var actionlink = e.currentTarget.dataset.actionlink;\n    actionLinks.run(actionlink, msg._id, instance, function (err) {\n      if (err) {\n        handleError(err);\n      }\n    });\n  };\n\n  var openDiscussion = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    var drid = e.currentTarget.dataset.drid;\n    goToRoomById(drid);\n  };\n\n  var replyBroadcast = function (e) {\n    var _e$currentTarget$data2 = e.currentTarget.dataset,\n        username = _e$currentTarget$data2.username,\n        mid = _e$currentTarget$data2.mid;\n    roomCoordinator.openRouteLink('d', {\n      name: username\n    }, _objectSpread(_objectSpread({}, FlowRouter.current().queryParams), {}, {\n      reply: mid\n    }));\n  };\n\n  return {\n    u: user,\n    room: Tracker.nonreactive(function () {\n      return Rooms.findOne({\n        _id: rid\n      }, {\n        fields: {\n          _updatedAt: 0,\n          lastMessage: 0\n        }\n      });\n    }),\n    subscription: Subscriptions.findOne({\n      rid: rid\n    }, {\n      fields: {\n        name: 1,\n        autoTranslate: 1,\n        rid: 1,\n        tunread: 1,\n        tunreadUser: 1,\n        tunreadGroup: 1\n      }\n    }),\n    actions: {\n      openThread: function () {\n        return openThread;\n      },\n      runAction: function (msg) {\n        return function () {\n          return function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            runAction(msg, e);\n          };\n        };\n      },\n      openDiscussion: function () {\n        return openDiscussion;\n      },\n      replyBroadcast: function () {\n        return replyBroadcast;\n      }\n    },\n    settings: {\n      translateLanguage: AutoTranslate.getLanguage(rid),\n      showMessageInMainThread: getUserPreference(user, 'showMessageInMainThread'),\n      autoImageLoad: getUserPreference(user, 'autoImageLoad'),\n      enableMessageParserEarlyAdoption: getUserPreference(user, 'enableMessageParserEarlyAdoption'),\n      saveMobileBandwidth: Meteor.Device.isPhone() && getUserPreference(user, 'saveMobileBandwidth'),\n      collapseMediaByDefault: getUserPreference(user, 'collapseMediaByDefault'),\n      showreply: true,\n      showReplyButton: true,\n      hasPermissionDeleteMessage: hasPermission('delete-message', rid),\n      hasPermissionDeleteOwnMessage: hasPermission('delete-own-message'),\n      hideRoles: !settings.get('UI_DisplayRoles') || getUserPreference(user, 'hideRoles'),\n      UI_Use_Real_Name: settings.get('UI_Use_Real_Name'),\n      Chatops_Username: settings.get('Chatops_Username'),\n      AutoTranslate_Enabled: settings.get('AutoTranslate_Enabled'),\n      Message_AllowEditing: settings.get('Message_AllowEditing'),\n      Message_AllowEditing_BlockEditInMinutes: settings.get('Message_AllowEditing_BlockEditInMinutes'),\n      Message_ShowEditedStatus: settings.get('Message_ShowEditedStatus'),\n      API_Embed: settings.get('API_Embed'),\n      API_EmbedDisabledFor: settings.get('API_EmbedDisabledFor'),\n      Message_GroupingPeriod: settings.get('Message_GroupingPeriod') * 1000\n    }\n  };\n}","map":{"version":3,"sources":["app/ui-utils/client/lib/messageContext.js"],"names":["_objectSpread","module","link","default","v","export","messageContext","Meteor","Template","FlowRouter","Tracker","Subscriptions","Rooms","Users","hasPermission","settings","getUserPreference","AutoTranslate","fireGlobalEvent","actionLinks","goToRoomById","isLayoutEmbedded","handleError","roomCoordinator","fields","instance","rid","uid","userId","user","findOne","_id","openThread","e","currentTarget","dataset","mid","tmid","room","go","getRouteName","name","tab","context","jump","preventDefault","stopPropagation","runAction","msg","actionlink","value","message","run","err","openDiscussion","drid","replyBroadcast","username","openRouteLink","current","queryParams","reply","u","nonreactive","_updatedAt","lastMessage","subscription","autoTranslate","tunread","tunreadUser","tunreadGroup","actions","translateLanguage","getLanguage","showMessageInMainThread","autoImageLoad","enableMessageParserEarlyAdoption","saveMobileBandwidth","Device","isPhone","collapseMediaByDefault","showreply","showReplyButton","hasPermissionDeleteMessage","hasPermissionDeleteOwnMessage","hideRoles","get","UI_Use_Real_Name","Chatops_Username","AutoTranslate_Enabled","Message_AllowEditing","Message_AllowEditing_BlockEditInMinutes","Message_ShowEditedStatus","API_Embed","API_EmbedDisabledFor","Message_GroupingPeriod"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Tracker } from 'meteor/tracker';\n\nimport { Subscriptions, Rooms, Users } from '../../../models/client';\nimport { hasPermission } from '../../../authorization/client';\nimport { settings } from '../../../settings/client';\nimport { getUserPreference } from '../../../utils/client';\nimport { AutoTranslate } from '../../../autotranslate/client';\nimport { fireGlobalEvent } from '../../../../client/lib/utils/fireGlobalEvent';\nimport { actionLinks } from '../../../action-links/client';\nimport { goToRoomById } from '../../../../client/lib/utils/goToRoomById';\nimport { isLayoutEmbedded } from '../../../../client/lib/utils/isLayoutEmbedded';\nimport { handleError } from '../../../../client/lib/utils/handleError';\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\n\nconst fields = {\n\t'name': 1,\n\t'username': 1,\n\t'settings.preferences.enableMessageParserEarlyAdoption': 1,\n\t'settings.preferences.showMessageInMainThread': 1,\n\t'settings.preferences.autoImageLoad': 1,\n\t'settings.preferences.saveMobileBandwidth': 1,\n\t'settings.preferences.collapseMediaByDefault': 1,\n\t'settings.preferences.hideRoles': 1,\n};\n\nexport function messageContext({ rid } = Template.instance()) {\n\tconst uid = Meteor.userId();\n\tconst user = Users.findOne({ _id: uid }, { fields }) || {};\n\tconst instance = Template.instance();\n\tconst openThread = (e) => {\n\t\tconst { rid, mid, tmid } = e.currentTarget.dataset;\n\t\tconst room = Rooms.findOne({ _id: rid });\n\t\tFlowRouter.go(\n\t\t\tFlowRouter.getRouteName(),\n\t\t\t{\n\t\t\t\trid,\n\t\t\t\tname: room.name,\n\t\t\t\ttab: 'thread',\n\t\t\t\tcontext: tmid || mid,\n\t\t\t},\n\t\t\t{\n\t\t\t\tjump: tmid && tmid !== mid && mid && mid,\n\t\t\t},\n\t\t);\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t};\n\n\tconst runAction = isLayoutEmbedded()\n\t\t? (msg, e) => {\n\t\t\t\tconst { actionlink } = e.currentTarget.dataset;\n\t\t\t\treturn fireGlobalEvent('click-action-link', {\n\t\t\t\t\tactionlink,\n\t\t\t\t\tvalue: msg._id,\n\t\t\t\t\tmessage: msg,\n\t\t\t\t});\n\t\t  }\n\t\t: (msg, e) => {\n\t\t\t\tconst { actionlink } = e.currentTarget.dataset;\n\t\t\t\tactionLinks.run(actionlink, msg._id, instance, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\thandleError(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t  };\n\n\tconst openDiscussion = (e) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tconst { drid } = e.currentTarget.dataset;\n\t\tgoToRoomById(drid);\n\t};\n\n\tconst replyBroadcast = (e) => {\n\t\tconst { username, mid } = e.currentTarget.dataset;\n\t\troomCoordinator.openRouteLink('d', { name: username }, { ...FlowRouter.current().queryParams, reply: mid });\n\t};\n\n\treturn {\n\t\tu: user,\n\t\troom: Tracker.nonreactive(() =>\n\t\t\tRooms.findOne(\n\t\t\t\t{ _id: rid },\n\t\t\t\t{\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_updatedAt: 0,\n\t\t\t\t\t\tlastMessage: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t),\n\t\tsubscription: Subscriptions.findOne(\n\t\t\t{ rid },\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\tname: 1,\n\t\t\t\t\tautoTranslate: 1,\n\t\t\t\t\trid: 1,\n\t\t\t\t\ttunread: 1,\n\t\t\t\t\ttunreadUser: 1,\n\t\t\t\t\ttunreadGroup: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t),\n\t\tactions: {\n\t\t\topenThread() {\n\t\t\t\treturn openThread;\n\t\t\t},\n\t\t\trunAction(msg) {\n\t\t\t\treturn () => (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\trunAction(msg, e);\n\t\t\t\t};\n\t\t\t},\n\t\t\topenDiscussion() {\n\t\t\t\treturn openDiscussion;\n\t\t\t},\n\t\t\treplyBroadcast() {\n\t\t\t\treturn replyBroadcast;\n\t\t\t},\n\t\t},\n\t\tsettings: {\n\t\t\ttranslateLanguage: AutoTranslate.getLanguage(rid),\n\t\t\tshowMessageInMainThread: getUserPreference(user, 'showMessageInMainThread'),\n\t\t\tautoImageLoad: getUserPreference(user, 'autoImageLoad'),\n\t\t\tenableMessageParserEarlyAdoption: getUserPreference(user, 'enableMessageParserEarlyAdoption'),\n\t\t\tsaveMobileBandwidth: Meteor.Device.isPhone() && getUserPreference(user, 'saveMobileBandwidth'),\n\t\t\tcollapseMediaByDefault: getUserPreference(user, 'collapseMediaByDefault'),\n\t\t\tshowreply: true,\n\t\t\tshowReplyButton: true,\n\t\t\thasPermissionDeleteMessage: hasPermission('delete-message', rid),\n\t\t\thasPermissionDeleteOwnMessage: hasPermission('delete-own-message'),\n\t\t\thideRoles: !settings.get('UI_DisplayRoles') || getUserPreference(user, 'hideRoles'),\n\t\t\tUI_Use_Real_Name: settings.get('UI_Use_Real_Name'),\n\t\t\tChatops_Username: settings.get('Chatops_Username'),\n\t\t\tAutoTranslate_Enabled: settings.get('AutoTranslate_Enabled'),\n\t\t\tMessage_AllowEditing: settings.get('Message_AllowEditing'),\n\t\t\tMessage_AllowEditing_BlockEditInMinutes: settings.get('Message_AllowEditing_BlockEditInMinutes'),\n\t\t\tMessage_ShowEditedStatus: settings.get('Message_ShowEditedStatus'),\n\t\t\tAPI_Embed: settings.get('API_Embed'),\n\t\t\tAPI_EmbedDisabledFor: settings.get('API_EmbedDisabledFor'),\n\t\t\tMessage_GroupingPeriod: settings.get('Message_GroupingPeriod') * 1000,\n\t\t},\n\t};\n}\n"]},"sourceType":"module","hash":"6d70aff5f58325b41d9e5a8c03d4896317c874ab"}
