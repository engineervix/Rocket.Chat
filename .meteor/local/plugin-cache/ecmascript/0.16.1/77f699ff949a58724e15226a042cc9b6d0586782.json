{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/lib/getCommonRoomEvents.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui/client/views/app/lib/getCommonRoomEvents.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/lib/getCommonRoomEvents.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui/client/views/app/lib/getCommonRoomEvents.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/views/app/lib/getCommonRoomEvents.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 2);\nmodule.export({\n  getCommonRoomEvents: function () {\n    return getCommonRoomEvents;\n  }\n});\nvar Clipboard;\nmodule.link(\"clipboard\", {\n  \"default\": function (v) {\n    Clipboard = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Random;\nmodule.link(\"meteor/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 2);\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 3);\nvar popover, MessageAction;\nmodule.link(\"../../../../../ui-utils/client\", {\n  popover: function (v) {\n    popover = v;\n  },\n  MessageAction: function (v) {\n    MessageAction = v;\n  }\n}, 4);\nvar addMessageToList;\nmodule.link(\"../../../../../ui-utils/client/lib/MessageAction\", {\n  addMessageToList: function (v) {\n    addMessageToList = v;\n  }\n}, 5);\nvar callWithErrorHandling;\nmodule.link(\"../../../../../../client/lib/utils/callWithErrorHandling\", {\n  callWithErrorHandling: function (v) {\n    callWithErrorHandling = v;\n  }\n}, 6);\nvar isURL;\nmodule.link(\"../../../../../utils/lib/isURL\", {\n  isURL: function (v) {\n    isURL = v;\n  }\n}, 7);\nvar openUserCard;\nmodule.link(\"../../../lib/UserCard\", {\n  openUserCard: function (v) {\n    openUserCard = v;\n  }\n}, 8);\nvar messageArgs;\nmodule.link(\"../../../../../ui-utils/client/lib/messageArgs\", {\n  messageArgs: function (v) {\n    messageArgs = v;\n  }\n}, 9);\nvar ChatMessage, Rooms, Messages;\nmodule.link(\"../../../../../models\", {\n  ChatMessage: function (v) {\n    ChatMessage = v;\n  },\n  Rooms: function (v) {\n    Rooms = v;\n  },\n  Messages: function (v) {\n    Messages = v;\n  }\n}, 10);\nvar t;\nmodule.link(\"../../../../../utils/client\", {\n  t: function (v) {\n    t = v;\n  }\n}, 11);\nvar chatMessages;\nmodule.link(\"../room\", {\n  chatMessages: function (v) {\n    chatMessages = v;\n  }\n}, 12);\nvar EmojiEvents;\nmodule.link(\"../../../../../reactions/client/init\", {\n  EmojiEvents: function (v) {\n    EmojiEvents = v;\n  }\n}, 13);\nvar goToRoomById;\nmodule.link(\"../../../../../../client/lib/utils/goToRoomById\", {\n  goToRoomById: function (v) {\n    goToRoomById = v;\n  }\n}, 14);\nvar fireGlobalEvent;\nmodule.link(\"../../../../../../client/lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent: function (v) {\n    fireGlobalEvent = v;\n  }\n}, 15);\nvar isLayoutEmbedded;\nmodule.link(\"../../../../../../client/lib/utils/isLayoutEmbedded\", {\n  isLayoutEmbedded: function (v) {\n    isLayoutEmbedded = v;\n  }\n}, 16);\nvar onClientBeforeSendMessage;\nmodule.link(\"../../../../../../client/lib/onClientBeforeSendMessage\", {\n  onClientBeforeSendMessage: function (v) {\n    onClientBeforeSendMessage = v;\n  }\n}, 17);\n\nvar mountPopover = function (e, i, outerContext) {\n  var context = $(e.target).parents('.message').data('context');\n\n  if (!context) {\n    context = 'message';\n  }\n\n  var messageContext = messageArgs(outerContext);\n  var menuItems = MessageAction.getButtons(messageContext, context, 'menu').map(function (item) {\n    return {\n      icon: item.icon,\n      name: t(item.label),\n      type: 'message-action',\n      id: item.id,\n      modifier: item.color\n    };\n  });\n\n  if (window.matchMedia('(max-width: 500px)').matches) {\n    var messageItems = MessageAction.getButtons(messageContext, context, 'message').map(function (item) {\n      return {\n        icon: item.icon,\n        name: t(item.label),\n        type: 'message-action',\n        id: item.id,\n        modifier: item.color\n      };\n    });\n    menuItems = menuItems.concat(messageItems);\n  }\n\n  var _menuItems$reduce = menuItems.reduce(function (result, value) {\n    result[value.id === 'delete-message' ? 1 : 0].push(value);\n    return result;\n  }, [[], []]),\n      _menuItems$reduce2 = _slicedToArray(_menuItems$reduce, 2),\n      items = _menuItems$reduce2[0],\n      deleteItem = _menuItems$reduce2[1];\n\n  var groups = [{\n    items: items\n  }];\n\n  if (deleteItem.length) {\n    groups.push({\n      items: deleteItem\n    });\n  }\n\n  var config = {\n    columns: [{\n      groups: groups\n    }],\n    instance: i,\n    currentTarget: e.currentTarget,\n    data: outerContext,\n    activeElement: $(e.currentTarget).parents('.message')[0],\n    onRendered: function () {\n      return new Clipboard('.rc-popover__item');\n    }\n  };\n  popover.open(config);\n};\n\nvar getCommonRoomEvents = function () {\n  return _objectSpread(_objectSpread({}, function () {\n    var touchMoved = false;\n    var lastTouchX = null;\n    var lastTouchY = null;\n    var touchtime = null;\n    return _objectSpread(_objectSpread({}, EmojiEvents), {}, {\n      'click .message img': function (e) {\n        clearTimeout(touchtime);\n\n        if (touchMoved === true) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      },\n      'touchstart .message': function (e) {\n        var _this = this;\n\n        var touches = e.originalEvent.touches;\n\n        if (touches && touches.length) {\n          lastTouchX = touches[0].pageX;\n          lastTouchY = touches[0].pagey;\n        }\n\n        touchMoved = false;\n\n        if (e.originalEvent.touches.length !== 1) {\n          return;\n        }\n\n        if ($(e.currentTarget).hasClass('system')) {\n          return;\n        }\n\n        if (e.target && e.target.nodeName === 'AUDIO') {\n          return;\n        }\n\n        if (e.target && e.target.nodeName === 'A' && isURL(e.target.getAttribute('href'))) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n\n        var doLongTouch = function () {\n          mountPopover(e, t, _this);\n        };\n\n        clearTimeout(touchtime);\n        touchtime = setTimeout(doLongTouch, 500);\n      },\n      'touchend .message': function (e) {\n        clearTimeout(touchtime);\n\n        if (e.target && e.target.nodeName === 'A' && isURL(e.target.getAttribute('href'))) {\n          if (touchMoved === true) {\n            e.preventDefault();\n            e.stopPropagation();\n            return;\n          }\n\n          window.open(e.target.href);\n        }\n      },\n      'touchmove .message': function (e) {\n        var touches = e.originalEvent.touches;\n\n        if (touches && touches.length) {\n          var deltaX = Math.abs(lastTouchX - touches[0].pageX);\n          var deltaY = Math.abs(lastTouchY - touches[0].pageY);\n\n          if (deltaX > 5 || deltaY > 5) {\n            touchMoved = true;\n          }\n        }\n\n        clearTimeout(touchtime);\n      },\n      'touchcancel .message': function () {\n        clearTimeout(touchtime);\n      }\n    });\n  }()), {}, {\n    'click [data-message-action]': function (event, template) {\n      var button = MessageAction.getButtonById(event.currentTarget.dataset.messageAction);\n\n      if ((button != null ? button.action : undefined) != null) {\n        button.action.call(this, event, {\n          tabBar: template.tabBar,\n          rid: template.data.rid\n        });\n      }\n    },\n    'click .js-follow-thread': function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      var _messageArgs = messageArgs(this),\n          msg = _messageArgs.msg;\n\n      callWithErrorHandling('followMessage', {\n        mid: msg._id\n      });\n    },\n    'click .js-unfollow-thread': function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      var _messageArgs2 = messageArgs(this),\n          msg = _messageArgs2.msg;\n\n      callWithErrorHandling('unfollowMessage', {\n        mid: msg._id\n      });\n    },\n    'click .js-open-thread': function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      var _messageArgs3 = messageArgs(this),\n          _messageArgs3$msg = _messageArgs3.msg,\n          rid = _messageArgs3$msg.rid,\n          _id = _messageArgs3$msg._id,\n          tmid = _messageArgs3$msg.tmid;\n\n      var room = Rooms.findOne({\n        _id: rid\n      });\n      FlowRouter.go(FlowRouter.getRouteName(), {\n        rid: rid,\n        name: room.name,\n        tab: 'thread',\n        context: tmid || _id\n      }, {\n        jump: tmid && tmid !== _id && _id && _id\n      });\n    },\n    'click .image-to-download': function (event) {\n      var _messageArgs4 = messageArgs(this),\n          msg = _messageArgs4.msg;\n\n      ChatMessage.update({\n        '_id': msg._id,\n        'urls.url': $(event.currentTarget).data('url')\n      }, {\n        $set: {\n          'urls.$.downloadImages': true\n        }\n      });\n      ChatMessage.update({\n        '_id': msg._id,\n        'attachments.image_url': $(event.currentTarget).data('url')\n      }, {\n        $set: {\n          'attachments.$.downloadImages': true\n        }\n      });\n    },\n    'click .user-card-message': function (e, instance) {\n      var _messageArgs5 = messageArgs(this),\n          msg = _messageArgs5.msg;\n\n      if (!Meteor.userId()) {\n        return;\n      }\n\n      var username = msg.u.username;\n\n      if (username) {\n        openUserCard({\n          username: username,\n          rid: instance.data.rid,\n          target: e.currentTarget,\n          open: function (e) {\n            e.preventDefault();\n            instance.data.tabBar.openUserInfo(username);\n          }\n        });\n      }\n    },\n    'click .js-actionButton-respondWithMessage': function (event, instance) {\n      var rid = instance.data.rid;\n      var msg = event.currentTarget.value;\n\n      if (!msg) {\n        return;\n      }\n\n      var input = chatMessages[rid].input;\n      input.value = msg;\n      input.focus();\n    },\n    'click .js-actionButton-respondWithQuotedMessage': function () {\n      function _callee(event, instance) {\n        var rid, msgId, $input, message, messages;\n        return _regeneratorRuntime.async(function () {\n          function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  rid = instance.data.rid;\n                  msgId = event.currentTarget.id;\n                  $input = chatMessages[rid].$input;\n\n                  if (msgId) {\n                    _context.next = 5;\n                    break;\n                  }\n\n                  return _context.abrupt(\"return\");\n\n                case 5:\n                  message = Messages.findOne({\n                    _id: msgId\n                  });\n                  messages = $input.data('reply') || [];\n                  messages = addMessageToList(messages, message);\n                  $input.focus().data('mention-user', false).data('reply', messages).trigger('dataChange');\n\n                case 9:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }\n\n          return _callee$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee;\n    }(),\n    'click .js-actionButton-sendMessage': function () {\n      function _callee2(event, instance) {\n        var rid, msg, msgObject, _chatMessages;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  rid = instance.data.rid;\n                  msg = event.currentTarget.value;\n                  msgObject = {\n                    _id: Random.id(),\n                    rid: rid,\n                    msg: msg\n                  };\n\n                  if (msg) {\n                    _context2.next = 5;\n                    break;\n                  }\n\n                  return _context2.abrupt(\"return\");\n\n                case 5:\n                  _context2.next = 7;\n                  return _regeneratorRuntime.awrap(onClientBeforeSendMessage(msgObject));\n\n                case 7:\n                  msgObject = _context2.sent;\n                  _chatMessages = chatMessages[rid];\n                  _context2.t0 = _chatMessages;\n\n                  if (!_context2.t0) {\n                    _context2.next = 14;\n                    break;\n                  }\n\n                  _context2.next = 13;\n                  return _regeneratorRuntime.awrap(_chatMessages.processSlashCommand(msgObject));\n\n                case 13:\n                  _context2.t0 = _context2.sent;\n\n                case 14:\n                  if (!_context2.t0) {\n                    _context2.next = 16;\n                    break;\n                  }\n\n                  return _context2.abrupt(\"return\");\n\n                case 16:\n                  _context2.next = 18;\n                  return _regeneratorRuntime.awrap(callWithErrorHandling('sendMessage', msgObject));\n\n                case 18:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }\n\n          return _callee2$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee2;\n    }(),\n    'click .message-actions__menu': function (e, template) {\n      var messageContext = messageArgs(this);\n      var message = messageContext.msg,\n          ctx = messageContext.context;\n      var context = ctx || message.context || message.actionContext || 'message';\n      var allItems = MessageAction.getButtons(messageContext, context, 'menu').map(function (item) {\n        return {\n          icon: item.icon,\n          name: t(item.label),\n          type: 'message-action',\n          id: item.id,\n          modifier: item.color\n        };\n      });\n      var itemsBelowDivider = ['delete-message', 'report-message'];\n\n      var _allItems$reduce = allItems.reduce(function (result, value) {\n        result[itemsBelowDivider.includes(value.id) ? 1 : 0].push(value);\n        return result;\n      }, [[], []]),\n          _allItems$reduce2 = _slicedToArray(_allItems$reduce, 2),\n          items = _allItems$reduce2[0],\n          alertsItem = _allItems$reduce2[1];\n\n      var groups = [{\n        items: items\n      }];\n\n      if (alertsItem.length) {\n        groups.push({\n          items: alertsItem\n        });\n      }\n\n      var config = {\n        columns: [{\n          groups: groups\n        }],\n        instance: template,\n        rid: template.data.rid,\n        data: this,\n        currentTarget: e.currentTarget,\n        activeElement: $(e.currentTarget).parents('.message')[0],\n        onRendered: function () {\n          return new Clipboard('.rc-popover__item');\n        }\n      };\n      popover.open(config);\n    },\n    'click .mention-link': function (e, instance) {\n      e.stopPropagation();\n      e.preventDefault();\n\n      if (!Meteor.userId()) {\n        return;\n      }\n\n      var _e$currentTarget$data = e.currentTarget.dataset,\n          channel = _e$currentTarget$data.channel,\n          group = _e$currentTarget$data.group,\n          username = _e$currentTarget$data.username;\n\n      if (channel) {\n        if (isLayoutEmbedded()) {\n          fireGlobalEvent('click-mention-link', {\n            path: FlowRouter.path('channel', {\n              name: channel\n            }),\n            channel: channel\n          });\n        }\n\n        goToRoomById(channel);\n        return;\n      }\n\n      if (group) {\n        return;\n      }\n\n      if (username) {\n        openUserCard({\n          username: username,\n          rid: instance.data.rid,\n          target: e.currentTarget,\n          open: function (e) {\n            e.preventDefault();\n            instance.data.tabBar.openUserInfo(username);\n          }\n        });\n      }\n    }\n  });\n};","map":{"version":3,"sources":["app/ui/client/views/app/lib/getCommonRoomEvents.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","_slicedToArray","export","getCommonRoomEvents","Clipboard","Meteor","Random","FlowRouter","popover","MessageAction","addMessageToList","callWithErrorHandling","isURL","openUserCard","messageArgs","ChatMessage","Rooms","Messages","t","chatMessages","EmojiEvents","goToRoomById","fireGlobalEvent","isLayoutEmbedded","onClientBeforeSendMessage","mountPopover","e","i","outerContext","context","$","target","parents","data","messageContext","menuItems","getButtons","map","item","icon","name","label","type","id","modifier","color","window","matchMedia","matches","messageItems","concat","reduce","result","value","push","items","deleteItem","groups","length","config","columns","instance","currentTarget","activeElement","onRendered","open","touchMoved","lastTouchX","lastTouchY","touchtime","clearTimeout","preventDefault","stopPropagation","touches","originalEvent","pageX","pagey","hasClass","nodeName","getAttribute","doLongTouch","setTimeout","href","deltaX","Math","abs","deltaY","pageY","event","template","button","getButtonById","dataset","messageAction","action","undefined","call","tabBar","rid","msg","mid","_id","tmid","room","findOne","go","getRouteName","tab","jump","update","$set","userId","username","u","openUserInfo","input","focus","msgId","$input","message","messages","trigger","msgObject","_chatMessages","processSlashCommand","ctx","actionContext","allItems","itemsBelowDivider","includes","alertsItem","channel","group","path"],"mappings":"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","sourcesContent":["import Clipboard from 'clipboard';\nimport { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\n\nimport { popover, MessageAction } from '../../../../../ui-utils/client';\nimport { addMessageToList } from '../../../../../ui-utils/client/lib/MessageAction';\nimport { callWithErrorHandling } from '../../../../../../client/lib/utils/callWithErrorHandling';\nimport { isURL } from '../../../../../utils/lib/isURL';\nimport { openUserCard } from '../../../lib/UserCard';\nimport { messageArgs } from '../../../../../ui-utils/client/lib/messageArgs';\nimport { ChatMessage, Rooms, Messages } from '../../../../../models';\nimport { t } from '../../../../../utils/client';\nimport { chatMessages } from '../room';\nimport { EmojiEvents } from '../../../../../reactions/client/init';\nimport { goToRoomById } from '../../../../../../client/lib/utils/goToRoomById';\nimport { fireGlobalEvent } from '../../../../../../client/lib/utils/fireGlobalEvent';\nimport { isLayoutEmbedded } from '../../../../../../client/lib/utils/isLayoutEmbedded';\nimport { onClientBeforeSendMessage } from '../../../../../../client/lib/onClientBeforeSendMessage';\n\nconst mountPopover = (e, i, outerContext) => {\n\tlet context = $(e.target).parents('.message').data('context');\n\tif (!context) {\n\t\tcontext = 'message';\n\t}\n\n\tconst messageContext = messageArgs(outerContext);\n\n\tlet menuItems = MessageAction.getButtons(messageContext, context, 'menu').map((item) => ({\n\t\ticon: item.icon,\n\t\tname: t(item.label),\n\t\ttype: 'message-action',\n\t\tid: item.id,\n\t\tmodifier: item.color,\n\t}));\n\n\tif (window.matchMedia('(max-width: 500px)').matches) {\n\t\tconst messageItems = MessageAction.getButtons(messageContext, context, 'message').map((item) => ({\n\t\t\ticon: item.icon,\n\t\t\tname: t(item.label),\n\t\t\ttype: 'message-action',\n\t\t\tid: item.id,\n\t\t\tmodifier: item.color,\n\t\t}));\n\n\t\tmenuItems = menuItems.concat(messageItems);\n\t}\n\n\tconst [items, deleteItem] = menuItems.reduce(\n\t\t(result, value) => {\n\t\t\tresult[value.id === 'delete-message' ? 1 : 0].push(value);\n\t\t\treturn result;\n\t\t},\n\t\t[[], []],\n\t);\n\tconst groups = [{ items }];\n\n\tif (deleteItem.length) {\n\t\tgroups.push({ items: deleteItem });\n\t}\n\n\tconst config = {\n\t\tcolumns: [\n\t\t\t{\n\t\t\t\tgroups,\n\t\t\t},\n\t\t],\n\t\tinstance: i,\n\t\tcurrentTarget: e.currentTarget,\n\t\tdata: outerContext,\n\t\tactiveElement: $(e.currentTarget).parents('.message')[0],\n\t\tonRendered: () => new Clipboard('.rc-popover__item'),\n\t};\n\n\tpopover.open(config);\n};\n\nexport const getCommonRoomEvents = () => ({\n\t...(() => {\n\t\tlet touchMoved = false;\n\t\tlet lastTouchX = null;\n\t\tlet lastTouchY = null;\n\n\t\tlet touchtime = null;\n\t\treturn {\n\t\t\t...EmojiEvents,\n\t\t\t'click .message img'(e) {\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t\tif (touchMoved === true) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t'touchstart .message'(e) {\n\t\t\t\tconst { touches } = e.originalEvent;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\tlastTouchX = touches[0].pageX;\n\t\t\t\t\tlastTouchY = touches[0].pagey;\n\t\t\t\t}\n\t\t\t\ttouchMoved = false;\n\t\t\t\tif (e.originalEvent.touches.length !== 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ($(e.currentTarget).hasClass('system')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.target && e.target.nodeName === 'AUDIO') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.target && e.target.nodeName === 'A' && isURL(e.target.getAttribute('href'))) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\n\t\t\t\tconst doLongTouch = () => {\n\t\t\t\t\tmountPopover(e, t, this);\n\t\t\t\t};\n\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t\ttouchtime = setTimeout(doLongTouch, 500);\n\t\t\t},\n\n\t\t\t'touchend .message'(e) {\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t\tif (e.target && e.target.nodeName === 'A' && isURL(e.target.getAttribute('href'))) {\n\t\t\t\t\tif (touchMoved === true) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.open(e.target.href);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t'touchmove .message'(e) {\n\t\t\t\tconst { touches } = e.originalEvent;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\tconst deltaX = Math.abs(lastTouchX - touches[0].pageX);\n\t\t\t\t\tconst deltaY = Math.abs(lastTouchY - touches[0].pageY);\n\t\t\t\t\tif (deltaX > 5 || deltaY > 5) {\n\t\t\t\t\t\ttouchMoved = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t},\n\n\t\t\t'touchcancel .message'() {\n\t\t\t\tclearTimeout(touchtime);\n\t\t\t},\n\t\t};\n\t})(),\n\t'click [data-message-action]'(event, template) {\n\t\tconst button = MessageAction.getButtonById(event.currentTarget.dataset.messageAction);\n\t\tif ((button != null ? button.action : undefined) != null) {\n\t\t\tbutton.action.call(this, event, { tabBar: template.tabBar, rid: template.data.rid });\n\t\t}\n\t},\n\t'click .js-follow-thread'(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tconst { msg } = messageArgs(this);\n\t\tcallWithErrorHandling('followMessage', { mid: msg._id });\n\t},\n\t'click .js-unfollow-thread'(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tconst { msg } = messageArgs(this);\n\t\tcallWithErrorHandling('unfollowMessage', { mid: msg._id });\n\t},\n\t'click .js-open-thread'(event) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst {\n\t\t\tmsg: { rid, _id, tmid },\n\t\t} = messageArgs(this);\n\t\tconst room = Rooms.findOne({ _id: rid });\n\n\t\tFlowRouter.go(\n\t\t\tFlowRouter.getRouteName(),\n\t\t\t{\n\t\t\t\trid,\n\t\t\t\tname: room.name,\n\t\t\t\ttab: 'thread',\n\t\t\t\tcontext: tmid || _id,\n\t\t\t},\n\t\t\t{\n\t\t\t\tjump: tmid && tmid !== _id && _id && _id,\n\t\t\t},\n\t\t);\n\t},\n\n\t'click .image-to-download'(event) {\n\t\tconst { msg } = messageArgs(this);\n\t\tChatMessage.update({ '_id': msg._id, 'urls.url': $(event.currentTarget).data('url') }, { $set: { 'urls.$.downloadImages': true } });\n\t\tChatMessage.update(\n\t\t\t{ '_id': msg._id, 'attachments.image_url': $(event.currentTarget).data('url') },\n\t\t\t{ $set: { 'attachments.$.downloadImages': true } },\n\t\t);\n\t},\n\t'click .user-card-message'(e, instance) {\n\t\tconst { msg } = messageArgs(this);\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { username } = msg.u;\n\n\t\tif (username) {\n\t\t\topenUserCard({\n\t\t\t\tusername,\n\t\t\t\trid: instance.data.rid,\n\t\t\t\ttarget: e.currentTarget,\n\t\t\t\topen: (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tinstance.data.tabBar.openUserInfo(username);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\t'click .js-actionButton-respondWithMessage'(event, instance) {\n\t\tconst { rid } = instance.data;\n\t\tconst msg = event.currentTarget.value;\n\t\tif (!msg) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { input } = chatMessages[rid];\n\t\tinput.value = msg;\n\t\tinput.focus();\n\t},\n\tasync 'click .js-actionButton-respondWithQuotedMessage'(event, instance) {\n\t\tconst { rid } = instance.data;\n\t\tconst { id: msgId } = event.currentTarget;\n\t\tconst { $input } = chatMessages[rid];\n\n\t\tif (!msgId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = Messages.findOne({ _id: msgId });\n\n\t\tlet messages = $input.data('reply') || [];\n\t\tmessages = addMessageToList(messages, message);\n\n\t\t$input.focus().data('mention-user', false).data('reply', messages).trigger('dataChange');\n\t},\n\tasync 'click .js-actionButton-sendMessage'(event, instance) {\n\t\tconst { rid } = instance.data;\n\t\tconst msg = event.currentTarget.value;\n\t\tlet msgObject = { _id: Random.id(), rid, msg };\n\t\tif (!msg) {\n\t\t\treturn;\n\t\t}\n\n\t\tmsgObject = await onClientBeforeSendMessage(msgObject);\n\n\t\tconst _chatMessages = chatMessages[rid];\n\t\tif (_chatMessages && (await _chatMessages.processSlashCommand(msgObject))) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait callWithErrorHandling('sendMessage', msgObject);\n\t},\n\t'click .message-actions__menu'(e, template) {\n\t\tconst messageContext = messageArgs(this);\n\t\tconst { msg: message, context: ctx } = messageContext;\n\t\tconst context = ctx || message.context || message.actionContext || 'message';\n\n\t\tconst allItems = MessageAction.getButtons(messageContext, context, 'menu').map((item) => ({\n\t\t\ticon: item.icon,\n\t\t\tname: t(item.label),\n\t\t\ttype: 'message-action',\n\t\t\tid: item.id,\n\t\t\tmodifier: item.color,\n\t\t}));\n\n\t\tconst itemsBelowDivider = ['delete-message', 'report-message'];\n\t\tconst [items, alertsItem] = allItems.reduce(\n\t\t\t(result, value) => {\n\t\t\t\tresult[itemsBelowDivider.includes(value.id) ? 1 : 0].push(value);\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\t[[], []],\n\t\t);\n\t\tconst groups = [{ items }];\n\n\t\tif (alertsItem.length) {\n\t\t\tgroups.push({ items: alertsItem });\n\t\t}\n\t\tconst config = {\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tgroups,\n\t\t\t\t},\n\t\t\t],\n\t\t\tinstance: template,\n\t\t\trid: template.data.rid,\n\t\t\tdata: this,\n\t\t\tcurrentTarget: e.currentTarget,\n\t\t\tactiveElement: $(e.currentTarget).parents('.message')[0],\n\t\t\tonRendered: () => new Clipboard('.rc-popover__item'),\n\t\t};\n\n\t\tpopover.open(config);\n\t},\n\t'click .mention-link'(e, instance) {\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tcurrentTarget: {\n\t\t\t\tdataset: { channel, group, username },\n\t\t\t},\n\t\t} = e;\n\n\t\tif (channel) {\n\t\t\tif (isLayoutEmbedded()) {\n\t\t\t\tfireGlobalEvent('click-mention-link', {\n\t\t\t\t\tpath: FlowRouter.path('channel', { name: channel }),\n\t\t\t\t\tchannel,\n\t\t\t\t});\n\t\t\t}\n\t\t\tgoToRoomById(channel);\n\t\t\treturn;\n\t\t}\n\n\t\tif (group) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (username) {\n\t\t\topenUserCard({\n\t\t\t\tusername,\n\t\t\t\trid: instance.data.rid,\n\t\t\t\ttarget: e.currentTarget,\n\t\t\t\topen: (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tinstance.data.tabBar.openUserInfo(username);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n});\n"]},"sourceType":"module","hash":"77f699ff949a58724e15226a042cc9b6d0586782"}
