{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 0);\nmodule.link(\"./contactChatHistoryMessages.html\");\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 1);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 2);\nvar messageContext;\nmodule.link(\"../../../../../ui-utils/client/lib/messageContext\", {\n  messageContext: function (v) {\n    messageContext = v;\n  }\n}, 3);\nvar APIClient;\nmodule.link(\"../../../../../utils/client\", {\n  APIClient: function (v) {\n    APIClient = v;\n  }\n}, 4);\nvar MESSAGES_LIMIT = 50;\nTemplate.contactChatHistoryMessages.helpers({\n  messages: function () {\n    return Template.instance().messages.get();\n  },\n  messageContext: function () {\n    var result = messageContext.call(this, {\n      rid: Template.instance().rid\n    });\n    return _objectSpread(_objectSpread({}, result), {}, {\n      settings: _objectSpread(_objectSpread({}, result.settings), {}, {\n        showReplyButton: false,\n        showreply: false,\n        hideRoles: true\n      })\n    });\n  },\n  hasMore: function () {\n    return Template.instance().hasMore.get();\n  },\n  isLoading: function () {\n    return Template.instance().isLoading.get();\n  },\n  isSearching: function () {\n    return Template.instance().searchTerm.get().length > 0;\n  },\n  empty: function () {\n    return Template.instance().messages.get().length === 0;\n  },\n  hasError: function () {\n    return Template.instance().hasError.get();\n  },\n  error: function () {\n    return Template.instance().error.get();\n  }\n});\nTemplate.contactChatHistoryMessages.events({\n  'click .js-back': function (e, instance) {\n    return instance.clear();\n  },\n  'scroll .js-list': _.throttle(function (e, instance) {\n    if (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight && instance.hasMore.get()) {\n      instance.offset.set(instance.offset.get() + instance.limit.get());\n    }\n  }, 200),\n  'keyup #message-search': _.debounce(function (e, instance) {\n    if (e.keyCode === 13) {\n      return e.preventDefault();\n    }\n\n    var value = e.target.value;\n\n    if (e.keyCode === 40 || e.keyCode === 38) {\n      return e.preventDefault();\n    }\n\n    instance.offset.set(0);\n    instance.searchTerm.set(value);\n  }, 300)\n});\nTemplate.contactChatHistoryMessages.onCreated(function () {\n  var _this = this;\n\n  var currentData = Template.currentData();\n  this.rid = currentData.rid;\n  this.messages = new ReactiveVar([]);\n  this.hasMore = new ReactiveVar(true);\n  this.offset = new ReactiveVar(0);\n  this.searchTerm = new ReactiveVar('');\n  this.isLoading = new ReactiveVar(true);\n  this.limit = new ReactiveVar(MESSAGES_LIMIT);\n  this.hasError = new ReactiveVar(false);\n  this.error = new ReactiveVar(null);\n\n  this.loadMessages = function () {\n    function _callee(url) {\n      var offset, _await$APIClient$v1$g, messages, total;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this.isLoading.set(true);\n\n                offset = _this.offset.get();\n                _context.prev = 2;\n                _context.next = 5;\n                return _regeneratorRuntime.awrap(APIClient.v1.get(url));\n\n              case 5:\n                _await$APIClient$v1$g = _context.sent;\n                messages = _await$APIClient$v1$g.messages;\n                total = _await$APIClient$v1$g.total;\n\n                _this.messages.set(offset === 0 ? messages : _this.messages.get().concat(messages));\n\n                _this.hasMore.set(total > _this.messages.get().length);\n\n                _context.next = 16;\n                break;\n\n              case 12:\n                _context.prev = 12;\n                _context.t0 = _context[\"catch\"](2);\n\n                _this.hasError.set(true);\n\n                _this.error.set(_context.t0);\n\n              case 16:\n                _context.prev = 16;\n\n                _this.isLoading.set(false);\n\n                return _context.finish(16);\n\n              case 19:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return _callee$;\n      }(), null, null, [[2, 12, 16, 19]], Promise);\n    }\n\n    return _callee;\n  }();\n\n  this.autorun(function () {\n    var limit = _this.limit.get();\n\n    var offset = _this.offset.get();\n\n    var searchTerm = _this.searchTerm.get();\n\n    if (searchTerm !== '') {\n      return _this.loadMessages(\"chat.search/?roomId=\" + _this.rid + \"&searchText=\" + searchTerm + \"&count=\" + limit + \"&offset=\" + offset + \"&sort={\\\"ts\\\": 1}\");\n    }\n\n    _this.loadMessages(\"livechat/\" + _this.rid + \"/messages?count=\" + limit + \"&offset=\" + offset + \"&sort={\\\"ts\\\": 1}\");\n  });\n  this.autorun(function () {\n    if (currentData.clear != null) {\n      _this.clear = currentData.clear;\n    }\n  });\n});","map":{"version":3,"sources":["app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","Template","ReactiveVar","_","messageContext","APIClient","MESSAGES_LIMIT","contactChatHistoryMessages","helpers","messages","instance","get","result","call","rid","settings","showReplyButton","showreply","hideRoles","hasMore","isLoading","isSearching","searchTerm","length","empty","hasError","error","events","e","clear","throttle","target","scrollTop","scrollHeight","clientHeight","offset","set","limit","debounce","keyCode","preventDefault","value","onCreated","currentData","loadMessages","url","v1","total","concat","autorun"],"mappings":"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","sourcesContent":["import { Template } from 'meteor/templating';\nimport './contactChatHistoryMessages.html';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport _ from 'underscore';\n\nimport { messageContext } from '../../../../../ui-utils/client/lib/messageContext';\nimport { APIClient } from '../../../../../utils/client';\n\nconst MESSAGES_LIMIT = 50;\n\nTemplate.contactChatHistoryMessages.helpers({\n\tmessages() {\n\t\treturn Template.instance().messages.get();\n\t},\n\tmessageContext() {\n\t\tconst result = messageContext.call(this, { rid: Template.instance().rid });\n\t\treturn {\n\t\t\t...result,\n\t\t\tsettings: {\n\t\t\t\t...result.settings,\n\t\t\t\tshowReplyButton: false,\n\t\t\t\tshowreply: false,\n\t\t\t\thideRoles: true,\n\t\t\t},\n\t\t};\n\t},\n\thasMore() {\n\t\treturn Template.instance().hasMore.get();\n\t},\n\tisLoading() {\n\t\treturn Template.instance().isLoading.get();\n\t},\n\tisSearching() {\n\t\treturn Template.instance().searchTerm.get().length > 0;\n\t},\n\tempty() {\n\t\treturn Template.instance().messages.get().length === 0;\n\t},\n\thasError() {\n\t\treturn Template.instance().hasError.get();\n\t},\n\terror() {\n\t\treturn Template.instance().error.get();\n\t},\n});\n\nTemplate.contactChatHistoryMessages.events({\n\t'click .js-back'(e, instance) {\n\t\treturn instance.clear();\n\t},\n\t'scroll .js-list': _.throttle(function (e, instance) {\n\t\tif (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight && instance.hasMore.get()) {\n\t\t\tinstance.offset.set(instance.offset.get() + instance.limit.get());\n\t\t}\n\t}, 200),\n\t'keyup #message-search': _.debounce(function (e, instance) {\n\t\tif (e.keyCode === 13) {\n\t\t\treturn e.preventDefault();\n\t\t}\n\n\t\tconst { value } = e.target;\n\n\t\tif (e.keyCode === 40 || e.keyCode === 38) {\n\t\t\treturn e.preventDefault();\n\t\t}\n\n\t\tinstance.offset.set(0);\n\t\tinstance.searchTerm.set(value);\n\t}, 300),\n});\n\nTemplate.contactChatHistoryMessages.onCreated(function () {\n\tconst currentData = Template.currentData();\n\tthis.rid = currentData.rid;\n\tthis.messages = new ReactiveVar([]);\n\tthis.hasMore = new ReactiveVar(true);\n\tthis.offset = new ReactiveVar(0);\n\tthis.searchTerm = new ReactiveVar('');\n\tthis.isLoading = new ReactiveVar(true);\n\tthis.limit = new ReactiveVar(MESSAGES_LIMIT);\n\tthis.hasError = new ReactiveVar(false);\n\tthis.error = new ReactiveVar(null);\n\n\tthis.loadMessages = async (url) => {\n\t\tthis.isLoading.set(true);\n\t\tconst offset = this.offset.get();\n\n\t\ttry {\n\t\t\tconst { messages, total } = await APIClient.v1.get(url);\n\t\t\tthis.messages.set(offset === 0 ? messages : this.messages.get().concat(messages));\n\t\t\tthis.hasMore.set(total > this.messages.get().length);\n\t\t} catch (e) {\n\t\t\tthis.hasError.set(true);\n\t\t\tthis.error.set(e);\n\t\t} finally {\n\t\t\tthis.isLoading.set(false);\n\t\t}\n\t};\n\n\tthis.autorun(() => {\n\t\tconst limit = this.limit.get();\n\t\tconst offset = this.offset.get();\n\t\tconst searchTerm = this.searchTerm.get();\n\n\t\tif (searchTerm !== '') {\n\t\t\treturn this.loadMessages(`chat.search/?roomId=${this.rid}&searchText=${searchTerm}&count=${limit}&offset=${offset}&sort={\"ts\": 1}`);\n\t\t}\n\n\t\tthis.loadMessages(`livechat/${this.rid}/messages?count=${limit}&offset=${offset}&sort={\"ts\": 1}`);\n\t});\n\n\tthis.autorun(() => {\n\t\tif (currentData.clear != null) {\n\t\t\tthis.clear = currentData.clear;\n\t\t}\n\t});\n});\n"]},"sourceType":"module","hash":"6bb67263e9cb8c2ffad93415ad1974e9cef769b6"}
