{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ConnectedModalBlock.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/blocks/ConnectedModalBlock.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ConnectedModalBlock.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/blocks/ConnectedModalBlock.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/blocks/ConnectedModalBlock.js"}},"code":"var _excluded = [\"type\"];\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\n\nvar _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default: function (v) {\n    _objectWithoutProperties = v;\n  }\n}, 1);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 2);\nvar UIKitIncomingInteractionContainerType;\nmodule.link(\"@rocket.chat/apps-engine/definition/uikit/UIKitIncomingInteractionContainer\", {\n  UIKitIncomingInteractionContainerType: function (v) {\n    UIKitIncomingInteractionContainerType = v;\n  }\n}, 0);\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 1);\nvar kitContext;\nmodule.link(\"@rocket.chat/fuselage-ui-kit\", {\n  kitContext: function (v) {\n    kitContext = v;\n  }\n}, 2);\nvar React, useEffect, useReducer, useState;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useReducer: function (v) {\n    useReducer = v;\n  },\n  useState: function (v) {\n    useState = v;\n  }\n}, 3);\nvar ActionManager;\nmodule.link(\"../../../app/ui-message/client/ActionManager\", {\n  \"*\": function (v) {\n    ActionManager = v;\n  }\n}, 4);\nvar ModalBlock;\nmodule.link(\"./ModalBlock\", {\n  \"default\": function (v) {\n    ModalBlock = v;\n  }\n}, 5);\nmodule.link(\"./textParsers\");\n\nvar useActionManagerState = function (initialState) {\n  var _useState = useState(initialState),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var viewId = state.viewId;\n  useEffect(function () {\n    var handleUpdate = function (_ref) {\n      var type = _ref.type,\n          data = _objectWithoutProperties(_ref, _excluded);\n\n      if (type === 'errors') {\n        var errors = data.errors;\n        setState(function (state) {\n          return _objectSpread(_objectSpread({}, state), {}, {\n            errors: errors\n          });\n        });\n        return;\n      }\n\n      setState(data);\n    };\n\n    ActionManager.on(viewId, handleUpdate);\n    return function () {\n      ActionManager.off(viewId, handleUpdate);\n    };\n  }, [viewId]);\n  return state;\n};\n\nvar useValues = function (view) {\n  var reducer = useMutableCallback(function (values, _ref2) {\n    var _objectSpread2;\n\n    var actionId = _ref2.actionId,\n        payload = _ref2.payload;\n    return _objectSpread(_objectSpread({}, values), {}, (_objectSpread2 = {}, _objectSpread2[actionId] = payload, _objectSpread2));\n  });\n  var initializer = useMutableCallback(function () {\n    var filterInputFields = function (_ref3) {\n      var element = _ref3.element,\n          _ref3$elements = _ref3.elements,\n          elements = _ref3$elements === void 0 ? [] : _ref3$elements;\n\n      if (element && element.initialValue) {\n        return true;\n      }\n\n      if (elements.length && elements.map(function (element) {\n        return {\n          element: element\n        };\n      }).filter(filterInputFields).length) {\n        return true;\n      }\n    };\n\n    var mapElementToState = function (_ref4) {\n      var element = _ref4.element,\n          blockId = _ref4.blockId,\n          _ref4$elements = _ref4.elements,\n          elements = _ref4$elements === void 0 ? [] : _ref4$elements;\n\n      if (elements.length) {\n        return elements.map(function (element) {\n          return {\n            element: element,\n            blockId: blockId\n          };\n        }).filter(filterInputFields).map(mapElementToState);\n      }\n\n      return [element.actionId, {\n        value: element.initialValue,\n        blockId: blockId\n      }];\n    };\n\n    return view.blocks.filter(filterInputFields).map(mapElementToState).reduce(function (obj, el) {\n      var _objectSpread3;\n\n      if (Array.isArray(el[0])) {\n        return _objectSpread(_objectSpread({}, obj), Object.fromEntries(el));\n      }\n\n      var _el = _slicedToArray(el, 2),\n          key = _el[0],\n          value = _el[1];\n\n      return _objectSpread(_objectSpread({}, obj), {}, (_objectSpread3 = {}, _objectSpread3[key] = value, _objectSpread3));\n    }, {});\n  });\n  return useReducer(reducer, null, initializer);\n};\n\nfunction ConnectedModalBlock(props) {\n  var state = useActionManagerState(props);\n  var appId = state.appId,\n      viewId = state.viewId,\n      _mid = state.mid,\n      errors = state.errors,\n      view = state.view;\n\n  var _useValues = useValues(view),\n      _useValues2 = _slicedToArray(_useValues, 2),\n      values = _useValues2[0],\n      updateValues = _useValues2[1];\n\n  var groupStateByBlockId = function (obj) {\n    return Object.entries(obj).reduce(function (obj, _ref5) {\n      var _ref6 = _slicedToArray(_ref5, 2),\n          key = _ref6[0],\n          _ref6$ = _ref6[1],\n          blockId = _ref6$.blockId,\n          value = _ref6$.value;\n\n      obj[blockId] = obj[blockId] || {};\n      obj[blockId][key] = value;\n      return obj;\n    }, {});\n  };\n\n  var prevent = function (e) {\n    if (e) {\n      (e.nativeEvent || e).stopImmediatePropagation();\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  };\n\n  var context = _objectSpread(_objectSpread({\n    action: function (_ref7) {\n      var actionId = _ref7.actionId,\n          appId = _ref7.appId,\n          value = _ref7.value,\n          blockId = _ref7.blockId,\n          _ref7$mid = _ref7.mid,\n          mid = _ref7$mid === void 0 ? _mid : _ref7$mid;\n      return ActionManager.triggerBlockAction({\n        container: {\n          type: UIKitIncomingInteractionContainerType.VIEW,\n          id: viewId\n        },\n        actionId: actionId,\n        appId: appId,\n        value: value,\n        blockId: blockId,\n        mid: mid\n      });\n    },\n    state: function (_ref8) {\n      var actionId = _ref8.actionId,\n          value = _ref8.value,\n          _ref8$blockId = _ref8.blockId,\n          blockId = _ref8$blockId === void 0 ? 'default' : _ref8$blockId;\n      updateValues({\n        actionId: actionId,\n        payload: {\n          blockId: blockId,\n          value: value\n        }\n      });\n    }\n  }, state), {}, {\n    values: values\n  });\n\n  var handleSubmit = useMutableCallback(function (e) {\n    prevent(e);\n    ActionManager.triggerSubmitView({\n      viewId: viewId,\n      appId: appId,\n      payload: {\n        view: _objectSpread(_objectSpread({}, view), {}, {\n          id: viewId,\n          state: groupStateByBlockId(values)\n        })\n      }\n    });\n  });\n  var handleCancel = useMutableCallback(function (e) {\n    prevent(e);\n    return ActionManager.triggerCancel({\n      appId: appId,\n      viewId: viewId,\n      view: _objectSpread(_objectSpread({}, view), {}, {\n        id: viewId,\n        state: groupStateByBlockId(values)\n      })\n    });\n  });\n  var handleClose = useMutableCallback(function (e) {\n    prevent(e);\n    return ActionManager.triggerCancel({\n      appId: appId,\n      viewId: viewId,\n      view: _objectSpread(_objectSpread({}, view), {}, {\n        id: viewId,\n        state: groupStateByBlockId(values)\n      }),\n      isCleared: true\n    });\n  });\n  return /*#__PURE__*/React.createElement(kitContext.Provider, {\n    value: context\n  }, /*#__PURE__*/React.createElement(ModalBlock, {\n    view: view,\n    errors: errors,\n    appId: appId,\n    onSubmit: handleSubmit,\n    onCancel: handleCancel,\n    onClose: handleClose\n  }));\n}\n\nmodule.exportDefault(ConnectedModalBlock);","map":{"version":3,"sources":["client/views/blocks/ConnectedModalBlock.js"],"names":["_objectSpread","module","link","default","v","_objectWithoutProperties","_slicedToArray","UIKitIncomingInteractionContainerType","useMutableCallback","kitContext","React","useEffect","useReducer","useState","ActionManager","ModalBlock","useActionManagerState","initialState","state","setState","viewId","handleUpdate","type","data","errors","on","off","useValues","view","reducer","values","actionId","payload","initializer","filterInputFields","element","elements","initialValue","length","map","filter","mapElementToState","blockId","value","blocks","reduce","obj","el","Array","isArray","Object","fromEntries","key","ConnectedModalBlock","props","appId","_mid","mid","updateValues","groupStateByBlockId","entries","prevent","e","nativeEvent","stopImmediatePropagation","stopPropagation","preventDefault","context","action","triggerBlockAction","container","VIEW","id","handleSubmit","triggerSubmitView","handleCancel","triggerCancel","handleClose","isCleared","exportDefault"],"mappings":"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","sourcesContent":["import { UIKitIncomingInteractionContainerType } from '@rocket.chat/apps-engine/definition/uikit/UIKitIncomingInteractionContainer';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { kitContext } from '@rocket.chat/fuselage-ui-kit';\nimport React, { useEffect, useReducer, useState } from 'react';\n\nimport * as ActionManager from '../../../app/ui-message/client/ActionManager';\nimport ModalBlock from './ModalBlock';\nimport './textParsers';\n\nconst useActionManagerState = (initialState) => {\n\tconst [state, setState] = useState(initialState);\n\n\tconst { viewId } = state;\n\n\tuseEffect(() => {\n\t\tconst handleUpdate = ({ type, ...data }) => {\n\t\t\tif (type === 'errors') {\n\t\t\t\tconst { errors } = data;\n\t\t\t\tsetState((state) => ({ ...state, errors }));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetState(data);\n\t\t};\n\n\t\tActionManager.on(viewId, handleUpdate);\n\n\t\treturn () => {\n\t\t\tActionManager.off(viewId, handleUpdate);\n\t\t};\n\t}, [viewId]);\n\n\treturn state;\n};\n\nconst useValues = (view) => {\n\tconst reducer = useMutableCallback((values, { actionId, payload }) => ({\n\t\t...values,\n\t\t[actionId]: payload,\n\t}));\n\n\tconst initializer = useMutableCallback(() => {\n\t\tconst filterInputFields = ({ element, elements = [] }) => {\n\t\t\tif (element && element.initialValue) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (elements.length && elements.map((element) => ({ element })).filter(filterInputFields).length) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t};\n\n\t\tconst mapElementToState = ({ element, blockId, elements = [] }) => {\n\t\t\tif (elements.length) {\n\t\t\t\treturn elements\n\t\t\t\t\t.map((element) => ({ element, blockId }))\n\t\t\t\t\t.filter(filterInputFields)\n\t\t\t\t\t.map(mapElementToState);\n\t\t\t}\n\t\t\treturn [element.actionId, { value: element.initialValue, blockId }];\n\t\t};\n\n\t\treturn view.blocks\n\t\t\t.filter(filterInputFields)\n\t\t\t.map(mapElementToState)\n\t\t\t.reduce((obj, el) => {\n\t\t\t\tif (Array.isArray(el[0])) {\n\t\t\t\t\treturn { ...obj, ...Object.fromEntries(el) };\n\t\t\t\t}\n\n\t\t\t\tconst [key, value] = el;\n\t\t\t\treturn { ...obj, [key]: value };\n\t\t\t}, {});\n\t});\n\n\treturn useReducer(reducer, null, initializer);\n};\n\nfunction ConnectedModalBlock(props) {\n\tconst state = useActionManagerState(props);\n\n\tconst { appId, viewId, mid: _mid, errors, view } = state;\n\n\tconst [values, updateValues] = useValues(view);\n\n\tconst groupStateByBlockId = (obj) =>\n\t\tObject.entries(obj).reduce((obj, [key, { blockId, value }]) => {\n\t\t\tobj[blockId] = obj[blockId] || {};\n\t\t\tobj[blockId][key] = value;\n\t\t\treturn obj;\n\t\t}, {});\n\n\tconst prevent = (e) => {\n\t\tif (e) {\n\t\t\t(e.nativeEvent || e).stopImmediatePropagation();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\tconst context = {\n\t\taction: ({ actionId, appId, value, blockId, mid = _mid }) =>\n\t\t\tActionManager.triggerBlockAction({\n\t\t\t\tcontainer: {\n\t\t\t\t\ttype: UIKitIncomingInteractionContainerType.VIEW,\n\t\t\t\t\tid: viewId,\n\t\t\t\t},\n\t\t\t\tactionId,\n\t\t\t\tappId,\n\t\t\t\tvalue,\n\t\t\t\tblockId,\n\t\t\t\tmid,\n\t\t\t}),\n\t\tstate: ({ actionId, value, /* ,appId, */ blockId = 'default' }) => {\n\t\t\tupdateValues({\n\t\t\t\tactionId,\n\t\t\t\tpayload: {\n\t\t\t\t\tblockId,\n\t\t\t\t\tvalue,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t...state,\n\t\tvalues,\n\t};\n\n\tconst handleSubmit = useMutableCallback((e) => {\n\t\tprevent(e);\n\t\tActionManager.triggerSubmitView({\n\t\t\tviewId,\n\t\t\tappId,\n\t\t\tpayload: {\n\t\t\t\tview: {\n\t\t\t\t\t...view,\n\t\t\t\t\tid: viewId,\n\t\t\t\t\tstate: groupStateByBlockId(values),\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t});\n\n\tconst handleCancel = useMutableCallback((e) => {\n\t\tprevent(e);\n\t\treturn ActionManager.triggerCancel({\n\t\t\tappId,\n\t\t\tviewId,\n\t\t\tview: {\n\t\t\t\t...view,\n\t\t\t\tid: viewId,\n\t\t\t\tstate: groupStateByBlockId(values),\n\t\t\t},\n\t\t});\n\t});\n\n\tconst handleClose = useMutableCallback((e) => {\n\t\tprevent(e);\n\t\treturn ActionManager.triggerCancel({\n\t\t\tappId,\n\t\t\tviewId,\n\t\t\tview: {\n\t\t\t\t...view,\n\t\t\t\tid: viewId,\n\t\t\t\tstate: groupStateByBlockId(values),\n\t\t\t},\n\t\t\tisCleared: true,\n\t\t});\n\t});\n\n\treturn (\n\t\t<kitContext.Provider value={context}>\n\t\t\t<ModalBlock view={view} errors={errors} appId={appId} onSubmit={handleSubmit} onCancel={handleCancel} onClose={handleClose} />\n\t\t</kitContext.Provider>\n\t);\n}\n\nexport default ConnectedModalBlock;\n"]},"sourceType":"module","hash":"47c1509b1d468270d0f017d84c5e0a319d2979a6"}
