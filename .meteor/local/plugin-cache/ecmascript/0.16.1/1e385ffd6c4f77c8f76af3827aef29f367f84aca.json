{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/hooks/useFileInput.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/hooks/useFileInput.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/hooks/useFileInput.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/hooks/useFileInput.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/hooks/useFileInput.js"}},"code":"module.export({\n  useFileInput: () => useFileInput\n});\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n\n}, 0);\nlet useRef, useEffect;\nmodule.link(\"react\", {\n  useRef(v) {\n    useRef = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  }\n\n}, 1);\n\nconst useFileInput = function (onSetFile) {\n  let fileType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'image/*';\n  let fileField = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'image';\n  const ref = useRef();\n  useEffect(() => {\n    const fileInput = document.createElement('input');\n    fileInput.setAttribute('type', 'file');\n    fileInput.setAttribute('style', 'display: none');\n    document.body.appendChild(fileInput);\n    ref.current = fileInput;\n    return () => {\n      ref.current = null;\n      fileInput.remove();\n    };\n  }, []);\n  useEffect(() => {\n    const fileInput = ref.current;\n\n    if (!fileInput) {\n      return;\n    }\n\n    fileInput.setAttribute('accept', fileType);\n  }, [fileType]);\n  useEffect(() => {\n    const fileInput = ref.current;\n\n    if (!fileInput) {\n      return;\n    }\n\n    const handleFiles = () => {\n      const formData = new FormData();\n      formData.append(fileField, fileInput.files[0]);\n      onSetFile(fileInput.files[0], formData);\n    };\n\n    fileInput.addEventListener('change', handleFiles, false);\n    return () => {\n      fileInput.removeEventListener('change', handleFiles, false);\n    };\n  }, [fileField, fileType, onSetFile]);\n  const onClick = useMutableCallback(() => ref.current.click());\n  const reset = useMutableCallback(() => {\n    ref.current.value = '';\n  });\n  return [onClick, reset];\n};","map":{"version":3,"sources":["client/hooks/useFileInput.js"],"names":["module","export","useFileInput","useMutableCallback","link","v","useRef","useEffect","onSetFile","fileType","fileField","ref","fileInput","document","createElement","setAttribute","body","appendChild","current","remove","handleFiles","formData","FormData","append","files","addEventListener","removeEventListener","onClick","click","reset","value"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,YAAY,EAAC,MAAIA;AAAlB,CAAd;AAA+C,IAAIC,kBAAJ;AAAuBH,MAAM,CAACI,IAAP,CAAY,6BAAZ,EAA0C;AAACD,EAAAA,kBAAkB,CAACE,CAAD,EAAG;AAACF,IAAAA,kBAAkB,GAACE,CAAnB;AAAqB;;AAA5C,CAA1C,EAAwF,CAAxF;AAA2F,IAAIC,MAAJ,EAAWC,SAAX;AAAqBP,MAAM,CAACI,IAAP,CAAY,OAAZ,EAAoB;AAACE,EAAAA,MAAM,CAACD,CAAD,EAAG;AAACC,IAAAA,MAAM,GAACD,CAAP;AAAS,GAApB;;AAAqBE,EAAAA,SAAS,CAACF,CAAD,EAAG;AAACE,IAAAA,SAAS,GAACF,CAAV;AAAY;;AAA9C,CAApB,EAAoE,CAApE;;AAG/K,MAAMH,YAAY,GAAG,UAACM,SAAD,EAA0D;AAAA,MAA9CC,QAA8C,uEAAnC,SAAmC;AAAA,MAAxBC,SAAwB,uEAAZ,OAAY;AACrF,QAAMC,GAAG,GAAGL,MAAM,EAAlB;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACf,UAAMK,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAlB;AACAF,IAAAA,SAAS,CAACG,YAAV,CAAuB,MAAvB,EAA+B,MAA/B;AACAH,IAAAA,SAAS,CAACG,YAAV,CAAuB,OAAvB,EAAgC,eAAhC;AACAF,IAAAA,QAAQ,CAACG,IAAT,CAAcC,WAAd,CAA0BL,SAA1B;AACAD,IAAAA,GAAG,CAACO,OAAJ,GAAcN,SAAd;AAEA,WAAO,MAAM;AACZD,MAAAA,GAAG,CAACO,OAAJ,GAAc,IAAd;AACAN,MAAAA,SAAS,CAACO,MAAV;AACA,KAHD;AAIA,GAXQ,EAWN,EAXM,CAAT;AAaAZ,EAAAA,SAAS,CAAC,MAAM;AACf,UAAMK,SAAS,GAAGD,GAAG,CAACO,OAAtB;;AACA,QAAI,CAACN,SAAL,EAAgB;AACf;AACA;;AAEDA,IAAAA,SAAS,CAACG,YAAV,CAAuB,QAAvB,EAAiCN,QAAjC;AACA,GAPQ,EAON,CAACA,QAAD,CAPM,CAAT;AASAF,EAAAA,SAAS,CAAC,MAAM;AACf,UAAMK,SAAS,GAAGD,GAAG,CAACO,OAAtB;;AACA,QAAI,CAACN,SAAL,EAAgB;AACf;AACA;;AAED,UAAMQ,WAAW,GAAG,MAAM;AACzB,YAAMC,QAAQ,GAAG,IAAIC,QAAJ,EAAjB;AACAD,MAAAA,QAAQ,CAACE,MAAT,CAAgBb,SAAhB,EAA2BE,SAAS,CAACY,KAAV,CAAgB,CAAhB,CAA3B;AACAhB,MAAAA,SAAS,CAACI,SAAS,CAACY,KAAV,CAAgB,CAAhB,CAAD,EAAqBH,QAArB,CAAT;AACA,KAJD;;AAMAT,IAAAA,SAAS,CAACa,gBAAV,CAA2B,QAA3B,EAAqCL,WAArC,EAAkD,KAAlD;AAEA,WAAO,MAAM;AACZR,MAAAA,SAAS,CAACc,mBAAV,CAA8B,QAA9B,EAAwCN,WAAxC,EAAqD,KAArD;AACA,KAFD;AAGA,GAjBQ,EAiBN,CAACV,SAAD,EAAYD,QAAZ,EAAsBD,SAAtB,CAjBM,CAAT;AAmBA,QAAMmB,OAAO,GAAGxB,kBAAkB,CAAC,MAAMQ,GAAG,CAACO,OAAJ,CAAYU,KAAZ,EAAP,CAAlC;AACA,QAAMC,KAAK,GAAG1B,kBAAkB,CAAC,MAAM;AACtCQ,IAAAA,GAAG,CAACO,OAAJ,CAAYY,KAAZ,GAAoB,EAApB;AACA,GAF+B,CAAhC;AAGA,SAAO,CAACH,OAAD,EAAUE,KAAV,CAAP;AACA,CAjDM","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useRef, useEffect } from 'react';\n\nexport const useFileInput = (onSetFile, fileType = 'image/*', fileField = 'image') => {\n\tconst ref = useRef();\n\n\tuseEffect(() => {\n\t\tconst fileInput = document.createElement('input');\n\t\tfileInput.setAttribute('type', 'file');\n\t\tfileInput.setAttribute('style', 'display: none');\n\t\tdocument.body.appendChild(fileInput);\n\t\tref.current = fileInput;\n\n\t\treturn () => {\n\t\t\tref.current = null;\n\t\t\tfileInput.remove();\n\t\t};\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconst fileInput = ref.current;\n\t\tif (!fileInput) {\n\t\t\treturn;\n\t\t}\n\n\t\tfileInput.setAttribute('accept', fileType);\n\t}, [fileType]);\n\n\tuseEffect(() => {\n\t\tconst fileInput = ref.current;\n\t\tif (!fileInput) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleFiles = () => {\n\t\t\tconst formData = new FormData();\n\t\t\tformData.append(fileField, fileInput.files[0]);\n\t\t\tonSetFile(fileInput.files[0], formData);\n\t\t};\n\n\t\tfileInput.addEventListener('change', handleFiles, false);\n\n\t\treturn () => {\n\t\t\tfileInput.removeEventListener('change', handleFiles, false);\n\t\t};\n\t}, [fileField, fileType, onSetFile]);\n\n\tconst onClick = useMutableCallback(() => ref.current.click());\n\tconst reset = useMutableCallback(() => {\n\t\tref.current.value = '';\n\t});\n\treturn [onClick, reset];\n};\n"]},"sourceType":"module","hash":"1e385ffd6c4f77c8f76af3827aef29f367f84aca"}
