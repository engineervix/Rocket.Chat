{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/messageContext.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-utils/client/lib/messageContext.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/messageContext.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/messageContext.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-utils/client/lib/messageContext.js"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nmodule.export({\n  messageContext: () => messageContext\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 1);\nlet FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter(v) {\n    FlowRouter = v;\n  }\n\n}, 2);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 3);\nlet Subscriptions, Rooms, Users;\nmodule.link(\"../../../models/client\", {\n  Subscriptions(v) {\n    Subscriptions = v;\n  },\n\n  Rooms(v) {\n    Rooms = v;\n  },\n\n  Users(v) {\n    Users = v;\n  }\n\n}, 4);\nlet hasPermission;\nmodule.link(\"../../../authorization/client\", {\n  hasPermission(v) {\n    hasPermission = v;\n  }\n\n}, 5);\nlet settings;\nmodule.link(\"../../../settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 6);\nlet getUserPreference;\nmodule.link(\"../../../utils/client\", {\n  getUserPreference(v) {\n    getUserPreference = v;\n  }\n\n}, 7);\nlet AutoTranslate;\nmodule.link(\"../../../autotranslate/client\", {\n  AutoTranslate(v) {\n    AutoTranslate = v;\n  }\n\n}, 8);\nlet fireGlobalEvent;\nmodule.link(\"../../../../client/lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent(v) {\n    fireGlobalEvent = v;\n  }\n\n}, 9);\nlet actionLinks;\nmodule.link(\"../../../action-links/client\", {\n  actionLinks(v) {\n    actionLinks = v;\n  }\n\n}, 10);\nlet goToRoomById;\nmodule.link(\"../../../../client/lib/utils/goToRoomById\", {\n  goToRoomById(v) {\n    goToRoomById = v;\n  }\n\n}, 11);\nlet isLayoutEmbedded;\nmodule.link(\"../../../../client/lib/utils/isLayoutEmbedded\", {\n  isLayoutEmbedded(v) {\n    isLayoutEmbedded = v;\n  }\n\n}, 12);\nlet handleError;\nmodule.link(\"../../../../client/lib/utils/handleError\", {\n  handleError(v) {\n    handleError = v;\n  }\n\n}, 13);\nlet roomCoordinator;\nmodule.link(\"../../../../client/lib/rooms/roomCoordinator\", {\n  roomCoordinator(v) {\n    roomCoordinator = v;\n  }\n\n}, 14);\nconst fields = {\n  'name': 1,\n  'username': 1,\n  'settings.preferences.enableMessageParserEarlyAdoption': 1,\n  'settings.preferences.showMessageInMainThread': 1,\n  'settings.preferences.autoImageLoad': 1,\n  'settings.preferences.saveMobileBandwidth': 1,\n  'settings.preferences.collapseMediaByDefault': 1,\n  'settings.preferences.hideRoles': 1\n};\n\nfunction messageContext() {\n  let {\n    rid\n  } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Template.instance();\n  const uid = Meteor.userId();\n  const user = Users.findOne({\n    _id: uid\n  }, {\n    fields\n  }) || {};\n  const instance = Template.instance();\n\n  const openThread = e => {\n    const {\n      rid,\n      mid,\n      tmid\n    } = e.currentTarget.dataset;\n    const room = Rooms.findOne({\n      _id: rid\n    });\n    FlowRouter.go(FlowRouter.getRouteName(), {\n      rid,\n      name: room.name,\n      tab: 'thread',\n      context: tmid || mid\n    }, {\n      jump: tmid && tmid !== mid && mid && mid\n    });\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const runAction = isLayoutEmbedded() ? (msg, e) => {\n    const {\n      actionlink\n    } = e.currentTarget.dataset;\n    return fireGlobalEvent('click-action-link', {\n      actionlink,\n      value: msg._id,\n      message: msg\n    });\n  } : (msg, e) => {\n    const {\n      actionlink\n    } = e.currentTarget.dataset;\n    actionLinks.run(actionlink, msg._id, instance, err => {\n      if (err) {\n        handleError(err);\n      }\n    });\n  };\n\n  const openDiscussion = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    const {\n      drid\n    } = e.currentTarget.dataset;\n    goToRoomById(drid);\n  };\n\n  const replyBroadcast = e => {\n    const {\n      username,\n      mid\n    } = e.currentTarget.dataset;\n    roomCoordinator.openRouteLink('d', {\n      name: username\n    }, _objectSpread(_objectSpread({}, FlowRouter.current().queryParams), {}, {\n      reply: mid\n    }));\n  };\n\n  return {\n    u: user,\n    room: Tracker.nonreactive(() => Rooms.findOne({\n      _id: rid\n    }, {\n      fields: {\n        _updatedAt: 0,\n        lastMessage: 0\n      }\n    })),\n    subscription: Subscriptions.findOne({\n      rid\n    }, {\n      fields: {\n        name: 1,\n        autoTranslate: 1,\n        rid: 1,\n        tunread: 1,\n        tunreadUser: 1,\n        tunreadGroup: 1\n      }\n    }),\n    actions: {\n      openThread() {\n        return openThread;\n      },\n\n      runAction(msg) {\n        return () => e => {\n          e.preventDefault();\n          e.stopPropagation();\n          runAction(msg, e);\n        };\n      },\n\n      openDiscussion() {\n        return openDiscussion;\n      },\n\n      replyBroadcast() {\n        return replyBroadcast;\n      }\n\n    },\n    settings: {\n      translateLanguage: AutoTranslate.getLanguage(rid),\n      showMessageInMainThread: getUserPreference(user, 'showMessageInMainThread'),\n      autoImageLoad: getUserPreference(user, 'autoImageLoad'),\n      enableMessageParserEarlyAdoption: getUserPreference(user, 'enableMessageParserEarlyAdoption'),\n      saveMobileBandwidth: Meteor.Device.isPhone() && getUserPreference(user, 'saveMobileBandwidth'),\n      collapseMediaByDefault: getUserPreference(user, 'collapseMediaByDefault'),\n      showreply: true,\n      showReplyButton: true,\n      hasPermissionDeleteMessage: hasPermission('delete-message', rid),\n      hasPermissionDeleteOwnMessage: hasPermission('delete-own-message'),\n      hideRoles: !settings.get('UI_DisplayRoles') || getUserPreference(user, 'hideRoles'),\n      UI_Use_Real_Name: settings.get('UI_Use_Real_Name'),\n      Chatops_Username: settings.get('Chatops_Username'),\n      AutoTranslate_Enabled: settings.get('AutoTranslate_Enabled'),\n      Message_AllowEditing: settings.get('Message_AllowEditing'),\n      Message_AllowEditing_BlockEditInMinutes: settings.get('Message_AllowEditing_BlockEditInMinutes'),\n      Message_ShowEditedStatus: settings.get('Message_ShowEditedStatus'),\n      API_Embed: settings.get('API_Embed'),\n      API_EmbedDisabledFor: settings.get('API_EmbedDisabledFor'),\n      Message_GroupingPeriod: settings.get('Message_GroupingPeriod') * 1000\n    }\n  };\n}","map":{"version":3,"sources":["app/ui-utils/client/lib/messageContext.js"],"names":["_objectSpread","module","link","default","v","export","messageContext","Meteor","Template","FlowRouter","Tracker","Subscriptions","Rooms","Users","hasPermission","settings","getUserPreference","AutoTranslate","fireGlobalEvent","actionLinks","goToRoomById","isLayoutEmbedded","handleError","roomCoordinator","fields","rid","instance","uid","userId","user","findOne","_id","openThread","e","mid","tmid","currentTarget","dataset","room","go","getRouteName","name","tab","context","jump","preventDefault","stopPropagation","runAction","msg","actionlink","value","message","run","err","openDiscussion","drid","replyBroadcast","username","openRouteLink","current","queryParams","reply","u","nonreactive","_updatedAt","lastMessage","subscription","autoTranslate","tunread","tunreadUser","tunreadGroup","actions","translateLanguage","getLanguage","showMessageInMainThread","autoImageLoad","enableMessageParserEarlyAdoption","saveMobileBandwidth","Device","isPhone","collapseMediaByDefault","showreply","showReplyButton","hasPermissionDeleteMessage","hasPermissionDeleteOwnMessage","hideRoles","get","UI_Use_Real_Name","Chatops_Username","AutoTranslate_Enabled","Message_AllowEditing","Message_AllowEditing_BlockEditInMinutes","Message_ShowEditedStatus","API_Embed","API_EmbedDisabledFor","Message_GroupingPeriod"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Tracker } from 'meteor/tracker';\n\nimport { Subscriptions, Rooms, Users } from '../../../models/client';\nimport { hasPermission } from '../../../authorization/client';\nimport { settings } from '../../../settings/client';\nimport { getUserPreference } from '../../../utils/client';\nimport { AutoTranslate } from '../../../autotranslate/client';\nimport { fireGlobalEvent } from '../../../../client/lib/utils/fireGlobalEvent';\nimport { actionLinks } from '../../../action-links/client';\nimport { goToRoomById } from '../../../../client/lib/utils/goToRoomById';\nimport { isLayoutEmbedded } from '../../../../client/lib/utils/isLayoutEmbedded';\nimport { handleError } from '../../../../client/lib/utils/handleError';\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\n\nconst fields = {\n\t'name': 1,\n\t'username': 1,\n\t'settings.preferences.enableMessageParserEarlyAdoption': 1,\n\t'settings.preferences.showMessageInMainThread': 1,\n\t'settings.preferences.autoImageLoad': 1,\n\t'settings.preferences.saveMobileBandwidth': 1,\n\t'settings.preferences.collapseMediaByDefault': 1,\n\t'settings.preferences.hideRoles': 1,\n};\n\nexport function messageContext({ rid } = Template.instance()) {\n\tconst uid = Meteor.userId();\n\tconst user = Users.findOne({ _id: uid }, { fields }) || {};\n\tconst instance = Template.instance();\n\tconst openThread = (e) => {\n\t\tconst { rid, mid, tmid } = e.currentTarget.dataset;\n\t\tconst room = Rooms.findOne({ _id: rid });\n\t\tFlowRouter.go(\n\t\t\tFlowRouter.getRouteName(),\n\t\t\t{\n\t\t\t\trid,\n\t\t\t\tname: room.name,\n\t\t\t\ttab: 'thread',\n\t\t\t\tcontext: tmid || mid,\n\t\t\t},\n\t\t\t{\n\t\t\t\tjump: tmid && tmid !== mid && mid && mid,\n\t\t\t},\n\t\t);\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t};\n\n\tconst runAction = isLayoutEmbedded()\n\t\t? (msg, e) => {\n\t\t\t\tconst { actionlink } = e.currentTarget.dataset;\n\t\t\t\treturn fireGlobalEvent('click-action-link', {\n\t\t\t\t\tactionlink,\n\t\t\t\t\tvalue: msg._id,\n\t\t\t\t\tmessage: msg,\n\t\t\t\t});\n\t\t  }\n\t\t: (msg, e) => {\n\t\t\t\tconst { actionlink } = e.currentTarget.dataset;\n\t\t\t\tactionLinks.run(actionlink, msg._id, instance, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\thandleError(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t  };\n\n\tconst openDiscussion = (e) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tconst { drid } = e.currentTarget.dataset;\n\t\tgoToRoomById(drid);\n\t};\n\n\tconst replyBroadcast = (e) => {\n\t\tconst { username, mid } = e.currentTarget.dataset;\n\t\troomCoordinator.openRouteLink('d', { name: username }, { ...FlowRouter.current().queryParams, reply: mid });\n\t};\n\n\treturn {\n\t\tu: user,\n\t\troom: Tracker.nonreactive(() =>\n\t\t\tRooms.findOne(\n\t\t\t\t{ _id: rid },\n\t\t\t\t{\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_updatedAt: 0,\n\t\t\t\t\t\tlastMessage: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t),\n\t\tsubscription: Subscriptions.findOne(\n\t\t\t{ rid },\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\tname: 1,\n\t\t\t\t\tautoTranslate: 1,\n\t\t\t\t\trid: 1,\n\t\t\t\t\ttunread: 1,\n\t\t\t\t\ttunreadUser: 1,\n\t\t\t\t\ttunreadGroup: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t),\n\t\tactions: {\n\t\t\topenThread() {\n\t\t\t\treturn openThread;\n\t\t\t},\n\t\t\trunAction(msg) {\n\t\t\t\treturn () => (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\trunAction(msg, e);\n\t\t\t\t};\n\t\t\t},\n\t\t\topenDiscussion() {\n\t\t\t\treturn openDiscussion;\n\t\t\t},\n\t\t\treplyBroadcast() {\n\t\t\t\treturn replyBroadcast;\n\t\t\t},\n\t\t},\n\t\tsettings: {\n\t\t\ttranslateLanguage: AutoTranslate.getLanguage(rid),\n\t\t\tshowMessageInMainThread: getUserPreference(user, 'showMessageInMainThread'),\n\t\t\tautoImageLoad: getUserPreference(user, 'autoImageLoad'),\n\t\t\tenableMessageParserEarlyAdoption: getUserPreference(user, 'enableMessageParserEarlyAdoption'),\n\t\t\tsaveMobileBandwidth: Meteor.Device.isPhone() && getUserPreference(user, 'saveMobileBandwidth'),\n\t\t\tcollapseMediaByDefault: getUserPreference(user, 'collapseMediaByDefault'),\n\t\t\tshowreply: true,\n\t\t\tshowReplyButton: true,\n\t\t\thasPermissionDeleteMessage: hasPermission('delete-message', rid),\n\t\t\thasPermissionDeleteOwnMessage: hasPermission('delete-own-message'),\n\t\t\thideRoles: !settings.get('UI_DisplayRoles') || getUserPreference(user, 'hideRoles'),\n\t\t\tUI_Use_Real_Name: settings.get('UI_Use_Real_Name'),\n\t\t\tChatops_Username: settings.get('Chatops_Username'),\n\t\t\tAutoTranslate_Enabled: settings.get('AutoTranslate_Enabled'),\n\t\t\tMessage_AllowEditing: settings.get('Message_AllowEditing'),\n\t\t\tMessage_AllowEditing_BlockEditInMinutes: settings.get('Message_AllowEditing_BlockEditInMinutes'),\n\t\t\tMessage_ShowEditedStatus: settings.get('Message_ShowEditedStatus'),\n\t\t\tAPI_Embed: settings.get('API_Embed'),\n\t\t\tAPI_EmbedDisabledFor: settings.get('API_EmbedDisabledFor'),\n\t\t\tMessage_GroupingPeriod: settings.get('Message_GroupingPeriod') * 1000,\n\t\t},\n\t};\n}\n"]},"sourceType":"module","hash":"d49483fc3b51c659e83fe246a2eeee1b3afb8d60"}
