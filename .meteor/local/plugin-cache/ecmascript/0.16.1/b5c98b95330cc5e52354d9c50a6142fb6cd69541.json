{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/helpers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/admin/apps/helpers.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/helpers.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/apps/helpers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/apps/helpers.js"}},"code":"module.export({\n  appEnabledStatuses: () => appEnabledStatuses,\n  apiCurlGetter: () => apiCurlGetter,\n  handleInstallError: () => handleInstallError,\n  handleAPIError: () => handleAPIError,\n  warnStatusChange: () => warnStatusChange,\n  appButtonProps: () => appButtonProps,\n  appStatusSpanProps: () => appStatusSpanProps,\n  formatPrice: () => formatPrice,\n  formatPricingPlan: () => formatPricingPlan\n});\nlet AppStatus;\nmodule.link(\"@rocket.chat/apps-engine/definition/AppStatus\", {\n  AppStatus(v) {\n    AppStatus = v;\n  }\n\n}, 0);\nlet semver;\nmodule.link(\"semver\", {\n  default(v) {\n    semver = v;\n  }\n\n}, 1);\nlet Utilities;\nmodule.link(\"../../../../app/apps/lib/misc/Utilities\", {\n  Utilities(v) {\n    Utilities = v;\n  }\n\n}, 2);\nlet t;\nmodule.link(\"../../../../app/utils/client\", {\n  t(v) {\n    t = v;\n  }\n\n}, 3);\nlet dispatchToastMessage;\nmodule.link(\"../../../lib/toast\", {\n  dispatchToastMessage(v) {\n    dispatchToastMessage = v;\n  }\n\n}, 4);\nconst appEnabledStatuses = [AppStatus.AUTO_ENABLED, AppStatus.MANUALLY_ENABLED];\nconst appErroredStatuses = [AppStatus.COMPILER_ERROR_DISABLED, AppStatus.ERROR_DISABLED, AppStatus.INVALID_SETTINGS_DISABLED, AppStatus.INVALID_LICENSE_DISABLED];\n\nconst apiCurlGetter = absoluteUrl => (method, api) => {\n  const example = api.examples[method] || {};\n  return Utilities.curl({\n    url: absoluteUrl(api.computedPath),\n    method,\n    params: example.params,\n    query: example.query,\n    content: example.content,\n    headers: example.headers\n  }).split('\\n');\n};\n\nfunction handleInstallError(apiError) {\n  if (!apiError.xhr || !apiError.xhr.responseJSON) {\n    return;\n  }\n\n  const {\n    status,\n    messages,\n    error,\n    payload = null\n  } = apiError.xhr.responseJSON;\n  let message;\n\n  switch (status) {\n    case 'storage_error':\n      message = messages.join('');\n      break;\n\n    case 'app_user_error':\n      message = messages.join('');\n\n      if (payload && payload.username) {\n        message = t('Apps_User_Already_Exists', {\n          username: payload.username\n        });\n      }\n\n      break;\n\n    default:\n      if (error) {\n        message = error;\n      } else {\n        message = 'There has been an error installing the app';\n      }\n\n  }\n\n  dispatchToastMessage({\n    type: 'error',\n    message\n  });\n}\n\nconst shouldHandleErrorAsWarning = message => {\n  const warnings = ['Could not reach the Marketplace'];\n  return warnings.includes(message);\n};\n\nconst handleAPIError = error => {\n  const message = error.xhr && error.xhr.responseJSON && error.xhr.responseJSON.error || error.message;\n\n  if (shouldHandleErrorAsWarning(message)) {\n    dispatchToastMessage({\n      type: 'warning',\n      message\n    });\n    return;\n  }\n\n  dispatchToastMessage({\n    type: 'error',\n    message\n  });\n};\n\nconst warnStatusChange = (appName, status) => {\n  if (appErroredStatuses.includes(status)) {\n    dispatchToastMessage({\n      type: 'error',\n      message: (t(\"App_status_\".concat(status)), appName)\n    });\n    return;\n  }\n\n  dispatchToastMessage({\n    type: 'info',\n    message: (t(\"App_status_\".concat(status)), appName)\n  });\n};\n\nconst appButtonProps = _ref => {\n  let {\n    installed,\n    version,\n    marketplaceVersion,\n    isPurchased,\n    price,\n    purchaseType,\n    subscriptionInfo,\n    pricingPlans,\n    isEnterpriseOnly\n  } = _ref;\n  const canUpdate = installed && version && marketplaceVersion && semver.lt(version, marketplaceVersion);\n\n  if (canUpdate) {\n    return {\n      action: 'update',\n      icon: 'reload',\n      label: 'Update'\n    };\n  }\n\n  if (installed) {\n    return;\n  }\n\n  const canDownload = isPurchased;\n\n  if (canDownload) {\n    return {\n      action: 'install',\n      label: 'Install'\n    };\n  }\n\n  const canSubscribe = purchaseType === 'subscription' && !subscriptionInfo.status;\n\n  if (canSubscribe) {\n    const cannotTry = pricingPlans.every(currentPricingPlan => currentPricingPlan.trialDays === 0);\n\n    if (cannotTry || isEnterpriseOnly) {\n      return {\n        action: 'purchase',\n        label: 'Subscribe'\n      };\n    }\n\n    return {\n      action: 'purchase',\n      label: 'Trial'\n    };\n  }\n\n  const canBuy = price > 0;\n\n  if (canBuy) {\n    return {\n      action: 'purchase',\n      label: 'Buy'\n    };\n  }\n\n  return {\n    action: 'purchase',\n    label: 'Install'\n  };\n};\n\nconst appStatusSpanProps = _ref2 => {\n  let {\n    installed,\n    status,\n    subscriptionInfo\n  } = _ref2;\n\n  if (!installed) {\n    return;\n  }\n\n  const isFailed = appErroredStatuses.includes(status);\n\n  if (isFailed) {\n    return {\n      type: 'failed',\n      icon: 'warning',\n      label: status === AppStatus.INVALID_SETTINGS_DISABLED ? 'Config Needed' : 'Failed'\n    };\n  }\n\n  const isEnabled = appEnabledStatuses.includes(status);\n\n  if (!isEnabled) {\n    return {\n      type: 'warning',\n      icon: 'warning',\n      label: 'Disabled'\n    };\n  }\n\n  const isOnTrialPeriod = subscriptionInfo && subscriptionInfo.status === 'trialing';\n\n  if (isOnTrialPeriod) {\n    return {\n      icon: 'checkmark-circled',\n      label: 'Trial period'\n    };\n  }\n\n  return {\n    icon: 'checkmark-circled',\n    label: 'Enabled'\n  };\n};\n\nconst formatPrice = price => \"$\".concat(Number.parseFloat(price).toFixed(2));\n\nconst formatPricingPlan = _ref3 => {\n  let {\n    strategy,\n    price,\n    tiers = []\n  } = _ref3;\n  const {\n    perUnit = false\n  } = Array.isArray(tiers) && tiers.find(tier => tier.price === price) || {};\n  const pricingPlanTranslationString = ['Apps_Marketplace_pricingPlan', Array.isArray(tiers) && tiers.length > 0 && 'startingAt', strategy, perUnit && 'perUser'].filter(Boolean).join('_');\n  return t(pricingPlanTranslationString, {\n    price: formatPrice(price)\n  });\n};","map":{"version":3,"sources":["client/views/admin/apps/helpers.js"],"names":["module","export","appEnabledStatuses","apiCurlGetter","handleInstallError","handleAPIError","warnStatusChange","appButtonProps","appStatusSpanProps","formatPrice","formatPricingPlan","AppStatus","link","v","semver","default","Utilities","t","dispatchToastMessage","AUTO_ENABLED","MANUALLY_ENABLED","appErroredStatuses","COMPILER_ERROR_DISABLED","ERROR_DISABLED","INVALID_SETTINGS_DISABLED","INVALID_LICENSE_DISABLED","absoluteUrl","method","api","example","examples","curl","url","computedPath","params","query","content","headers","split","apiError","xhr","responseJSON","status","messages","error","payload","message","join","username","type","shouldHandleErrorAsWarning","warnings","includes","appName","installed","version","marketplaceVersion","isPurchased","price","purchaseType","subscriptionInfo","pricingPlans","isEnterpriseOnly","canUpdate","lt","action","icon","label","canDownload","canSubscribe","cannotTry","every","currentPricingPlan","trialDays","canBuy","isFailed","isEnabled","isOnTrialPeriod","Number","parseFloat","toFixed","strategy","tiers","perUnit","Array","isArray","find","tier","pricingPlanTranslationString","length","filter","Boolean"],"mappings":"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","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport semver from 'semver';\n\nimport { Utilities } from '../../../../app/apps/lib/misc/Utilities';\nimport { t } from '../../../../app/utils/client';\nimport { dispatchToastMessage } from '../../../lib/toast';\n\nexport const appEnabledStatuses = [AppStatus.AUTO_ENABLED, AppStatus.MANUALLY_ENABLED];\n\nconst appErroredStatuses = [\n\tAppStatus.COMPILER_ERROR_DISABLED,\n\tAppStatus.ERROR_DISABLED,\n\tAppStatus.INVALID_SETTINGS_DISABLED,\n\tAppStatus.INVALID_LICENSE_DISABLED,\n];\n\nexport const apiCurlGetter = (absoluteUrl) => (method, api) => {\n\tconst example = api.examples[method] || {};\n\treturn Utilities.curl({\n\t\turl: absoluteUrl(api.computedPath),\n\t\tmethod,\n\t\tparams: example.params,\n\t\tquery: example.query,\n\t\tcontent: example.content,\n\t\theaders: example.headers,\n\t}).split('\\n');\n};\n\nexport function handleInstallError(apiError) {\n\tif (!apiError.xhr || !apiError.xhr.responseJSON) {\n\t\treturn;\n\t}\n\n\tconst { status, messages, error, payload = null } = apiError.xhr.responseJSON;\n\n\tlet message;\n\n\tswitch (status) {\n\t\tcase 'storage_error':\n\t\t\tmessage = messages.join('');\n\t\t\tbreak;\n\t\tcase 'app_user_error':\n\t\t\tmessage = messages.join('');\n\t\t\tif (payload && payload.username) {\n\t\t\t\tmessage = t('Apps_User_Already_Exists', { username: payload.username });\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (error) {\n\t\t\t\tmessage = error;\n\t\t\t} else {\n\t\t\t\tmessage = 'There has been an error installing the app';\n\t\t\t}\n\t}\n\n\tdispatchToastMessage({ type: 'error', message });\n}\n\nconst shouldHandleErrorAsWarning = (message) => {\n\tconst warnings = ['Could not reach the Marketplace'];\n\n\treturn warnings.includes(message);\n};\n\nexport const handleAPIError = (error) => {\n\tconst message = (error.xhr && error.xhr.responseJSON && error.xhr.responseJSON.error) || error.message;\n\n\tif (shouldHandleErrorAsWarning(message)) {\n\t\tdispatchToastMessage({ type: 'warning', message });\n\t\treturn;\n\t}\n\n\tdispatchToastMessage({ type: 'error', message });\n};\n\nexport const warnStatusChange = (appName, status) => {\n\tif (appErroredStatuses.includes(status)) {\n\t\tdispatchToastMessage({ type: 'error', message: (t(`App_status_${status}`), appName) });\n\t\treturn;\n\t}\n\n\tdispatchToastMessage({ type: 'info', message: (t(`App_status_${status}`), appName) });\n};\n\nexport const appButtonProps = ({\n\tinstalled,\n\tversion,\n\tmarketplaceVersion,\n\tisPurchased,\n\tprice,\n\tpurchaseType,\n\tsubscriptionInfo,\n\tpricingPlans,\n\tisEnterpriseOnly,\n}) => {\n\tconst canUpdate = installed && version && marketplaceVersion && semver.lt(version, marketplaceVersion);\n\tif (canUpdate) {\n\t\treturn {\n\t\t\taction: 'update',\n\t\t\ticon: 'reload',\n\t\t\tlabel: 'Update',\n\t\t};\n\t}\n\n\tif (installed) {\n\t\treturn;\n\t}\n\n\tconst canDownload = isPurchased;\n\tif (canDownload) {\n\t\treturn {\n\t\t\taction: 'install',\n\t\t\tlabel: 'Install',\n\t\t};\n\t}\n\n\tconst canSubscribe = purchaseType === 'subscription' && !subscriptionInfo.status;\n\tif (canSubscribe) {\n\t\tconst cannotTry = pricingPlans.every((currentPricingPlan) => currentPricingPlan.trialDays === 0);\n\n\t\tif (cannotTry || isEnterpriseOnly) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Subscribe',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Trial',\n\t\t};\n\t}\n\n\tconst canBuy = price > 0;\n\tif (canBuy) {\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Buy',\n\t\t};\n\t}\n\n\treturn {\n\t\taction: 'purchase',\n\t\tlabel: 'Install',\n\t};\n};\n\nexport const appStatusSpanProps = ({ installed, status, subscriptionInfo }) => {\n\tif (!installed) {\n\t\treturn;\n\t}\n\n\tconst isFailed = appErroredStatuses.includes(status);\n\tif (isFailed) {\n\t\treturn {\n\t\t\ttype: 'failed',\n\t\t\ticon: 'warning',\n\t\t\tlabel: status === AppStatus.INVALID_SETTINGS_DISABLED ? 'Config Needed' : 'Failed',\n\t\t};\n\t}\n\n\tconst isEnabled = appEnabledStatuses.includes(status);\n\tif (!isEnabled) {\n\t\treturn {\n\t\t\ttype: 'warning',\n\t\t\ticon: 'warning',\n\t\t\tlabel: 'Disabled',\n\t\t};\n\t}\n\n\tconst isOnTrialPeriod = subscriptionInfo && subscriptionInfo.status === 'trialing';\n\tif (isOnTrialPeriod) {\n\t\treturn {\n\t\t\ticon: 'checkmark-circled',\n\t\t\tlabel: 'Trial period',\n\t\t};\n\t}\n\n\treturn {\n\t\ticon: 'checkmark-circled',\n\t\tlabel: 'Enabled',\n\t};\n};\n\nexport const formatPrice = (price) => `\\$${Number.parseFloat(price).toFixed(2)}`;\n\nexport const formatPricingPlan = ({ strategy, price, tiers = [] }) => {\n\tconst { perUnit = false } = (Array.isArray(tiers) && tiers.find((tier) => tier.price === price)) || {};\n\n\tconst pricingPlanTranslationString = [\n\t\t'Apps_Marketplace_pricingPlan',\n\t\tArray.isArray(tiers) && tiers.length > 0 && 'startingAt',\n\t\tstrategy,\n\t\tperUnit && 'perUser',\n\t]\n\t\t.filter(Boolean)\n\t\t.join('_');\n\n\treturn t(pricingPlanTranslationString, {\n\t\tprice: formatPrice(price),\n\t});\n};\n"]},"sourceType":"module","hash":"b5c98b95330cc5e52354d9c50a6142fb6cd69541"}
