{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/authorization/client/startup.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/authorization/client/startup.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/authorization/client/startup.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/authorization/client/startup.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/authorization/client/startup.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 1);\nlet hasAtLeastOnePermission;\nmodule.link(\"./hasPermission\", {\n  hasAtLeastOnePermission(v) {\n    hasAtLeastOnePermission = v;\n  }\n\n}, 2);\nlet CachedCollectionManager;\nmodule.link(\"../../ui-cached-collection\", {\n  CachedCollectionManager(v) {\n    CachedCollectionManager = v;\n  }\n\n}, 3);\nlet APIClient;\nmodule.link(\"../../utils/client\", {\n  APIClient(v) {\n    APIClient = v;\n  }\n\n}, 4);\nlet Roles;\nmodule.link(\"../../models/client\", {\n  Roles(v) {\n    Roles = v;\n  }\n\n}, 5);\nlet rolesStreamer;\nmodule.link(\"./lib/streamer\", {\n  rolesStreamer(v) {\n    rolesStreamer = v;\n  }\n\n}, 6);\nlet registerAdminSidebarItem;\nmodule.link(\"../../../client/views/admin\", {\n  registerAdminSidebarItem(v) {\n    registerAdminSidebarItem = v;\n  }\n\n}, 7);\nMeteor.startup(() => {\n  CachedCollectionManager.onLogin(async () => {\n    const {\n      roles\n    } = await APIClient.v1.get('roles.list'); // if a role is checked before this collection is populated, it will return undefined\n\n    Roles._collection._docs._map = new Map(roles.map(record => [Roles._collection._docs._idStringify(record._id), record]));\n    Object.values(Roles._collection.queries).forEach(query => Roles._collection._recomputeResults(query));\n    Roles.ready.set(true);\n  });\n  registerAdminSidebarItem({\n    href: 'admin-permissions',\n    i18nLabel: 'Permissions',\n    icon: 'lock',\n\n    permissionGranted() {\n      return hasAtLeastOnePermission(['access-permissions', 'access-setting-permissions']);\n    }\n\n  });\n  const events = {\n    changed: role => {\n      delete role.type;\n      Roles.upsert({\n        _id: role._id\n      }, role);\n    },\n    removed: role => {\n      Roles.remove({\n        _id: role._id\n      });\n    }\n  };\n  Tracker.autorun(c => {\n    if (!Meteor.userId()) {\n      return;\n    }\n\n    rolesStreamer.on('roles', role => events[role.type](role));\n    c.stop();\n  });\n});","map":{"version":3,"sources":["app/authorization/client/startup.js"],"names":["Meteor","module","link","v","Tracker","hasAtLeastOnePermission","CachedCollectionManager","APIClient","Roles","rolesStreamer","registerAdminSidebarItem","startup","onLogin","roles","v1","get","_collection","_docs","_map","Map","map","record","_idStringify","_id","Object","values","queries","forEach","query","_recomputeResults","ready","set","href","i18nLabel","icon","permissionGranted","events","changed","role","type","upsert","removed","remove","autorun","c","userId","on","stop"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { hasAtLeastOnePermission } from './hasPermission';\nimport { CachedCollectionManager } from '../../ui-cached-collection';\nimport { APIClient } from '../../utils/client';\nimport { Roles } from '../../models/client';\nimport { rolesStreamer } from './lib/streamer';\nimport { registerAdminSidebarItem } from '../../../client/views/admin';\n\nMeteor.startup(() => {\n\tCachedCollectionManager.onLogin(async () => {\n\t\tconst { roles } = await APIClient.v1.get('roles.list');\n\t\t// if a role is checked before this collection is populated, it will return undefined\n\t\tRoles._collection._docs._map = new Map(roles.map((record) => [Roles._collection._docs._idStringify(record._id), record]));\n\t\tObject.values(Roles._collection.queries).forEach((query) => Roles._collection._recomputeResults(query));\n\n\t\tRoles.ready.set(true);\n\t});\n\n\tregisterAdminSidebarItem({\n\t\thref: 'admin-permissions',\n\t\ti18nLabel: 'Permissions',\n\t\ticon: 'lock',\n\t\tpermissionGranted() {\n\t\t\treturn hasAtLeastOnePermission(['access-permissions', 'access-setting-permissions']);\n\t\t},\n\t});\n\tconst events = {\n\t\tchanged: (role) => {\n\t\t\tdelete role.type;\n\t\t\tRoles.upsert({ _id: role._id }, role);\n\t\t},\n\t\tremoved: (role) => {\n\t\t\tRoles.remove({ _id: role._id });\n\t\t},\n\t};\n\n\tTracker.autorun((c) => {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\t\trolesStreamer.on('roles', (role) => events[role.type](role));\n\t\tc.stop();\n\t});\n});\n"]},"sourceType":"module","hash":"2d7dde0dad530624174894ed4054e6a33f00af76"}
