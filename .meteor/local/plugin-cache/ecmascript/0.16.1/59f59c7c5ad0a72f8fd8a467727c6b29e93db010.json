{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji/client/lib/EmojiPicker.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/emoji/client/lib/EmojiPicker.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji/client/lib/EmojiPicker.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/emoji/client/lib/EmojiPicker.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/emoji/client/lib/EmojiPicker.js"}},"code":"module.export({\n  EmojiPicker: () => EmojiPicker\n});\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 0);\nlet Blaze;\nmodule.link(\"meteor/blaze\", {\n  Blaze(v) {\n    Blaze = v;\n  }\n\n}, 1);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 2);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 3);\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 4);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 5);\nlet emoji;\nmodule.link(\"../../lib/rocketchat\", {\n  emoji(v) {\n    emoji = v;\n  }\n\n}, 6);\nlet updatePositions = true;\nconst EmojiPicker = {\n  width: 365,\n  height: 300,\n  initiated: false,\n  input: null,\n  source: null,\n  recent: [],\n  tone: null,\n  opened: false,\n  pickCallback: null,\n  scrollingToCategory: false,\n  currentCategory: new ReactiveVar('recent'),\n\n  async init() {\n    if (this.initiated) {\n      return;\n    }\n\n    this.initiated = true;\n    this.recent = Meteor._localStorage.getItem('emoji.recent') ? Meteor._localStorage.getItem('emoji.recent').split(',') : [];\n    this.tone = Meteor._localStorage.getItem('emoji.tone') || 0;\n    Blaze.render(Template.emojiPicker, document.body);\n    $(document).click(event => {\n      if (!this.opened) {\n        return;\n      }\n\n      if (!$(event.target).closest('.emoji-picker').length && !$(event.target).is('.emoji-picker')) {\n        if (this.opened) {\n          this.close();\n        }\n      }\n    });\n    $(window).resize(_.debounce(() => {\n      if (!this.opened) {\n        return;\n      }\n\n      this.setPosition();\n    }, 300));\n  },\n\n  isOpened() {\n    return this.opened;\n  },\n\n  setTone(tone) {\n    this.tone = tone;\n\n    Meteor._localStorage.setItem('emoji.tone', tone);\n  },\n\n  getTone() {\n    return this.tone;\n  },\n\n  getRecent() {\n    return this.recent;\n  },\n\n  setPosition() {\n    const windowHeight = window.innerHeight;\n    const windowWidth = window.innerWidth;\n    const windowBorder = 10;\n    const sourcePos = $(this.source).offset();\n    const {\n      left,\n      top\n    } = sourcePos;\n    const cssProperties = {\n      top,\n      left\n    };\n    const isLargerThanWindow = this.width + windowBorder > windowWidth;\n\n    if (top + this.height >= windowHeight) {\n      cssProperties.top = windowHeight - this.height - windowBorder - 75;\n    }\n\n    if (left < windowBorder) {\n      cssProperties.left = isLargerThanWindow ? 0 : windowBorder;\n    }\n\n    if (left + this.width >= windowWidth) {\n      cssProperties.left = isLargerThanWindow ? 0 : windowWidth - this.width - windowBorder;\n    }\n\n    return $('.emoji-picker').css(cssProperties);\n  },\n\n  async open(source, callback) {\n    if (!this.initiated) {\n      await this.init();\n    }\n\n    this.pickCallback = callback;\n    this.source = source;\n    const containerEl = this.setPosition();\n    containerEl.addClass('show');\n    const emojiInput = containerEl.find('.js-emojipicker-search');\n\n    if (emojiInput) {\n      emojiInput.focus();\n    }\n\n    this.calculateCategoryPositions();\n\n    if (this.recent.length === 0 && this.currentCategory.get() === 'recent') {\n      this.showCategory(emoji.packages.emojiCustom.list.length > 0 ? 'rocket' : 'people', false);\n    }\n\n    this.opened = true;\n  },\n\n  close() {\n    $('.emoji-picker').removeClass('show');\n    this.opened = false;\n    this.source.focus();\n  },\n\n  pickEmoji(emoji) {\n    this.pickCallback(emoji);\n    this.close();\n    this.addRecent(emoji);\n  },\n\n  addRecent(_emoji) {\n    const pos = this.recent.indexOf(_emoji);\n\n    if (pos !== -1) {\n      this.recent.splice(pos, 1);\n    }\n\n    this.recent.unshift(_emoji); // limit recent emojis to 27 (3 rows of 9)\n\n    this.recent.splice(27);\n    updatePositions = true;\n\n    Meteor._localStorage.setItem('emoji.recent', this.recent);\n\n    emoji.packages.base.emojisByCategory.recent = this.recent;\n    this.updateRecent('recent');\n  },\n\n  removeFromRecent(_emoji) {\n    const pos = this.recent.indexOf(_emoji);\n\n    if (pos === -1) {\n      return;\n    }\n\n    this.recent.splice(pos, 1);\n\n    Meteor._localStorage.setItem('emoji.recent', this.recent);\n  },\n\n  async updateRecent(category) {\n    const emojiPickerImport = await module.dynamicImport('../emojiPicker');\n    const {\n      updateRecentEmoji\n    } = emojiPickerImport;\n    updateRecentEmoji(category);\n  },\n\n  calculateCategoryPositions() {\n    if (!updatePositions) {\n      return;\n    }\n\n    updatePositions = false;\n    const containerScroll = $('.emoji-picker .emojis').scrollTop();\n    this.catPositions = Array.from(document.querySelectorAll('.emoji-list-category')).map(el => {\n      const {\n        top\n      } = $(el).position();\n      return {\n        el,\n        top: top + containerScroll\n      };\n    });\n  },\n\n  getCategoryPositions() {\n    return this.catPositions;\n  },\n\n  showCategory(category) {\n    let animate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    this.scrollingToCategory = animate;\n    $('.emoji-picker .js-emojipicker-search').val('').change().focus();\n    this.currentCategory.set(category);\n    Tracker.afterFlush(() => {\n      const header = $(\"#emoji-list-category-\".concat(category));\n      const container = $('.emoji-picker .emojis');\n      const scrollTop = header.position().top + container.scrollTop(); // - container.position().top;\n\n      if (animate) {\n        return container.animate({\n          scrollTop\n        }, 300, () => {\n          this.scrollingToCategory = false;\n        });\n      }\n\n      container.scrollTop(scrollTop);\n    });\n  }\n\n};","map":{"version":3,"sources":["app/emoji/client/lib/EmojiPicker.js"],"names":["module","export","EmojiPicker","_","link","default","v","Blaze","Meteor","Template","ReactiveVar","Tracker","emoji","updatePositions","width","height","initiated","input","source","recent","tone","opened","pickCallback","scrollingToCategory","currentCategory","init","_localStorage","getItem","split","render","emojiPicker","document","body","$","click","event","target","closest","length","is","close","window","resize","debounce","setPosition","isOpened","setTone","setItem","getTone","getRecent","windowHeight","innerHeight","windowWidth","innerWidth","windowBorder","sourcePos","offset","left","top","cssProperties","isLargerThanWindow","css","open","callback","containerEl","addClass","emojiInput","find","focus","calculateCategoryPositions","get","showCategory","packages","emojiCustom","list","removeClass","pickEmoji","addRecent","_emoji","pos","indexOf","splice","unshift","base","emojisByCategory","updateRecent","removeFromRecent","category","emojiPickerImport","updateRecentEmoji","containerScroll","scrollTop","catPositions","Array","from","querySelectorAll","map","el","position","getCategoryPositions","animate","val","change","set","afterFlush","header","container"],"mappings":"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","sourcesContent":["import _ from 'underscore';\nimport { Blaze } from 'meteor/blaze';\nimport { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport { emoji } from '../../lib/rocketchat';\n\nlet updatePositions = true;\n\nexport const EmojiPicker = {\n\twidth: 365,\n\theight: 300,\n\tinitiated: false,\n\tinput: null,\n\tsource: null,\n\trecent: [],\n\ttone: null,\n\topened: false,\n\tpickCallback: null,\n\tscrollingToCategory: false,\n\tcurrentCategory: new ReactiveVar('recent'),\n\tasync init() {\n\t\tif (this.initiated) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initiated = true;\n\n\t\tthis.recent = Meteor._localStorage.getItem('emoji.recent') ? Meteor._localStorage.getItem('emoji.recent').split(',') : [];\n\t\tthis.tone = Meteor._localStorage.getItem('emoji.tone') || 0;\n\n\t\tBlaze.render(Template.emojiPicker, document.body);\n\n\t\t$(document).click((event) => {\n\t\t\tif (!this.opened) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!$(event.target).closest('.emoji-picker').length && !$(event.target).is('.emoji-picker')) {\n\t\t\t\tif (this.opened) {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(window).resize(\n\t\t\t_.debounce(() => {\n\t\t\t\tif (!this.opened) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.setPosition();\n\t\t\t}, 300),\n\t\t);\n\t},\n\tisOpened() {\n\t\treturn this.opened;\n\t},\n\tsetTone(tone) {\n\t\tthis.tone = tone;\n\t\tMeteor._localStorage.setItem('emoji.tone', tone);\n\t},\n\tgetTone() {\n\t\treturn this.tone;\n\t},\n\tgetRecent() {\n\t\treturn this.recent;\n\t},\n\tsetPosition() {\n\t\tconst windowHeight = window.innerHeight;\n\t\tconst windowWidth = window.innerWidth;\n\t\tconst windowBorder = 10;\n\t\tconst sourcePos = $(this.source).offset();\n\t\tconst { left, top } = sourcePos;\n\t\tconst cssProperties = { top, left };\n\t\tconst isLargerThanWindow = this.width + windowBorder > windowWidth;\n\n\t\tif (top + this.height >= windowHeight) {\n\t\t\tcssProperties.top = windowHeight - this.height - windowBorder - 75;\n\t\t}\n\n\t\tif (left < windowBorder) {\n\t\t\tcssProperties.left = isLargerThanWindow ? 0 : windowBorder;\n\t\t}\n\n\t\tif (left + this.width >= windowWidth) {\n\t\t\tcssProperties.left = isLargerThanWindow ? 0 : windowWidth - this.width - windowBorder;\n\t\t}\n\n\t\treturn $('.emoji-picker').css(cssProperties);\n\t},\n\tasync open(source, callback) {\n\t\tif (!this.initiated) {\n\t\t\tawait this.init();\n\t\t}\n\t\tthis.pickCallback = callback;\n\t\tthis.source = source;\n\n\t\tconst containerEl = this.setPosition();\n\t\tcontainerEl.addClass('show');\n\n\t\tconst emojiInput = containerEl.find('.js-emojipicker-search');\n\t\tif (emojiInput) {\n\t\t\temojiInput.focus();\n\t\t}\n\n\t\tthis.calculateCategoryPositions();\n\n\t\tif (this.recent.length === 0 && this.currentCategory.get() === 'recent') {\n\t\t\tthis.showCategory(emoji.packages.emojiCustom.list.length > 0 ? 'rocket' : 'people', false);\n\t\t}\n\n\t\tthis.opened = true;\n\t},\n\tclose() {\n\t\t$('.emoji-picker').removeClass('show');\n\t\tthis.opened = false;\n\t\tthis.source.focus();\n\t},\n\tpickEmoji(emoji) {\n\t\tthis.pickCallback(emoji);\n\n\t\tthis.close();\n\t\tthis.addRecent(emoji);\n\t},\n\taddRecent(_emoji) {\n\t\tconst pos = this.recent.indexOf(_emoji);\n\n\t\tif (pos !== -1) {\n\t\t\tthis.recent.splice(pos, 1);\n\t\t}\n\n\t\tthis.recent.unshift(_emoji);\n\n\t\t// limit recent emojis to 27 (3 rows of 9)\n\t\tthis.recent.splice(27);\n\n\t\tupdatePositions = true;\n\n\t\tMeteor._localStorage.setItem('emoji.recent', this.recent);\n\t\temoji.packages.base.emojisByCategory.recent = this.recent;\n\t\tthis.updateRecent('recent');\n\t},\n\tremoveFromRecent(_emoji) {\n\t\tconst pos = this.recent.indexOf(_emoji);\n\t\tif (pos === -1) {\n\t\t\treturn;\n\t\t}\n\t\tthis.recent.splice(pos, 1);\n\t\tMeteor._localStorage.setItem('emoji.recent', this.recent);\n\t},\n\tasync updateRecent(category) {\n\t\tconst emojiPickerImport = await import('../emojiPicker');\n\t\tconst { updateRecentEmoji } = emojiPickerImport;\n\t\tupdateRecentEmoji(category);\n\t},\n\tcalculateCategoryPositions() {\n\t\tif (!updatePositions) {\n\t\t\treturn;\n\t\t}\n\t\tupdatePositions = false;\n\n\t\tconst containerScroll = $('.emoji-picker .emojis').scrollTop();\n\n\t\tthis.catPositions = Array.from(document.querySelectorAll('.emoji-list-category')).map((el) => {\n\t\t\tconst { top } = $(el).position();\n\t\t\treturn {\n\t\t\t\tel,\n\t\t\t\ttop: top + containerScroll,\n\t\t\t};\n\t\t});\n\t},\n\tgetCategoryPositions() {\n\t\treturn this.catPositions;\n\t},\n\tshowCategory(category, animate = true) {\n\t\tthis.scrollingToCategory = animate;\n\n\t\t$('.emoji-picker .js-emojipicker-search').val('').change().focus();\n\n\t\tthis.currentCategory.set(category);\n\n\t\tTracker.afterFlush(() => {\n\t\t\tconst header = $(`#emoji-list-category-${category}`);\n\t\t\tconst container = $('.emoji-picker .emojis');\n\n\t\t\tconst scrollTop = header.position().top + container.scrollTop(); // - container.position().top;\n\n\t\t\tif (animate) {\n\t\t\t\treturn container.animate(\n\t\t\t\t\t{\n\t\t\t\t\t\tscrollTop,\n\t\t\t\t\t},\n\t\t\t\t\t300,\n\t\t\t\t\t() => {\n\t\t\t\t\t\tthis.scrollingToCategory = false;\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tcontainer.scrollTop(scrollTop);\n\t\t});\n\t},\n};\n"]},"sourceType":"module","hash":"59f59c7c5ad0a72f8fd8a467727c6b29e93db010"}
