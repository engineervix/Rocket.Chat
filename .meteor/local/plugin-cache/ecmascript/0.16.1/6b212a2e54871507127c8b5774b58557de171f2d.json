{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/CustomFieldsForm.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/components/CustomFieldsForm.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/CustomFieldsForm.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/CustomFieldsForm.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/CustomFieldsForm.js"}},"code":"var _excluded = [\"formValues\", \"formHandlers\", \"customFields\"],\n    _excluded2 = [\"jsonCustomFields\", \"customFieldsData\", \"setCustomFieldsData\", \"onLoadFields\"];\n\nvar _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default: function (v) {\n    _extends = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\n\nvar _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default: function (v) {\n    _objectWithoutProperties = v;\n  }\n}, 2);\n\nvar _toConsumableArray;\n\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 3);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 4);\nmodule.export({\n  \"default\": function () {\n    return CustomFieldsForm;\n  }\n});\nvar TextInput, Select, Field;\nmodule.link(\"@rocket.chat/fuselage\", {\n  TextInput: function (v) {\n    TextInput = v;\n  },\n  Select: function (v) {\n    Select = v;\n  },\n  Field: function (v) {\n    Field = v;\n  }\n}, 0);\nvar capitalize;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  capitalize: function (v) {\n    capitalize = v;\n  }\n}, 1);\nvar React, useMemo, useEffect, useState;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useState: function (v) {\n    useState = v;\n  }\n}, 2);\nvar useSetting;\nmodule.link(\"../contexts/SettingsContext\", {\n  useSetting: function (v) {\n    useSetting = v;\n  }\n}, 3);\nvar useTranslation;\nmodule.link(\"../contexts/TranslationContext\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 4);\nvar useComponentDidUpdate;\nmodule.link(\"../hooks/useComponentDidUpdate\", {\n  useComponentDidUpdate: function (v) {\n    useComponentDidUpdate = v;\n  }\n}, 5);\nvar useForm;\nmodule.link(\"../hooks/useForm\", {\n  useForm: function (v) {\n    useForm = v;\n  }\n}, 6);\n\nvar CustomTextInput = function (_ref) {\n  var label = _ref.label,\n      name = _ref.name,\n      required = _ref.required,\n      minLength = _ref.minLength,\n      maxLength = _ref.maxLength,\n      setState = _ref.setState,\n      state = _ref.state,\n      className = _ref.className,\n      _ref$setCustomFieldsE = _ref.setCustomFieldsError,\n      setCustomFieldsError = _ref$setCustomFieldsE === void 0 ? function () {\n    return [];\n  } : _ref$setCustomFieldsE;\n  var t = useTranslation();\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      inputError = _useState2[0],\n      setInputError = _useState2[1];\n\n  var verify = useMemo(function () {\n    var errors = [];\n\n    if (!state && required) {\n      errors.push(t('The_field_is_required', label || name));\n    }\n\n    if (state.length < minLength && state.length > 0) {\n      errors.push(t('Min_length_is', minLength));\n    }\n\n    return errors.join(', ');\n  }, [state, required, minLength, t, label, name]);\n  useEffect(function () {\n    setCustomFieldsError(function (oldErrors) {\n      return verify ? [].concat(_toConsumableArray(oldErrors), [{\n        name: name\n      }]) : oldErrors.filter(function (item) {\n        return item.name !== name;\n      });\n    });\n  }, [name, setCustomFieldsError, verify]);\n  useComponentDidUpdate(function () {\n    setInputError(verify);\n  }, [verify]);\n  return useMemo(function () {\n    return /*#__PURE__*/React.createElement(Field, {\n      className: className\n    }, /*#__PURE__*/React.createElement(Field.Label, null, label || t(name), required && '*'), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextInput, {\n      name: name,\n      error: inputError,\n      maxLength: maxLength,\n      flexGrow: 1,\n      value: state,\n      onChange: function (e) {\n        return setState(e.currentTarget.value);\n      }\n    })), /*#__PURE__*/React.createElement(Field.Error, null, inputError));\n  }, [className, label, t, name, required, inputError, maxLength, state, setState]);\n};\n\nvar CustomSelect = function (_ref2) {\n  var label = _ref2.label,\n      name = _ref2.name,\n      required = _ref2.required,\n      _ref2$options = _ref2.options,\n      options = _ref2$options === void 0 ? {} : _ref2$options,\n      setState = _ref2.setState,\n      state = _ref2.state,\n      className = _ref2.className,\n      _ref2$setCustomFields = _ref2.setCustomFieldsError,\n      setCustomFieldsError = _ref2$setCustomFields === void 0 ? function () {\n    return [];\n  } : _ref2$setCustomFields;\n  var t = useTranslation();\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      selectError = _useState4[0],\n      setSelectError = _useState4[1];\n\n  var mappedOptions = useMemo(function () {\n    return Object.values(options).map(function (value) {\n      return [value, value];\n    });\n  }, [options]);\n  var verify = useMemo(function () {\n    return !state.length && required ? t('The_field_is_required', label || name) : '';\n  }, [name, label, required, state.length, t]);\n  useEffect(function () {\n    setCustomFieldsError(function (oldErrors) {\n      return verify ? [].concat(_toConsumableArray(oldErrors), [{\n        name: name\n      }]) : oldErrors.filter(function (item) {\n        return item.name !== name;\n      });\n    });\n  }, [name, setCustomFieldsError, verify]);\n  useComponentDidUpdate(function () {\n    setSelectError(verify);\n  }, [verify]);\n  return useMemo(function () {\n    return /*#__PURE__*/React.createElement(Field, {\n      className: className\n    }, /*#__PURE__*/React.createElement(Field.Label, null, label || t(name), required && '*'), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(Select, {\n      name: name,\n      error: selectError,\n      flexGrow: 1,\n      value: state,\n      options: mappedOptions,\n      onChange: function (val) {\n        return setState(val);\n      }\n    })), /*#__PURE__*/React.createElement(Field.Error, null, selectError));\n  }, [className, label, t, name, required, selectError, state, mappedOptions, setState]);\n};\n\nvar CustomFieldsAssembler = function (_ref3) {\n  var formValues = _ref3.formValues,\n      formHandlers = _ref3.formHandlers,\n      customFields = _ref3.customFields,\n      props = _objectWithoutProperties(_ref3, _excluded);\n\n  return Object.entries(customFields).map(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        key = _ref5[0],\n        value = _ref5[1];\n\n    var extraProps = _objectSpread({\n      key: key,\n      name: key,\n      setState: formHandlers[\"handle\" + capitalize(key)],\n      state: formValues[key]\n    }, value);\n\n    if (value.type === 'select') {\n      return /*#__PURE__*/React.createElement(CustomSelect, _extends({}, extraProps, props));\n    }\n\n    if (value.type === 'text') {\n      return /*#__PURE__*/React.createElement(CustomTextInput, _extends({}, extraProps, props));\n    }\n\n    return null;\n  });\n};\n\nfunction CustomFieldsForm(_ref6) {\n  var jsonCustomFields = _ref6.jsonCustomFields,\n      customFieldsData = _ref6.customFieldsData,\n      setCustomFieldsData = _ref6.setCustomFieldsData,\n      _ref6$onLoadFields = _ref6.onLoadFields,\n      onLoadFields = _ref6$onLoadFields === void 0 ? function () {} : _ref6$onLoadFields,\n      props = _objectWithoutProperties(_ref6, _excluded2);\n\n  var accountsCustomFieldsJson = useSetting('Accounts_CustomFields');\n\n  var _useState5 = useState(function () {\n    try {\n      return jsonCustomFields || JSON.parse(accountsCustomFieldsJson || '{}');\n    } catch (_unused) {\n      return {};\n    }\n  }),\n      _useState6 = _slicedToArray(_useState5, 1),\n      customFields = _useState6[0];\n\n  var hasCustomFields = Boolean(Object.values(customFields).length);\n  var defaultFields = useMemo(function () {\n    return Object.entries(customFields).reduce(function (data, _ref7) {\n      var _value$defaultValue;\n\n      var _ref8 = _slicedToArray(_ref7, 2),\n          key = _ref8[0],\n          value = _ref8[1];\n\n      data[key] = (_value$defaultValue = value.defaultValue) !== null && _value$defaultValue !== void 0 ? _value$defaultValue : '';\n      return data;\n    }, {});\n  }, [customFields]);\n\n  var _useForm = useForm(_objectSpread(_objectSpread({}, defaultFields), customFieldsData)),\n      values = _useForm.values,\n      handlers = _useForm.handlers;\n\n  useEffect(function () {\n    onLoadFields(hasCustomFields);\n\n    if (hasCustomFields) {\n      setCustomFieldsData(values);\n    }\n  }, [hasCustomFields, onLoadFields, setCustomFieldsData, values]);\n\n  if (!hasCustomFields) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(CustomFieldsAssembler, _extends({\n    formValues: values,\n    formHandlers: handlers,\n    customFields: customFields\n  }, props));\n}","map":{"version":3,"sources":["client/components/CustomFieldsForm.js"],"names":["_extends","module","link","default","v","_objectSpread","_objectWithoutProperties","_toConsumableArray","_slicedToArray","export","CustomFieldsForm","TextInput","Select","Field","capitalize","React","useMemo","useEffect","useState","useSetting","useTranslation","useComponentDidUpdate","useForm","CustomTextInput","label","name","required","minLength","maxLength","setState","state","className","setCustomFieldsError","t","inputError","setInputError","verify","errors","push","length","join","oldErrors","filter","item","e","currentTarget","value","CustomSelect","options","selectError","setSelectError","mappedOptions","Object","values","map","val","CustomFieldsAssembler","formValues","formHandlers","customFields","props","entries","key","extraProps","type","jsonCustomFields","customFieldsData","setCustomFieldsData","onLoadFields","accountsCustomFieldsJson","JSON","parse","hasCustomFields","Boolean","defaultFields","reduce","data","defaultValue","handlers"],"mappings":"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","sourcesContent":["import { TextInput, Select, Field } from '@rocket.chat/fuselage';\nimport { capitalize } from '@rocket.chat/string-helpers';\nimport React, { useMemo, useEffect, useState } from 'react';\n\nimport { useSetting } from '../contexts/SettingsContext';\nimport { useTranslation } from '../contexts/TranslationContext';\nimport { useComponentDidUpdate } from '../hooks/useComponentDidUpdate';\nimport { useForm } from '../hooks/useForm';\n\nconst CustomTextInput = ({ label, name, required, minLength, maxLength, setState, state, className, setCustomFieldsError = () => [] }) => {\n\tconst t = useTranslation();\n\n\tconst [inputError, setInputError] = useState('');\n\n\tconst verify = useMemo(() => {\n\t\tconst errors = [];\n\t\tif (!state && required) {\n\t\t\terrors.push(t('The_field_is_required', label || name));\n\t\t}\n\n\t\tif (state.length < minLength && state.length > 0) {\n\t\t\terrors.push(t('Min_length_is', minLength));\n\t\t}\n\n\t\treturn errors.join(', ');\n\t}, [state, required, minLength, t, label, name]);\n\n\tuseEffect(() => {\n\t\tsetCustomFieldsError((oldErrors) => (verify ? [...oldErrors, { name }] : oldErrors.filter((item) => item.name !== name)));\n\t}, [name, setCustomFieldsError, verify]);\n\n\tuseComponentDidUpdate(() => {\n\t\tsetInputError(verify);\n\t}, [verify]);\n\n\treturn useMemo(\n\t\t() => (\n\t\t\t<Field className={className}>\n\t\t\t\t<Field.Label>\n\t\t\t\t\t{label || t(name)}\n\t\t\t\t\t{required && '*'}\n\t\t\t\t</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tname={name}\n\t\t\t\t\t\terror={inputError}\n\t\t\t\t\t\tmaxLength={maxLength}\n\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\tvalue={state}\n\t\t\t\t\t\tonChange={(e) => setState(e.currentTarget.value)}\n\t\t\t\t\t/>\n\t\t\t\t</Field.Row>\n\t\t\t\t<Field.Error>{inputError}</Field.Error>\n\t\t\t</Field>\n\t\t),\n\t\t[className, label, t, name, required, inputError, maxLength, state, setState],\n\t);\n};\n\nconst CustomSelect = ({ label, name, required, options = {}, setState, state, className, setCustomFieldsError = () => [] }) => {\n\tconst t = useTranslation();\n\tconst [selectError, setSelectError] = useState('');\n\n\tconst mappedOptions = useMemo(() => Object.values(options).map((value) => [value, value]), [options]);\n\tconst verify = useMemo(\n\t\t() => (!state.length && required ? t('The_field_is_required', label || name) : ''),\n\t\t[name, label, required, state.length, t],\n\t);\n\n\tuseEffect(() => {\n\t\tsetCustomFieldsError((oldErrors) => (verify ? [...oldErrors, { name }] : oldErrors.filter((item) => item.name !== name)));\n\t}, [name, setCustomFieldsError, verify]);\n\n\tuseComponentDidUpdate(() => {\n\t\tsetSelectError(verify);\n\t}, [verify]);\n\n\treturn useMemo(\n\t\t() => (\n\t\t\t<Field className={className}>\n\t\t\t\t<Field.Label>\n\t\t\t\t\t{label || t(name)}\n\t\t\t\t\t{required && '*'}\n\t\t\t\t</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<Select name={name} error={selectError} flexGrow={1} value={state} options={mappedOptions} onChange={(val) => setState(val)} />\n\t\t\t\t</Field.Row>\n\t\t\t\t<Field.Error>{selectError}</Field.Error>\n\t\t\t</Field>\n\t\t),\n\t\t[className, label, t, name, required, selectError, state, mappedOptions, setState],\n\t);\n};\n\nconst CustomFieldsAssembler = ({ formValues, formHandlers, customFields, ...props }) =>\n\tObject.entries(customFields).map(([key, value]) => {\n\t\tconst extraProps = {\n\t\t\tkey,\n\t\t\tname: key,\n\t\t\tsetState: formHandlers[`handle${capitalize(key)}`],\n\t\t\tstate: formValues[key],\n\t\t\t...value,\n\t\t};\n\n\t\tif (value.type === 'select') {\n\t\t\treturn <CustomSelect {...extraProps} {...props} />;\n\t\t}\n\n\t\tif (value.type === 'text') {\n\t\t\treturn <CustomTextInput {...extraProps} {...props} />;\n\t\t}\n\n\t\treturn null;\n\t});\n\nexport default function CustomFieldsForm({ jsonCustomFields, customFieldsData, setCustomFieldsData, onLoadFields = () => {}, ...props }) {\n\tconst accountsCustomFieldsJson = useSetting('Accounts_CustomFields');\n\n\tconst [customFields] = useState(() => {\n\t\ttry {\n\t\t\treturn jsonCustomFields || JSON.parse(accountsCustomFieldsJson || '{}');\n\t\t} catch {\n\t\t\treturn {};\n\t\t}\n\t});\n\n\tconst hasCustomFields = Boolean(Object.values(customFields).length);\n\tconst defaultFields = useMemo(\n\t\t() =>\n\t\t\tObject.entries(customFields).reduce((data, [key, value]) => {\n\t\t\t\tdata[key] = value.defaultValue ?? '';\n\t\t\t\treturn data;\n\t\t\t}, {}),\n\t\t[customFields],\n\t);\n\n\tconst { values, handlers } = useForm({ ...defaultFields, ...customFieldsData });\n\n\tuseEffect(() => {\n\t\tonLoadFields(hasCustomFields);\n\t\tif (hasCustomFields) {\n\t\t\tsetCustomFieldsData(values);\n\t\t}\n\t}, [hasCustomFields, onLoadFields, setCustomFieldsData, values]);\n\n\tif (!hasCustomFields) {\n\t\treturn null;\n\t}\n\n\treturn <CustomFieldsAssembler formValues={values} formHandlers={handlers} customFields={customFields} {...props} />;\n}\n"]},"sourceType":"module","hash":"6b212a2e54871507127c8b5774b58557de171f2d"}
