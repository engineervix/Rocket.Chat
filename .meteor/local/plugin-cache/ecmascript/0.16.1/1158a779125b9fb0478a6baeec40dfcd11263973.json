{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/users/UsersPage.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/admin/users/UsersPage.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/users/UsersPage.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/views/admin/users/UsersPage.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/admin/users/UsersPage.js"}},"code":"var _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nvar useDebouncedValue;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useDebouncedValue: function (v) {\n    useDebouncedValue = v;\n  }\n}, 0);\nvar React, useEffect, useMemo, useState;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  },\n  useState: function (v) {\n    useState = v;\n  }\n}, 1);\nvar UserPageHeaderContentWithSeatsCap;\nmodule.link(\"../../../../ee/client/views/admin/users/UserPageHeaderContentWithSeatsCap\", {\n  \"default\": function (v) {\n    UserPageHeaderContentWithSeatsCap = v;\n  }\n}, 2);\nvar useSeatsCap;\nmodule.link(\"../../../../ee/client/views/admin/users/useSeatsCap\", {\n  useSeatsCap: function (v) {\n    useSeatsCap = v;\n  }\n}, 3);\nvar Page;\nmodule.link(\"../../../components/Page\", {\n  \"default\": function (v) {\n    Page = v;\n  }\n}, 4);\nvar VerticalBar;\nmodule.link(\"../../../components/VerticalBar\", {\n  \"default\": function (v) {\n    VerticalBar = v;\n  }\n}, 5);\nvar useRoute, useRouteParameter;\nmodule.link(\"../../../contexts/RouterContext\", {\n  useRoute: function (v) {\n    useRoute = v;\n  },\n  useRouteParameter: function (v) {\n    useRouteParameter = v;\n  }\n}, 6);\nvar useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 7);\nvar useEndpointData;\nmodule.link(\"../../../hooks/useEndpointData\", {\n  useEndpointData: function (v) {\n    useEndpointData = v;\n  }\n}, 8);\nvar AddUser;\nmodule.link(\"./AddUser\", {\n  AddUser: function (v) {\n    AddUser = v;\n  }\n}, 9);\nvar EditUserWithData;\nmodule.link(\"./EditUserWithData\", {\n  \"default\": function (v) {\n    EditUserWithData = v;\n  }\n}, 10);\nvar InviteUsers;\nmodule.link(\"./InviteUsers\", {\n  InviteUsers: function (v) {\n    InviteUsers = v;\n  }\n}, 11);\nvar UserInfoWithData;\nmodule.link(\"./UserInfo\", {\n  UserInfoWithData: function (v) {\n    UserInfoWithData = v;\n  }\n}, 12);\nvar UserPageHeaderContent;\nmodule.link(\"./UserPageHeaderContent\", {\n  \"default\": function (v) {\n    UserPageHeaderContent = v;\n  }\n}, 13);\nvar UsersTable;\nmodule.link(\"./UsersTable\", {\n  \"default\": function (v) {\n    UsersTable = v;\n  }\n}, 14);\n\nvar sortDir = function (sortDir) {\n  return sortDir === 'asc' ? 1 : -1;\n};\n\nvar useQuery = function (_ref, sortFields) {\n  var text = _ref.text,\n      itemsPerPage = _ref.itemsPerPage,\n      current = _ref.current;\n  return useMemo(function () {\n    return _objectSpread(_objectSpread({\n      fields: JSON.stringify({\n        name: 1,\n        username: 1,\n        emails: 1,\n        roles: 1,\n        status: 1,\n        avatarETag: 1,\n        active: 1\n      }),\n      query: JSON.stringify({\n        $or: [{\n          'emails.address': {\n            $regex: text || '',\n            $options: 'i'\n          }\n        }, {\n          username: {\n            $regex: text || '',\n            $options: 'i'\n          }\n        }, {\n          name: {\n            $regex: text || '',\n            $options: 'i'\n          }\n        }]\n      }),\n      sort: JSON.stringify(sortFields.reduce(function (agg, _ref2) {\n        var _ref3 = _slicedToArray(_ref2, 2),\n            column = _ref3[0],\n            direction = _ref3[1];\n\n        agg[column] = sortDir(direction);\n        return agg;\n      }, {}))\n    }, itemsPerPage && {\n      count: itemsPerPage\n    }), current && {\n      offset: current\n    });\n  }, [text, itemsPerPage, current, sortFields]);\n};\n\nfunction UsersPage() {\n  var context = useRouteParameter('context');\n  var id = useRouteParameter('id');\n  var seatsCap = useSeatsCap();\n  var usersRoute = useRoute('admin-users');\n  useEffect(function () {\n    if (!context || !seatsCap) {\n      return;\n    }\n\n    if (seatsCap.activeUsers >= seatsCap.maxActiveUsers && !['edit', 'info'].includes(context)) {\n      usersRoute.push({});\n    }\n  }, [context, seatsCap, usersRoute]);\n  var t = useTranslation();\n\n  var handleVerticalBarCloseButtonClick = function () {\n    usersRoute.push({});\n  };\n\n  var _useState = useState({\n    text: '',\n    current: 0,\n    itemsPerPage: 25\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      params = _useState2[0],\n      setParams = _useState2[1];\n\n  var _useState3 = useState([['name', 'asc'], ['usernames', 'asc']]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      sort = _useState4[0],\n      setSort = _useState4[1];\n\n  var debouncedParams = useDebouncedValue(params, 500);\n  var debouncedSort = useDebouncedValue(sort, 500);\n  var query = useQuery(debouncedParams, debouncedSort);\n\n  var _useEndpointData = useEndpointData('users.list', query),\n      _useEndpointData$valu = _useEndpointData.value,\n      data = _useEndpointData$valu === void 0 ? {} : _useEndpointData$valu,\n      reloadList = _useEndpointData.reload;\n\n  var reload = function () {\n    seatsCap === null || seatsCap === void 0 ? void 0 : seatsCap.reload();\n    reloadList();\n  };\n\n  return /*#__PURE__*/React.createElement(Page, {\n    flexDirection: \"row\"\n  }, /*#__PURE__*/React.createElement(Page, null, /*#__PURE__*/React.createElement(Page.Header, {\n    title: t('Users')\n  }, seatsCap && (seatsCap.maxActiveUsers < Number.POSITIVE_INFINITY ? /*#__PURE__*/React.createElement(UserPageHeaderContentWithSeatsCap, seatsCap) : /*#__PURE__*/React.createElement(UserPageHeaderContent, null))), /*#__PURE__*/React.createElement(Page.Content, null, /*#__PURE__*/React.createElement(UsersTable, {\n    users: data.users,\n    total: data.total,\n    params: params,\n    onChangeParams: setParams,\n    sort: sort,\n    onChangeSort: setSort\n  }))), context && /*#__PURE__*/React.createElement(VerticalBar, null, /*#__PURE__*/React.createElement(VerticalBar.Header, null, context === 'info' && t('User_Info'), context === 'edit' && t('Edit_User'), context === 'new' && t('Add_User'), context === 'invite' && t('Invite_Users'), /*#__PURE__*/React.createElement(VerticalBar.Close, {\n    onClick: handleVerticalBarCloseButtonClick\n  })), context === 'info' && id && /*#__PURE__*/React.createElement(UserInfoWithData, {\n    uid: id,\n    onReload: reload\n  }), context === 'edit' && /*#__PURE__*/React.createElement(EditUserWithData, {\n    uid: id,\n    onReload: reload\n  }), context === 'new' && /*#__PURE__*/React.createElement(AddUser, {\n    onReload: reload\n  }), context === 'invite' && /*#__PURE__*/React.createElement(InviteUsers, null)));\n}\n\nmodule.exportDefault(UsersPage);","map":{"version":3,"sources":["client/views/admin/users/UsersPage.js"],"names":["_slicedToArray","module","link","default","v","_objectSpread","useDebouncedValue","React","useEffect","useMemo","useState","UserPageHeaderContentWithSeatsCap","useSeatsCap","Page","VerticalBar","useRoute","useRouteParameter","useTranslation","useEndpointData","AddUser","EditUserWithData","InviteUsers","UserInfoWithData","UserPageHeaderContent","UsersTable","sortDir","useQuery","sortFields","text","itemsPerPage","current","fields","JSON","stringify","name","username","emails","roles","status","avatarETag","active","query","$or","$regex","$options","sort","reduce","agg","column","direction","count","offset","UsersPage","context","id","seatsCap","usersRoute","activeUsers","maxActiveUsers","includes","push","t","handleVerticalBarCloseButtonClick","params","setParams","setSort","debouncedParams","debouncedSort","value","data","reloadList","reload","Number","POSITIVE_INFINITY","users","total","exportDefault"],"mappings":"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","sourcesContent":["import { useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport UserPageHeaderContentWithSeatsCap from '../../../../ee/client/views/admin/users/UserPageHeaderContentWithSeatsCap';\nimport { useSeatsCap } from '../../../../ee/client/views/admin/users/useSeatsCap';\nimport Page from '../../../components/Page';\nimport VerticalBar from '../../../components/VerticalBar';\nimport { useRoute, useRouteParameter } from '../../../contexts/RouterContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useEndpointData } from '../../../hooks/useEndpointData';\nimport { AddUser } from './AddUser';\nimport EditUserWithData from './EditUserWithData';\nimport { InviteUsers } from './InviteUsers';\nimport { UserInfoWithData } from './UserInfo';\nimport UserPageHeaderContent from './UserPageHeaderContent';\nimport UsersTable from './UsersTable';\n\nconst sortDir = (sortDir) => (sortDir === 'asc' ? 1 : -1);\n\nconst useQuery = ({ text, itemsPerPage, current }, sortFields) =>\n\tuseMemo(\n\t\t() => ({\n\t\t\tfields: JSON.stringify({\n\t\t\t\tname: 1,\n\t\t\t\tusername: 1,\n\t\t\t\temails: 1,\n\t\t\t\troles: 1,\n\t\t\t\tstatus: 1,\n\t\t\t\tavatarETag: 1,\n\t\t\t\tactive: 1,\n\t\t\t}),\n\t\t\tquery: JSON.stringify({\n\t\t\t\t$or: [\n\t\t\t\t\t{ 'emails.address': { $regex: text || '', $options: 'i' } },\n\t\t\t\t\t{ username: { $regex: text || '', $options: 'i' } },\n\t\t\t\t\t{ name: { $regex: text || '', $options: 'i' } },\n\t\t\t\t],\n\t\t\t}),\n\t\t\tsort: JSON.stringify(\n\t\t\t\tsortFields.reduce((agg, [column, direction]) => {\n\t\t\t\t\tagg[column] = sortDir(direction);\n\t\t\t\t\treturn agg;\n\t\t\t\t}, {}),\n\t\t\t),\n\t\t\t...(itemsPerPage && { count: itemsPerPage }),\n\t\t\t...(current && { offset: current }),\n\t\t}),\n\t\t[text, itemsPerPage, current, sortFields],\n\t);\n\nfunction UsersPage() {\n\tconst context = useRouteParameter('context');\n\tconst id = useRouteParameter('id');\n\tconst seatsCap = useSeatsCap();\n\tconst usersRoute = useRoute('admin-users');\n\n\tuseEffect(() => {\n\t\tif (!context || !seatsCap) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (seatsCap.activeUsers >= seatsCap.maxActiveUsers && !['edit', 'info'].includes(context)) {\n\t\t\tusersRoute.push({});\n\t\t}\n\t}, [context, seatsCap, usersRoute]);\n\n\tconst t = useTranslation();\n\n\tconst handleVerticalBarCloseButtonClick = () => {\n\t\tusersRoute.push({});\n\t};\n\tconst [params, setParams] = useState({ text: '', current: 0, itemsPerPage: 25 });\n\tconst [sort, setSort] = useState([\n\t\t['name', 'asc'],\n\t\t['usernames', 'asc'],\n\t]);\n\n\tconst debouncedParams = useDebouncedValue(params, 500);\n\tconst debouncedSort = useDebouncedValue(sort, 500);\n\tconst query = useQuery(debouncedParams, debouncedSort);\n\tconst { value: data = {}, reload: reloadList } = useEndpointData('users.list', query);\n\n\tconst reload = () => {\n\t\tseatsCap?.reload();\n\t\treloadList();\n\t};\n\n\treturn (\n\t\t<Page flexDirection='row'>\n\t\t\t<Page>\n\t\t\t\t<Page.Header title={t('Users')}>\n\t\t\t\t\t{seatsCap &&\n\t\t\t\t\t\t(seatsCap.maxActiveUsers < Number.POSITIVE_INFINITY ? (\n\t\t\t\t\t\t\t<UserPageHeaderContentWithSeatsCap {...seatsCap} />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<UserPageHeaderContent />\n\t\t\t\t\t\t))}\n\t\t\t\t</Page.Header>\n\t\t\t\t<Page.Content>\n\t\t\t\t\t<UsersTable users={data.users} total={data.total} params={params} onChangeParams={setParams} sort={sort} onChangeSort={setSort} />\n\t\t\t\t</Page.Content>\n\t\t\t</Page>\n\t\t\t{context && (\n\t\t\t\t<VerticalBar>\n\t\t\t\t\t<VerticalBar.Header>\n\t\t\t\t\t\t{context === 'info' && t('User_Info')}\n\t\t\t\t\t\t{context === 'edit' && t('Edit_User')}\n\t\t\t\t\t\t{context === 'new' && t('Add_User')}\n\t\t\t\t\t\t{context === 'invite' && t('Invite_Users')}\n\t\t\t\t\t\t<VerticalBar.Close onClick={handleVerticalBarCloseButtonClick} />\n\t\t\t\t\t</VerticalBar.Header>\n\n\t\t\t\t\t{context === 'info' && id && <UserInfoWithData uid={id} onReload={reload} />}\n\t\t\t\t\t{context === 'edit' && <EditUserWithData uid={id} onReload={reload} />}\n\t\t\t\t\t{context === 'new' && <AddUser onReload={reload} />}\n\t\t\t\t\t{context === 'invite' && <InviteUsers />}\n\t\t\t\t</VerticalBar>\n\t\t\t)}\n\t\t</Page>\n\t);\n}\n\nexport default UsersPage;\n"]},"sourceType":"module","hash":"1158a779125b9fb0478a6baeec40dfcd11263973"}
