{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/popover.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-utils/client/lib/popover.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/popover.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-utils/client/lib/popover.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-utils/client/lib/popover.js"}},"code":"const _excluded = [\"currentTarget\"];\n\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 1);\nmodule.export({\n  popover: () => popover\n});\nmodule.link(\"./popover.html\");\nlet Blaze;\nmodule.link(\"meteor/blaze\", {\n  Blaze(v) {\n    Blaze = v;\n  }\n\n}, 0);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 1);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 2);\nlet messageBox;\nmodule.link(\"./messageBox\", {\n  messageBox(v) {\n    messageBox = v;\n  }\n\n}, 3);\nlet MessageAction;\nmodule.link(\"./MessageAction\", {\n  MessageAction(v) {\n    MessageAction = v;\n  }\n\n}, 4);\nlet isRtl;\nmodule.link(\"../../../utils/client\", {\n  isRtl(v) {\n    isRtl = v;\n  }\n\n}, 5);\nconst popover = {\n  renderedPopover: null,\n\n  open(_ref) {\n    let {\n      currentTarget\n    } = _ref,\n        config = _objectWithoutProperties(_ref, _excluded);\n\n    // Popover position must be computed as soon as possible, avoiding DOM changes over currentTarget\n    const data = _objectSpread({\n      targetRect: currentTarget === null || currentTarget === void 0 ? void 0 : currentTarget.getBoundingClientRect()\n    }, config);\n\n    this.renderedPopover = Blaze.renderWithData(Template.popover, data, document.body);\n  },\n\n  close() {\n    if (!this.renderedPopover) {\n      return false;\n    }\n\n    Blaze.remove(this.renderedPopover);\n    const {\n      activeElement\n    } = this.renderedPopover.dataVar.curValue;\n\n    if (activeElement) {\n      $(activeElement).removeClass('active');\n    }\n  }\n\n};\nTemplate.popover.helpers({\n  hasAction() {\n    return !!this.action;\n  }\n\n});\nTemplate.popover.onRendered(function () {\n  if (this.data.onRendered) {\n    this.data.onRendered();\n  }\n\n  $('.rc-popover').click(function (e) {\n    if (e.currentTarget === e.target) {\n      popover.close();\n    }\n  });\n  const {\n    offsetVertical = 0,\n    offsetHorizontal = 0\n  } = this.data;\n  const {\n    activeElement\n  } = this.data;\n  const originalWidth = window.innerWidth;\n  const popoverContent = this.firstNode.children[0];\n\n  const position = _.throttle(() => {\n    const direction = typeof this.data.direction === 'function' ? this.data.direction() : this.data.direction;\n    const verticalDirection = /top/.test(direction) ? 'top' : 'bottom';\n    const rtlDirection = isRtl() ^ /inverted/.test(direction) ? 'left' : 'right';\n    const rightDirection = /right/.test(direction) ? 'right' : rtlDirection;\n    const horizontalDirection = /left/.test(direction) ? 'left' : rightDirection;\n    const position = typeof this.data.position === 'function' ? this.data.position() : this.data.position;\n    const customCSSProperties = typeof this.data.customCSSProperties === 'function' ? this.data.customCSSProperties() : this.data.customCSSProperties;\n    const mousePosition = typeof this.data.mousePosition === 'function' ? this.data.mousePosition() : this.data.mousePosition || {\n      x: this.data.targetRect[horizontalDirection === 'left' ? 'right' : 'left'],\n      y: this.data.targetRect[verticalDirection]\n    };\n    const offsetWidth = offsetHorizontal * (horizontalDirection === 'left' ? 1 : -1);\n    const offsetHeight = offsetVertical * (verticalDirection === 'bottom' ? 1 : -1);\n    const leftDiff = window.innerWidth - originalWidth;\n\n    if (position) {\n      popoverContent.style.top = \"\".concat(position.top, \"px\");\n      popoverContent.style.left = \"\".concat(position.left + leftDiff, \"px\");\n    } else {\n      const clientHeight = this.data.targetRect.height;\n      const popoverWidth = popoverContent.offsetWidth;\n      const popoverHeight = popoverContent.offsetHeight;\n      const windowWidth = window.innerWidth;\n      const windowHeight = window.innerHeight;\n      let top = mousePosition.y - clientHeight + offsetHeight;\n\n      if (verticalDirection === 'top') {\n        top = mousePosition.y - popoverHeight + offsetHeight;\n\n        if (top < 0) {\n          top = 10 + offsetHeight;\n        }\n      }\n\n      if (top + popoverHeight > windowHeight) {\n        top = windowHeight - 10 - popoverHeight - offsetHeight;\n      }\n\n      let left = mousePosition.x - popoverWidth + offsetWidth;\n\n      if (horizontalDirection === 'right') {\n        left = mousePosition.x + offsetWidth;\n      }\n\n      if (left + popoverWidth >= windowWidth) {\n        left = mousePosition.x - popoverWidth + offsetWidth;\n      }\n\n      if (left <= 0) {\n        left = mousePosition.x + offsetWidth;\n      }\n\n      popoverContent.style.top = \"\".concat(top, \"px\");\n      popoverContent.style.left = \"\".concat(left + leftDiff, \"px\");\n    }\n\n    if (customCSSProperties) {\n      Object.keys(customCSSProperties).forEach(function (property) {\n        popoverContent.style[property] = customCSSProperties[property];\n      });\n    }\n\n    const realTop = Number(popoverContent.style.top.replace('px', ''));\n\n    if (realTop + popoverContent.offsetHeight > window.innerHeight) {\n      popoverContent.style.overflow = 'scroll';\n      popoverContent.style.bottom = 0;\n      popoverContent.className = 'rc-popover__content rc-popover__content-scroll';\n    }\n\n    if (activeElement) {\n      $(activeElement).addClass('active');\n    }\n\n    popoverContent.style.opacity = 1;\n  }, 50);\n\n  const observer = new MutationObserver(position);\n  observer.observe(popoverContent, {\n    childList: true,\n    subtree: true\n  });\n  $(window).on('resize', position);\n  position();\n  this.position = position;\n  this.observer = observer;\n  this.firstNode.style.visibility = 'visible';\n});\nTemplate.popover.onDestroyed(function () {\n  var _this$observer;\n\n  if (this.data.onDestroyed) {\n    this.data.onDestroyed();\n  }\n\n  $(window).off('resize', this.position);\n  (_this$observer = this.observer) === null || _this$observer === void 0 ? void 0 : _this$observer.disconnect();\n});\nTemplate.popover.events({\n  'click .js-action'(e, instance) {\n    !this.action || this.action.call(this, e, instance.data.data);\n    popover.close();\n  },\n\n  'click .js-close'() {\n    popover.close();\n  },\n\n  'click [data-type=\"messagebox-action\"]'(event, t) {\n    const {\n      id\n    } = event.currentTarget.dataset;\n    const actions = messageBox.actions.getById(id);\n    actions.filter(_ref2 => {\n      let {\n        action\n      } = _ref2;\n      return !!action;\n    }).forEach(_ref3 => {\n      let {\n        action\n      } = _ref3;\n      action.call(null, _objectSpread(_objectSpread({}, t.data.data), {}, {\n        event\n      }));\n    });\n    popover.close();\n  },\n\n  'click [data-type=\"message-action\"]'(e, t) {\n    const button = MessageAction.getButtonById(e.currentTarget.dataset.id);\n\n    if ((button != null ? button.action : undefined) != null) {\n      e.stopPropagation();\n      e.preventDefault();\n      const {\n        tabBar,\n        rid\n      } = t.data.instance;\n      button.action.call(t.data.data, e, {\n        tabBar,\n        rid\n      });\n      popover.close();\n      return false;\n    }\n  }\n\n});\nTemplate.popover.helpers({\n  isSafariIos: /iP(ad|hone|od).+Version\\/[\\d\\.]+.*Safari/i.test(navigator.userAgent)\n});","map":{"version":3,"sources":["app/ui-utils/client/lib/popover.js"],"names":["_objectSpread","module","link","default","v","_objectWithoutProperties","export","popover","Blaze","Template","_","messageBox","MessageAction","isRtl","renderedPopover","open","currentTarget","config","data","targetRect","getBoundingClientRect","renderWithData","document","body","close","remove","activeElement","dataVar","curValue","$","removeClass","helpers","hasAction","action","onRendered","click","e","target","offsetVertical","offsetHorizontal","originalWidth","window","innerWidth","popoverContent","firstNode","children","position","throttle","direction","verticalDirection","test","rtlDirection","rightDirection","horizontalDirection","customCSSProperties","mousePosition","x","y","offsetWidth","offsetHeight","leftDiff","style","top","left","clientHeight","height","popoverWidth","popoverHeight","windowWidth","windowHeight","innerHeight","Object","keys","forEach","property","realTop","Number","replace","overflow","bottom","className","addClass","opacity","observer","MutationObserver","observe","childList","subtree","on","visibility","onDestroyed","off","disconnect","events","instance","call","event","t","id","dataset","actions","getById","filter","button","getButtonById","undefined","stopPropagation","preventDefault","tabBar","rid","isSafariIos","navigator","userAgent"],"mappings":"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","sourcesContent":["import './popover.html';\nimport { Blaze } from 'meteor/blaze';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\n\nimport { messageBox } from './messageBox';\nimport { MessageAction } from './MessageAction';\nimport { isRtl } from '../../../utils/client';\n\nexport const popover = {\n\trenderedPopover: null,\n\topen({ currentTarget, ...config }) {\n\t\t// Popover position must be computed as soon as possible, avoiding DOM changes over currentTarget\n\t\tconst data = {\n\t\t\ttargetRect: currentTarget?.getBoundingClientRect(),\n\t\t\t...config,\n\t\t};\n\t\tthis.renderedPopover = Blaze.renderWithData(Template.popover, data, document.body);\n\t},\n\tclose() {\n\t\tif (!this.renderedPopover) {\n\t\t\treturn false;\n\t\t}\n\n\t\tBlaze.remove(this.renderedPopover);\n\n\t\tconst { activeElement } = this.renderedPopover.dataVar.curValue;\n\t\tif (activeElement) {\n\t\t\t$(activeElement).removeClass('active');\n\t\t}\n\t},\n};\n\nTemplate.popover.helpers({\n\thasAction() {\n\t\treturn !!this.action;\n\t},\n});\n\nTemplate.popover.onRendered(function () {\n\tif (this.data.onRendered) {\n\t\tthis.data.onRendered();\n\t}\n\n\t$('.rc-popover').click(function (e) {\n\t\tif (e.currentTarget === e.target) {\n\t\t\tpopover.close();\n\t\t}\n\t});\n\tconst { offsetVertical = 0, offsetHorizontal = 0 } = this.data;\n\tconst { activeElement } = this.data;\n\tconst originalWidth = window.innerWidth;\n\tconst popoverContent = this.firstNode.children[0];\n\tconst position = _.throttle(() => {\n\t\tconst direction = typeof this.data.direction === 'function' ? this.data.direction() : this.data.direction;\n\n\t\tconst verticalDirection = /top/.test(direction) ? 'top' : 'bottom';\n\t\tconst rtlDirection = isRtl() ^ /inverted/.test(direction) ? 'left' : 'right';\n\t\tconst rightDirection = /right/.test(direction) ? 'right' : rtlDirection;\n\t\tconst horizontalDirection = /left/.test(direction) ? 'left' : rightDirection;\n\n\t\tconst position = typeof this.data.position === 'function' ? this.data.position() : this.data.position;\n\t\tconst customCSSProperties =\n\t\t\ttypeof this.data.customCSSProperties === 'function' ? this.data.customCSSProperties() : this.data.customCSSProperties;\n\n\t\tconst mousePosition =\n\t\t\ttypeof this.data.mousePosition === 'function'\n\t\t\t\t? this.data.mousePosition()\n\t\t\t\t: this.data.mousePosition || {\n\t\t\t\t\t\tx: this.data.targetRect[horizontalDirection === 'left' ? 'right' : 'left'],\n\t\t\t\t\t\ty: this.data.targetRect[verticalDirection],\n\t\t\t\t  };\n\t\tconst offsetWidth = offsetHorizontal * (horizontalDirection === 'left' ? 1 : -1);\n\t\tconst offsetHeight = offsetVertical * (verticalDirection === 'bottom' ? 1 : -1);\n\n\t\tconst leftDiff = window.innerWidth - originalWidth;\n\n\t\tif (position) {\n\t\t\tpopoverContent.style.top = `${position.top}px`;\n\t\t\tpopoverContent.style.left = `${position.left + leftDiff}px`;\n\t\t} else {\n\t\t\tconst clientHeight = this.data.targetRect.height;\n\t\t\tconst popoverWidth = popoverContent.offsetWidth;\n\t\t\tconst popoverHeight = popoverContent.offsetHeight;\n\t\t\tconst windowWidth = window.innerWidth;\n\t\t\tconst windowHeight = window.innerHeight;\n\n\t\t\tlet top = mousePosition.y - clientHeight + offsetHeight;\n\n\t\t\tif (verticalDirection === 'top') {\n\t\t\t\ttop = mousePosition.y - popoverHeight + offsetHeight;\n\n\t\t\t\tif (top < 0) {\n\t\t\t\t\ttop = 10 + offsetHeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (top + popoverHeight > windowHeight) {\n\t\t\t\ttop = windowHeight - 10 - popoverHeight - offsetHeight;\n\t\t\t}\n\n\t\t\tlet left = mousePosition.x - popoverWidth + offsetWidth;\n\n\t\t\tif (horizontalDirection === 'right') {\n\t\t\t\tleft = mousePosition.x + offsetWidth;\n\t\t\t}\n\n\t\t\tif (left + popoverWidth >= windowWidth) {\n\t\t\t\tleft = mousePosition.x - popoverWidth + offsetWidth;\n\t\t\t}\n\n\t\t\tif (left <= 0) {\n\t\t\t\tleft = mousePosition.x + offsetWidth;\n\t\t\t}\n\n\t\t\tpopoverContent.style.top = `${top}px`;\n\t\t\tpopoverContent.style.left = `${left + leftDiff}px`;\n\t\t}\n\n\t\tif (customCSSProperties) {\n\t\t\tObject.keys(customCSSProperties).forEach(function (property) {\n\t\t\t\tpopoverContent.style[property] = customCSSProperties[property];\n\t\t\t});\n\t\t}\n\n\t\tconst realTop = Number(popoverContent.style.top.replace('px', ''));\n\t\tif (realTop + popoverContent.offsetHeight > window.innerHeight) {\n\t\t\tpopoverContent.style.overflow = 'scroll';\n\t\t\tpopoverContent.style.bottom = 0;\n\t\t\tpopoverContent.className = 'rc-popover__content rc-popover__content-scroll';\n\t\t}\n\n\t\tif (activeElement) {\n\t\t\t$(activeElement).addClass('active');\n\t\t}\n\t\tpopoverContent.style.opacity = 1;\n\t}, 50);\n\n\tconst observer = new MutationObserver(position);\n\tobserver.observe(popoverContent, { childList: true, subtree: true });\n\n\t$(window).on('resize', position);\n\tposition();\n\tthis.position = position;\n\tthis.observer = observer;\n\n\tthis.firstNode.style.visibility = 'visible';\n});\n\nTemplate.popover.onDestroyed(function () {\n\tif (this.data.onDestroyed) {\n\t\tthis.data.onDestroyed();\n\t}\n\t$(window).off('resize', this.position);\n\tthis.observer?.disconnect();\n});\n\nTemplate.popover.events({\n\t'click .js-action'(e, instance) {\n\t\t!this.action || this.action.call(this, e, instance.data.data);\n\t\tpopover.close();\n\t},\n\t'click .js-close'() {\n\t\tpopover.close();\n\t},\n\t'click [data-type=\"messagebox-action\"]'(event, t) {\n\t\tconst { id } = event.currentTarget.dataset;\n\t\tconst actions = messageBox.actions.getById(id);\n\t\tactions\n\t\t\t.filter(({ action }) => !!action)\n\t\t\t.forEach(({ action }) => {\n\t\t\t\taction.call(null, {\n\t\t\t\t\t...t.data.data,\n\t\t\t\t\tevent,\n\t\t\t\t});\n\t\t\t});\n\t\tpopover.close();\n\t},\n\t'click [data-type=\"message-action\"]'(e, t) {\n\t\tconst button = MessageAction.getButtonById(e.currentTarget.dataset.id);\n\t\tif ((button != null ? button.action : undefined) != null) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconst { tabBar, rid } = t.data.instance;\n\t\t\tbutton.action.call(t.data.data, e, { tabBar, rid });\n\t\t\tpopover.close();\n\t\t\treturn false;\n\t\t}\n\t},\n});\n\nTemplate.popover.helpers({\n\tisSafariIos: /iP(ad|hone|od).+Version\\/[\\d\\.]+.*Safari/i.test(navigator.userAgent),\n});\n"]},"sourceType":"module","hash":"20f3bfcd3b14b58800b4df59ec71139089755ccc"}
