{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/threads/client/flextab/thread.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/threads/client/flextab/thread.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/threads/client/flextab/thread.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/threads/client/flextab/thread.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/threads/client/flextab/thread.js"}},"code":"var _excluded = [\"context\", \"tab\"],\n    _excluded2 = [\"_id\"],\n    _excluded3 = [\"_id\"];\n\nvar _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default: function (v) {\n    _objectWithoutProperties = v;\n  }\n}, 1);\n\nvar _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 2);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Mongo;\nmodule.link(\"meteor/mongo\", {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 2);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 3);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 4);\nvar ReactiveDict;\nmodule.link(\"meteor/reactive-dict\", {\n  ReactiveDict: function (v) {\n    ReactiveDict = v;\n  }\n}, 5);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 6);\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 7);\nvar chatMessages, ChatMessages;\nmodule.link(\"../../../ui\", {\n  chatMessages: function (v) {\n    chatMessages = v;\n  },\n  ChatMessages: function (v) {\n    ChatMessages = v;\n  }\n}, 8);\nvar callWithErrorHandling;\nmodule.link(\"../../../../client/lib/utils/callWithErrorHandling\", {\n  callWithErrorHandling: function (v) {\n    callWithErrorHandling = v;\n  }\n}, 9);\nvar messageContext;\nmodule.link(\"../../../ui-utils/client/lib/messageContext\", {\n  messageContext: function (v) {\n    messageContext = v;\n  }\n}, 10);\nvar upsertMessageBulk;\nmodule.link(\"../../../ui-utils/client/lib/RoomHistoryManager\", {\n  upsertMessageBulk: function (v) {\n    upsertMessageBulk = v;\n  }\n}, 11);\nvar Messages;\nmodule.link(\"../../../models\", {\n  Messages: function (v) {\n    Messages = v;\n  }\n}, 12);\nvar fileUpload;\nmodule.link(\"../../../ui/client/lib/fileUpload\", {\n  fileUpload: function (v) {\n    fileUpload = v;\n  }\n}, 13);\nvar dropzoneEvents, dropzoneHelpers;\nmodule.link(\"../../../ui/client/views/app/room\", {\n  dropzoneEvents: function (v) {\n    dropzoneEvents = v;\n  },\n  dropzoneHelpers: function (v) {\n    dropzoneHelpers = v;\n  }\n}, 14);\nmodule.link(\"./thread.html\");\nvar getUserPreference;\nmodule.link(\"../../../utils\", {\n  getUserPreference: function (v) {\n    getUserPreference = v;\n  }\n}, 15);\nvar settings;\nmodule.link(\"../../../settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 16);\nvar callbacks;\nmodule.link(\"../../../../lib/callbacks\", {\n  callbacks: function (v) {\n    callbacks = v;\n  }\n}, 17);\nmodule.link(\"./messageBoxFollow\");\nvar getCommonRoomEvents;\nmodule.link(\"../../../ui/client/views/app/lib/getCommonRoomEvents\", {\n  getCommonRoomEvents: function (v) {\n    getCommonRoomEvents = v;\n  }\n}, 18);\nvar keyCodes;\nmodule.link(\"../../../../client/lib/utils/keyCodes\", {\n  keyCodes: function (v) {\n    keyCodes = v;\n  }\n}, 19);\nvar sort = {\n  ts: 1\n};\nTemplate.thread.events(_objectSpread(_objectSpread(_objectSpread({}, dropzoneEvents), getCommonRoomEvents()), {}, {\n  'click .js-close': function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    var close = this.close;\n    return close && close();\n  },\n  'scroll .js-scroll-thread': _.throttle(function (_ref, i) {\n    var e = _ref.currentTarget;\n    i.atBottom = e.scrollTop >= e.scrollHeight - e.clientHeight;\n  }, 150),\n  'click .toggle-hidden': function (e) {\n    var id = e.currentTarget.dataset.message;\n    document.querySelector(\"#thread-\" + id).classList.toggle('message--ignored');\n  }\n}));\nTemplate.thread.helpers(_objectSpread(_objectSpread({}, dropzoneHelpers), {}, {\n  mainMessage: function () {\n    var _Template$instance = Template.instance(),\n        Threads = _Template$instance.Threads,\n        state = _Template$instance.state;\n\n    var tmid = state.get('tmid');\n    return Threads.findOne({\n      _id: tmid\n    });\n  },\n  isLoading: function () {\n    return Template.instance().state.get('loading') !== false;\n  },\n  messages: function () {\n    var _Template$instance2 = Template.instance(),\n        Threads = _Template$instance2.Threads,\n        state = _Template$instance2.state;\n\n    var tmid = state.get('tmid');\n    return Threads.find({\n      tmid: tmid,\n      _id: {\n        $ne: tmid\n      }\n    }, {\n      sort: sort\n    });\n  },\n  messageContext: function () {\n    var result = messageContext.call(this, {\n      rid: this.mainMessage.rid\n    });\n    return _objectSpread(_objectSpread({}, result), {}, {\n      settings: _objectSpread(_objectSpread({}, result.settings), {}, {\n        showReplyButton: false,\n        showreply: false\n      })\n    });\n  },\n  messageBoxData: function () {\n    var instance = Template.instance();\n\n    var _Template$currentData = Template.currentData(),\n        _Template$currentData2 = _Template$currentData.mainMessage,\n        rid = _Template$currentData2.rid,\n        tmid = _Template$currentData2._id,\n        subscription = _Template$currentData.subscription;\n\n    var showFormattingTips = settings.get('Message_ShowFormattingTips');\n    return {\n      showFormattingTips: showFormattingTips,\n      tshow: instance.state.get('sendToChannel'),\n      subscription: subscription,\n      rid: rid,\n      tmid: tmid,\n      onSend: function () {\n        instance.sendToBottom();\n        instance.state.set('sendToChannel', false);\n\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        return instance.chatMessages && instance.chatMessages.send.apply(instance.chatMessages, args);\n      },\n      onKeyUp: function () {\n        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n          args[_key2] = arguments[_key2];\n        }\n\n        return instance.chatMessages && instance.chatMessages.keyup.apply(instance.chatMessages, args);\n      },\n      onKeyDown: function () {\n        for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n          args[_key3] = arguments[_key3];\n        }\n\n        var result = instance.chatMessages && instance.chatMessages.keydown.apply(instance.chatMessages, args);\n        var event = args[0];\n        var keyCode = event.which;\n\n        if (keyCode === keyCodes.ESCAPE && !result && !event.target.value.trim()) {\n          var _FlowRouter$current = FlowRouter.current(),\n              name = _FlowRouter$current.route.name,\n              _FlowRouter$current$p = _FlowRouter$current.params,\n              context = _FlowRouter$current$p.context,\n              tab = _FlowRouter$current$p.tab,\n              params = _objectWithoutProperties(_FlowRouter$current$p, _excluded);\n\n          FlowRouter.go(name, params);\n        }\n      }\n    };\n  },\n  hideUsername: function () {\n    return getUserPreference(Meteor.userId(), 'hideUsernames') ? 'hide-usernames' : undefined;\n  },\n  checkboxData: function () {\n    var instance = Template.instance();\n    var checked = instance.state.get('sendToChannel');\n    return {\n      id: 'sendAlso',\n      checked: checked,\n      onChange: function () {\n        return instance.state.set('sendToChannel', !checked);\n      }\n    };\n  }\n}));\nTemplate.thread.onRendered(function () {\n  var _this = this;\n\n  var rid = Tracker.nonreactive(function () {\n    return _this.state.get('rid');\n  });\n  var tmid = Tracker.nonreactive(function () {\n    return _this.state.get('tmid');\n  });\n  this.atBottom = true;\n  this.chatMessages = new ChatMessages(this.Threads);\n  this.chatMessages.initializeWrapper(this.find('.js-scroll-thread'));\n  this.chatMessages.initializeInput(this.find('.js-input-message'), {\n    rid: rid,\n    tmid: tmid\n  });\n  this.sendToBottom = _.throttle(function () {\n    _this.atBottom = true;\n    _this.chatMessages.wrapper.scrollTop = _this.chatMessages.wrapper.scrollHeight;\n  }, 300);\n\n  this.sendToBottomIfNecessary = function () {\n    _this.atBottom && _this.sendToBottom();\n  };\n\n  var observer = new ResizeObserver(this.sendToBottomIfNecessary);\n  observer.observe(this.firstNode.querySelector('.js-scroll-thread ul'));\n\n  this.onFile = function (filesToUpload) {\n    fileUpload(filesToUpload, _this.chatMessages.input, {\n      rid: _this.state.get('rid'),\n      tmid: _this.state.get('tmid')\n    });\n  };\n\n  this.autorun(function () {\n    var rid = _this.state.get('rid');\n\n    var tmid = _this.state.get('tmid');\n\n    if (!rid) {\n      return;\n    }\n\n    _this.callbackRemove && _this.callbackRemove();\n\n    _this.callbackRemove = function () {\n      return callbacks.remove('streamNewMessage', \"thread-\" + rid);\n    };\n\n    callbacks.add('streamNewMessage', _.debounce(function (msg) {\n      if (Session.get('openedRoom') !== msg.rid || rid !== msg.rid || msg.editedAt || msg.tmid !== tmid) {\n        return;\n      }\n\n      Meteor.call('readThreads', tmid);\n    }, 1000), callbacks.priority.MEDIUM, \"thread-\" + rid);\n  });\n  this.autorun(function () {\n    var tmid = _this.state.get('tmid');\n\n    _this.threadsObserve && _this.threadsObserve.stop();\n    _this.threadsObserve = Messages.find({\n      $or: [{\n        tmid: tmid\n      }, {\n        _id: tmid\n      }],\n      _hidden: {\n        $ne: true\n      }\n    }, {\n      fields: {\n        collapsed: 0,\n        threadMsg: 0,\n        repliesCount: 0\n      }\n    }).observe({\n      added: function (_ref2) {\n        var _id = _ref2._id,\n            message = _objectWithoutProperties(_ref2, _excluded2);\n\n        _this.Threads.upsert({\n          _id: _id\n        }, message);\n      },\n      changed: function (_ref3) {\n        var _id = _ref3._id,\n            message = _objectWithoutProperties(_ref3, _excluded3);\n\n        _this.Threads.update({\n          _id: _id\n        }, message);\n      },\n      removed: function (_ref4) {\n        var _id = _ref4._id;\n        return _this.Threads.remove(_id);\n      }\n    });\n\n    _this.loadMore();\n  });\n  this.autorun(function () {\n    var rid = _this.state.get('rid');\n\n    var tmid = _this.state.get('tmid');\n\n    _this.chatMessages.initializeInput(_this.find('.js-input-message'), {\n      rid: rid,\n      tmid: tmid\n    });\n\n    if (rid && tmid) {\n      chatMessages[rid + \"-\" + tmid] = _this.chatMessages;\n    }\n  });\n  this.autorun(function () {\n    FlowRouter.watchPathChange();\n    var jump = FlowRouter.getQueryParam('jump');\n\n    var _Template$currentData3 = Template.currentData(),\n        mainMessage = _Template$currentData3.mainMessage;\n\n    _this.state.set({\n      tmid: mainMessage._id,\n      rid: mainMessage.rid,\n      jump: jump\n    });\n  });\n  this.autorun(function () {\n    var jump = _this.state.get('jump');\n\n    var loading = _this.state.get('loading');\n\n    if (jump && _this.lastJump !== jump && loading === false) {\n      _this.lastJump = jump;\n      _this.find('.js-scroll-thread').style.scrollBehavior = 'smooth';\n\n      _this.state.set('jump', null);\n\n      Tracker.afterFlush(function () {\n        var message = _this.find(\"#thread-\" + jump);\n\n        message.classList.add('highlight');\n\n        var removeClass = function () {\n          message.classList.remove('highlight');\n          message.removeEventListener('animationend', removeClass);\n        };\n\n        message.addEventListener('animationend', removeClass);\n        setTimeout(function () {\n          message.scrollIntoView();\n        }, 300);\n      });\n    }\n  });\n});\nTemplate.thread.onCreated(function () {\n  function _callee2() {\n    var _this2 = this;\n\n    return _regeneratorRuntime.async(function () {\n      function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              this.Threads = new Mongo.Collection(null);\n              this.state = new ReactiveDict({\n                sendToChannel: !this.data.mainMessage.tcount\n              });\n\n              this.loadMore = function () {\n                function _callee() {\n                  var _Tracker$nonreactive, tmid, messages;\n\n                  return _regeneratorRuntime.async(function () {\n                    function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            _Tracker$nonreactive = Tracker.nonreactive(function () {\n                              return _this2.state.all();\n                            }), tmid = _Tracker$nonreactive.tmid;\n\n                            if (tmid) {\n                              _context.next = 3;\n                              break;\n                            }\n\n                            return _context.abrupt(\"return\");\n\n                          case 3:\n                            _this2.state.set('loading', true);\n\n                            _context.next = 6;\n                            return _regeneratorRuntime.awrap(callWithErrorHandling('getThreadMessages', {\n                              tmid: tmid\n                            }));\n\n                          case 6:\n                            messages = _context.sent;\n                            upsertMessageBulk({\n                              msgs: messages\n                            }, _this2.Threads);\n                            Tracker.afterFlush(function () {\n                              _this2.state.set('loading', false);\n                            });\n\n                          case 9:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }\n\n                    return _callee$;\n                  }(), null, null, null, Promise);\n                }\n\n                return _callee;\n              }();\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }\n\n      return _callee2$;\n    }(), null, this, null, Promise);\n  }\n\n  return _callee2;\n}());\nTemplate.thread.onDestroyed(function () {\n  var Threads = this.Threads,\n      threadsObserve = this.threadsObserve,\n      callbackRemove = this.callbackRemove,\n      state = this.state,\n      chatMessages = this.chatMessages;\n  Threads.remove({});\n  threadsObserve && threadsObserve.stop();\n  callbackRemove && callbackRemove();\n  var tmid = state.get('tmid');\n  var rid = state.get('rid');\n\n  if (rid && tmid) {\n    chatMessages.onDestroyed && chatMessages.onDestroyed(rid, tmid);\n    delete chatMessages[rid + \"-\" + tmid];\n  }\n});","map":{"version":3,"sources":["app/threads/client/flextab/thread.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectWithoutProperties","_objectSpread","_","Meteor","Mongo","Template","Session","ReactiveDict","Tracker","FlowRouter","chatMessages","ChatMessages","callWithErrorHandling","messageContext","upsertMessageBulk","Messages","fileUpload","dropzoneEvents","dropzoneHelpers","getUserPreference","settings","callbacks","getCommonRoomEvents","keyCodes","sort","ts","thread","events","e","preventDefault","stopPropagation","close","throttle","i","currentTarget","atBottom","scrollTop","scrollHeight","clientHeight","id","dataset","message","document","querySelector","classList","toggle","helpers","mainMessage","instance","Threads","state","tmid","get","findOne","_id","isLoading","messages","find","$ne","result","call","rid","showReplyButton","showreply","messageBoxData","currentData","subscription","showFormattingTips","tshow","onSend","sendToBottom","set","args","send","apply","onKeyUp","keyup","onKeyDown","keydown","event","keyCode","which","ESCAPE","target","value","trim","current","name","route","params","context","tab","go","hideUsername","userId","undefined","checkboxData","checked","onChange","onRendered","nonreactive","initializeWrapper","initializeInput","wrapper","sendToBottomIfNecessary","observer","ResizeObserver","observe","firstNode","onFile","filesToUpload","input","autorun","callbackRemove","remove","add","debounce","msg","editedAt","priority","MEDIUM","threadsObserve","stop","$or","_hidden","fields","collapsed","threadMsg","repliesCount","added","upsert","changed","update","removed","loadMore","watchPathChange","jump","getQueryParam","loading","lastJump","style","scrollBehavior","afterFlush","removeClass","removeEventListener","addEventListener","setTimeout","scrollIntoView","onCreated","Collection","sendToChannel","data","tcount","all","msgs","onDestroyed"],"mappings":";;;;AAAA,IAAIA,mBAAJ;;AAAwBC,MAAM,CAACC,IAAP,CAAY,4BAAZ,EAAyC;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACJ,IAAAA,mBAAmB,GAACI,CAApB;AAAsB;AAA3C,CAAzC,EAAsF,CAAtF;;AAAyF,IAAIC,wBAAJ;;AAA6BJ,MAAM,CAACC,IAAP,CAAY,gDAAZ,EAA6D;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACC,IAAAA,wBAAwB,GAACD,CAAzB;AAA2B;AAAhD,CAA7D,EAA+G,CAA/G;;AAAkH,IAAIE,aAAJ;;AAAkBL,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACE,IAAAA,aAAa,GAACF,CAAd;AAAgB;AAArC,CAAnD,EAA0F,CAA1F;;AAAlR,IAAIG,CAAJ;;AAAMN,MAAM,CAACC,IAAP,CAAY,YAAZ,EAAyB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACG,IAAAA,CAAC,GAACH,CAAF;AAAI;AAAzB,CAAzB,EAAoD,CAApD;AAAuD,IAAII,MAAJ;AAAWP,MAAM,CAACC,IAAP,CAAY,eAAZ,EAA4B;AAACM,EAAAA,MAAM,EAAC,UAASJ,CAAT,EAAW;AAACI,IAAAA,MAAM,GAACJ,CAAP;AAAS;AAA7B,CAA5B,EAA2D,CAA3D;AAA8D,IAAIK,KAAJ;AAAUR,MAAM,CAACC,IAAP,CAAY,cAAZ,EAA2B;AAACO,EAAAA,KAAK,EAAC,UAASL,CAAT,EAAW;AAACK,IAAAA,KAAK,GAACL,CAAN;AAAQ;AAA3B,CAA3B,EAAwD,CAAxD;AAA2D,IAAIM,QAAJ;AAAaT,MAAM,CAACC,IAAP,CAAY,mBAAZ,EAAgC;AAACQ,EAAAA,QAAQ,EAAC,UAASN,CAAT,EAAW;AAACM,IAAAA,QAAQ,GAACN,CAAT;AAAW;AAAjC,CAAhC,EAAmE,CAAnE;AAAsE,IAAIO,OAAJ;AAAYV,MAAM,CAACC,IAAP,CAAY,gBAAZ,EAA6B;AAACS,EAAAA,OAAO,EAAC,UAASP,CAAT,EAAW;AAACO,IAAAA,OAAO,GAACP,CAAR;AAAU;AAA/B,CAA7B,EAA8D,CAA9D;AAAiE,IAAIQ,YAAJ;AAAiBX,MAAM,CAACC,IAAP,CAAY,sBAAZ,EAAmC;AAACU,EAAAA,YAAY,EAAC,UAASR,CAAT,EAAW;AAACQ,IAAAA,YAAY,GAACR,CAAb;AAAe;AAAzC,CAAnC,EAA8E,CAA9E;AAAiF,IAAIS,OAAJ;AAAYZ,MAAM,CAACC,IAAP,CAAY,gBAAZ,EAA6B;AAACW,EAAAA,OAAO,EAAC,UAAST,CAAT,EAAW;AAACS,IAAAA,OAAO,GAACT,CAAR;AAAU;AAA/B,CAA7B,EAA8D,CAA9D;AAAiE,IAAIU,UAAJ;AAAeb,MAAM,CAACC,IAAP,CAAY,2BAAZ,EAAwC;AAACY,EAAAA,UAAU,EAAC,UAASV,CAAT,EAAW;AAACU,IAAAA,UAAU,GAACV,CAAX;AAAa;AAArC,CAAxC,EAA+E,CAA/E;AAAkF,IAAIW,YAAJ,EAAiBC,YAAjB;AAA8Bf,MAAM,CAACC,IAAP,CAAY,aAAZ,EAA0B;AAACa,EAAAA,YAAY,EAAC,UAASX,CAAT,EAAW;AAACW,IAAAA,YAAY,GAACX,CAAb;AAAe,GAAzC;AAA0CY,EAAAA,YAAY,EAAC,UAASZ,CAAT,EAAW;AAACY,IAAAA,YAAY,GAACZ,CAAb;AAAe;AAAlF,CAA1B,EAA8G,CAA9G;AAAiH,IAAIa,qBAAJ;AAA0BhB,MAAM,CAACC,IAAP,CAAY,oDAAZ,EAAiE;AAACe,EAAAA,qBAAqB,EAAC,UAASb,CAAT,EAAW;AAACa,IAAAA,qBAAqB,GAACb,CAAtB;AAAwB;AAA3D,CAAjE,EAA8H,CAA9H;AAAiI,IAAIc,cAAJ;AAAmBjB,MAAM,CAACC,IAAP,CAAY,6CAAZ,EAA0D;AAACgB,EAAAA,cAAc,EAAC,UAASd,CAAT,EAAW;AAACc,IAAAA,cAAc,GAACd,CAAf;AAAiB;AAA7C,CAA1D,EAAyG,EAAzG;AAA6G,IAAIe,iBAAJ;AAAsBlB,MAAM,CAACC,IAAP,CAAY,iDAAZ,EAA8D;AAACiB,EAAAA,iBAAiB,EAAC,UAASf,CAAT,EAAW;AAACe,IAAAA,iBAAiB,GAACf,CAAlB;AAAoB;AAAnD,CAA9D,EAAmH,EAAnH;AAAuH,IAAIgB,QAAJ;AAAanB,MAAM,CAACC,IAAP,CAAY,iBAAZ,EAA8B;AAACkB,EAAAA,QAAQ,EAAC,UAAShB,CAAT,EAAW;AAACgB,IAAAA,QAAQ,GAAChB,CAAT;AAAW;AAAjC,CAA9B,EAAiE,EAAjE;AAAqE,IAAIiB,UAAJ;AAAepB,MAAM,CAACC,IAAP,CAAY,mCAAZ,EAAgD;AAACmB,EAAAA,UAAU,EAAC,UAASjB,CAAT,EAAW;AAACiB,IAAAA,UAAU,GAACjB,CAAX;AAAa;AAArC,CAAhD,EAAuF,EAAvF;AAA2F,IAAIkB,cAAJ,EAAmBC,eAAnB;AAAmCtB,MAAM,CAACC,IAAP,CAAY,mCAAZ,EAAgD;AAACoB,EAAAA,cAAc,EAAC,UAASlB,CAAT,EAAW;AAACkB,IAAAA,cAAc,GAAClB,CAAf;AAAiB,GAA7C;AAA8CmB,EAAAA,eAAe,EAAC,UAASnB,CAAT,EAAW;AAACmB,IAAAA,eAAe,GAACnB,CAAhB;AAAkB;AAA5F,CAAhD,EAA8I,EAA9I;AAAkJH,MAAM,CAACC,IAAP,CAAY,eAAZ;AAA6B,IAAIsB,iBAAJ;AAAsBvB,MAAM,CAACC,IAAP,CAAY,gBAAZ,EAA6B;AAACsB,EAAAA,iBAAiB,EAAC,UAASpB,CAAT,EAAW;AAACoB,IAAAA,iBAAiB,GAACpB,CAAlB;AAAoB;AAAnD,CAA7B,EAAkF,EAAlF;AAAsF,IAAIqB,QAAJ;AAAaxB,MAAM,CAACC,IAAP,CAAY,0BAAZ,EAAuC;AAACuB,EAAAA,QAAQ,EAAC,UAASrB,CAAT,EAAW;AAACqB,IAAAA,QAAQ,GAACrB,CAAT;AAAW;AAAjC,CAAvC,EAA0E,EAA1E;AAA8E,IAAIsB,SAAJ;AAAczB,MAAM,CAACC,IAAP,CAAY,2BAAZ,EAAwC;AAACwB,EAAAA,SAAS,EAAC,UAAStB,CAAT,EAAW;AAACsB,IAAAA,SAAS,GAACtB,CAAV;AAAY;AAAnC,CAAxC,EAA6E,EAA7E;AAAiFH,MAAM,CAACC,IAAP,CAAY,oBAAZ;AAAkC,IAAIyB,mBAAJ;AAAwB1B,MAAM,CAACC,IAAP,CAAY,sDAAZ,EAAmE;AAACyB,EAAAA,mBAAmB,EAAC,UAASvB,CAAT,EAAW;AAACuB,IAAAA,mBAAmB,GAACvB,CAApB;AAAsB;AAAvD,CAAnE,EAA4H,EAA5H;AAAgI,IAAIwB,QAAJ;AAAa3B,MAAM,CAACC,IAAP,CAAY,uCAAZ,EAAoD;AAAC0B,EAAAA,QAAQ,EAAC,UAASxB,CAAT,EAAW;AAACwB,IAAAA,QAAQ,GAACxB,CAAT;AAAW;AAAjC,CAApD,EAAuF,EAAvF;AAwB7iE,IAAMyB,IAAI,GAAG;AAAEC,EAAAA,EAAE,EAAE;AAAN,CAAb;AAEApB,QAAQ,CAACqB,MAAT,CAAgBC,MAAhB,+CACIV,cADJ,GAEIK,mBAAmB,EAFvB;AAGC,mBAHD,YAGmBM,CAHnB,EAGsB;AACpBA,IAAAA,CAAC,CAACC,cAAF;AACAD,IAAAA,CAAC,CAACE,eAAF;AACA,QAAQC,KAAR,GAAkB,IAAlB,CAAQA,KAAR;AACA,WAAOA,KAAK,IAAIA,KAAK,EAArB;AACA,GARF;AASC,8BAA4B7B,CAAC,CAAC8B,QAAF,CAAW,gBAAuBC,CAAvB,EAA6B;AAAA,QAAXL,CAAW,QAA1BM,aAA0B;AACnED,IAAAA,CAAC,CAACE,QAAF,GAAaP,CAAC,CAACQ,SAAF,IAAeR,CAAC,CAACS,YAAF,GAAiBT,CAAC,CAACU,YAA/C;AACA,GAF2B,EAEzB,GAFyB,CAT7B;AAYC,wBAZD,YAYwBV,CAZxB,EAY2B;AACzB,QAAMW,EAAE,GAAGX,CAAC,CAACM,aAAF,CAAgBM,OAAhB,CAAwBC,OAAnC;AACAC,IAAAA,QAAQ,CAACC,aAAT,cAAkCJ,EAAlC,EAAwCK,SAAxC,CAAkDC,MAAlD,CAAyD,kBAAzD;AACA;AAfF;AAkBAxC,QAAQ,CAACqB,MAAT,CAAgBoB,OAAhB,iCACI5B,eADJ;AAEC6B,EAAAA,WAFD,cAEe;AACb,6BAA2B1C,QAAQ,CAAC2C,QAAT,EAA3B;AAAA,QAAQC,OAAR,sBAAQA,OAAR;AAAA,QAAiBC,KAAjB,sBAAiBA,KAAjB;;AACA,QAAMC,IAAI,GAAGD,KAAK,CAACE,GAAN,CAAU,MAAV,CAAb;AACA,WAAOH,OAAO,CAACI,OAAR,CAAgB;AAAEC,MAAAA,GAAG,EAAEH;AAAP,KAAhB,CAAP;AACA,GANF;AAOCI,EAAAA,SAPD,cAOa;AACX,WAAOlD,QAAQ,CAAC2C,QAAT,GAAoBE,KAApB,CAA0BE,GAA1B,CAA8B,SAA9B,MAA6C,KAApD;AACA,GATF;AAUCI,EAAAA,QAVD,cAUY;AACV,8BAA2BnD,QAAQ,CAAC2C,QAAT,EAA3B;AAAA,QAAQC,OAAR,uBAAQA,OAAR;AAAA,QAAiBC,KAAjB,uBAAiBA,KAAjB;;AACA,QAAMC,IAAI,GAAGD,KAAK,CAACE,GAAN,CAAU,MAAV,CAAb;AAEA,WAAOH,OAAO,CAACQ,IAAR,CAAa;AAAEN,MAAAA,IAAI,EAAJA,IAAF;AAAQG,MAAAA,GAAG,EAAE;AAAEI,QAAAA,GAAG,EAAEP;AAAP;AAAb,KAAb,EAA2C;AAAE3B,MAAAA,IAAI,EAAJA;AAAF,KAA3C,CAAP;AACA,GAfF;AAgBCX,EAAAA,cAhBD,cAgBkB;AAChB,QAAM8C,MAAM,GAAG9C,cAAc,CAAC+C,IAAf,CAAoB,IAApB,EAA0B;AAAEC,MAAAA,GAAG,EAAE,KAAKd,WAAL,CAAiBc;AAAxB,KAA1B,CAAf;AACA,2CACIF,MADJ;AAECvC,MAAAA,QAAQ,kCACJuC,MAAM,CAACvC,QADH;AAEP0C,QAAAA,eAAe,EAAE,KAFV;AAGPC,QAAAA,SAAS,EAAE;AAHJ;AAFT;AAQA,GA1BF;AA2BCC,EAAAA,cA3BD,cA2BkB;AAChB,QAAMhB,QAAQ,GAAG3C,QAAQ,CAAC2C,QAAT,EAAjB;;AACA,gCAGI3C,QAAQ,CAAC4D,WAAT,EAHJ;AAAA,uDACClB,WADD;AAAA,QACgBc,GADhB,0BACgBA,GADhB;AAAA,QAC0BV,IAD1B,0BACqBG,GADrB;AAAA,QAECY,YAFD,yBAECA,YAFD;;AAKA,QAAMC,kBAAkB,GAAG/C,QAAQ,CAACgC,GAAT,CAAa,4BAAb,CAA3B;AACA,WAAO;AACNe,MAAAA,kBAAkB,EAAlBA,kBADM;AAENC,MAAAA,KAAK,EAAEpB,QAAQ,CAACE,KAAT,CAAeE,GAAf,CAAmB,eAAnB,CAFD;AAGNc,MAAAA,YAAY,EAAZA,YAHM;AAINL,MAAAA,GAAG,EAAHA,GAJM;AAKNV,MAAAA,IAAI,EAAJA,IALM;AAMNkB,MAAAA,MAAM,EAAE,YAAa;AACpBrB,QAAAA,QAAQ,CAACsB,YAAT;AACAtB,QAAAA,QAAQ,CAACE,KAAT,CAAeqB,GAAf,CAAmB,eAAnB,EAAoC,KAApC;;AAFoB,0CAATC,IAAS;AAATA,UAAAA,IAAS;AAAA;;AAGpB,eAAOxB,QAAQ,CAACtC,YAAT,IAAyBsC,QAAQ,CAACtC,YAAT,CAAsB+D,IAAtB,CAA2BC,KAA3B,CAAiC1B,QAAQ,CAACtC,YAA1C,EAAwD8D,IAAxD,CAAhC;AACA,OAVK;AAWNG,MAAAA,OAAO,EAAE;AAAA,2CAAIH,IAAJ;AAAIA,UAAAA,IAAJ;AAAA;;AAAA,eAAaxB,QAAQ,CAACtC,YAAT,IAAyBsC,QAAQ,CAACtC,YAAT,CAAsBkE,KAAtB,CAA4BF,KAA5B,CAAkC1B,QAAQ,CAACtC,YAA3C,EAAyD8D,IAAzD,CAAtC;AAAA,OAXH;AAYNK,MAAAA,SAAS,EAAE,YAAa;AAAA,2CAATL,IAAS;AAATA,UAAAA,IAAS;AAAA;;AACvB,YAAMb,MAAM,GAAGX,QAAQ,CAACtC,YAAT,IAAyBsC,QAAQ,CAACtC,YAAT,CAAsBoE,OAAtB,CAA8BJ,KAA9B,CAAoC1B,QAAQ,CAACtC,YAA7C,EAA2D8D,IAA3D,CAAxC;AACA,YAAOO,KAAP,GAAgBP,IAAhB;AAEA,YAAeQ,OAAf,GAA2BD,KAA3B,CAAQE,KAAR;;AAEA,YAAID,OAAO,KAAKzD,QAAQ,CAAC2D,MAArB,IAA+B,CAACvB,MAAhC,IAA0C,CAACoB,KAAK,CAACI,MAAN,CAAaC,KAAb,CAAmBC,IAAnB,EAA/C,EAA0E;AACzE,oCAGI5E,UAAU,CAAC6E,OAAX,EAHJ;AAAA,cACUC,IADV,uBACCC,KADD,CACUD,IADV;AAAA,0DAECE,MAFD;AAAA,cAEWC,OAFX,yBAEWA,OAFX;AAAA,cAEoBC,GAFpB,yBAEoBA,GAFpB;AAAA,cAE4BF,MAF5B;;AAIAhF,UAAAA,UAAU,CAACmF,EAAX,CAAcL,IAAd,EAAoBE,MAApB;AACA;AACD;AAzBK,KAAP;AA2BA,GA9DF;AA+DCI,EAAAA,YA/DD,cA+DgB;AACd,WAAO1E,iBAAiB,CAAChB,MAAM,CAAC2F,MAAP,EAAD,EAAkB,eAAlB,CAAjB,GAAsD,gBAAtD,GAAyEC,SAAhF;AACA,GAjEF;AAkECC,EAAAA,YAlED,cAkEgB;AACd,QAAMhD,QAAQ,GAAG3C,QAAQ,CAAC2C,QAAT,EAAjB;AACA,QAAMiD,OAAO,GAAGjD,QAAQ,CAACE,KAAT,CAAeE,GAAf,CAAmB,eAAnB,CAAhB;AACA,WAAO;AACNb,MAAAA,EAAE,EAAE,UADE;AAEN0D,MAAAA,OAAO,EAAPA,OAFM;AAGNC,MAAAA,QAAQ,EAAE;AAAA,eAAMlD,QAAQ,CAACE,KAAT,CAAeqB,GAAf,CAAmB,eAAnB,EAAoC,CAAC0B,OAArC,CAAN;AAAA;AAHJ,KAAP;AAKA;AA1EF;AA6EA5F,QAAQ,CAACqB,MAAT,CAAgByE,UAAhB,CAA2B,YAAY;AAAA;;AACtC,MAAMtC,GAAG,GAAGrD,OAAO,CAAC4F,WAAR,CAAoB;AAAA,WAAM,KAAI,CAAClD,KAAL,CAAWE,GAAX,CAAe,KAAf,CAAN;AAAA,GAApB,CAAZ;AACA,MAAMD,IAAI,GAAG3C,OAAO,CAAC4F,WAAR,CAAoB;AAAA,WAAM,KAAI,CAAClD,KAAL,CAAWE,GAAX,CAAe,MAAf,CAAN;AAAA,GAApB,CAAb;AACA,OAAKjB,QAAL,GAAgB,IAAhB;AAEA,OAAKzB,YAAL,GAAoB,IAAIC,YAAJ,CAAiB,KAAKsC,OAAtB,CAApB;AACA,OAAKvC,YAAL,CAAkB2F,iBAAlB,CAAoC,KAAK5C,IAAL,CAAU,mBAAV,CAApC;AACA,OAAK/C,YAAL,CAAkB4F,eAAlB,CAAkC,KAAK7C,IAAL,CAAU,mBAAV,CAAlC,EAAkE;AAAEI,IAAAA,GAAG,EAAHA,GAAF;AAAOV,IAAAA,IAAI,EAAJA;AAAP,GAAlE;AAEA,OAAKmB,YAAL,GAAoBpE,CAAC,CAAC8B,QAAF,CAAW,YAAM;AACpC,IAAA,KAAI,CAACG,QAAL,GAAgB,IAAhB;AACA,IAAA,KAAI,CAACzB,YAAL,CAAkB6F,OAAlB,CAA0BnE,SAA1B,GAAsC,KAAI,CAAC1B,YAAL,CAAkB6F,OAAlB,CAA0BlE,YAAhE;AACA,GAHmB,EAGjB,GAHiB,CAApB;;AAKA,OAAKmE,uBAAL,GAA+B,YAAM;AACpC,IAAA,KAAI,CAACrE,QAAL,IAAiB,KAAI,CAACmC,YAAL,EAAjB;AACA,GAFD;;AAIA,MAAMmC,QAAQ,GAAG,IAAIC,cAAJ,CAAmB,KAAKF,uBAAxB,CAAjB;AACAC,EAAAA,QAAQ,CAACE,OAAT,CAAiB,KAAKC,SAAL,CAAejE,aAAf,CAA6B,sBAA7B,CAAjB;;AAEA,OAAKkE,MAAL,GAAc,UAACC,aAAD,EAAmB;AAChC9F,IAAAA,UAAU,CAAC8F,aAAD,EAAgB,KAAI,CAACpG,YAAL,CAAkBqG,KAAlC,EAAyC;AAClDlD,MAAAA,GAAG,EAAE,KAAI,CAACX,KAAL,CAAWE,GAAX,CAAe,KAAf,CAD6C;AAElDD,MAAAA,IAAI,EAAE,KAAI,CAACD,KAAL,CAAWE,GAAX,CAAe,MAAf;AAF4C,KAAzC,CAAV;AAIA,GALD;;AAOA,OAAK4D,OAAL,CAAa,YAAM;AAClB,QAAMnD,GAAG,GAAG,KAAI,CAACX,KAAL,CAAWE,GAAX,CAAe,KAAf,CAAZ;;AACA,QAAMD,IAAI,GAAG,KAAI,CAACD,KAAL,CAAWE,GAAX,CAAe,MAAf,CAAb;;AACA,QAAI,CAACS,GAAL,EAAU;AACT;AACA;;AACD,IAAA,KAAI,CAACoD,cAAL,IAAuB,KAAI,CAACA,cAAL,EAAvB;;AAEA,IAAA,KAAI,CAACA,cAAL,GAAsB;AAAA,aAAM5F,SAAS,CAAC6F,MAAV,CAAiB,kBAAjB,cAA+CrD,GAA/C,CAAN;AAAA,KAAtB;;AAEAxC,IAAAA,SAAS,CAAC8F,GAAV,CACC,kBADD,EAECjH,CAAC,CAACkH,QAAF,CAAW,UAACC,GAAD,EAAS;AACnB,UAAI/G,OAAO,CAAC8C,GAAR,CAAY,YAAZ,MAA8BiE,GAAG,CAACxD,GAAlC,IAAyCA,GAAG,KAAKwD,GAAG,CAACxD,GAArD,IAA4DwD,GAAG,CAACC,QAAhE,IAA4ED,GAAG,CAAClE,IAAJ,KAAaA,IAA7F,EAAmG;AAClG;AACA;;AACDhD,MAAAA,MAAM,CAACyD,IAAP,CAAY,aAAZ,EAA2BT,IAA3B;AACA,KALD,EAKG,IALH,CAFD,EAQC9B,SAAS,CAACkG,QAAV,CAAmBC,MARpB,cASW3D,GATX;AAWA,GArBD;AAuBA,OAAKmD,OAAL,CAAa,YAAM;AAClB,QAAM7D,IAAI,GAAG,KAAI,CAACD,KAAL,CAAWE,GAAX,CAAe,MAAf,CAAb;;AACA,IAAA,KAAI,CAACqE,cAAL,IAAuB,KAAI,CAACA,cAAL,CAAoBC,IAApB,EAAvB;AAEA,IAAA,KAAI,CAACD,cAAL,GAAsB1G,QAAQ,CAAC0C,IAAT,CACrB;AAAEkE,MAAAA,GAAG,EAAE,CAAC;AAAExE,QAAAA,IAAI,EAAJA;AAAF,OAAD,EAAW;AAAEG,QAAAA,GAAG,EAAEH;AAAP,OAAX,CAAP;AAAkCyE,MAAAA,OAAO,EAAE;AAAElE,QAAAA,GAAG,EAAE;AAAP;AAA3C,KADqB,EAErB;AACCmE,MAAAA,MAAM,EAAE;AACPC,QAAAA,SAAS,EAAE,CADJ;AAEPC,QAAAA,SAAS,EAAE,CAFJ;AAGPC,QAAAA,YAAY,EAAE;AAHP;AADT,KAFqB,EASpBrB,OAToB,CASZ;AACTsB,MAAAA,KAAK,EAAE,iBAAyB;AAAA,YAAtB3E,GAAsB,SAAtBA,GAAsB;AAAA,YAAdb,OAAc;;AAC/B,QAAA,KAAI,CAACQ,OAAL,CAAaiF,MAAb,CAAoB;AAAE5E,UAAAA,GAAG,EAAHA;AAAF,SAApB,EAA6Bb,OAA7B;AACA,OAHQ;AAIT0F,MAAAA,OAAO,EAAE,iBAAyB;AAAA,YAAtB7E,GAAsB,SAAtBA,GAAsB;AAAA,YAAdb,OAAc;;AACjC,QAAA,KAAI,CAACQ,OAAL,CAAamF,MAAb,CAAoB;AAAE9E,UAAAA,GAAG,EAAHA;AAAF,SAApB,EAA6Bb,OAA7B;AACA,OANQ;AAOT4F,MAAAA,OAAO,EAAE;AAAA,YAAG/E,GAAH,SAAGA,GAAH;AAAA,eAAa,KAAI,CAACL,OAAL,CAAaiE,MAAb,CAAoB5D,GAApB,CAAb;AAAA;AAPA,KATY,CAAtB;;AAmBA,IAAA,KAAI,CAACgF,QAAL;AACA,GAxBD;AA0BA,OAAKtB,OAAL,CAAa,YAAM;AAClB,QAAMnD,GAAG,GAAG,KAAI,CAACX,KAAL,CAAWE,GAAX,CAAe,KAAf,CAAZ;;AACA,QAAMD,IAAI,GAAG,KAAI,CAACD,KAAL,CAAWE,GAAX,CAAe,MAAf,CAAb;;AACA,IAAA,KAAI,CAAC1C,YAAL,CAAkB4F,eAAlB,CAAkC,KAAI,CAAC7C,IAAL,CAAU,mBAAV,CAAlC,EAAkE;AAAEI,MAAAA,GAAG,EAAHA,GAAF;AAAOV,MAAAA,IAAI,EAAJA;AAAP,KAAlE;;AACA,QAAIU,GAAG,IAAIV,IAAX,EAAiB;AAChBzC,MAAAA,YAAY,CAAImD,GAAJ,SAAWV,IAAX,CAAZ,GAAiC,KAAI,CAACzC,YAAtC;AACA;AACD,GAPD;AASA,OAAKsG,OAAL,CAAa,YAAM;AAClBvG,IAAAA,UAAU,CAAC8H,eAAX;AACA,QAAMC,IAAI,GAAG/H,UAAU,CAACgI,aAAX,CAAyB,MAAzB,CAAb;;AACA,iCAAwBpI,QAAQ,CAAC4D,WAAT,EAAxB;AAAA,QAAQlB,WAAR,0BAAQA,WAAR;;AACA,IAAA,KAAI,CAACG,KAAL,CAAWqB,GAAX,CAAe;AACdpB,MAAAA,IAAI,EAAEJ,WAAW,CAACO,GADJ;AAEdO,MAAAA,GAAG,EAAEd,WAAW,CAACc,GAFH;AAGd2E,MAAAA,IAAI,EAAJA;AAHc,KAAf;AAKA,GATD;AAWA,OAAKxB,OAAL,CAAa,YAAM;AAClB,QAAMwB,IAAI,GAAG,KAAI,CAACtF,KAAL,CAAWE,GAAX,CAAe,MAAf,CAAb;;AACA,QAAMsF,OAAO,GAAG,KAAI,CAACxF,KAAL,CAAWE,GAAX,CAAe,SAAf,CAAhB;;AAEA,QAAIoF,IAAI,IAAI,KAAI,CAACG,QAAL,KAAkBH,IAA1B,IAAkCE,OAAO,KAAK,KAAlD,EAAyD;AACxD,MAAA,KAAI,CAACC,QAAL,GAAgBH,IAAhB;AACA,MAAA,KAAI,CAAC/E,IAAL,CAAU,mBAAV,EAA+BmF,KAA/B,CAAqCC,cAArC,GAAsD,QAAtD;;AACA,MAAA,KAAI,CAAC3F,KAAL,CAAWqB,GAAX,CAAe,MAAf,EAAuB,IAAvB;;AACA/D,MAAAA,OAAO,CAACsI,UAAR,CAAmB,YAAM;AACxB,YAAMrG,OAAO,GAAG,KAAI,CAACgB,IAAL,cAAqB+E,IAArB,CAAhB;;AACA/F,QAAAA,OAAO,CAACG,SAAR,CAAkBuE,GAAlB,CAAsB,WAAtB;;AACA,YAAM4B,WAAW,GAAG,YAAM;AACzBtG,UAAAA,OAAO,CAACG,SAAR,CAAkBsE,MAAlB,CAAyB,WAAzB;AACAzE,UAAAA,OAAO,CAACuG,mBAAR,CAA4B,cAA5B,EAA4CD,WAA5C;AACA,SAHD;;AAIAtG,QAAAA,OAAO,CAACwG,gBAAR,CAAyB,cAAzB,EAAyCF,WAAzC;AACAG,QAAAA,UAAU,CAAC,YAAM;AAChBzG,UAAAA,OAAO,CAAC0G,cAAR;AACA,SAFS,EAEP,GAFO,CAAV;AAGA,OAXD;AAYA;AACD,GArBD;AAsBA,CAvHD;AAyHA9I,QAAQ,CAACqB,MAAT,CAAgB0H,SAAhB;AAA0B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACzB,mBAAKnG,OAAL,GAAe,IAAI7C,KAAK,CAACiJ,UAAV,CAAqB,IAArB,CAAf;AAEA,mBAAKnG,KAAL,GAAa,IAAI3C,YAAJ,CAAiB;AAC7B+I,gBAAAA,aAAa,EAAE,CAAC,KAAKC,IAAL,CAAUxG,WAAV,CAAsByG;AADT,eAAjB,CAAb;;AAIA,mBAAKlB,QAAL;AAAgB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDACE9H,OAAO,CAAC4F,WAAR,CAAoB;AAAA,qCAAM,MAAI,CAAClD,KAAL,CAAWuG,GAAX,EAAN;AAAA,6BAApB,CADF,EACPtG,IADO,wBACPA,IADO;;AAAA,gCAEVA,IAFU;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAMf,4BAAA,MAAI,CAACD,KAAL,CAAWqB,GAAX,CAAe,SAAf,EAA0B,IAA1B;;AANe;AAAA,6DAQQ3D,qBAAqB,CAAC,mBAAD,EAAsB;AAAEuC,8BAAAA,IAAI,EAAJA;AAAF,6BAAtB,CAR7B;;AAAA;AAQTK,4BAAAA,QARS;AAUf1C,4BAAAA,iBAAiB,CAAC;AAAE4I,8BAAAA,IAAI,EAAElG;AAAR,6BAAD,EAAqB,MAAI,CAACP,OAA1B,CAAjB;AAEAzC,4BAAAA,OAAO,CAACsI,UAAR,CAAmB,YAAM;AACxB,8BAAA,MAAI,CAAC5F,KAAL,CAAWqB,GAAX,CAAe,SAAf,EAA0B,KAA1B;AACA,6BAFD;;AAZe;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAhB;AAAA;;AAPyB;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAA1B;AAAA;AAyBAlE,QAAQ,CAACqB,MAAT,CAAgBiI,WAAhB,CAA4B,YAAY;AACvC,MAAQ1G,OAAR,GAAyE,IAAzE,CAAQA,OAAR;AAAA,MAAiBwE,cAAjB,GAAyE,IAAzE,CAAiBA,cAAjB;AAAA,MAAiCR,cAAjC,GAAyE,IAAzE,CAAiCA,cAAjC;AAAA,MAAiD/D,KAAjD,GAAyE,IAAzE,CAAiDA,KAAjD;AAAA,MAAwDxC,YAAxD,GAAyE,IAAzE,CAAwDA,YAAxD;AACAuC,EAAAA,OAAO,CAACiE,MAAR,CAAe,EAAf;AACAO,EAAAA,cAAc,IAAIA,cAAc,CAACC,IAAf,EAAlB;AAEAT,EAAAA,cAAc,IAAIA,cAAc,EAAhC;AAEA,MAAM9D,IAAI,GAAGD,KAAK,CAACE,GAAN,CAAU,MAAV,CAAb;AACA,MAAMS,GAAG,GAAGX,KAAK,CAACE,GAAN,CAAU,KAAV,CAAZ;;AACA,MAAIS,GAAG,IAAIV,IAAX,EAAiB;AAChBzC,IAAAA,YAAY,CAACiJ,WAAb,IAA4BjJ,YAAY,CAACiJ,WAAb,CAAyB9F,GAAzB,EAA8BV,IAA9B,CAA5B;AACA,WAAOzC,YAAY,CAAImD,GAAJ,SAAWV,IAAX,CAAnB;AACA;AACD,CAbD","sourcesContent":["import _ from 'underscore';\nimport { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { Template } from 'meteor/templating';\nimport { Session } from 'meteor/session';\nimport { ReactiveDict } from 'meteor/reactive-dict';\nimport { Tracker } from 'meteor/tracker';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\n\nimport { chatMessages, ChatMessages } from '../../../ui';\nimport { callWithErrorHandling } from '../../../../client/lib/utils/callWithErrorHandling';\nimport { messageContext } from '../../../ui-utils/client/lib/messageContext';\nimport { upsertMessageBulk } from '../../../ui-utils/client/lib/RoomHistoryManager';\nimport { Messages } from '../../../models';\nimport { fileUpload } from '../../../ui/client/lib/fileUpload';\nimport { dropzoneEvents, dropzoneHelpers } from '../../../ui/client/views/app/room';\nimport './thread.html';\nimport { getUserPreference } from '../../../utils';\nimport { settings } from '../../../settings/client';\nimport { callbacks } from '../../../../lib/callbacks';\nimport './messageBoxFollow';\nimport { getCommonRoomEvents } from '../../../ui/client/views/app/lib/getCommonRoomEvents';\nimport { keyCodes } from '../../../../client/lib/utils/keyCodes';\n\nconst sort = { ts: 1 };\n\nTemplate.thread.events({\n\t...dropzoneEvents,\n\t...getCommonRoomEvents(),\n\t'click .js-close'(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tconst { close } = this;\n\t\treturn close && close();\n\t},\n\t'scroll .js-scroll-thread': _.throttle(({ currentTarget: e }, i) => {\n\t\ti.atBottom = e.scrollTop >= e.scrollHeight - e.clientHeight;\n\t}, 150),\n\t'click .toggle-hidden'(e) {\n\t\tconst id = e.currentTarget.dataset.message;\n\t\tdocument.querySelector(`#thread-${id}`).classList.toggle('message--ignored');\n\t},\n});\n\nTemplate.thread.helpers({\n\t...dropzoneHelpers,\n\tmainMessage() {\n\t\tconst { Threads, state } = Template.instance();\n\t\tconst tmid = state.get('tmid');\n\t\treturn Threads.findOne({ _id: tmid });\n\t},\n\tisLoading() {\n\t\treturn Template.instance().state.get('loading') !== false;\n\t},\n\tmessages() {\n\t\tconst { Threads, state } = Template.instance();\n\t\tconst tmid = state.get('tmid');\n\n\t\treturn Threads.find({ tmid, _id: { $ne: tmid } }, { sort });\n\t},\n\tmessageContext() {\n\t\tconst result = messageContext.call(this, { rid: this.mainMessage.rid });\n\t\treturn {\n\t\t\t...result,\n\t\t\tsettings: {\n\t\t\t\t...result.settings,\n\t\t\t\tshowReplyButton: false,\n\t\t\t\tshowreply: false,\n\t\t\t},\n\t\t};\n\t},\n\tmessageBoxData() {\n\t\tconst instance = Template.instance();\n\t\tconst {\n\t\t\tmainMessage: { rid, _id: tmid },\n\t\t\tsubscription,\n\t\t} = Template.currentData();\n\n\t\tconst showFormattingTips = settings.get('Message_ShowFormattingTips');\n\t\treturn {\n\t\t\tshowFormattingTips,\n\t\t\ttshow: instance.state.get('sendToChannel'),\n\t\t\tsubscription,\n\t\t\trid,\n\t\t\ttmid,\n\t\t\tonSend: (...args) => {\n\t\t\t\tinstance.sendToBottom();\n\t\t\t\tinstance.state.set('sendToChannel', false);\n\t\t\t\treturn instance.chatMessages && instance.chatMessages.send.apply(instance.chatMessages, args);\n\t\t\t},\n\t\t\tonKeyUp: (...args) => instance.chatMessages && instance.chatMessages.keyup.apply(instance.chatMessages, args),\n\t\t\tonKeyDown: (...args) => {\n\t\t\t\tconst result = instance.chatMessages && instance.chatMessages.keydown.apply(instance.chatMessages, args);\n\t\t\t\tconst [event] = args;\n\n\t\t\t\tconst { which: keyCode } = event;\n\n\t\t\t\tif (keyCode === keyCodes.ESCAPE && !result && !event.target.value.trim()) {\n\t\t\t\t\tconst {\n\t\t\t\t\t\troute: { name },\n\t\t\t\t\t\tparams: { context, tab, ...params },\n\t\t\t\t\t} = FlowRouter.current();\n\t\t\t\t\tFlowRouter.go(name, params);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t},\n\thideUsername() {\n\t\treturn getUserPreference(Meteor.userId(), 'hideUsernames') ? 'hide-usernames' : undefined;\n\t},\n\tcheckboxData() {\n\t\tconst instance = Template.instance();\n\t\tconst checked = instance.state.get('sendToChannel');\n\t\treturn {\n\t\t\tid: 'sendAlso',\n\t\t\tchecked,\n\t\t\tonChange: () => instance.state.set('sendToChannel', !checked),\n\t\t};\n\t},\n});\n\nTemplate.thread.onRendered(function () {\n\tconst rid = Tracker.nonreactive(() => this.state.get('rid'));\n\tconst tmid = Tracker.nonreactive(() => this.state.get('tmid'));\n\tthis.atBottom = true;\n\n\tthis.chatMessages = new ChatMessages(this.Threads);\n\tthis.chatMessages.initializeWrapper(this.find('.js-scroll-thread'));\n\tthis.chatMessages.initializeInput(this.find('.js-input-message'), { rid, tmid });\n\n\tthis.sendToBottom = _.throttle(() => {\n\t\tthis.atBottom = true;\n\t\tthis.chatMessages.wrapper.scrollTop = this.chatMessages.wrapper.scrollHeight;\n\t}, 300);\n\n\tthis.sendToBottomIfNecessary = () => {\n\t\tthis.atBottom && this.sendToBottom();\n\t};\n\n\tconst observer = new ResizeObserver(this.sendToBottomIfNecessary);\n\tobserver.observe(this.firstNode.querySelector('.js-scroll-thread ul'));\n\n\tthis.onFile = (filesToUpload) => {\n\t\tfileUpload(filesToUpload, this.chatMessages.input, {\n\t\t\trid: this.state.get('rid'),\n\t\t\ttmid: this.state.get('tmid'),\n\t\t});\n\t};\n\n\tthis.autorun(() => {\n\t\tconst rid = this.state.get('rid');\n\t\tconst tmid = this.state.get('tmid');\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\t\tthis.callbackRemove && this.callbackRemove();\n\n\t\tthis.callbackRemove = () => callbacks.remove('streamNewMessage', `thread-${rid}`);\n\n\t\tcallbacks.add(\n\t\t\t'streamNewMessage',\n\t\t\t_.debounce((msg) => {\n\t\t\t\tif (Session.get('openedRoom') !== msg.rid || rid !== msg.rid || msg.editedAt || msg.tmid !== tmid) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tMeteor.call('readThreads', tmid);\n\t\t\t}, 1000),\n\t\t\tcallbacks.priority.MEDIUM,\n\t\t\t`thread-${rid}`,\n\t\t);\n\t});\n\n\tthis.autorun(() => {\n\t\tconst tmid = this.state.get('tmid');\n\t\tthis.threadsObserve && this.threadsObserve.stop();\n\n\t\tthis.threadsObserve = Messages.find(\n\t\t\t{ $or: [{ tmid }, { _id: tmid }], _hidden: { $ne: true } },\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\tcollapsed: 0,\n\t\t\t\t\tthreadMsg: 0,\n\t\t\t\t\trepliesCount: 0,\n\t\t\t\t},\n\t\t\t},\n\t\t).observe({\n\t\t\tadded: ({ _id, ...message }) => {\n\t\t\t\tthis.Threads.upsert({ _id }, message);\n\t\t\t},\n\t\t\tchanged: ({ _id, ...message }) => {\n\t\t\t\tthis.Threads.update({ _id }, message);\n\t\t\t},\n\t\t\tremoved: ({ _id }) => this.Threads.remove(_id),\n\t\t});\n\n\t\tthis.loadMore();\n\t});\n\n\tthis.autorun(() => {\n\t\tconst rid = this.state.get('rid');\n\t\tconst tmid = this.state.get('tmid');\n\t\tthis.chatMessages.initializeInput(this.find('.js-input-message'), { rid, tmid });\n\t\tif (rid && tmid) {\n\t\t\tchatMessages[`${rid}-${tmid}`] = this.chatMessages;\n\t\t}\n\t});\n\n\tthis.autorun(() => {\n\t\tFlowRouter.watchPathChange();\n\t\tconst jump = FlowRouter.getQueryParam('jump');\n\t\tconst { mainMessage } = Template.currentData();\n\t\tthis.state.set({\n\t\t\ttmid: mainMessage._id,\n\t\t\trid: mainMessage.rid,\n\t\t\tjump,\n\t\t});\n\t});\n\n\tthis.autorun(() => {\n\t\tconst jump = this.state.get('jump');\n\t\tconst loading = this.state.get('loading');\n\n\t\tif (jump && this.lastJump !== jump && loading === false) {\n\t\t\tthis.lastJump = jump;\n\t\t\tthis.find('.js-scroll-thread').style.scrollBehavior = 'smooth';\n\t\t\tthis.state.set('jump', null);\n\t\t\tTracker.afterFlush(() => {\n\t\t\t\tconst message = this.find(`#thread-${jump}`);\n\t\t\t\tmessage.classList.add('highlight');\n\t\t\t\tconst removeClass = () => {\n\t\t\t\t\tmessage.classList.remove('highlight');\n\t\t\t\t\tmessage.removeEventListener('animationend', removeClass);\n\t\t\t\t};\n\t\t\t\tmessage.addEventListener('animationend', removeClass);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tmessage.scrollIntoView();\n\t\t\t\t}, 300);\n\t\t\t});\n\t\t}\n\t});\n});\n\nTemplate.thread.onCreated(async function () {\n\tthis.Threads = new Mongo.Collection(null);\n\n\tthis.state = new ReactiveDict({\n\t\tsendToChannel: !this.data.mainMessage.tcount,\n\t});\n\n\tthis.loadMore = async () => {\n\t\tconst { tmid } = Tracker.nonreactive(() => this.state.all());\n\t\tif (!tmid) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.state.set('loading', true);\n\n\t\tconst messages = await callWithErrorHandling('getThreadMessages', { tmid });\n\n\t\tupsertMessageBulk({ msgs: messages }, this.Threads);\n\n\t\tTracker.afterFlush(() => {\n\t\t\tthis.state.set('loading', false);\n\t\t});\n\t};\n});\n\nTemplate.thread.onDestroyed(function () {\n\tconst { Threads, threadsObserve, callbackRemove, state, chatMessages } = this;\n\tThreads.remove({});\n\tthreadsObserve && threadsObserve.stop();\n\n\tcallbackRemove && callbackRemove();\n\n\tconst tmid = state.get('tmid');\n\tconst rid = state.get('rid');\n\tif (rid && tmid) {\n\t\tchatMessages.onDestroyed && chatMessages.onDestroyed(rid, tmid);\n\t\tdelete chatMessages[`${rid}-${tmid}`];\n\t}\n});\n"]},"sourceType":"module","hash":"cd2ee248458c0bc7bb2e89999dcfae72643bf9a9"}
