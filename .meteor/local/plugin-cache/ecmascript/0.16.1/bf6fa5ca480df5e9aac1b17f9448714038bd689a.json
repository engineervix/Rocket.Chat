{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/ForwardChatModal.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/components/Omnichannel/modals/ForwardChatModal.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/ForwardChatModal.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/client/components/Omnichannel/modals/ForwardChatModal.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/Omnichannel/modals/ForwardChatModal.js"}},"code":"var _excluded = [\"onForward\", \"onCancel\", \"room\"];\n\nvar _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\n\nvar _slicedToArray;\n\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\n\nvar _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default: function (v) {\n    _objectWithoutProperties = v;\n  }\n}, 2);\nvar Field, Button, TextAreaInput, Icon, ButtonGroup, Modal, Box, PaginatedSelectFiltered;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Field: function (v) {\n    Field = v;\n  },\n  Button: function (v) {\n    Button = v;\n  },\n  TextAreaInput: function (v) {\n    TextAreaInput = v;\n  },\n  Icon: function (v) {\n    Icon = v;\n  },\n  ButtonGroup: function (v) {\n    ButtonGroup = v;\n  },\n  Modal: function (v) {\n    Modal = v;\n  },\n  Box: function (v) {\n    Box = v;\n  },\n  PaginatedSelectFiltered: function (v) {\n    PaginatedSelectFiltered = v;\n  }\n}, 0);\nvar useMutableCallback, useAutoFocus, useDebouncedValue;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  },\n  useAutoFocus: function (v) {\n    useAutoFocus = v;\n  },\n  useDebouncedValue: function (v) {\n    useDebouncedValue = v;\n  }\n}, 1);\nvar React, useEffect, useMemo, useState;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  },\n  useState: function (v) {\n    useState = v;\n  }\n}, 2);\nvar useEndpoint;\nmodule.link(\"../../../contexts/ServerContext\", {\n  useEndpoint: function (v) {\n    useEndpoint = v;\n  }\n}, 3);\nvar useTranslation;\nmodule.link(\"../../../contexts/TranslationContext\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 4);\nvar useRecordList;\nmodule.link(\"../../../hooks/lists/useRecordList\", {\n  useRecordList: function (v) {\n    useRecordList = v;\n  }\n}, 5);\nvar AsyncStatePhase;\nmodule.link(\"../../../hooks/useAsyncState\", {\n  AsyncStatePhase: function (v) {\n    AsyncStatePhase = v;\n  }\n}, 6);\nvar useForm;\nmodule.link(\"../../../hooks/useForm\", {\n  useForm: function (v) {\n    useForm = v;\n  }\n}, 7);\nvar UserAutoComplete;\nmodule.link(\"../../UserAutoComplete\", {\n  \"default\": function (v) {\n    UserAutoComplete = v;\n  }\n}, 8);\nvar useDepartmentsList;\nmodule.link(\"../hooks/useDepartmentsList\", {\n  useDepartmentsList: function (v) {\n    useDepartmentsList = v;\n  }\n}, 9);\nvar ModalSeparator;\nmodule.link(\"./ModalSeparator\", {\n  \"default\": function (v) {\n    ModalSeparator = v;\n  }\n}, 10);\n\nvar ForwardChatModal = function (_ref) {\n  var onForward = _ref.onForward,\n      onCancel = _ref.onCancel,\n      room = _ref.room,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  var t = useTranslation();\n  var inputRef = useAutoFocus(true);\n\n  var _useForm = useForm({\n    username: '',\n    comment: '',\n    department: {}\n  }),\n      values = _useForm.values,\n      handlers = _useForm.handlers;\n\n  var username = values.username,\n      comment = values.comment,\n      department = values.department;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      userId = _useState2[0],\n      setUserId = _useState2[1];\n\n  var handleUsername = handlers.handleUsername,\n      handleComment = handlers.handleComment,\n      handleDepartment = handlers.handleDepartment;\n  var getUserData = useEndpoint('GET', \"users.info?username=\" + username);\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      departmentsFilter = _useState4[0],\n      setDepartmentsFilter = _useState4[1];\n\n  var debouncedDepartmentsFilter = useDebouncedValue(departmentsFilter, 500);\n\n  var _useDepartmentsList = useDepartmentsList(useMemo(function () {\n    return {\n      filter: debouncedDepartmentsFilter,\n      enabled: true\n    };\n  }, [debouncedDepartmentsFilter])),\n      departmentsList = _useDepartmentsList.itemsList,\n      loadMoreDepartments = _useDepartmentsList.loadMoreItems;\n\n  var _useRecordList = useRecordList(departmentsList),\n      departmentsPhase = _useRecordList.phase,\n      departmentsItems = _useRecordList.items,\n      departmentsTotal = _useRecordList.itemCount;\n\n  var handleSend = useMutableCallback(function () {\n    onForward(department === null || department === void 0 ? void 0 : department.value, userId, comment);\n  }, [onForward, department.value, userId, comment]);\n  var onChangeUsername = useMutableCallback(function (username) {\n    handleUsername(username);\n  });\n  useEffect(function () {\n    if (!username) {\n      return;\n    }\n\n    var fetchData = function () {\n      function _callee() {\n        var _await$getUserData, user;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return _regeneratorRuntime.awrap(getUserData());\n\n                case 2:\n                  _await$getUserData = _context.sent;\n                  user = _await$getUserData.user;\n                  setUserId(user._id);\n\n                case 5:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }\n\n          return _callee$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee;\n    }();\n\n    fetchData(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [username]);\n  var canForward = department || username;\n  var departments = departmentsItems;\n  var hasDepartments = departments && departments.length > 0;\n\n  var _ref2 = room || {},\n      _ref2$servedBy = _ref2.servedBy;\n\n  _ref2$servedBy = _ref2$servedBy === void 0 ? {} : _ref2$servedBy;\n  var agentId = _ref2$servedBy._id;\n\n  var _id = agentId && {\n    $ne: agentId\n  };\n\n  var conditions = {\n    _id: _id,\n    status: {\n      $ne: 'offline'\n    },\n    statusLivechat: 'available'\n  };\n  return /*#__PURE__*/React.createElement(Modal, props, /*#__PURE__*/React.createElement(Modal.Header, null, /*#__PURE__*/React.createElement(Icon, {\n    name: \"baloon-arrow-top-right\",\n    size: 20\n  }), /*#__PURE__*/React.createElement(Modal.Title, null, t('Forward_chat')), /*#__PURE__*/React.createElement(Modal.Close, {\n    onClick: onCancel\n  })), /*#__PURE__*/React.createElement(Modal.Content, {\n    fontScale: \"p2\"\n  }, /*#__PURE__*/React.createElement(Field, {\n    mbe: 'x30'\n  }, /*#__PURE__*/React.createElement(Field.Label, null, t('Forward_to_department')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(PaginatedSelectFiltered, {\n    withTitle: true,\n    filter: departmentsFilter,\n    setFilter: setDepartmentsFilter,\n    options: departmentsItems,\n    value: department,\n    maxWidth: \"100%\",\n    placeholder: t('Select_an_option'),\n    onChange: handleDepartment,\n    flexGrow: 1,\n    endReached: departmentsPhase === AsyncStatePhase.LOADING ? function () {} : function (start) {\n      return loadMoreDepartments(start, Math.min(50, departmentsTotal));\n    }\n  }))), /*#__PURE__*/React.createElement(ModalSeparator, {\n    text: t('or')\n  }), /*#__PURE__*/React.createElement(Field, {\n    mbs: hasDepartments && 'x30'\n  }, /*#__PURE__*/React.createElement(Field.Label, null, t('Forward_to_user')), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(UserAutoComplete, {\n    conditions: conditions,\n    flexGrow: 1,\n    value: username,\n    onChange: onChangeUsername,\n    placeholder: t('Username')\n  }))), /*#__PURE__*/React.createElement(Field, {\n    marginBlock: \"x15\"\n  }, /*#__PURE__*/React.createElement(Field.Label, null, t('Leave_a_comment'), ' ', /*#__PURE__*/React.createElement(Box, {\n    is: \"span\",\n    color: \"neutral-600\"\n  }, \"(\", t('Optional'), \")\")), /*#__PURE__*/React.createElement(Field.Row, null, /*#__PURE__*/React.createElement(TextAreaInput, {\n    ref: inputRef,\n    rows: 8,\n    flexGrow: 1,\n    value: comment,\n    onChange: handleComment\n  })))), /*#__PURE__*/React.createElement(Modal.Footer, null, /*#__PURE__*/React.createElement(ButtonGroup, {\n    align: \"end\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onCancel\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    disabled: !canForward,\n    primary: true,\n    onClick: handleSend\n  }, t('Forward')))));\n};\n\nmodule.exportDefault(ForwardChatModal);","map":{"version":3,"sources":["client/components/Omnichannel/modals/ForwardChatModal.js"],"names":["_regeneratorRuntime","module","link","default","v","_slicedToArray","_objectWithoutProperties","Field","Button","TextAreaInput","Icon","ButtonGroup","Modal","Box","PaginatedSelectFiltered","useMutableCallback","useAutoFocus","useDebouncedValue","React","useEffect","useMemo","useState","useEndpoint","useTranslation","useRecordList","AsyncStatePhase","useForm","UserAutoComplete","useDepartmentsList","ModalSeparator","ForwardChatModal","onForward","onCancel","room","props","t","inputRef","username","comment","department","values","handlers","userId","setUserId","handleUsername","handleComment","handleDepartment","getUserData","departmentsFilter","setDepartmentsFilter","debouncedDepartmentsFilter","filter","enabled","departmentsList","itemsList","loadMoreDepartments","loadMoreItems","departmentsPhase","phase","departmentsItems","items","departmentsTotal","itemCount","handleSend","value","onChangeUsername","fetchData","user","_id","canForward","departments","hasDepartments","length","servedBy","agentId","$ne","conditions","status","statusLivechat","LOADING","start","Math","min","exportDefault"],"mappings":"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","sourcesContent":["import { Field, Button, TextAreaInput, Icon, ButtonGroup, Modal, Box, PaginatedSelectFiltered } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useAutoFocus, useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport { useEndpoint } from '../../../contexts/ServerContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useRecordList } from '../../../hooks/lists/useRecordList';\nimport { AsyncStatePhase } from '../../../hooks/useAsyncState';\nimport { useForm } from '../../../hooks/useForm';\nimport UserAutoComplete from '../../UserAutoComplete';\nimport { useDepartmentsList } from '../hooks/useDepartmentsList';\nimport ModalSeparator from './ModalSeparator';\n\nconst ForwardChatModal = ({ onForward, onCancel, room, ...props }) => {\n\tconst t = useTranslation();\n\n\tconst inputRef = useAutoFocus(true);\n\n\tconst { values, handlers } = useForm({\n\t\tusername: '',\n\t\tcomment: '',\n\t\tdepartment: {},\n\t});\n\tconst { username, comment, department } = values;\n\tconst [userId, setUserId] = useState('');\n\n\tconst { handleUsername, handleComment, handleDepartment } = handlers;\n\tconst getUserData = useEndpoint('GET', `users.info?username=${username}`);\n\n\tconst [departmentsFilter, setDepartmentsFilter] = useState('');\n\n\tconst debouncedDepartmentsFilter = useDebouncedValue(departmentsFilter, 500);\n\n\tconst { itemsList: departmentsList, loadMoreItems: loadMoreDepartments } = useDepartmentsList(\n\t\tuseMemo(() => ({ filter: debouncedDepartmentsFilter, enabled: true }), [debouncedDepartmentsFilter]),\n\t);\n\n\tconst { phase: departmentsPhase, items: departmentsItems, itemCount: departmentsTotal } = useRecordList(departmentsList);\n\n\tconst handleSend = useMutableCallback(() => {\n\t\tonForward(department?.value, userId, comment);\n\t}, [onForward, department.value, userId, comment]);\n\n\tconst onChangeUsername = useMutableCallback((username) => {\n\t\thandleUsername(username);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!username) {\n\t\t\treturn;\n\t\t}\n\t\tconst fetchData = async () => {\n\t\t\tconst { user } = await getUserData();\n\t\t\tsetUserId(user._id);\n\t\t};\n\t\tfetchData();\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [username]);\n\n\tconst canForward = department || username;\n\n\tconst departments = departmentsItems;\n\n\tconst hasDepartments = departments && departments.length > 0;\n\n\tconst { servedBy: { _id: agentId } = {} } = room || {};\n\n\tconst _id = agentId && { $ne: agentId };\n\n\tconst conditions = { _id, status: { $ne: 'offline' }, statusLivechat: 'available' };\n\n\treturn (\n\t\t<Modal {...props}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Icon name='baloon-arrow-top-right' size={20} />\n\t\t\t\t<Modal.Title>{t('Forward_chat')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t<Field mbe={'x30'}>\n\t\t\t\t\t<Field.Label>{t('Forward_to_department')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<PaginatedSelectFiltered\n\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\tfilter={departmentsFilter}\n\t\t\t\t\t\t\tsetFilter={setDepartmentsFilter}\n\t\t\t\t\t\t\toptions={departmentsItems}\n\t\t\t\t\t\t\tvalue={department}\n\t\t\t\t\t\t\tmaxWidth='100%'\n\t\t\t\t\t\t\tplaceholder={t('Select_an_option')}\n\t\t\t\t\t\t\tonChange={handleDepartment}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tendReached={\n\t\t\t\t\t\t\t\tdepartmentsPhase === AsyncStatePhase.LOADING\n\t\t\t\t\t\t\t\t\t? () => {}\n\t\t\t\t\t\t\t\t\t: (start) => loadMoreDepartments(start, Math.min(50, departmentsTotal))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t\t<ModalSeparator text={t('or')} />\n\t\t\t\t<Field mbs={hasDepartments && 'x30'}>\n\t\t\t\t\t<Field.Label>{t('Forward_to_user')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<UserAutoComplete\n\t\t\t\t\t\t\tconditions={conditions}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tvalue={username}\n\t\t\t\t\t\t\tonChange={onChangeUsername}\n\t\t\t\t\t\t\tplaceholder={t('Username')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t\t<Field marginBlock='x15'>\n\t\t\t\t\t<Field.Label>\n\t\t\t\t\t\t{t('Leave_a_comment')}{' '}\n\t\t\t\t\t\t<Box is='span' color='neutral-600'>\n\t\t\t\t\t\t\t({t('Optional')})\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<TextAreaInput ref={inputRef} rows={8} flexGrow={1} value={comment} onChange={handleComment} />\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button disabled={!canForward} primary onClick={handleSend}>\n\t\t\t\t\t\t{t('Forward')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default ForwardChatModal;\n"]},"sourceType":"module","hash":"bf6fa5ca480df5e9aac1b17f9448714038bd689a"}
