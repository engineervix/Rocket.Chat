{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet Template;\nmodule.link(\"meteor/templating\", {\n  Template(v) {\n    Template = v;\n  }\n\n}, 0);\nmodule.link(\"./contactChatHistoryMessages.html\");\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 1);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 2);\nlet messageContext;\nmodule.link(\"../../../../../ui-utils/client/lib/messageContext\", {\n  messageContext(v) {\n    messageContext = v;\n  }\n\n}, 3);\nlet APIClient;\nmodule.link(\"../../../../../utils/client\", {\n  APIClient(v) {\n    APIClient = v;\n  }\n\n}, 4);\nconst MESSAGES_LIMIT = 50;\nTemplate.contactChatHistoryMessages.helpers({\n  messages() {\n    return Template.instance().messages.get();\n  },\n\n  messageContext() {\n    const result = messageContext.call(this, {\n      rid: Template.instance().rid\n    });\n    return _objectSpread(_objectSpread({}, result), {}, {\n      settings: _objectSpread(_objectSpread({}, result.settings), {}, {\n        showReplyButton: false,\n        showreply: false,\n        hideRoles: true\n      })\n    });\n  },\n\n  hasMore() {\n    return Template.instance().hasMore.get();\n  },\n\n  isLoading() {\n    return Template.instance().isLoading.get();\n  },\n\n  isSearching() {\n    return Template.instance().searchTerm.get().length > 0;\n  },\n\n  empty() {\n    return Template.instance().messages.get().length === 0;\n  },\n\n  hasError() {\n    return Template.instance().hasError.get();\n  },\n\n  error() {\n    return Template.instance().error.get();\n  }\n\n});\nTemplate.contactChatHistoryMessages.events({\n  'click .js-back'(e, instance) {\n    return instance.clear();\n  },\n\n  'scroll .js-list': _.throttle(function (e, instance) {\n    if (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight && instance.hasMore.get()) {\n      instance.offset.set(instance.offset.get() + instance.limit.get());\n    }\n  }, 200),\n  'keyup #message-search': _.debounce(function (e, instance) {\n    if (e.keyCode === 13) {\n      return e.preventDefault();\n    }\n\n    const {\n      value\n    } = e.target;\n\n    if (e.keyCode === 40 || e.keyCode === 38) {\n      return e.preventDefault();\n    }\n\n    instance.offset.set(0);\n    instance.searchTerm.set(value);\n  }, 300)\n});\nTemplate.contactChatHistoryMessages.onCreated(function () {\n  const currentData = Template.currentData();\n  this.rid = currentData.rid;\n  this.messages = new ReactiveVar([]);\n  this.hasMore = new ReactiveVar(true);\n  this.offset = new ReactiveVar(0);\n  this.searchTerm = new ReactiveVar('');\n  this.isLoading = new ReactiveVar(true);\n  this.limit = new ReactiveVar(MESSAGES_LIMIT);\n  this.hasError = new ReactiveVar(false);\n  this.error = new ReactiveVar(null);\n\n  this.loadMessages = async url => {\n    this.isLoading.set(true);\n    const offset = this.offset.get();\n\n    try {\n      const {\n        messages,\n        total\n      } = await APIClient.v1.get(url);\n      this.messages.set(offset === 0 ? messages : this.messages.get().concat(messages));\n      this.hasMore.set(total > this.messages.get().length);\n    } catch (e) {\n      this.hasError.set(true);\n      this.error.set(e);\n    } finally {\n      this.isLoading.set(false);\n    }\n  };\n\n  this.autorun(() => {\n    const limit = this.limit.get();\n    const offset = this.offset.get();\n    const searchTerm = this.searchTerm.get();\n\n    if (searchTerm !== '') {\n      return this.loadMessages(\"chat.search/?roomId=\".concat(this.rid, \"&searchText=\").concat(searchTerm, \"&count=\").concat(limit, \"&offset=\").concat(offset, \"&sort={\\\"ts\\\": 1}\"));\n    }\n\n    this.loadMessages(\"livechat/\".concat(this.rid, \"/messages?count=\").concat(limit, \"&offset=\").concat(offset, \"&sort={\\\"ts\\\": 1}\"));\n  });\n  this.autorun(() => {\n    if (currentData.clear != null) {\n      this.clear = currentData.clear;\n    }\n  });\n});","map":{"version":3,"sources":["app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js"],"names":["_objectSpread","module","link","default","v","Template","ReactiveVar","_","messageContext","APIClient","MESSAGES_LIMIT","contactChatHistoryMessages","helpers","messages","instance","get","result","call","rid","settings","showReplyButton","showreply","hideRoles","hasMore","isLoading","isSearching","searchTerm","length","empty","hasError","error","events","e","clear","throttle","target","scrollTop","scrollHeight","clientHeight","offset","set","limit","debounce","keyCode","preventDefault","value","onCreated","currentData","loadMessages","url","total","v1","concat","autorun"],"mappings":"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","sourcesContent":["import { Template } from 'meteor/templating';\nimport './contactChatHistoryMessages.html';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport _ from 'underscore';\n\nimport { messageContext } from '../../../../../ui-utils/client/lib/messageContext';\nimport { APIClient } from '../../../../../utils/client';\n\nconst MESSAGES_LIMIT = 50;\n\nTemplate.contactChatHistoryMessages.helpers({\n\tmessages() {\n\t\treturn Template.instance().messages.get();\n\t},\n\tmessageContext() {\n\t\tconst result = messageContext.call(this, { rid: Template.instance().rid });\n\t\treturn {\n\t\t\t...result,\n\t\t\tsettings: {\n\t\t\t\t...result.settings,\n\t\t\t\tshowReplyButton: false,\n\t\t\t\tshowreply: false,\n\t\t\t\thideRoles: true,\n\t\t\t},\n\t\t};\n\t},\n\thasMore() {\n\t\treturn Template.instance().hasMore.get();\n\t},\n\tisLoading() {\n\t\treturn Template.instance().isLoading.get();\n\t},\n\tisSearching() {\n\t\treturn Template.instance().searchTerm.get().length > 0;\n\t},\n\tempty() {\n\t\treturn Template.instance().messages.get().length === 0;\n\t},\n\thasError() {\n\t\treturn Template.instance().hasError.get();\n\t},\n\terror() {\n\t\treturn Template.instance().error.get();\n\t},\n});\n\nTemplate.contactChatHistoryMessages.events({\n\t'click .js-back'(e, instance) {\n\t\treturn instance.clear();\n\t},\n\t'scroll .js-list': _.throttle(function (e, instance) {\n\t\tif (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight && instance.hasMore.get()) {\n\t\t\tinstance.offset.set(instance.offset.get() + instance.limit.get());\n\t\t}\n\t}, 200),\n\t'keyup #message-search': _.debounce(function (e, instance) {\n\t\tif (e.keyCode === 13) {\n\t\t\treturn e.preventDefault();\n\t\t}\n\n\t\tconst { value } = e.target;\n\n\t\tif (e.keyCode === 40 || e.keyCode === 38) {\n\t\t\treturn e.preventDefault();\n\t\t}\n\n\t\tinstance.offset.set(0);\n\t\tinstance.searchTerm.set(value);\n\t}, 300),\n});\n\nTemplate.contactChatHistoryMessages.onCreated(function () {\n\tconst currentData = Template.currentData();\n\tthis.rid = currentData.rid;\n\tthis.messages = new ReactiveVar([]);\n\tthis.hasMore = new ReactiveVar(true);\n\tthis.offset = new ReactiveVar(0);\n\tthis.searchTerm = new ReactiveVar('');\n\tthis.isLoading = new ReactiveVar(true);\n\tthis.limit = new ReactiveVar(MESSAGES_LIMIT);\n\tthis.hasError = new ReactiveVar(false);\n\tthis.error = new ReactiveVar(null);\n\n\tthis.loadMessages = async (url) => {\n\t\tthis.isLoading.set(true);\n\t\tconst offset = this.offset.get();\n\n\t\ttry {\n\t\t\tconst { messages, total } = await APIClient.v1.get(url);\n\t\t\tthis.messages.set(offset === 0 ? messages : this.messages.get().concat(messages));\n\t\t\tthis.hasMore.set(total > this.messages.get().length);\n\t\t} catch (e) {\n\t\t\tthis.hasError.set(true);\n\t\t\tthis.error.set(e);\n\t\t} finally {\n\t\t\tthis.isLoading.set(false);\n\t\t}\n\t};\n\n\tthis.autorun(() => {\n\t\tconst limit = this.limit.get();\n\t\tconst offset = this.offset.get();\n\t\tconst searchTerm = this.searchTerm.get();\n\n\t\tif (searchTerm !== '') {\n\t\t\treturn this.loadMessages(`chat.search/?roomId=${this.rid}&searchText=${searchTerm}&count=${limit}&offset=${offset}&sort={\"ts\": 1}`);\n\t\t}\n\n\t\tthis.loadMessages(`livechat/${this.rid}/messages?count=${limit}&offset=${offset}&sort={\"ts\": 1}`);\n\t});\n\n\tthis.autorun(() => {\n\t\tif (currentData.clear != null) {\n\t\t\tthis.clear = currentData.clear;\n\t\t}\n\t});\n});\n"]},"sourceType":"module","hash":"14752179828bcbc4d296a69a1cddc949d13f8fac"}
