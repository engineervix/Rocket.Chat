{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-login/client/username/username.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-login/client/username/username.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-login/client/username/username.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/ui-login/client/username/username.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-login/client/username/username.js"}},"code":"var Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 1);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 4);\nvar settings;\nmodule.link(\"../../../settings\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 5);\nvar Button;\nmodule.link(\"../../../ui\", {\n  Button: function (v) {\n    Button = v;\n  }\n}, 6);\nvar t;\nmodule.link(\"../../../utils\", {\n  t: function (v) {\n    t = v;\n  }\n}, 7);\nvar callbacks;\nmodule.link(\"../../../../lib/callbacks\", {\n  callbacks: function (v) {\n    callbacks = v;\n  }\n}, 8);\nvar dispatchToastMessage;\nmodule.link(\"../../../../client/lib/toast\", {\n  dispatchToastMessage: function (v) {\n    dispatchToastMessage = v;\n  }\n}, 9);\nTemplate.username.onCreated(function () {\n  var _this = this;\n\n  var self = this;\n  self.customFields = new ReactiveVar();\n  self.username = new ReactiveVar();\n  Tracker.autorun(function () {\n    var Accounts_CustomFields = settings.get('Accounts_CustomFields');\n\n    if (typeof Accounts_CustomFields === 'string' && Accounts_CustomFields.trim() !== '') {\n      try {\n        return _this.customFields.set(JSON.parse(settings.get('Accounts_CustomFields')));\n      } catch (error1) {\n        return console.error('Invalid JSON for Accounts_CustomFields');\n      }\n    } else {\n      return _this.customFields.set(null);\n    }\n  });\n\n  var validateCustomFields = function (formObj, validationObj) {\n    var customFields = self.customFields.get();\n\n    if (!customFields) {\n      return;\n    }\n\n    for (var field in meteorBabelHelpers.sanitizeForInObject(formObj)) {\n      if (formObj.hasOwnProperty(field)) {\n        var value = formObj[field];\n\n        if (customFields[field] == null) {\n          continue;\n        }\n\n        var customField = customFields[field];\n\n        if (customField.required === true && !value) {\n          validationObj[field] = t('Field_required');\n          return validationObj[field];\n        }\n\n        if (customField.maxLength != null && value.length > customField.maxLength) {\n          validationObj[field] = t('Max_length_is', customField.maxLength);\n          return validationObj[field];\n        }\n\n        if (customField.minLength != null && value.length < customField.minLength) {\n          validationObj[field] = t('Min_length_is', customField.minLength);\n          return validationObj[field];\n        }\n      }\n    }\n  };\n\n  this.validate = function () {\n    var formData = $('#login-card').serializeArray();\n    var formObj = {};\n    var validationObj = {};\n    formData.forEach(function (field) {\n      formObj[field.name] = field.value;\n    });\n    $('#login-card h2').removeClass('error');\n    $('#login-card input.error, #login-card select.error').removeClass('error');\n    $('#login-card .input-error').text('');\n    validateCustomFields(formObj, validationObj);\n\n    if (!_.isEmpty(validationObj)) {\n      $('#login-card h2').addClass('error');\n      Object.keys(validationObj).forEach(function (key) {\n        var value = validationObj[key];\n        $(\"#login-card input[name=\" + key + \"], #login-card select[name=\" + key + \"]\").addClass('error');\n        $(\"#login-card input[name=\" + key + \"]~.input-error, #login-card select[name=\" + key + \"]~.input-error\").text(value);\n      });\n      return false;\n    }\n\n    return formObj;\n  };\n\n  return Meteor.call('getUsernameSuggestion', function (error, username) {\n    self.username.set({\n      ready: true,\n      username: username\n    });\n    return Meteor.defer(function () {\n      return self.find('input').focus();\n    });\n  });\n});\nTemplate.username.helpers({\n  username: function () {\n    return Template.instance().username.get();\n  },\n  backgroundUrl: function () {\n    var asset = settings.get('Assets_background');\n    var prefix = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '';\n\n    if (asset && (asset.url || asset.defaultUrl)) {\n      return prefix + \"/\" + (asset.url || asset.defaultUrl);\n    }\n  }\n});\nTemplate.username.events({\n  'focus .input-text input': function (event) {\n    return $(event.currentTarget).parents('.input-text').addClass('focus');\n  },\n  'blur .input-text input': function (event) {\n    if (event.currentTarget.value === '') {\n      return $(event.currentTarget).parents('.input-text').removeClass('focus');\n    }\n  },\n  'reset #login-card': function () {\n    Meteor.logout();\n  },\n  'submit #login-card': function (event, instance) {\n    event.preventDefault();\n    var formData = instance.validate();\n    var username = instance.username.get();\n    username.empty = false;\n    username.error = false;\n    username.invalid = false;\n    instance.username.set(username);\n    var button = $(event.target).find('button.login');\n    Button.loading(button);\n\n    if (!formData) {\n      Button.reset(button);\n      return;\n    }\n\n    var usernameValue = $('#username').val().trim();\n\n    if (usernameValue === '') {\n      username.empty = true;\n      instance.username.set(username);\n      Button.reset(button);\n      return;\n    }\n\n    Meteor.call('saveCustomFields', formData, function (err) {\n      if (err != null) {\n        dispatchToastMessage({\n          type: 'error',\n          message: err.error\n        });\n      }\n    });\n    Meteor.call('setUsername', usernameValue, function (err) {\n      if (err != null) {\n        if (err.error === 'username-invalid') {\n          username.invalid = true;\n        } else if (err.error === 'error-blocked-username') {\n          username.blocked = true;\n        } else {\n          username.unavailable = true;\n        }\n\n        username.username = usernameValue;\n        username.escaped = _.escape(usernameValue);\n      }\n\n      Button.reset(button);\n      instance.username.set(username);\n      return callbacks.run('usernameSet');\n    });\n  }\n});","map":{"version":3,"sources":["app/ui-login/client/username/username.js"],"names":["Meteor","module","link","v","ReactiveVar","Template","Tracker","_","settings","Button","t","callbacks","dispatchToastMessage","username","onCreated","self","customFields","autorun","Accounts_CustomFields","get","trim","set","JSON","parse","error1","console","error","validateCustomFields","formObj","validationObj","field","hasOwnProperty","value","customField","required","maxLength","length","minLength","validate","formData","$","serializeArray","forEach","name","removeClass","text","isEmpty","addClass","Object","keys","key","call","ready","defer","find","focus","helpers","instance","backgroundUrl","asset","prefix","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","url","defaultUrl","events","event","currentTarget","parents","logout","preventDefault","empty","invalid","button","target","loading","reset","usernameValue","val","err","type","message","blocked","unavailable","escaped","escape","run"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Template } from 'meteor/templating';\nimport { Tracker } from 'meteor/tracker';\nimport _ from 'underscore';\n\nimport { settings } from '../../../settings';\nimport { Button } from '../../../ui';\nimport { t } from '../../../utils';\nimport { callbacks } from '../../../../lib/callbacks';\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\n\nTemplate.username.onCreated(function () {\n\tconst self = this;\n\tself.customFields = new ReactiveVar();\n\tself.username = new ReactiveVar();\n\n\tTracker.autorun(() => {\n\t\tconst Accounts_CustomFields = settings.get('Accounts_CustomFields');\n\t\tif (typeof Accounts_CustomFields === 'string' && Accounts_CustomFields.trim() !== '') {\n\t\t\ttry {\n\t\t\t\treturn this.customFields.set(JSON.parse(settings.get('Accounts_CustomFields')));\n\t\t\t} catch (error1) {\n\t\t\t\treturn console.error('Invalid JSON for Accounts_CustomFields');\n\t\t\t}\n\t\t} else {\n\t\t\treturn this.customFields.set(null);\n\t\t}\n\t});\n\n\tconst validateCustomFields = function (formObj, validationObj) {\n\t\tconst customFields = self.customFields.get();\n\t\tif (!customFields) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const field in formObj) {\n\t\t\tif (formObj.hasOwnProperty(field)) {\n\t\t\t\tconst value = formObj[field];\n\t\t\t\tif (customFields[field] == null) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst customField = customFields[field];\n\t\t\t\tif (customField.required === true && !value) {\n\t\t\t\t\tvalidationObj[field] = t('Field_required');\n\t\t\t\t\treturn validationObj[field];\n\t\t\t\t}\n\t\t\t\tif (customField.maxLength != null && value.length > customField.maxLength) {\n\t\t\t\t\tvalidationObj[field] = t('Max_length_is', customField.maxLength);\n\t\t\t\t\treturn validationObj[field];\n\t\t\t\t}\n\t\t\t\tif (customField.minLength != null && value.length < customField.minLength) {\n\t\t\t\t\tvalidationObj[field] = t('Min_length_is', customField.minLength);\n\t\t\t\t\treturn validationObj[field];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.validate = function () {\n\t\tconst formData = $('#login-card').serializeArray();\n\t\tconst formObj = {};\n\t\tconst validationObj = {};\n\t\tformData.forEach((field) => {\n\t\t\tformObj[field.name] = field.value;\n\t\t});\n\n\t\t$('#login-card h2').removeClass('error');\n\t\t$('#login-card input.error, #login-card select.error').removeClass('error');\n\t\t$('#login-card .input-error').text('');\n\t\tvalidateCustomFields(formObj, validationObj);\n\t\tif (!_.isEmpty(validationObj)) {\n\t\t\t$('#login-card h2').addClass('error');\n\n\t\t\tObject.keys(validationObj).forEach((key) => {\n\t\t\t\tconst value = validationObj[key];\n\t\t\t\t$(`#login-card input[name=${key}], #login-card select[name=${key}]`).addClass('error');\n\t\t\t\t$(`#login-card input[name=${key}]~.input-error, #login-card select[name=${key}]~.input-error`).text(value);\n\t\t\t});\n\n\t\t\treturn false;\n\t\t}\n\t\treturn formObj;\n\t};\n\n\treturn Meteor.call('getUsernameSuggestion', function (error, username) {\n\t\tself.username.set({\n\t\t\tready: true,\n\t\t\tusername,\n\t\t});\n\t\treturn Meteor.defer(() => self.find('input').focus());\n\t});\n});\n\nTemplate.username.helpers({\n\tusername() {\n\t\treturn Template.instance().username.get();\n\t},\n\n\tbackgroundUrl() {\n\t\tconst asset = settings.get('Assets_background');\n\t\tconst prefix = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '';\n\t\tif (asset && (asset.url || asset.defaultUrl)) {\n\t\t\treturn `${prefix}/${asset.url || asset.defaultUrl}`;\n\t\t}\n\t},\n});\n\nTemplate.username.events({\n\t'focus .input-text input'(event) {\n\t\treturn $(event.currentTarget).parents('.input-text').addClass('focus');\n\t},\n\n\t'blur .input-text input'(event) {\n\t\tif (event.currentTarget.value === '') {\n\t\t\treturn $(event.currentTarget).parents('.input-text').removeClass('focus');\n\t\t}\n\t},\n\t'reset #login-card'() {\n\t\tMeteor.logout();\n\t},\n\t'submit #login-card'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tconst formData = instance.validate();\n\n\t\tconst username = instance.username.get();\n\t\tusername.empty = false;\n\t\tusername.error = false;\n\t\tusername.invalid = false;\n\t\tinstance.username.set(username);\n\n\t\tconst button = $(event.target).find('button.login');\n\t\tButton.loading(button);\n\n\t\tif (!formData) {\n\t\t\tButton.reset(button);\n\t\t\treturn;\n\t\t}\n\n\t\tconst usernameValue = $('#username').val().trim();\n\t\tif (usernameValue === '') {\n\t\t\tusername.empty = true;\n\t\t\tinstance.username.set(username);\n\t\t\tButton.reset(button);\n\t\t\treturn;\n\t\t}\n\n\t\tMeteor.call('saveCustomFields', formData, function (err) {\n\t\t\tif (err != null) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: err.error });\n\t\t\t}\n\t\t});\n\n\t\tMeteor.call('setUsername', usernameValue, function (err) {\n\t\t\tif (err != null) {\n\t\t\t\tif (err.error === 'username-invalid') {\n\t\t\t\t\tusername.invalid = true;\n\t\t\t\t} else if (err.error === 'error-blocked-username') {\n\t\t\t\t\tusername.blocked = true;\n\t\t\t\t} else {\n\t\t\t\t\tusername.unavailable = true;\n\t\t\t\t}\n\t\t\t\tusername.username = usernameValue;\n\t\t\t\tusername.escaped = _.escape(usernameValue);\n\t\t\t}\n\n\t\t\tButton.reset(button);\n\t\t\tinstance.username.set(username);\n\t\t\treturn callbacks.run('usernameSet');\n\t\t});\n\t},\n});\n"]},"sourceType":"module","hash":"a81672aa164cbe9636416887b9b5d4de7c53ddf2"}
