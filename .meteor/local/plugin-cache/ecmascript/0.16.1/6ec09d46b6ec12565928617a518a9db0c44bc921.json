{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/notifications/client/lib/Notifications.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/notifications/client/lib/Notifications.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/notifications/client/lib/Notifications.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/notifications/client/lib/Notifications.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/notifications/client/lib/Notifications.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 1);\nmodule.link(\"./Presence\");\n\nvar Notifications = /*#__PURE__*/function () {\n  function Notifications() {\n    var _this = this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    this.logged = Meteor.userId() !== null;\n    this.loginCb = [];\n    Tracker.autorun(function () {\n      if (Meteor.userId() !== null && _this.logged === false) {\n        _this.loginCb.forEach(function (cb) {\n          return cb();\n        });\n      }\n\n      _this.logged = Meteor.userId() !== null;\n    });\n    this.debug = false;\n    this.streamAll = new Meteor.Streamer('notify-all');\n    this.streamLogged = new Meteor.Streamer('notify-logged');\n    this.streamRoom = new Meteor.Streamer('notify-room');\n    this.streamRoomUsers = new Meteor.Streamer('notify-room-users');\n    this.streamUser = new Meteor.Streamer('notify-user');\n\n    if (this.debug === true) {\n      this.onAll(function () {\n        return console.log('RocketChat.Notifications: onAll', args);\n      });\n      this.onUser(function () {\n        return console.log('RocketChat.Notifications: onAll', args);\n      });\n    }\n  }\n\n  var _proto = Notifications.prototype;\n\n  _proto.onLogin = function () {\n    function onLogin(cb) {\n      this.loginCb.push(cb);\n\n      if (this.logged) {\n        return cb();\n      }\n    }\n\n    return onLogin;\n  }();\n\n  _proto.notifyRoom = function () {\n    function notifyRoom(room, eventName) {\n      for (var _len2 = arguments.length, args = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n        args[_key2 - 2] = arguments[_key2];\n      }\n\n      if (this.debug === true) {\n        console.log('RocketChat.Notifications: notifyRoom', [room, eventName].concat(args));\n      }\n\n      args.unshift(room + \"/\" + eventName);\n      return this.streamRoom.emit.apply(this.streamRoom, args);\n    }\n\n    return notifyRoom;\n  }();\n\n  _proto.notifyUser = function () {\n    function notifyUser(userId, eventName) {\n      for (var _len3 = arguments.length, args = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n        args[_key3 - 2] = arguments[_key3];\n      }\n\n      if (this.debug === true) {\n        console.log('RocketChat.Notifications: notifyUser', [userId, eventName].concat(args));\n      }\n\n      args.unshift(userId + \"/\" + eventName);\n      return this.streamUser.emit.apply(this.streamUser, args);\n    }\n\n    return notifyUser;\n  }();\n\n  _proto.notifyUsersOfRoom = function () {\n    function notifyUsersOfRoom(room, eventName) {\n      for (var _len4 = arguments.length, args = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n        args[_key4 - 2] = arguments[_key4];\n      }\n\n      if (this.debug === true) {\n        console.log('RocketChat.Notifications: notifyUsersOfRoom', [room, eventName].concat(args));\n      }\n\n      args.unshift(room + \"/\" + eventName);\n      return this.streamRoomUsers.emit.apply(this.streamRoomUsers, args);\n    }\n\n    return notifyUsersOfRoom;\n  }();\n\n  _proto.onAll = function () {\n    function onAll(eventName, callback) {\n      return this.streamAll.on(eventName, callback);\n    }\n\n    return onAll;\n  }();\n\n  _proto.onLogged = function () {\n    function onLogged(eventName, callback) {\n      var _this2 = this;\n\n      return this.onLogin(function () {\n        return _this2.streamLogged.on(eventName, callback);\n      });\n    }\n\n    return onLogged;\n  }();\n\n  _proto.onRoom = function () {\n    function onRoom(room, eventName, callback) {\n      if (this.debug === true) {\n        this.streamRoom.on(room, function () {\n          return console.log(\"RocketChat.Notifications: onRoom \" + room, [room, eventName, callback]);\n        });\n      }\n\n      return this.streamRoom.on(room + \"/\" + eventName, callback);\n    }\n\n    return onRoom;\n  }();\n\n  _proto.onUser = function () {\n    function onUser(eventName, callback) {\n      var _this3 = this;\n\n      var visitorId,\n          _args = arguments;\n      return _regeneratorRuntime.async(function () {\n        function onUser$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                visitorId = _args.length > 2 && _args[2] !== undefined ? _args[2] : null;\n                _context.next = 3;\n                return _regeneratorRuntime.awrap(this.streamUser.on((Meteor.userId() || visitorId) + \"/\" + eventName, callback));\n\n              case 3:\n                return _context.abrupt(\"return\", function () {\n                  return _this3.unUser(eventName, callback, visitorId);\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return onUser$;\n      }(), null, this, null, Promise);\n    }\n\n    return onUser;\n  }();\n\n  _proto.unAll = function () {\n    function unAll(callback) {\n      return this.streamAll.removeListener('notify', callback);\n    }\n\n    return unAll;\n  }();\n\n  _proto.unLogged = function () {\n    function unLogged(callback) {\n      return this.streamLogged.removeListener('notify', callback);\n    }\n\n    return unLogged;\n  }();\n\n  _proto.unRoom = function () {\n    function unRoom(room, eventName, callback) {\n      return this.streamRoom.removeListener(room + \"/\" + eventName, callback);\n    }\n\n    return unRoom;\n  }();\n\n  _proto.unUser = function () {\n    function unUser(eventName, callback) {\n      var visitorId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      return this.streamUser.removeListener((Meteor.userId() || visitorId) + \"/\" + eventName, callback);\n    }\n\n    return unUser;\n  }();\n\n  return Notifications;\n}();\n\nmodule.exportDefault(new Notifications());","map":{"version":3,"sources":["app/notifications/client/lib/Notifications.js"],"names":["_regeneratorRuntime","module","link","default","v","Meteor","Tracker","Notifications","args","logged","userId","loginCb","autorun","forEach","cb","debug","streamAll","Streamer","streamLogged","streamRoom","streamRoomUsers","streamUser","onAll","console","log","onUser","onLogin","push","notifyRoom","room","eventName","unshift","emit","apply","notifyUser","notifyUsersOfRoom","callback","on","onLogged","onRoom","visitorId","unUser","unAll","removeListener","unLogged","unRoom","exportDefault"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport './Presence';\n\nclass Notifications {\n\tconstructor(...args) {\n\t\tthis.logged = Meteor.userId() !== null;\n\t\tthis.loginCb = [];\n\t\tTracker.autorun(() => {\n\t\t\tif (Meteor.userId() !== null && this.logged === false) {\n\t\t\t\tthis.loginCb.forEach((cb) => cb());\n\t\t\t}\n\t\t\tthis.logged = Meteor.userId() !== null;\n\t\t});\n\t\tthis.debug = false;\n\t\tthis.streamAll = new Meteor.Streamer('notify-all');\n\t\tthis.streamLogged = new Meteor.Streamer('notify-logged');\n\t\tthis.streamRoom = new Meteor.Streamer('notify-room');\n\t\tthis.streamRoomUsers = new Meteor.Streamer('notify-room-users');\n\t\tthis.streamUser = new Meteor.Streamer('notify-user');\n\n\t\tif (this.debug === true) {\n\t\t\tthis.onAll(function () {\n\t\t\t\treturn console.log('RocketChat.Notifications: onAll', args);\n\t\t\t});\n\t\t\tthis.onUser(function () {\n\t\t\t\treturn console.log('RocketChat.Notifications: onAll', args);\n\t\t\t});\n\t\t}\n\t}\n\n\tonLogin(cb) {\n\t\tthis.loginCb.push(cb);\n\t\tif (this.logged) {\n\t\t\treturn cb();\n\t\t}\n\t}\n\n\tnotifyRoom(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('RocketChat.Notifications: notifyRoom', [room, eventName, ...args]);\n\t\t}\n\t\targs.unshift(`${room}/${eventName}`);\n\t\treturn this.streamRoom.emit.apply(this.streamRoom, args);\n\t}\n\n\tnotifyUser(userId, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('RocketChat.Notifications: notifyUser', [userId, eventName, ...args]);\n\t\t}\n\t\targs.unshift(`${userId}/${eventName}`);\n\t\treturn this.streamUser.emit.apply(this.streamUser, args);\n\t}\n\n\tnotifyUsersOfRoom(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('RocketChat.Notifications: notifyUsersOfRoom', [room, eventName, ...args]);\n\t\t}\n\t\targs.unshift(`${room}/${eventName}`);\n\t\treturn this.streamRoomUsers.emit.apply(this.streamRoomUsers, args);\n\t}\n\n\tonAll(eventName, callback) {\n\t\treturn this.streamAll.on(eventName, callback);\n\t}\n\n\tonLogged(eventName, callback) {\n\t\treturn this.onLogin(() => this.streamLogged.on(eventName, callback));\n\t}\n\n\tonRoom(room, eventName, callback) {\n\t\tif (this.debug === true) {\n\t\t\tthis.streamRoom.on(room, function () {\n\t\t\t\treturn console.log(`RocketChat.Notifications: onRoom ${room}`, [room, eventName, callback]);\n\t\t\t});\n\t\t}\n\t\treturn this.streamRoom.on(`${room}/${eventName}`, callback);\n\t}\n\n\tasync onUser(eventName, callback, visitorId = null) {\n\t\tawait this.streamUser.on(`${Meteor.userId() || visitorId}/${eventName}`, callback);\n\t\treturn () => this.unUser(eventName, callback, visitorId);\n\t}\n\n\tunAll(callback) {\n\t\treturn this.streamAll.removeListener('notify', callback);\n\t}\n\n\tunLogged(callback) {\n\t\treturn this.streamLogged.removeListener('notify', callback);\n\t}\n\n\tunRoom(room, eventName, callback) {\n\t\treturn this.streamRoom.removeListener(`${room}/${eventName}`, callback);\n\t}\n\n\tunUser(eventName, callback, visitorId = null) {\n\t\treturn this.streamUser.removeListener(`${Meteor.userId() || visitorId}/${eventName}`, callback);\n\t}\n}\n\nexport default new Notifications();\n"]},"sourceType":"module","hash":"6ec09d46b6ec12565928617a518a9db0c44bc921"}
