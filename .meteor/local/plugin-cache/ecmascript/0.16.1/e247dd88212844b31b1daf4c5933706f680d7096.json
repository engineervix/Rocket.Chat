{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/visitorInfo.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/livechat/client/views/app/tabbar/visitorInfo.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/visitorInfo.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/app/livechat/client/views/app/tabbar/visitorInfo.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/client/views/app/tabbar/visitorInfo.js"}},"code":"var _regeneratorRuntime;\n\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar TAPi18n;\nmodule.link(\"meteor/rocketchat:tap-i18n\", {\n  TAPi18n: function (v) {\n    TAPi18n = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\nvar FlowRouter;\nmodule.link(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 3);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 4);\nvar Template;\nmodule.link(\"meteor/templating\", {\n  Template: function (v) {\n    Template = v;\n  }\n}, 5);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 6);\nvar moment;\nmodule.link(\"moment\", {\n  \"default\": function (v) {\n    moment = v;\n  }\n}, 7);\nvar UAParser;\nmodule.link(\"ua-parser-js\", {\n  \"default\": function (v) {\n    UAParser = v;\n  }\n}, 8);\nvar modal;\nmodule.link(\"../../../../../ui-utils\", {\n  modal: function (v) {\n    modal = v;\n  }\n}, 9);\nvar Subscriptions;\nmodule.link(\"../../../../../models\", {\n  Subscriptions: function (v) {\n    Subscriptions = v;\n  }\n}, 10);\nvar settings;\nmodule.link(\"../../../../../settings\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 11);\nvar t;\nmodule.link(\"../../../../../utils\", {\n  t: function (v) {\n    t = v;\n  }\n}, 12);\nvar hasRole, hasPermission, hasAtLeastOnePermission;\nmodule.link(\"../../../../../authorization\", {\n  hasRole: function (v) {\n    hasRole = v;\n  },\n  hasPermission: function (v) {\n    hasPermission = v;\n  },\n  hasAtLeastOnePermission: function (v) {\n    hasAtLeastOnePermission = v;\n  }\n}, 13);\nmodule.link(\"./visitorInfo.html\");\nvar APIClient;\nmodule.link(\"../../../../../utils/client\", {\n  APIClient: function (v) {\n    APIClient = v;\n  }\n}, 14);\nvar RoomManager;\nmodule.link(\"../../../../../ui-utils/client\", {\n  RoomManager: function (v) {\n    RoomManager = v;\n  }\n}, 15);\nvar getCustomFormTemplate;\nmodule.link(\"../customTemplates/register\", {\n  getCustomFormTemplate: function (v) {\n    getCustomFormTemplate = v;\n  }\n}, 16);\nvar Markdown;\nmodule.link(\"../../../../../markdown/client\", {\n  Markdown: function (v) {\n    Markdown = v;\n  }\n}, 17);\nvar handleError;\nmodule.link(\"../../../../../../client/lib/utils/handleError\", {\n  handleError: function (v) {\n    handleError = v;\n  }\n}, 18);\nvar formatDateAndTime;\nmodule.link(\"../../../../../../client/lib/utils/formatDateAndTime\", {\n  formatDateAndTime: function (v) {\n    formatDateAndTime = v;\n  }\n}, 19);\nvar roomCoordinator;\nmodule.link(\"../../../../../../client/lib/rooms/roomCoordinator\", {\n  roomCoordinator: function (v) {\n    roomCoordinator = v;\n  }\n}, 20);\n\nvar isSubscribedToRoom = function () {\n  var data = Template.currentData();\n\n  if (!data || !data.rid) {\n    return false;\n  }\n\n  var subscription = Subscriptions.findOne({\n    rid: data.rid\n  });\n  return subscription !== undefined;\n};\n\nvar closingDialogRequired = function (department) {\n  if (settings.get('Livechat_request_comment_when_closing_conversation')) {\n    return true;\n  }\n\n  return department && department.requestTagBeforeClosingChat;\n};\n\nTemplate.visitorInfo.helpers({\n  user: function () {\n    var user = Template.instance().user.get();\n\n    if (user && user.userAgent) {\n      var _roomCoordinator$getR;\n\n      var ua = new UAParser();\n      ua.setUA(user.userAgent);\n      user.os = ua.getOS().name + \" \" + ua.getOS().version;\n\n      if (['Mac OS', 'iOS'].indexOf(ua.getOS().name) !== -1) {\n        user.osIcon = 'icon-apple';\n      } else {\n        user.osIcon = \"icon-\" + ua.getOS().name.toLowerCase();\n      }\n\n      user.browser = ua.getBrowser().name + \" \" + ua.getBrowser().version;\n      user.browserIcon = \"icon-\" + ua.getBrowser().name.toLowerCase();\n      user.status = ((_roomCoordinator$getR = roomCoordinator.getRoomDirectives('l')) === null || _roomCoordinator$getR === void 0 ? void 0 : _roomCoordinator$getR.getUserStatus(this.rid)) || 'offline';\n    }\n\n    return user;\n  },\n  room: function () {\n    return Template.instance().room.get();\n  },\n  department: function () {\n    return Template.instance().department.get();\n  },\n  joinTags: function () {\n    var tags = Template.instance().tags.get();\n    return tags && tags.join(', ');\n  },\n  customRoomFields: function () {\n    var customFields = Template.instance().customFields.get();\n\n    if (!customFields || customFields.length === 0) {\n      return [];\n    }\n\n    var fields = [];\n    var room = Template.instance().room.get();\n\n    var _ref = room || {},\n        _ref$livechatData = _ref.livechatData,\n        livechatData = _ref$livechatData === void 0 ? {} : _ref$livechatData;\n\n    Object.keys(livechatData).forEach(function (key) {\n      var field = _.findWhere(customFields, {\n        _id: key\n      });\n\n      if (field && field.visibility !== 'hidden' && field.scope === 'room') {\n        fields.push({\n          label: field.label,\n          value: livechatData[key]\n        });\n      }\n    });\n    return fields;\n  },\n  customVisitorFields: function () {\n    var customFields = Template.instance().customFields.get();\n\n    if (!hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields'])) {\n      return;\n    }\n\n    if (!customFields || customFields.length === 0) {\n      return [];\n    }\n\n    var fields = [];\n    var user = Template.instance().user.get();\n\n    var _ref2 = user || {},\n        _ref2$livechatData = _ref2.livechatData,\n        livechatData = _ref2$livechatData === void 0 ? {} : _ref2$livechatData;\n\n    Object.keys(livechatData).forEach(function (key) {\n      var field = _.findWhere(customFields, {\n        _id: key\n      });\n\n      if (field && field.visibility !== 'hidden' && field.scope === 'visitor') {\n        fields.push({\n          label: field.label,\n          value: livechatData[key]\n        });\n      }\n    });\n    return fields;\n  },\n  createdAt: function () {\n    if (!this.createdAt) {\n      return '';\n    }\n\n    return moment(this.createdAt).format('L LTS');\n  },\n  lastLogin: function () {\n    if (!this.lastLogin) {\n      return '';\n    }\n\n    return moment(this.lastLogin).format('L LTS');\n  },\n  editing: function () {\n    return Template.instance().action.get() === 'edit';\n  },\n  forwarding: function () {\n    return Template.instance().action.get() === 'forward';\n  },\n  sendingTranscript: function () {\n    return Template.instance().action.get() === 'transcript';\n  },\n  roomInfoData: function () {\n    var instance = Template.instance();\n    var user = instance.user.get();\n    return {\n      visitorId: user ? user._id : null,\n      roomId: this.rid,\n      save: function () {\n        instance.action.set();\n      },\n      cancel: function () {\n        instance.action.set();\n      }\n    };\n  },\n  roomOpen: function () {\n    var room = Template.instance().room.get();\n    var uid = Meteor.userId();\n    return room && room.open && (room.servedBy && room.servedBy._id === uid || hasRole(uid, 'livechat-manager'));\n  },\n  canReturnQueue: function () {\n    var config = Template.instance().routingConfig.get();\n    return config.returnQueue;\n  },\n  showDetail: function () {\n    if (Template.instance().action.get()) {\n      return 'hidden';\n    }\n  },\n  canSeeButtons: function () {\n    if (hasAtLeastOnePermission(['close-others-livechat-room', 'transfer-livechat-guest'])) {\n      return true;\n    }\n\n    return isSubscribedToRoom();\n  },\n  canEditRoom: function () {\n    if (hasPermission('save-others-livechat-room-info')) {\n      return true;\n    }\n\n    return isSubscribedToRoom();\n  },\n  canCloseRoom: function () {\n    if (hasPermission('close-others-livechat-room')) {\n      return true;\n    }\n\n    return isSubscribedToRoom();\n  },\n  canForwardGuest: function () {\n    return hasPermission('transfer-livechat-guest');\n  },\n  canSendTranscript: function () {\n    var room = Template.instance().room.get();\n    return !room.email && hasPermission('send-omnichannel-chat-transcript');\n  },\n  canPlaceChatOnHold: function () {\n    var _room$lastMessage;\n\n    var room = Template.instance().room.get();\n    return room.open && !room.onHold && room.servedBy && room.lastMessage && !((_room$lastMessage = room.lastMessage) !== null && _room$lastMessage !== void 0 && _room$lastMessage.token) && settings.get('Livechat_allow_manual_on_hold');\n  },\n  roomClosedDateTime: function () {\n    var closedAt = this.closedAt;\n    return formatDateAndTime(closedAt);\n  },\n  roomClosedBy: function () {\n    var _this$closedBy = this.closedBy,\n        closedBy = _this$closedBy === void 0 ? {} : _this$closedBy,\n        _this$servedBy = this.servedBy,\n        servedBy = _this$servedBy === void 0 ? {} : _this$servedBy;\n    var closer = this.closer;\n\n    if (closer === 'user') {\n      if (servedBy._id !== closedBy._id) {\n        return closedBy.username;\n      }\n\n      closer = 'agent';\n    }\n\n    var closerLabel = closer.charAt(0).toUpperCase() + closer.slice(1);\n    return t(\"\" + closerLabel);\n  },\n  customInfoTemplate: function () {\n    return getCustomFormTemplate('livechatVisitorInfo');\n  },\n  roomDataContext: function () {\n    // To make the dynamic template reactive we need to pass a ReactiveVar through the data property\n    // because only the dynamic template data will be reloaded\n    return Template.instance().room;\n  },\n  transcriptRequest: function () {\n    var room = Template.instance().room.get();\n    return room === null || room === void 0 ? void 0 : room.transcriptRequest;\n  },\n  transcriptRequestedDateTime: function () {\n    var requestedAt = this.requestedAt;\n    return formatDateAndTime(requestedAt);\n  },\n  markdown: function (text) {\n    return Markdown.parse(text);\n  }\n});\nTemplate.visitorInfo.events({\n  'click .edit-livechat': function (event, instance) {\n    event.preventDefault();\n    instance.action.set('edit');\n  },\n  'click .close-livechat': function (event, instance) {\n    event.preventDefault();\n\n    if (!closingDialogRequired(instance.department.get())) {\n      var comment = TAPi18n.__('Chat_closed_by_agent');\n\n      return Meteor.call('livechat:closeRoom', this.rid, comment, {\n        clientAction: true\n      }, function (error\n      /* , result*/\n      ) {\n        if (error) {\n          return handleError(error);\n        }\n\n        modal.open({\n          title: t('Chat_closed'),\n          text: t('Chat_closed_successfully'),\n          type: 'success',\n          timer: 1000,\n          showConfirmButton: false\n        });\n      });\n    }\n\n    modal.open({\n      title: t('Closing_chat'),\n      modifier: 'modal',\n      content: 'closeRoom',\n      data: {\n        rid: this.rid\n      },\n      confirmOnEnter: false,\n      showConfirmButton: false,\n      showCancelButton: false\n    });\n  },\n  'click .return-inquiry': function (event) {\n    var _this = this;\n\n    event.preventDefault();\n    modal.open({\n      title: t('Would_you_like_to_return_the_inquiry'),\n      type: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#3085d6',\n      cancelButtonColor: '#d33',\n      confirmButtonText: t('Yes')\n    }, function () {\n      Meteor.call('livechat:returnAsInquiry', _this.rid, function (error\n      /* , result*/\n      ) {\n        if (error) {\n          handleError(error);\n        } else {\n          Session.set('openedRoom');\n          FlowRouter.go('/home');\n        }\n      });\n    });\n  },\n  'click .forward-livechat': function (event, instance) {\n    event.preventDefault();\n    instance.action.set('forward');\n  },\n  'click .send-transcript': function (event, instance) {\n    event.preventDefault();\n    instance.action.set('transcript');\n  },\n  'click .on-hold': function (event) {\n    var _this2 = this;\n\n    event.preventDefault();\n    modal.open({\n      title: t('Would_you_like_to_place_chat_on_hold'),\n      type: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#3085d6',\n      cancelButtonColor: '#d33',\n      confirmButtonText: t('Yes')\n    }, function () {\n      function _callee() {\n        var _await$APIClient$v1$p, success;\n\n        return _regeneratorRuntime.async(function () {\n          function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return _regeneratorRuntime.awrap(APIClient.v1.post('livechat/room.onHold', {\n                    roomId: _this2.rid\n                  }));\n\n                case 2:\n                  _await$APIClient$v1$p = _context.sent;\n                  success = _await$APIClient$v1$p.success;\n\n                  if (success) {\n                    modal.open({\n                      title: t('Chat_On_Hold'),\n                      text: t('Chat_On_Hold_Successfully'),\n                      type: 'success',\n                      timer: 1500,\n                      showConfirmButton: false\n                    });\n                  }\n\n                case 5:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }\n\n          return _callee$;\n        }(), null, null, null, Promise);\n      }\n\n      return _callee;\n    }());\n  }\n});\nTemplate.visitorInfo.onCreated(function () {\n  var _this3 = this;\n\n  this.visitorId = new ReactiveVar(null);\n  this.customFields = new ReactiveVar([]);\n  this.action = new ReactiveVar();\n  this.user = new ReactiveVar();\n  this.departmentId = new ReactiveVar(null);\n  this.tags = new ReactiveVar(null);\n  this.routingConfig = new ReactiveVar({});\n  this.department = new ReactiveVar({});\n  this.room = new ReactiveVar({});\n\n  this.updateVisitor = function () {\n    function _callee2(visitorId) {\n      var _await$APIClient$v1$g, visitor;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _regeneratorRuntime.awrap(APIClient.v1.get(\"livechat/visitors.info?visitorId=\" + visitorId));\n\n              case 2:\n                _await$APIClient$v1$g = _context2.sent;\n                visitor = _await$APIClient$v1$g.visitor;\n\n                _this3.user.set(visitor);\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }\n\n        return _callee2$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee2;\n  }();\n\n  this.updateRoom = function (room) {\n    _this3.departmentId.set(room && room.departmentId);\n\n    _this3.tags.set(room && room.tags);\n\n    _this3.room.set(room);\n\n    var visitorId = room && room.v && room.v._id;\n\n    _this3.visitorId.set(visitorId);\n\n    _this3.updateVisitor(visitorId);\n  };\n\n  Meteor.call('livechat:getCustomFields', function (err, customFields) {\n    if (customFields) {\n      _this3.customFields.set(customFields);\n    }\n  });\n\n  var _Template$currentData = Template.currentData(),\n      rid = _Template$currentData.rid;\n\n  Meteor.call('livechat:getRoutingConfig', function (err, config) {\n    if (config) {\n      _this3.routingConfig.set(config);\n    }\n  });\n\n  var loadRoomData = function () {\n    function _callee3(rid) {\n      var _await$APIClient$v1$g2, room;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return _regeneratorRuntime.awrap(APIClient.v1.get(\"rooms.info?roomId=\" + rid));\n\n              case 2:\n                _await$APIClient$v1$g2 = _context3.sent;\n                room = _await$APIClient$v1$g2.room;\n\n                _this3.updateRoom(room);\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }\n\n        return _callee3$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee3;\n  }();\n\n  if (rid) {\n    RoomManager.roomStream.on(rid, this.updateRoom);\n    loadRoomData(rid);\n  }\n\n  this.autorun(function () {\n    function _callee4() {\n      var _await$APIClient$v1$g3, department;\n\n      return _regeneratorRuntime.async(function () {\n        function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!_this3.departmentId.get()) {\n                  _context4.next = 6;\n                  break;\n                }\n\n                _context4.next = 3;\n                return _regeneratorRuntime.awrap(APIClient.v1.get(\"livechat/department/\" + _this3.departmentId.get() + \"?includeAgents=false\"));\n\n              case 3:\n                _await$APIClient$v1$g3 = _context4.sent;\n                department = _await$APIClient$v1$g3.department;\n\n                _this3.department.set(department);\n\n              case 6:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }\n\n        return _callee4$;\n      }(), null, null, null, Promise);\n    }\n\n    return _callee4;\n  }());\n  this.autorun(function () {\n    var visitorId = _this3.visitorId.get();\n\n    if (visitorId) {\n      _this3.updateVisitor(visitorId);\n    }\n  });\n});\nTemplate.visitorInfo.onDestroyed(function () {\n  var _Template$currentData2 = Template.currentData(),\n      rid = _Template$currentData2.rid;\n\n  RoomManager.roomStream.removeListener(rid, this.updateRoom);\n});","map":{"version":3,"sources":["app/livechat/client/views/app/tabbar/visitorInfo.js"],"names":["_regeneratorRuntime","module","link","default","v","TAPi18n","Meteor","ReactiveVar","FlowRouter","Session","Template","_","moment","UAParser","modal","Subscriptions","settings","t","hasRole","hasPermission","hasAtLeastOnePermission","APIClient","RoomManager","getCustomFormTemplate","Markdown","handleError","formatDateAndTime","roomCoordinator","isSubscribedToRoom","data","currentData","rid","subscription","findOne","undefined","closingDialogRequired","department","get","requestTagBeforeClosingChat","visitorInfo","helpers","user","instance","userAgent","ua","setUA","os","getOS","name","version","indexOf","osIcon","toLowerCase","browser","getBrowser","browserIcon","status","getRoomDirectives","getUserStatus","room","joinTags","tags","join","customRoomFields","customFields","length","fields","livechatData","Object","keys","forEach","key","field","findWhere","_id","visibility","scope","push","label","value","customVisitorFields","createdAt","format","lastLogin","editing","action","forwarding","sendingTranscript","roomInfoData","visitorId","roomId","save","set","cancel","roomOpen","uid","userId","open","servedBy","canReturnQueue","config","routingConfig","returnQueue","showDetail","canSeeButtons","canEditRoom","canCloseRoom","canForwardGuest","canSendTranscript","email","canPlaceChatOnHold","onHold","lastMessage","token","roomClosedDateTime","closedAt","roomClosedBy","closedBy","closer","username","closerLabel","charAt","toUpperCase","slice","customInfoTemplate","roomDataContext","transcriptRequest","transcriptRequestedDateTime","requestedAt","markdown","text","parse","events","event","preventDefault","comment","__","call","clientAction","error","title","type","timer","showConfirmButton","modifier","content","confirmOnEnter","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","go","v1","post","success","onCreated","departmentId","updateVisitor","visitor","updateRoom","err","loadRoomData","roomStream","on","autorun","onDestroyed","removeListener"],"mappings":"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","sourcesContent":["import { TAPi18n } from 'meteor/rocketchat:tap-i18n';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Session } from 'meteor/session';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\nimport moment from 'moment';\nimport UAParser from 'ua-parser-js';\n\nimport { modal } from '../../../../../ui-utils';\nimport { Subscriptions } from '../../../../../models';\nimport { settings } from '../../../../../settings';\nimport { t } from '../../../../../utils';\nimport { hasRole, hasPermission, hasAtLeastOnePermission } from '../../../../../authorization';\nimport './visitorInfo.html';\nimport { APIClient } from '../../../../../utils/client';\nimport { RoomManager } from '../../../../../ui-utils/client';\nimport { getCustomFormTemplate } from '../customTemplates/register';\nimport { Markdown } from '../../../../../markdown/client';\nimport { handleError } from '../../../../../../client/lib/utils/handleError';\nimport { formatDateAndTime } from '../../../../../../client/lib/utils/formatDateAndTime';\nimport { roomCoordinator } from '../../../../../../client/lib/rooms/roomCoordinator';\n\nconst isSubscribedToRoom = () => {\n\tconst data = Template.currentData();\n\tif (!data || !data.rid) {\n\t\treturn false;\n\t}\n\n\tconst subscription = Subscriptions.findOne({ rid: data.rid });\n\treturn subscription !== undefined;\n};\n\nconst closingDialogRequired = (department) => {\n\tif (settings.get('Livechat_request_comment_when_closing_conversation')) {\n\t\treturn true;\n\t}\n\n\treturn department && department.requestTagBeforeClosingChat;\n};\n\nTemplate.visitorInfo.helpers({\n\tuser() {\n\t\tconst user = Template.instance().user.get();\n\t\tif (user && user.userAgent) {\n\t\t\tconst ua = new UAParser();\n\t\t\tua.setUA(user.userAgent);\n\n\t\t\tuser.os = `${ua.getOS().name} ${ua.getOS().version}`;\n\t\t\tif (['Mac OS', 'iOS'].indexOf(ua.getOS().name) !== -1) {\n\t\t\t\tuser.osIcon = 'icon-apple';\n\t\t\t} else {\n\t\t\t\tuser.osIcon = `icon-${ua.getOS().name.toLowerCase()}`;\n\t\t\t}\n\t\t\tuser.browser = `${ua.getBrowser().name} ${ua.getBrowser().version}`;\n\t\t\tuser.browserIcon = `icon-${ua.getBrowser().name.toLowerCase()}`;\n\n\t\t\tuser.status = roomCoordinator.getRoomDirectives('l')?.getUserStatus(this.rid) || 'offline';\n\t\t}\n\t\treturn user;\n\t},\n\n\troom() {\n\t\treturn Template.instance().room.get();\n\t},\n\n\tdepartment() {\n\t\treturn Template.instance().department.get();\n\t},\n\n\tjoinTags() {\n\t\tconst tags = Template.instance().tags.get();\n\t\treturn tags && tags.join(', ');\n\t},\n\n\tcustomRoomFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\t\tif (!customFields || customFields.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst fields = [];\n\t\tconst room = Template.instance().room.get();\n\t\tconst { livechatData = {} } = room || {};\n\n\t\tObject.keys(livechatData).forEach((key) => {\n\t\t\tconst field = _.findWhere(customFields, { _id: key });\n\t\t\tif (field && field.visibility !== 'hidden' && field.scope === 'room') {\n\t\t\t\tfields.push({ label: field.label, value: livechatData[key] });\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t},\n\n\tcustomVisitorFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\t\tif (!hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields'])) {\n\t\t\treturn;\n\t\t}\n\t\tif (!customFields || customFields.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst fields = [];\n\t\tconst user = Template.instance().user.get();\n\t\tconst { livechatData = {} } = user || {};\n\n\t\tObject.keys(livechatData).forEach((key) => {\n\t\t\tconst field = _.findWhere(customFields, { _id: key });\n\t\t\tif (field && field.visibility !== 'hidden' && field.scope === 'visitor') {\n\t\t\t\tfields.push({ label: field.label, value: livechatData[key] });\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t},\n\n\tcreatedAt() {\n\t\tif (!this.createdAt) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.createdAt).format('L LTS');\n\t},\n\n\tlastLogin() {\n\t\tif (!this.lastLogin) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.lastLogin).format('L LTS');\n\t},\n\n\tediting() {\n\t\treturn Template.instance().action.get() === 'edit';\n\t},\n\n\tforwarding() {\n\t\treturn Template.instance().action.get() === 'forward';\n\t},\n\n\tsendingTranscript() {\n\t\treturn Template.instance().action.get() === 'transcript';\n\t},\n\n\troomInfoData() {\n\t\tconst instance = Template.instance();\n\t\tconst user = instance.user.get();\n\t\treturn {\n\t\t\tvisitorId: user ? user._id : null,\n\t\t\troomId: this.rid,\n\t\t\tsave() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t\tcancel() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t};\n\t},\n\n\troomOpen() {\n\t\tconst room = Template.instance().room.get();\n\t\tconst uid = Meteor.userId();\n\t\treturn room && room.open && ((room.servedBy && room.servedBy._id === uid) || hasRole(uid, 'livechat-manager'));\n\t},\n\n\tcanReturnQueue() {\n\t\tconst config = Template.instance().routingConfig.get();\n\t\treturn config.returnQueue;\n\t},\n\n\tshowDetail() {\n\t\tif (Template.instance().action.get()) {\n\t\t\treturn 'hidden';\n\t\t}\n\t},\n\n\tcanSeeButtons() {\n\t\tif (hasAtLeastOnePermission(['close-others-livechat-room', 'transfer-livechat-guest'])) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanEditRoom() {\n\t\tif (hasPermission('save-others-livechat-room-info')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanCloseRoom() {\n\t\tif (hasPermission('close-others-livechat-room')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanForwardGuest() {\n\t\treturn hasPermission('transfer-livechat-guest');\n\t},\n\n\tcanSendTranscript() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn !room.email && hasPermission('send-omnichannel-chat-transcript');\n\t},\n\n\tcanPlaceChatOnHold() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn (\n\t\t\troom.open &&\n\t\t\t!room.onHold &&\n\t\t\troom.servedBy &&\n\t\t\troom.lastMessage &&\n\t\t\t!room.lastMessage?.token &&\n\t\t\tsettings.get('Livechat_allow_manual_on_hold')\n\t\t);\n\t},\n\n\troomClosedDateTime() {\n\t\tconst { closedAt } = this;\n\t\treturn formatDateAndTime(closedAt);\n\t},\n\n\troomClosedBy() {\n\t\tconst { closedBy = {}, servedBy = {} } = this;\n\t\tlet { closer } = this;\n\n\t\tif (closer === 'user') {\n\t\t\tif (servedBy._id !== closedBy._id) {\n\t\t\t\treturn closedBy.username;\n\t\t\t}\n\n\t\t\tcloser = 'agent';\n\t\t}\n\n\t\tconst closerLabel = closer.charAt(0).toUpperCase() + closer.slice(1);\n\t\treturn t(`${closerLabel}`);\n\t},\n\n\tcustomInfoTemplate() {\n\t\treturn getCustomFormTemplate('livechatVisitorInfo');\n\t},\n\n\troomDataContext() {\n\t\t// To make the dynamic template reactive we need to pass a ReactiveVar through the data property\n\t\t// because only the dynamic template data will be reloaded\n\t\treturn Template.instance().room;\n\t},\n\n\ttranscriptRequest() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn room?.transcriptRequest;\n\t},\n\n\ttranscriptRequestedDateTime() {\n\t\tconst { requestedAt } = this;\n\t\treturn formatDateAndTime(requestedAt);\n\t},\n\n\tmarkdown(text) {\n\t\treturn Markdown.parse(text);\n\t},\n});\n\nTemplate.visitorInfo.events({\n\t'click .edit-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('edit');\n\t},\n\t'click .close-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tif (!closingDialogRequired(instance.department.get())) {\n\t\t\tconst comment = TAPi18n.__('Chat_closed_by_agent');\n\t\t\treturn Meteor.call('livechat:closeRoom', this.rid, comment, { clientAction: true }, function (error /* , result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\n\t\t\t\tmodal.open({\n\t\t\t\t\ttitle: t('Chat_closed'),\n\t\t\t\t\ttext: t('Chat_closed_successfully'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tmodal.open({\n\t\t\ttitle: t('Closing_chat'),\n\t\t\tmodifier: 'modal',\n\t\t\tcontent: 'closeRoom',\n\t\t\tdata: {\n\t\t\t\trid: this.rid,\n\t\t\t},\n\t\t\tconfirmOnEnter: false,\n\t\t\tshowConfirmButton: false,\n\t\t\tshowCancelButton: false,\n\t\t});\n\t},\n\n\t'click .return-inquiry'(event) {\n\t\tevent.preventDefault();\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Would_you_like_to_return_the_inquiry'),\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\t\tcancelButtonColor: '#d33',\n\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tMeteor.call('livechat:returnAsInquiry', this.rid, function (error /* , result*/) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\thandleError(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tSession.set('openedRoom');\n\t\t\t\t\t\tFlowRouter.go('/home');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t},\n\n\t'click .forward-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('forward');\n\t},\n\n\t'click .send-transcript'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('transcript');\n\t},\n\n\t'click .on-hold'(event) {\n\t\tevent.preventDefault();\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Would_you_like_to_place_chat_on_hold'),\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\t\tcancelButtonColor: '#d33',\n\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t},\n\t\t\tasync () => {\n\t\t\t\tconst { success } = await APIClient.v1.post('livechat/room.onHold', { roomId: this.rid });\n\t\t\t\tif (success) {\n\t\t\t\t\tmodal.open({\n\t\t\t\t\t\ttitle: t('Chat_On_Hold'),\n\t\t\t\t\t\ttext: t('Chat_On_Hold_Successfully'),\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\ttimer: 1500,\n\t\t\t\t\t\tshowConfirmButton: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t},\n});\n\nTemplate.visitorInfo.onCreated(function () {\n\tthis.visitorId = new ReactiveVar(null);\n\tthis.customFields = new ReactiveVar([]);\n\tthis.action = new ReactiveVar();\n\tthis.user = new ReactiveVar();\n\tthis.departmentId = new ReactiveVar(null);\n\tthis.tags = new ReactiveVar(null);\n\tthis.routingConfig = new ReactiveVar({});\n\tthis.department = new ReactiveVar({});\n\tthis.room = new ReactiveVar({});\n\n\tthis.updateVisitor = async (visitorId) => {\n\t\tconst { visitor } = await APIClient.v1.get(`livechat/visitors.info?visitorId=${visitorId}`);\n\t\tthis.user.set(visitor);\n\t};\n\n\tthis.updateRoom = (room) => {\n\t\tthis.departmentId.set(room && room.departmentId);\n\t\tthis.tags.set(room && room.tags);\n\t\tthis.room.set(room);\n\t\tconst visitorId = room && room.v && room.v._id;\n\t\tthis.visitorId.set(visitorId);\n\t\tthis.updateVisitor(visitorId);\n\t};\n\n\tMeteor.call('livechat:getCustomFields', (err, customFields) => {\n\t\tif (customFields) {\n\t\t\tthis.customFields.set(customFields);\n\t\t}\n\t});\n\n\tconst { rid } = Template.currentData();\n\tMeteor.call('livechat:getRoutingConfig', (err, config) => {\n\t\tif (config) {\n\t\t\tthis.routingConfig.set(config);\n\t\t}\n\t});\n\n\tconst loadRoomData = async (rid) => {\n\t\tconst { room } = await APIClient.v1.get(`rooms.info?roomId=${rid}`);\n\t\tthis.updateRoom(room);\n\t};\n\n\tif (rid) {\n\t\tRoomManager.roomStream.on(rid, this.updateRoom);\n\t\tloadRoomData(rid);\n\t}\n\n\tthis.autorun(async () => {\n\t\tif (this.departmentId.get()) {\n\t\t\tconst { department } = await APIClient.v1.get(`livechat/department/${this.departmentId.get()}?includeAgents=false`);\n\t\t\tthis.department.set(department);\n\t\t}\n\t});\n\n\tthis.autorun(() => {\n\t\tconst visitorId = this.visitorId.get();\n\t\tif (visitorId) {\n\t\t\tthis.updateVisitor(visitorId);\n\t\t}\n\t});\n});\n\nTemplate.visitorInfo.onDestroyed(function () {\n\tconst { rid } = Template.currentData();\n\tRoomManager.roomStream.removeListener(rid, this.updateRoom);\n});\n"]},"sourceType":"module","hash":"e247dd88212844b31b1daf4c5933706f680d7096"}
